{"version":3,"file":"../app/api/[[...route]]/route.js","mappings":"4dACA,KACA,EAIA,EADA,8BAAwE,aACxE,yCAA+G,eAAiB,UAAQ,gBAAiB,EAHzJ,GAKA,IAA8B,iBAAiB,EAAE,WACjD,UAA0B,UAAc,IACxC,yCACA,OACA,MACA,YAEA,oBACA,SACA,YAAW,uBACX,EACA,KACA,iBACA,uCAIA,OAHA,MACA,SAEA,CACA,CAAG,GAAI,EAEP,MACA,eAGA,OAFA,SAKA,aACA,SAEA,uBACA,QACA,EAEA,SACA,EAEA,iBAGA,SAFA,EAKA,CACA,EACA,UACA,qBACA,MACA,EAEA,iBCvDA,GACA,wCACA,yBACA,wBACA,sCACA,sBACA,kBACA,cACA,sBACA,0BACA,eACA,kBACA,UACA,eACA,WACA,CAAG,CACH,QACA,EAIA,UACA,KAGA,IACA,cACA,4BACA,iCAEA,qCACA,2BACA,mCAEA,mBACA,kDACA,CAAI,MACJ,MACA,CACA,EA4CA,GACA,YA5CA,QACA,IACA,uCACA,aACA,CAAI,MACJ,MACA,CACA,EAsCA,OArCA,QACA,IACA,MAAmB,QAAS,mBAC5B,aACA,CAAI,MACJ,MACA,CACA,EA+BA,OA9BA,cACA,IACA,0CACA,MACA,OAGA,aAAiB,GAAO,EA5Cf,EA2CT,GA3CoB,WAAgB,MAAS,KAAQ,cA4C7B,CACxB,aACA,KACA,QAEA,CACA,MACA,CAAI,MACJ,MACA,CACA,EAcA,KAbA,cACA,IAEA,QADA,mCACA,wBACA,aACA,CAAI,MACJ,MACA,CACA,CAMA,EAwBA,cACA,EACA,sBACA,WACA,KAGA,IAEA,GADA,SACA,CACA,SACA,sCAAgD,EAAa,IAAI,EAAa,GAE9E,KACA,CACA,CAAM,SACN,SACA,0BAAkC,GAAc,cAEhD,QACA,CACA,CACA,4BAIA,OAHA,aAnCA,gBACA,wDAGA,IACI,QAAS,oCACb,CAAI,SACJ,SACA,4CAEA,CACA,EAyBA,OAEA,CACA,EACA,MACA,OACA,KACA,KACA,eACA,mBACA,mBAEA,EAEA,OADA,SA5DA,GACA,sDACA,yEAEA,2BACA,+CAEA,iDACA,mDAEA,EAkDA,GACA,oBACA,IACA,aACA,mBACA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GAFA,EAMA,CChJO,OACP,OACA,IACA,IACA,CACA,KACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,KACA,IACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,IACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,KACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,CACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,KACA,KACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,IACA,IACA,KACA,IACA,CACA,IACA,IACA,KACA,KACA,IACA,CACA,IACA,IACA,KACA,CACA,IACA,IACA,IACA,KACA,KACA,CACA,IACA,IACA,KACA,IACA,KACA,CACA,IACA,IACA,IACA,CACA,SACA,IACA,IACA,KACA,KACA,CACA,UACA,IACA,KACA,KACA,IACA,CACA,SACA,IACA,IACA,KACA,CACA,UACA,IACA,KACA,IACA,KACA,CACA,SACA,IACA,KACA,IACA,KACA,CACA,SACA,IACA,IACA,KACA,KACA,CACA,SACA,IACA,KACA,IACA,KACA,CACA,SACA,IACA,IACA,KACA,KACA,CACA,SACA,IACA,IACA,KACA,KACA,CACA,SACA,IACA,IACA,KACA,KACA,CACA,SACA,IACA,IACA,KACA,CACA,SACA,IACA,IACA,KACA,CACA,SACA,KACA,KACA,IACA,IACA,CACA,SACA,KACA,IACA,IACA,CACA,SACA,IACA,IACA,KACA,CACA,SACA,IACA,IACA,KACA,CACA,SACA,KACA,IACA,IACA,CACA,SACA,KACA,IACA,IACA,CACA,SACA,KACA,KACA,IACA,IACA,CACA,SACA,KACA,KACA,IACA,IACA,CACA,SACA,KACA,IACA,KACA,IACA,CACA,SACA,KACA,IACA,IACA,CACA,SACA,IACA,KACA,KACA,IACA,EEh4CA,wBAAwD,EAAqB,aAC7E,MAD6E,OAC7E,UAAqD,EAAqB,cAC1E,KAD0E,IAC1E,OACA,OAAa,cACb,CAGA,4DACA,yBACA,uBACA,iCACA,+BACA,6BAEA,SADA,cAEA,qBACA,YACA,0BACA,aACA,mBACA,6BACA,EAEA,KACA,IAQA,YAPA,UAAwB,YAAY,IAAI,eAAe,WAOvD,6BACA,CACA,SACA,IACA,CACA,QAEA,gBACA,wBACA,EAEA,gBACA,gCACA,EACA,IACA,qBAEA,WAEA,QAMA,EAPA,KACA,IAA6B,mBAAuB,IACpD,kBAMA,IARA,IAIA,KACA,WACA,IAEA,MAEA,GADA,WACA,QACA,iDACA,GACA,QACA,uBACA,wDACA,CACA,QACA,EACA,EAEA,EACA,mBAEA,YAEA,QADA,KACA,IAAkD,EAAlD,EAAkD,OAAuB,KACzE,MADA,CACA,iBACA,OACA,CACA,QACA,EACA,IAEA,cACA,uBACA,EAEA,cACA,IAKA,EALA,WACA,oBAGA,sBAEA,gBACA,SACA,SACA,6BACA,QACA,EACA,8BACA,EACA,IAEA,YACA,oBACA,EAEA,YACA,sBACA,EACA,IAEA,YACA,kBACA,EAEA,YACA,sBACA,EAEA,gBACA,sBACA,CAGA,MAEA,gBAA4C,YAAY,IAAI,eAAe,WAC3E,gBAGA,IAFA,EAGA,OAFA,cAEA,SADA,SACA,SACA,CACA,MAGA,gBAEA,IADA,WACA,CACA,IA62BA,EA72BA,SACA,qBA62BA,CADA,EA52BA,IA62BA,WACA,QACA,cACA,QACA,QACA,QACA,QACA,QACA,QACA,cACA,cACA,cACA,cACA,QACA,QACA,QACA,QACA,QACA,SACA,SACA,SACA,SACA,SACA,gBACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,kBACA,kBACA,UACA,UACA,UACA,kBACA,UACA,UACA,UACA,kBACA,kBACA,UACA,UACA,kBACA,kBACA,UACA,UACA,UACA,kBACA,UACA,UACA,kBACA,kBACA,kBACA,kBACA,kBACA,UACA,kBACA,UACA,kBACA,UACA,kBACA,UACA,kBACA,kBACA,kBACA,UACA,UACA,UACA,kBACA,kBACA,kBACA,UACA,UACA,UACA,UACA,kBACA,kBACA,iBACA,UACA,UACA,kBACA,UACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,UACA,kBACA,UACA,kBACA,kBACA,kBACA,UACA,mBACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,oBACA,oBACA,WACA,WACA,oBACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,oBACA,oBACA,oBACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,oBACA,WACA,WACA,WACA,WACA,oBACA,WACA,WACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,WACA,oBACA,oBACA,WACA,WACA,WACA,WACA,oBACA,WACA,WACA,WACA,WACA,WACA,oBACA,WACA,oBACA,WACA,WACA,WACA,WACA,oBACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,oBACA,WACA,oBACA,oBACA,oBACA,WACA,WACA,WACA,oBACA,oBACA,WACA,oBACA,oBACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,oBACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,oBACA,WACA,WACA,WACA,WACA,mBAnmCA,MAEA,UACA,eACA,CACA,wBACA,EAEA,IAAI,EAAM,WACV,gBACA,aAAkC,MAClC,eACA,eAA0B,0BAC1B,6BACA,qBACA,iDACA,mDAsyBA,OApyBA,6BACA,qBACA,4CAEA,iCACA,EACA,yCAEA,IADA,SACA,gBACA,kBACA,WAAkC,KAClC,0BACA,SACA,SAEA,aACA,MACA,YAAuC,IACvC,WAEA,WACA,qCACA,2BACA,YACA,QACA,KAA0B,EAAI,MAC9B,EAD8B,OAC9B,yBACA,CAAiB,CACjB,MACA,WACA,gBACA,iBASA,WACA,iBACA,mBACA,yBACA,SACA,SAEA,aACA,KACA,CACA,6BACA,SACA,SAEA,aACA,MAtBA,MAIA,kBAAsC,EAAS,yEAH/C,KAsBA,CACA,OAAiB,eACjB,EAmBA,mCACA,2BACA,YACA,CADqB,GACrB,sBAEA,GADA,iBACA,kBAEA,OACA,KACA,KAA0B,EAAI,QAC9B,yBACA,kCACA,CAAiB,CACjB,QACA,EAEA,qBAoCA,kBAA8B,EAAS,uCAnCvC,kCACA,SACA,SAEA,YAEA,uBACA,sBAwBA,kBAAkC,EAAS,wCAvB3C,iCACA,kBAAsC,EAAS,uCAE/C,kCAEA,IADA,oBAEA,WAAsC,EAAS,kDAE/C,iBACA,kBAGA,CACA,KACA,KAA8B,EAAI,IAClC,IADkC,EAClC,EACA,WACA,kCACA,CAAqB,CACrB,QACA,EAVA,WAAsC,EAAS,sCAmB/C,EAIA,oCACA,IA4qBA,EA5qBA,gBAEA,IADA,YACA,CADqB,IACrB,UA2qBA,OADA,EA1qBA,cA4qBA,QACA,cACA,QACA,eACA,cACA,QACA,gBACA,gBACA,gBACA,iBACA,kBACA,kBACA,kBACA,oBACA,oBACA,oBACA,oBACA,sBA5rBA,YAEA,0CACA,EACA,uCAGA,IAFA,2BACA,OACA,CACA,4BACA,MACA,KACA,QACA,CACA,iCACA,MACA,KACA,QACA,CACA,sCACA,MACA,KACA,QACA,CACA,KACA,CACA,gCACA,OACA,KAAmB,KAAM,EAAI,2BAA4C,CACzE,QACA,CACA,EACA,oDAsoBA,SAroBA,cACA,kBACA,iBAooBA,GADA,EAjoBA,iBAkoBA,QA9nBA,CA8nBoD,KAjoBpD,YACA,CADyB,GAIzB,EAMA,sCACA,kCACA,YAIA,oBACA,QAIA,OAFA,YACA,YACA,GAEA,UACA,QACA,QACA,SACA,KACA,SACA,qCACA,MAEA,WACA,SACA,WACA,CACA,YACA,CADqB,GACrB,gBAGA,CAHwC,GACxC,YAEA,gBACA,kBACA,UACA,oBACA,WAEA,gBAEA,CAEA,YACA,KACA,MAGA,UAEA,WACA,CACA,wBACA,EACA,2CACA,gBACA,YAEA,yBACA,QACA,SACA,QACA,qCACA,SAA6B,IAC7B,MAGA,YACA,KAEA,EACA,wCACA,2BAGA,GAFA,YACA,CADqB,GACrB,EAD0B,QAC1B,GACA,aACA,kBAA8B,EAAS,yDAEvC,YAAqC,CAArC,QAEA,OADA,YACA,WAA8B,EAAS,0CAGvC,6CACA,MACA,kBAA8B,EAAS,8CAGvC,GADA,iBACA,aACA,kBAA8B,EAAS,yDAEvC,oBAEA,SAEA,KAF0B,EAC1B,YACA,CAD6B,IAE7B,CAFkC,KAGJ,EAAI,SAElC,QACA,kCACA,CAAqB,CACrB,QACA,CAGA,SAGA,GAFA,YACA,CAD6B,GAC7B,aACA,aACA,kBAAsC,EAAS,yDAE/C,yCAEA,SACA,kBAAkC,EAAS,6CAC3C,CACA,EAKA,iDACA,2BACA,gBACA,oBACA,aAIA,OAHA,eAGA,CAAiB,iBADjB,IADA,qBAEiB,CACjB,EACA,mDAKA,IAJA,EAIA,uBACA,yCACA,uBACA,UACA,OAEA,kBAAkC,EAAS,4BAC3C,cACA,WACA,WAIA,iBACA,WACA,qBACA,iBACA,2BACA,uCACA,SACA,SAEA,eACA,gBACA,kBAA0C,EAAS,oEAGnD,GAAyC,sBADzC,yBACyC,CACzC,CACA,oCACA,SACA,SAEA,gCAEA,wCAEA,0BACA,iBACA,4DACA,SACA,SAEA,OACA,KAAmC,KAAM,EAAI,sCAAgE,CAC7G,QACA,CACA,CAEA,gBACA,kBAA8C,EAAS,6BAEvD,ILhhBA,EKghBA,GAIA,cACA,GD1hBO,cC0hBqD,IDxhB5D,IADA,KACA,IAA6B,WAA8B,KAC3D,kBACA,YAEA,IADA,QACA,cACA,mBACA,IACA,IAEA,cACA,iBAEA,WAyBA,GACA,IAyBA,EAzBA,cASA,GARA,YAEA,cAEA,qBAEA,oBAEA,EACA,UACA,UACA,SACA,WACA,SACA,WACA,SACA,WACA,SACA,SACA,gCACA,CAGA,iBASA,MAPA,YACA,wBAMA,CAJqB,CAAQ,SACrB,CAAQ,SACR,CAAQ,uBACR,CAAQ,QAChB,GACA,EA5DA,GAIA,IAHA,kBACA,MAEA,QACA,GANA,IAQA,aACA,KAEA,KACA,QACA,OAGA,IAEA,CACA,QACA,ECyf4D,gBAE5D,OACA,KAAkC,EAAa,SAC/C,EAD+C,MAC/C,EACA,yBACA,yCL3hBA,KACA,wBACA,eACA,aAEA,QACA,0CACA,KAEA,SACA,iCACA,KACA,SACA,QACA,QACA,QACA,gFAEA,SACA,QACA,8DAEA,SACA,QACA,2DACA,KAEA,SACA,QACA,2DACA,SACA,iCACA,KACA,SACA,QACA,QACA,6EAEA,SACA,8CACA,KACA,SACA,OACA,iEAEA,kDACA,KACA,SACA,OACA,iEAEA,kDACA,KAEA,SACA,YACA,KACA,SACA,QACA,8EAEA,SACA,kBACA,kCACA,KACA,SACA,kBACA,kCACA,KACA,SACA,kBACA,kCACA,KACA,SACA,kBACA,kCACA,KACA,SACA,QACA,QACA,oFAEA,SACA,oCACA,KAEA,SACA,oCACA,KACA,SACA,QACA,8EAEA,SACA,kCACA,KACA,SACA,QACA,QACA,QACA,QACA,QACA,wFACA,CACA,QACA,CAAK,EACL,GKmbA,EAAoC,EAGpC,OACA,KAAmC,KAFnC,WAAwD,EAAI,KAAQ,EAAI,CAAZ,GAAY,CAErC,GAFqC,GAErC,qBAA8D,CACjG,QACA,CAEA,CAEA,OACA,KACA,kBAC8B,EAAI,OAClC,CADkC,QAClC,EACkC,EAAI,KACJ,EAAI,CADA,GACA,CACtC,GADsC,GACtC,EACA,WACA,6CACA,CAAqB,CACrB,QACA,CAEA,cACA,oBACA,aAIA,2BAEA,GADA,iBACA,kBACA,kBAAsC,EAAS,mCAAmE,cAAQ,GAAG,MAE7H,iBASA,uCACA,IACA,qCACA,qBACA,kBAA0C,EAAS,kFAEnD,iBACA,kCAA6D,EAAS,oCAAsC,EAAS,sCACrH,SACA,SAGA,iBACA,mCACA,QAEA,kDACA,SACA,SAEA,oCACA,SACA,SAEA,gCACA,gBACA,OACA,KACA,KAAkC,EAAI,OACtC,CADsC,KACtC,EACA,iBACA,UACA,CAAyB,CACzB,QACA,EAGA,OACA,KACA,KAAkC,EAAI,OACtC,CADsC,KACtC,EACA,iBACA,SACA,6CACA,UACA,CAAyB,CACzB,QACA,CAGA,SACA,kBAAkC,EAAS,6BAC3C,CACA,EACA,qDAGA,uBAAqD,CAArD,QACA,WAA8B,EAAS,0DAEvC,YACA,CAAiB,iBACjB,EAIA,qDAGA,IAFA,QACA,uBACA,eAEA,OADA,aAEA,QAGA,YACA,2BACA,wBACA,kBAA0C,EAAS,4DAEnD,YACA,KAEA,UACA,KAD8B,IAE9B,QACA,KAEA,UACA,UAIA,OACA,+CACA,QACA,EANA,KAQA,KAEA,SACA,WAEA,CAEA,OACA,+CACA,QACA,CACA,EACA,wDACA,SACA,IACA,EHrsBO,YACP,gBACA,CGmsBkD,KHnsBlD,yCAOA,QAJA,IACA,MAAe,GACf,mBAA+B,WADC,IACD,GAAsB,EACrD,KACA,IAAoD,EAApD,EAAoD,OAA4B,KAEhF,MAFA,CACA,IACA,WACA,gBACA,uCAGA,QADA,oBACA,IAA8C,WAAuB,IAErE,OAFA,CACA,IACA,OACA,uCAGA,QAAsB,iBAA8B,CACpD,CACA,QACA,EG4qBkD,EAClD,CACA,SACA,kBAA8B,EAAS,0BACvC,CACA,OACA,KACA,KAAsB,EAAa,OACnC,IADmC,GACnC,EACA,WACA,wCACsB,SH5jBf,GAEP,OG0jByC,CH3jBzC,KACA,IAAwC,EAAxC,EAAwC,OAAsB,KAC9D,WACA,eACA,cACA,QACA,kBACA,QACA,aACA,kBACA,YACA,QACA,gBACA,mBACA,wBACA,QACA,iBACA,SACA,iBACA,QACA,yBACA,QACA,0BACA,QACA,oBACA,WACA,eACA,oBArJA,sBAsJA,QACA,qBACA,QACA,qBACA,yBACA,QACA,oBACA,SACA,qBACA,wBACA,QACA,kBACA,EAAyB,cAAQ,CAAC,cAAQ,CAAC,cAAQ,GAAG,KAAa,sBAAwB,iCAA8C,MAAQ,cAAQ,CAAC,cAAQ,GAAG,UAAsC,GAAI,GAC/M,QACA,mBACA,EAAyB,cAAQ,CAAC,cAAQ,CAAC,cAAQ,GAAG,KAAa,uBAAyB,iCAA8C,MAAQ,cAAQ,CAAC,cAAQ,GAAG,UAAsC,GAAI,GAChN,QACA,uBACA,sBACA,QAEA,yBACA,iCACA,uBACA,QACA,wBACA,yBACA,sBACA,QACA,4BACA,yBACA,qBACA,QACA,2BACA,2BACA,QACA,aACA,iCACA,QACA,2BACA,uBACA,QACA,6BACA,sBACA,QACA,0BACA,uBACA,QACA,wBACA,wBACA,QACA,+BACA,0BACA,QACA,+BACA,2BACA,QACA,6BACA,4BACA,QAEA,qBACA,sBACA,6EAEA,6CACA,KACA,qCAEA,QACA,uEAEA,KACA,gEAEA,QACA,CAAiB,EACjB,QACA,CAEA,mBACA,qCACA,QACA,CACA,mBAIA,sBACA,kFAEA,uCAkBA,MAhBA,QACA,iCAGA,cACA,iCAGA,MACA,iCACA,4CAGA,iCACA,kCAEA,EACA,CAAa,EACb,mBAEA,QACA,EAAyB,cAAQ,CAAC,cAAQ,GAAG,KAAa,qCAAuC,EAEjG,GACA,GAAyB,cAAQ,CAAC,cAAQ,GAAG,WAE7C,QACA,CAEA,mBACA,EAAqB,cAAQ,CAAC,cAAQ,GAAG,eACzC,QACA,CACA,eACA,IACA,GAAqB,cAAQ,CAAC,cAAQ,GAAG,QAEzC,eA1MA,GAEA,MAaA,GAZA,wBACA,GACA,sBACA,EACA,cAEA,aACA,GACA,qBACA,EACA,cAEA,GACA,mBASA,GARA,UACA,uBACA,cAEA,WACA,2BACA,cAEA,WACA,wDAEA,iCAEA,QACA,EA2KA,OACA,IACA,GAAqB,cAAQ,CAAC,cAAQ,GAAG,OAEzC,CACA,QACA,EGuZyC,GACzC,EAAwB,CACX,CACb,QACA,CACA,EAWA,4DASA,IAPA,IADA,EACA,KACA,KACA,UACA,yBAIA,CACA,iBACA,2BACA,mCAEA,kCAA6D,EAAS,gCAAkC,EAAS,kCACjH,SACA,SAEA,4BACA,4CACA,MAEA,KAEA,CAEA,YACA,+BACsB,EAAS,mCACT,EAAS,qCAE/B,cACA,OAKA,iBACA,2BACA,kBAA+B,GAC/B,+BACsB,EAAS,yCACT,EAAS,uFAE/B,iCACA,SACA,SAEA,oCACA,SACA,SAEA,QACA,EACA,CACA,YACA,kCACA,CAAiB,CACjB,EAEA,SAEA,iBACA,iEAEA,aACA,wBACkB,EAAS,gCACT,EAAS,8EAE3B,6BACA,WAA8B,EAAS,mEAEvC,CAAiB,eACjB,EACA,iDACA,QACA,uBACA,kBAEA,kBACA,OAIA,IAFA,SACA,IACA,gBACA,kBACA,gBACA,KACA,cACA,iBAGA,KAEA,CACA,uCACA,EAIA,EADA,MAIA,CAAiB,gBAFjB,gBAJA,eAOA,EACA,8BACA,6BAEA,6BACA,4CAEA,qCAEA,OACA,4BACA,wBACA,2BACA,CACA,EAKA,4BACA,2BACA,0BACA,4BAEA,wBACA,cACA,4EAEA,QACA,EACA,gCACA,OACA,SACA,KACA,OACA,qBACA,UACA,CAAa,CAEb,EAEA,4BACA,kBAGA,iBACA,SACA,sBACA,uBACA,0BAGA,wBAEA,mCAEA,EAOA,+BACA,oCACA,YAA4B,WAAmB,IAC/C,YAEA,QACA,CACA,QACA,EAKA,kCACA,oBACA,mCACA,MACA,eACA,KAGA,iCACA,GAEA,EAKA,+BACA,mBACA,qHAGA,IADA,oCACA,CACA,oBACA,SACA,MAEA,OACA,kFAGA,GADA,YACA,aACA,KAEA,CACA,EAEA,iCACA,oCACA,WAEA,EAKA,4BACA,gBACA,YAEA,kBACA,gBACA,4CACA,qBACA,EACA,CACA,CAAC,GAOD,cACA,sBACA,YACA,CA8BA,cACA,oBACA,QACA,SACA,kBACA,UACA,QACA,CEp+BO,iBACP,aAA2B,MAE3B,UAAqB,EAAM,EAD3B,EAAW,OACgB,MADhB,CAAQ,EAAG,+CAAuD,KAClD,QAC3B,UACA,kBAAgC,CAAS,aAKzC,OAHA,0BAEA,gCACA,CACA,CAIA,MAHA,oCAjCA,cACA,sBAEA,GADA,kBACY,EAAe,IAAQ,EAAe,GAClD,UAD2B,GAC3B,GADkD,MAClD,CACA,6BACA,2BAGiB,EAAe,IAAQ,EAAgB,UAGxD,CAAkB,EAAa,CAHyB,GAGjB,EAAa,KACxC,EAAkB,IADC,GACD,EAC9B,CAFoD,MACtB,EAC9B,eAEiB,EAAY,IAC7B,YAD6B,CAG7B,CAAK,CACL,EAcA,OAEA,KACA,ECvCA,YAEA,gCAEA,gCAEA,qCACA,CAAC,UAA8B,EAC/B,mBAEA,kBACA,2BAGA,OAFA,SACA,oBACA,CACA,CAIA,MAVI,eAAS,MAOb,gCACA,qEACA,EACA,CACA,CAAC,QAED,eAEA,oBACA,yJAEA,MAJI,eAAS,MAIb,CACA,CAAC,KAED,eAEA,kBACA,mGAEA,MAJI,eAAS,MAIb,CACA,CAAC,KAED,eAEA,gBACA,8IAEA,MAJI,eAAS,MAIb,CACA,CAAC,KCtBM,eACP,0BACA,CAEO,wBAEP,GAEA,iBAA4B,EAAgB,MAC5C,OACA,CAF4C,KAG5C,UACA,iBACa,CACb,CAGA,QADA,KACA,IAAkC,EAAlC,EAAkC,OAAmB,KACrD,MADA,CACA,IAEA,GAAY,EAAgB,IAC5B,QACA,EAF4B,GAE5B,UACA,cACa,EACb,QACA,CAGA,GXiBA,CWjBY,CXiBZ,OAAuB,EAAI,IWjBD,CXiBC,CWjBD,CAC1B,CXgB2B,SWhB3B,UACA,QACA,eACA,oCACA,CAAiB,EAEjB,QACA,CACA,cAEA,gBACA,UAAsB,GAAiB,KAEvC,SAFuC,CAEvC,CACA,GAA6B,CAAjB,CXhBZ,OAAuB,EAAI,SWgBE,CAC7B,GAD6B,UAC7B,8BACA,GACA,uCACA,UACA,IAEA,QACA,2CACA,OACA,CAAa,EACb,QACA,CAIA,GAAY,EAAa,IACzB,aADyB,GACzB,eACA,gBACkB,EAAkB,SACpC,OADoC,CACpC,cACA,OACA,QACA,eACA,QACA,uBACA,SACA,CAAa,EACb,QACA,CACA,GAAY,EAAa,IACzB,aADyB,GACzB,eACA,gBACkB,EAAkB,SACpC,sBACA,cACA,QACA,eACA,QACA,uBACA,SACA,CAAa,EACb,QACA,CACA,GAAY,EAAe,IAC3B,eAD2B,CAC3B,eACA,kBACkB,EAAgB,SAClC,KADkC,EAClC,eACA,MACA,aACA,IAEA,YAEA,QACA,eACA,QACA,qBACA,SACA,CAAa,EACb,QACA,CACA,GAAY,EAAY,IACxB,YADwB,IACxB,WACA,OACA,UACA,UAA0B,GAAqB,gBAG/C,EAH+C,EAG/C,IADA,gBACA,gBAA2D,eAAiB,EAC5E,mBACA,QAEA,iCACA,OACA,2CACA,OACA,CACA,CAAa,EACb,CACA,GAAY,EAAe,IAC3B,eAD2B,CAC3B,oBACA,MACA,UAA0B,GAAiB,oCAE3C,oCACA,QACA,CACA,GAAY,EAAe,IAC3B,eAD2B,CAC3B,eACA,OACA,qBACA,UAA8B,GAAW,kHAAsH,EAAS,oBAExK,QACA,kBAA+C,kBAAqB,EACpE,wBACA,gCAEA,MACA,UAA0B,GAAiB,oCAE3C,oDACA,QACA,CACA,CACA,OAvKA,WAuKA,EApKA,uBACA,oBASA,OARA,GACA,oBACA,mBAIA,iBAHA,UAKA,CACA,CAAK,IA0JL,CCpJA,eACA,OACA,kBACA,OACA,gBACA,WACA,CAAiB,CACjB,kBACA,MACA,CAAiB,CAEjB,CACA,CACA,EDtCA,YACA,yBACA,sBACA,CAAC,UAA8B,EC8E/B,kBACA,oBACA,aAAkC,mBAClC,IApEA,EAuBA,EA6CA,OA0CA,GAzCA,qBACA,SAAsB,CACtB,WAAwB,CACxB,cACA,EACA,wBACA,yBAEA,gBACA,kBAEA,6BASA,OARA,UACA,SAAkC,EAAS,SAC3C,+BAIA,uBAHA,gBAKA,CACA,CAAa,YACb,YACA,SAEA,CACA,EACA,+BACA,OAAmB,GAAa,0DAChC,EACA,gCACA,MACA,OACA,yDACA,mDACa,EAEb,uBAAoC,cAEpC,eACA,uCACA,oBAEA,GADA,eACA,WACA,+FAEA,WAA+B,iBAA0C,YAAM,mBAE/E,sBAA0D,cAAQ,CAAC,cAAQ,GAAG,KAAgB,2BAA6B,EAC3H,MAEA,WAEA,4BACA,iEAIA,eA/HA,EA+HA,UA9HA,EAGA,wCAbA,IAeA,OADA,MAdA,EAcA,KAbA,CADA,EAcA,MAVW,cAAQ,CAAC,cAAQ,CAAC,cAAQ,GAAG,MAAW,OAAa,sCAEhE,OADA,KAAiB,cAAQ,CAAC,cAAQ,GAAG,eAAsB,EAC3D,CACA,CAAK,GAAI,GALT,GAaA,CACA,CAAK,CAAE,cAAQ,GAAG,KALlB,GA8HA,gBACA,kBAzGA,UADA,EA0GA,uBAzG4B,GAC5B,SAAkB,CAClB,WAAoB,CACpB,cAAuB,CACvB,EACA,CACA,gBAAyB,aAAO,YAGhC,QAFA,EACA,KACA,IAA6B,mBAAuB,IACpD,kBAEA,8CAAgE,mBAAa,iBAC7E,CAAS,EACT,mBACA,SAAsB,YAAU,UACvB,EACT,kBAA2B,aAAO,YAGlC,QAFA,EACA,KACA,IAA6B,mBAAuB,IACpD,kBAEA,gDAAkE,mBAAa,iBAC/E,CAAS,EACT,qBACA,SAAsB,YAAU,UACvB,EACT,eAAwB,aAAO,YAG/B,QAFA,EACA,KACA,IAA6B,mBAAuB,IACpD,kBAEA,6CAA+D,mBAAa,iBAC5E,CAAS,EACT,wBACA,SAAsB,YAAU,SAChC,CAAS,CACT,EAmEA,CAsFA,OArFA,yCACA,eAKA,OAJA,yBACA,yBACA,kDAEA,uBACA,CAAS,CACT,cACA,eACA,CAAK,EACL,6BACA,4BACA,yBAGA,yDAEA,YADA,WACA,KAEA,2BACA,EACA,UAAgC,GAIhC,EAJqC,OAIrC,EACA,QACA,SACA,uBACA,CAAa,CACb,UACA,gBACA,CAAa,CACb,SACA,eACA,CAAa,CACJ,CACT,MACA,OACA,gBACA,cACA,cACA,CAAa,CACb,QACA,cACA,cACA,cACA,CAAa,CACb,MACA,aACA,cACA,cACA,CAAa,CACb,MACA,eACA,aACA,cACA,cACA,CAAa,CACJ,CACT,MACA,OACA,eACA,gBACA,CAAa,CACb,QACA,eACA,iBACA,gBACA,CAAa,CACb,MACA,eACA,iBACA,iBACA,oBACA,CAAa,CACb,MACA,eACA,iBACA,iBACA,oBACA,CAAa,CACJ,EAET,CACA,CAAC,GClOD,OAAe,iBAAiB,EAAC,2uBCVjC,yGCAA,4DCGO,gBACP,2BACA,iCAEA,MADA,0BAkCA,cACA,IAJA,IAIA,mBACA,OALA,EAKA,iBALA,EAKA,aAJA,OAIA,OAJA,IAKA,CArCA,EACA,GACA,QACA,YACA,CAAK,CACL,CAOA,oBACA,MAHA,MAGA,GAHA,iBAGA,GAHA,YAAuF,MAGvF,SACA,WAKA,OAJA,aACA,iBACA,YAEA,CACA,CACA,kBACA,8CACA,OACA,WAKA,OAJA,aACA,kBACA,YAEA,CACA,gDAiBA,iBACA,gCACA,EAIA,aACA,aACA,8BACA,CAOA,OANA,4BACA,sBAEA,8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ADlD,mCAAwM,YAAc,GAEtN,gBAAwB,OAAY,iBAAsB,iCAAqC,4BAA2C,GAAM,mBAChJ,gBAA0B,KAAM,GAChC,CAAqB,EAArB,EADgC,SACX,oEADW,CAAiB,SAAY,cAE7D,cAA4B,YAC5B,cAA2B,aAC3B,gBAA0B,4CAC1B,CAEO,cACP,QACA,WAAe,iCAA6C,QAAU,4CAAsD,YAAc,GAC1I,gBAAwB,sBAA6B,cAAoB,0BAAuC,UAAkB,EAClI,CAEO,cACP,iFACA,gCACA,+BAAyG,qEAAuF,YAAc,IAC9M,cAAqB,uBAA8B,qCACnD,QADmG,EACnG,EADmG,EACnG,EADmG,iBACxD,gBADwD,SACxD,iBAAsC,GAAU,eAAmB,EAAI,GADf,CAAwD,GAE3J,CAEO,gBAEP,OADA,sBAA+B,+BAAuC,QAAY,EAAY,GAAP,EAAO,GAC9F,CACA,CAEA,kCACA,mCAAwC,sBAA4B,CACpE,CAAC,eACD,WACA,EAEA,cAMA,MALA,2CACA,SACA,0EACA,QACA,GACA,EACA,EAEO,cACP,4BACA,SACA,8BAAqD,WAAc,kCAEnE,OADA,OACA,CACA,CAEO,cACP,0BAA2C,UAC3C,CAEO,oBACP,gFACA,wIACA,oDACA,CAEO,sBACP,6DACA,gFACA,uIACA,kDACA,CAEO,gBACP,gHACA,yCACA,CAEO,kBACP,gBAEA,IADA,gFAEA,MACA,+EACA,yBAEA,eACA,qEACA,oBACA,QACA,CACA,iEACA,kBAAsC,IAAM,aAAoB,SAAY,4BAC5E,cAAqB,0BAA8C,CACnE,MACA,GACA,cAAqB,SAAa,EAElC,QACA,CAEA,yEACA,eACA,0DACA,EAEO,cACP,cACA,iFACA,aACA,CACA,UAkBA,OAjBA,aACA,sBACA,IACA,wEACA,cACA,8BACA,6DAAgG,OAAT,KAAS,IAAgB,CAChH,MACA,IACA,CACA,SACA,IACA,CAEA,qEACA,2BACA,GAEA,CAEO,sBACP,uCACA,iFACA,+DACA,CAAO,EAEP,CACA,CAEA,MAAe,CACf,YACA,WACA,SACA,aACA,UACA,eACA,oBACA,YACA,oBACA,aACA,YACA,cACA,kBACA,eACA,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","sources":["webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/utils/accept.js","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/language/language.js","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/language/index.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/_virtual/_rollupPluginBabelHelpers.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/routing/config.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/shared/utils.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/shared/constants.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/server/react-server/RequestLocaleCache.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/server/react-server/RequestLocale.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/server/react-server/RequestLocaleLegacy.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/server/react-server/getRequestConfig.js","webpack://@hijraah/web/./src/i18n/request.ts","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/server/react-server/getConfig.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/server/react-server/getLocale.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/react-server/ServerLink.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/shared/redirects.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/react-server/redirects.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/react-server/createSharedPathnamesNavigation.js","webpack://@hijraah/web/./src/i18n/navigation.ts","webpack://@hijraah/web/./src/i18n/server.ts","webpack://@hijraah/web/./src/i18n/index.ts","webpack://@hijraah/web/./src/app/api/middleware/language.ts","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/after-task-async-storage.external.js\"","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/pretty-json/index.js","webpack://@hijraah/web/./src/app/api/routes/auth.ts","webpack://@hijraah/web/external commonjs2 \"module\"","webpack://@hijraah/web/external commonjs \"next/dist/compiled/next-server/app-page.runtime.prod.js\"","webpack://@hijraah/web/./src/app/api/middleware/subscription-rate-limit.ts","webpack://@hijraah/web/external commonjs2 \"punycode\"","webpack://@hijraah/web/../../node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.es6.mjs?0c86","webpack://@hijraah/web/./src/lib/actions/admin.ts","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/error.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/types.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/regex.generated.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-skeleton-parser@1.8.14/node_modules/@formatjs/icu-skeleton-parser/lib/date-time.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-skeleton-parser@1.8.14/node_modules/@formatjs/icu-skeleton-parser/lib/regex.generated.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-skeleton-parser@1.8.14/node_modules/@formatjs/icu-skeleton-parser/lib/number.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/time-data.generated.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/date-time-pattern-generator.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/parser.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/manipulator.js","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+icu-messageformat-parser@2.11.2/node_modules/@formatjs/icu-messageformat-parser/lib/index.js","webpack://@hijraah/web/../../node_modules/.pnpm/intl-messageformat@10.7.16/node_modules/intl-messageformat/lib/src/error.js","webpack://@hijraah/web/../../node_modules/.pnpm/intl-messageformat@10.7.16/node_modules/intl-messageformat/lib/src/formatters.js","webpack://@hijraah/web/../../node_modules/.pnpm/intl-messageformat@10.7.16/node_modules/intl-messageformat/lib/src/core.js","webpack://@hijraah/web/../../node_modules/.pnpm/intl-messageformat@10.7.16/node_modules/intl-messageformat/lib/index.js","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/action-async-storage.external.js\"","webpack://@hijraah/web/external commonjs2 \"process\"","webpack://@hijraah/web/../../node_modules/.pnpm/@formatjs+fast-memoize@2.2.7/node_modules/@formatjs/fast-memoize/lib/index.js","webpack://@hijraah/web/./src/app/api/routes/admin.ts","webpack://@hijraah/web/external commonjs2 \"os\"","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/timing/timing.js","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/timing/index.js","webpack://@hijraah/web/../../node_modules/.pnpm/next@15.3.0-canary.31_@babe_be67f368de2727c847f3a61f5e6cf4fa/node_modules/next/dist/server/app-render/encryption.js","webpack://@hijraah/web/?5702","webpack://@hijraah/web/external commonjs2 \"stream\"","webpack://@hijraah/web/external commonjs2 \"util\"","webpack://@hijraah/web/../../node_modules/.pnpm/next@15.3.0-canary.31_@babe_be67f368de2727c847f3a61f5e6cf4fa/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js","webpack://@hijraah/web/./src/i18n/i18n.ts","webpack://@hijraah/web/external commonjs2 \"fs\"","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/work-async-storage.external.js\"","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/cors/index.js","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/adapter/vercel/handler.js","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/cache/index.js","webpack://@hijraah/web/external node-commonjs \"node:child_process\"","webpack://@hijraah/web/./src/app/api/routes/users.ts","webpack://@hijraah/web/external commonjs2 \"path\"","webpack://@hijraah/web/../../../../src/shared/lib/router/utils/app-paths.ts","webpack://@hijraah/web/./src/app/api/routes/immigration.ts","webpack://@hijraah/web/external commonjs2 \"tls\"","webpack://@hijraah/web/?20d7","webpack://@hijraah/web/./src/app/api/hono/middleware/sentry-error-logger.ts","webpack://@hijraah/web/?9ad6","webpack://@hijraah/web/external commonjs2 \"diagnostics_channel\"","webpack://@hijraah/web/external node-commonjs \"node:http\"","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/shared/constants.js?6a46","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/react-client/useLocale.js","webpack://@hijraah/web/external node-commonjs \"node:zlib\"","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/utils/color.js","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/middleware/logger/index.js","webpack://@hijraah/web/./src/lib/redis.ts","webpack://@hijraah/web/external node-commonjs \"node:tls\"","webpack://@hijraah/web/external node-commonjs \"node:https\"","webpack://@hijraah/web/external commonjs \"next/dist/compiled/next-server/app-route.runtime.prod.js\"","webpack://@hijraah/web/external node-commonjs \"node:os\"","webpack://@hijraah/web/./src/_core/documents/entities/document.ts","webpack://@hijraah/web/./src/services/case-application-service.ts","webpack://@hijraah/web/./src/app/api/routes/cases.ts","webpack://@hijraah/web/../../node_modules/.pnpm/hono@4.8.2/node_modules/hono/dist/utils/ lazy strict namespace object","webpack://@hijraah/web/../../../../src/shared/lib/page-path/ensure-leading-slash.ts","webpack://@hijraah/web/external node-commonjs \"node:diagnostics_channel\"","webpack://@hijraah/web/../../../src/server/app-render/encryption-utils.ts","webpack://@hijraah/web/external commonjs2 \"crypto\"","webpack://@hijraah/web/external commonjs2 \"https\"","webpack://@hijraah/web/external node-commonjs \"node:stream\"","webpack://@hijraah/web/external node-commonjs \"node:util\"","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/shared/utils.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/shared/syncLocaleCookie.js","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/shared/BaseLink.js","webpack://@hijraah/web/../../node_modules/.pnpm/use-intl@3.26.5_react@18.3.1/node_modules/use-intl/dist/production/initializeConfig-AbYTngyP.js","webpack://@hijraah/web/./src/app/api/routes/profile.ts","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/work-unit-async-storage.external.js\"","webpack://@hijraah/web/../../node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.es6.mjs","webpack://@hijraah/web/../../node_modules/.pnpm/use-intl@3.26.5_react@18.3.1/node_modules/use-intl/dist/production/core.js","webpack://@hijraah/web/./src/i18n/hooks.ts","webpack://@hijraah/web/external node-commonjs \"node:fs\"","webpack://@hijraah/web/?f080","webpack://@hijraah/web/../../../../src/build/webpack/loaders/next-flight-loader/action-validate.ts","webpack://@hijraah/web/external commonjs2 \"worker_threads\"","webpack://@hijraah/web/external commonjs2 \"zlib\"","webpack://@hijraah/web/external commonjs2 \"perf_hooks\"","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/_virtual/_rollupPluginBabelHelpers.js?8abd","webpack://@hijraah/web/external node-commonjs \"node:worker_threads\"","webpack://@hijraah/web/src/app/api/[[...route]]/route.ts","webpack://@hijraah/web/sentry-wrapper-module","webpack://@hijraah/web/external node-commonjs \"node:path\"","webpack://@hijraah/web/external node-commonjs \"node:net\"","webpack://@hijraah/web/../../node_modules/.pnpm/use-intl@3.26.5_react@18.3.1/node_modules/use-intl/dist/production/createFormatter-CZeYe_QF.js","webpack://@hijraah/web/external node-commonjs \"node:crypto\"","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/shared/utils.js?2850","webpack://@hijraah/web/../../node_modules/.pnpm/next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596/node_modules/next-intl/dist/esm/navigation/shared/LegacyBaseLink.js","webpack://@hijraah/web/external commonjs2 \"buffer\"","webpack://@hijraah/web/external commonjs2 \"url\"","webpack://@hijraah/web/external commonjs2 \"child_process\"","webpack://@hijraah/web/external node-commonjs \"node:readline\"","webpack://@hijraah/web/external commonjs2 \"http\"","webpack://@hijraah/web/external commonjs2 \"tty\"","webpack://@hijraah/web/external commonjs2 \"async_hooks\"","webpack://@hijraah/web/external module \"ai\"","webpack://@hijraah/web/external node-commonjs \"node:inspector\"","webpack://@hijraah/web/./src/_infrastructure/repositories/case-repository.ts","webpack://@hijraah/web/./src/_infrastructure/repositories/document-repository.ts","webpack://@hijraah/web/./src/_infrastructure/repositories/user-profile-repository.ts","webpack://@hijraah/web/./src/_infrastructure/repositories/index.ts","webpack://@hijraah/web/external commonjs2 \"net\"","webpack://@hijraah/web/external commonjs2 \"events\"","webpack://@hijraah/web/./src/app/api/routes/subscription.ts","webpack://@hijraah/web/./src/app/api/routes/documents.ts","webpack://@hijraah/web/./src/i18n/locales/ ./src/i18n/locales/ lazy ^\\.\\/.*\\.json$ namespace object","webpack://@hijraah/web/./src/_core/chat/services/chat-service.ts"],"sourcesContent":["// src/utils/accept.ts\nvar parseAccept = (acceptHeader) => {\n  if (!acceptHeader) {\n    return [];\n  }\n  const acceptValues = acceptHeader.split(\",\").map((value, index) => ({ value, index }));\n  return acceptValues.map(parseAcceptValue).filter((item) => Boolean(item)).sort(sortByQualityAndIndex).map(({ type, params, q }) => ({ type, params, q }));\n};\nvar parseAcceptValueRegex = /;(?=(?:(?:[^\"]*\"){2})*[^\"]*$)/;\nvar parseAcceptValue = ({ value, index }) => {\n  const parts = value.trim().split(parseAcceptValueRegex).map((s) => s.trim());\n  const type = parts[0];\n  if (!type) {\n    return null;\n  }\n  const params = parseParams(parts.slice(1));\n  const q = parseQuality(params.q);\n  return { type, params, q, index };\n};\nvar parseParams = (paramParts) => {\n  return paramParts.reduce((acc, param) => {\n    const [key, val] = param.split(\"=\").map((s) => s.trim());\n    if (key && val) {\n      acc[key] = val;\n    }\n    return acc;\n  }, {});\n};\nvar parseQuality = (qVal) => {\n  if (qVal === void 0) {\n    return 1;\n  }\n  if (qVal === \"\") {\n    return 1;\n  }\n  if (qVal === \"NaN\") {\n    return 0;\n  }\n  const num = Number(qVal);\n  if (num === Infinity) {\n    return 1;\n  }\n  if (num === -Infinity) {\n    return 0;\n  }\n  if (Number.isNaN(num)) {\n    return 1;\n  }\n  if (num < 0 || num > 1) {\n    return 1;\n  }\n  return num;\n};\nvar sortByQualityAndIndex = (a, b) => {\n  const qDiff = b.q - a.q;\n  if (qDiff !== 0) {\n    return qDiff;\n  }\n  return a.index - b.index;\n};\nexport {\n  parseAccept\n};\n","// src/middleware/language/language.ts\nimport { setCookie, getCookie } from \"../../helper/cookie/index.js\";\nimport { parseAccept } from \"../../utils/accept.js\";\nvar DEFAULT_OPTIONS = {\n  order: [\"querystring\", \"cookie\", \"header\"],\n  lookupQueryString: \"lang\",\n  lookupCookie: \"language\",\n  lookupFromHeaderKey: \"accept-language\",\n  lookupFromPathIndex: 0,\n  caches: [\"cookie\"],\n  ignoreCase: true,\n  fallbackLanguage: \"en\",\n  supportedLanguages: [\"en\"],\n  cookieOptions: {\n    sameSite: \"Strict\",\n    secure: true,\n    maxAge: 365 * 24 * 60 * 60,\n    httpOnly: true\n  },\n  debug: false\n};\nfunction parseAcceptLanguage(header) {\n  return parseAccept(header).map(({ type, q }) => ({ lang: type, q }));\n}\nvar normalizeLanguage = (lang, options) => {\n  if (!lang) {\n    return void 0;\n  }\n  try {\n    let normalizedLang = lang.trim();\n    if (options.convertDetectedLanguage) {\n      normalizedLang = options.convertDetectedLanguage(normalizedLang);\n    }\n    const compLang = options.ignoreCase ? normalizedLang.toLowerCase() : normalizedLang;\n    const compSupported = options.supportedLanguages.map(\n      (l) => options.ignoreCase ? l.toLowerCase() : l\n    );\n    const matchedLang = compSupported.find((l) => l === compLang);\n    return matchedLang ? options.supportedLanguages[compSupported.indexOf(matchedLang)] : void 0;\n  } catch {\n    return void 0;\n  }\n};\nvar detectFromQuery = (c, options) => {\n  try {\n    const query = c.req.query(options.lookupQueryString);\n    return normalizeLanguage(query, options);\n  } catch {\n    return void 0;\n  }\n};\nvar detectFromCookie = (c, options) => {\n  try {\n    const cookie = getCookie(c, options.lookupCookie);\n    return normalizeLanguage(cookie, options);\n  } catch {\n    return void 0;\n  }\n};\nfunction detectFromHeader(c, options) {\n  try {\n    const acceptLanguage = c.req.header(options.lookupFromHeaderKey);\n    if (!acceptLanguage) {\n      return void 0;\n    }\n    const languages = parseAcceptLanguage(acceptLanguage);\n    for (const { lang } of languages) {\n      const normalizedLang = normalizeLanguage(lang, options);\n      if (normalizedLang) {\n        return normalizedLang;\n      }\n    }\n    return void 0;\n  } catch {\n    return void 0;\n  }\n}\nfunction detectFromPath(c, options) {\n  try {\n    const pathSegments = c.req.path.split(\"/\").filter(Boolean);\n    const langSegment = pathSegments[options.lookupFromPathIndex];\n    return normalizeLanguage(langSegment, options);\n  } catch {\n    return void 0;\n  }\n}\nvar detectors = {\n  querystring: detectFromQuery,\n  cookie: detectFromCookie,\n  header: detectFromHeader,\n  path: detectFromPath\n};\nfunction validateOptions(options) {\n  if (!options.supportedLanguages.includes(options.fallbackLanguage)) {\n    throw new Error(\"Fallback language must be included in supported languages\");\n  }\n  if (options.lookupFromPathIndex < 0) {\n    throw new Error(\"Path index must be non-negative\");\n  }\n  if (!options.order.every((detector) => Object.keys(detectors).includes(detector))) {\n    throw new Error(\"Invalid detector type in order array\");\n  }\n}\nfunction cacheLanguage(c, language, options) {\n  if (!Array.isArray(options.caches) || !options.caches.includes(\"cookie\")) {\n    return;\n  }\n  try {\n    setCookie(c, options.lookupCookie, language, options.cookieOptions);\n  } catch (error) {\n    if (options.debug) {\n      console.error(\"Failed to cache language:\", error);\n    }\n  }\n}\nvar detectLanguage = (c, options) => {\n  let detectedLang;\n  for (const detectorName of options.order) {\n    const detector = detectors[detectorName];\n    if (!detector) {\n      continue;\n    }\n    try {\n      detectedLang = detector(c, options);\n      if (detectedLang) {\n        if (options.debug) {\n          console.log(`Language detected from ${detectorName}: ${detectedLang}`);\n        }\n        break;\n      }\n    } catch (error) {\n      if (options.debug) {\n        console.error(`Error in ${detectorName} detector:`, error);\n      }\n      continue;\n    }\n  }\n  const finalLang = detectedLang || options.fallbackLanguage;\n  if (detectedLang && options.caches) {\n    cacheLanguage(c, finalLang, options);\n  }\n  return finalLang;\n};\nvar languageDetector = (userOptions) => {\n  const options = {\n    ...DEFAULT_OPTIONS,\n    ...userOptions,\n    cookieOptions: {\n      ...DEFAULT_OPTIONS.cookieOptions,\n      ...userOptions.cookieOptions\n    }\n  };\n  validateOptions(options);\n  return async function languageDetector2(ctx, next) {\n    try {\n      const lang = detectLanguage(ctx, options);\n      ctx.set(\"language\", lang);\n    } catch (error) {\n      if (options.debug) {\n        console.error(\"Language detection failed:\", error);\n      }\n      ctx.set(\"language\", options.fallbackLanguage);\n    }\n    await next();\n  };\n};\nexport {\n  DEFAULT_OPTIONS,\n  detectFromCookie,\n  detectFromHeader,\n  detectFromPath,\n  detectFromQuery,\n  detectors,\n  languageDetector,\n  normalizeLanguage,\n  parseAcceptLanguage,\n  validateOptions\n};\n","// src/middleware/language/index.ts\nimport {\n  languageDetector,\n  detectFromCookie,\n  detectFromHeader,\n  detectFromPath,\n  detectFromQuery\n} from \"./language.js\";\nexport {\n  detectFromCookie,\n  detectFromHeader,\n  detectFromPath,\n  detectFromQuery,\n  languageDetector\n};\n","function n(){return n=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)({}).hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},n.apply(null,arguments)}export{n as extends};\n","function e(e){var t,n;return{...e,localePrefix:l(e.localePrefix),localeCookie:o(e.localeCookie),localeDetection:null===(t=e.localeDetection)||void 0===t||t,alternateLinks:null===(n=e.alternateLinks)||void 0===n||n}}function o(e){return!(null!=e&&!e)&&{name:\"NEXT_LOCALE\",maxAge:31536e3,sameSite:\"lax\",...\"object\"==typeof e&&e}}function l(e){return\"object\"==typeof e?e:{mode:e||\"always\"}}export{o as receiveLocaleCookie,l as receiveLocalePrefixConfig,e as receiveRoutingConfig};\n","function n(n){return function(n){return\"object\"==typeof n?null==n.host&&null==n.hostname:!/^[a-z]+:/i.test(n)}(n)&&!function(n){const t=\"object\"==typeof n?n.pathname:n;return null!=t&&!t.startsWith(\"/\")}(n)}function t(t,r){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,o=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;if(!n(t))return t;const f=r!==u,l=i(c,o);return(f||l)&&null!=c?e(t,c):t}function e(n,t){let e;return\"string\"==typeof n?e=u(t,n):(e={...n},n.pathname&&(e.pathname=u(t,n.pathname))),e}function r(n,t){return n.replace(new RegExp(\"^\".concat(t)),\"\")||\"/\"}function u(n,t){let e=n;return/^\\/(\\?.*)?$/.test(t)&&(t=t.slice(1)),e+=t,e}function i(n,t){return t===n||t.startsWith(\"\".concat(n,\"/\"))}function o(n){const t=function(){try{return\"true\"===process.env._next_intl_trailing_slash}catch(n){return!1}}();if(\"/\"!==n){const e=n.endsWith(\"/\");t&&!e?n+=\"/\":!t&&e&&(n=n.slice(0,-1))}return n}function c(n,t){const e=o(n),r=o(t);return s(e).test(r)}function f(n,t){var e;return\"never\"!==t.mode&&(null===(e=t.prefixes)||void 0===e?void 0:e[n])||l(n)}function l(n){return\"/\"+n}function s(n){const t=n.replace(/\\[\\[(\\.\\.\\.[^\\]]+)\\]\\]/g,\"?(.*)\").replace(/\\[(\\.\\.\\.[^\\]]+)\\]/g,\"(.+)\").replace(/\\[([^\\]]+)\\]/g,\"([^/]+)\");return new RegExp(\"^\".concat(t,\"$\"))}function a(n){return n.includes(\"[[...\")}function p(n){return n.includes(\"[...\")}function h(n){return n.includes(\"[\")}function g(n,t){const e=n.split(\"/\"),r=t.split(\"/\"),u=Math.max(e.length,r.length);for(let n=0;n<u;n++){const t=e[n],u=r[n];if(!t&&u)return-1;if(t&&!u)return 1;if(t||u){if(!h(t)&&h(u))return-1;if(h(t)&&!h(u))return 1;if(!p(t)&&p(u))return-1;if(p(t)&&!p(u))return 1;if(!a(t)&&a(u))return-1;if(a(t)&&!a(u))return 1}}return 0}function d(n){return n.sort(g)}function v(n){return\"function\"==typeof n.then}export{l as getLocaleAsPrefix,f as getLocalePrefix,d as getSortedPathnames,i as hasPathnamePrefixed,n as isLocalizableHref,v as isPromise,t as localizeHref,c as matchesPathname,o as normalizeTrailingSlash,e as prefixHref,u as prefixPathname,s as templateToRegex,r as unprefixPathname};\n","const o=\"X-NEXT-INTL-LOCALE\",L=\"locale\";export{o as HEADER_LOCALE_NAME,L as LOCALE_SEGMENT_NAME};\n","import{cache as o}from\"react\";const n=o((function(){return{locale:void 0}}));function t(){return n().locale}function c(o){n().locale=o}export{t as getCachedRequestLocale,c as setCachedRequestLocale};\n","import{headers as t}from\"next/headers\";import{cache as e}from\"react\";import{HEADER_LOCALE_NAME as n}from\"../../shared/constants.js\";import{isPromise as r}from\"../../shared/utils.js\";import{getCachedRequestLocale as o}from\"./RequestLocaleCache.js\";const i=e((async function(){const e=t();return r(e)?await e:e}));const s=e((async function(){let t;try{t=(await i()).get(n)||void 0}catch(t){if(t instanceof Error&&\"DYNAMIC_SERVER_USAGE\"===t.digest){const e=new Error(\"Usage of next-intl APIs in Server Components currently opts into dynamic rendering. This limitation will eventually be lifted, but as a stopgap solution, you can use the `setRequestLocale` API to enable static rendering, see https://next-intl.dev/docs/getting-started/app-router/with-i18n-routing#static-rendering\",{cause:t});throw e.digest=t.digest,e}throw t}return t}));async function a(){return o()||await s()}export{a as getRequestLocale};\n","import{headers as e}from\"next/headers\";import{notFound as t}from\"next/navigation\";import{cache as n}from\"react\";import{HEADER_LOCALE_NAME as o}from\"../../shared/constants.js\";import{getCachedRequestLocale as r}from\"./RequestLocaleCache.js\";const i=n((function(){let n;try{n=e().get(o)}catch(e){throw e instanceof Error&&\"DYNAMIC_SERVER_USAGE\"===e.digest?new Error(\"Usage of next-intl APIs in Server Components currently opts into dynamic rendering. This limitation will eventually be lifted, but as a stopgap solution, you can use the `setRequestLocale` API to enable static rendering, see https://next-intl.dev/docs/getting-started/app-router/with-i18n-routing#static-rendering\",{cause:e}):e}return n||(console.error(\"\\nUnable to find `next-intl` locale because the middleware didn't run on this request. See https://next-intl.dev/docs/routing/middleware#unable-to-find-locale. The `notFound()` function will be called as a result.\\n\"),t()),n}));function s(){return r()||i()}export{s as getRequestLocale};\n","function t(t){return t}export{t as default};\n","import { headers } from \"next/headers\";\r\nimport { getRequestConfig } from \"next-intl/server\";\r\n\r\nimport { locales, defaultLocale, getLocaleConfig } from \"@/i18n/i18n\";\r\n\r\n// Define error handler functions outside the config to avoid serialization issues\r\nconst handleError = (error: any) => {\r\n  if (error.code === \"MISSING_MESSAGE\") {\r\n    // Only log missing messages in development, not in production\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      console.warn(`Translation warning: ${error.message}`);\r\n    }\r\n  } else {\r\n    // Log other errors normally\r\n    console.error(\"Translation error:\", error);\r\n  }\r\n};\r\n\r\nconst getMessageFallback = ({\r\n  namespace,\r\n  key,\r\n  error,\r\n}: {\r\n  namespace?: string;\r\n  key: string;\r\n  error: any;\r\n}) => {\r\n  // Return a reasonable fallback based on the key\r\n  const fallback =\r\n    key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, \" $1\");\r\n\r\n  // Log the missing translation in development\r\n  if (process.env.NODE_ENV === \"development\") {\r\n    console.warn(\r\n      `Missing translation: ${namespace ? `${namespace}.${key}` : key}`,\r\n      error\r\n    );\r\n  }\r\n\r\n  // Format namespace.key for clearer missing translation indicators\r\n  if (namespace) {\r\n    return `${fallback}`;\r\n  }\r\n\r\n  return fallback;\r\n};\r\n\r\nexport default getRequestConfig(async () => {\r\n  // Get headers asynchronously\r\n  const headersList = await headers();\r\n  const currentPath = headersList.get(\"x-current-path\") || \"\";\r\n\r\n  // Extract locale from path\r\n  const pathSegments = currentPath.split(\"/\").filter(Boolean);\r\n  const localeFromPath = pathSegments[0];\r\n\r\n  // Validate that the incoming locale is supported\r\n  const resolvedLocale = locales.includes(localeFromPath as any)\r\n    ? localeFromPath\r\n    : defaultLocale;\r\n\r\n  let messages;\r\n  try {\r\n    switch (resolvedLocale) {\r\n      case \"en\":\r\n        messages = (await import(`@/i18n/locales/en.json`)).default;\r\n        break;\r\n      case \"ar\":\r\n        messages = (await import(`@/i18n/locales/ar.json`)).default;\r\n        break;\r\n      case \"es\":\r\n        messages = (await import(`@/i18n/locales/es.json`)).default;\r\n        break;\r\n      case \"fr\":\r\n        messages = (await import(`@/i18n/locales/fr.json`)).default;\r\n        break;\r\n      default:\r\n        // Fallback to defaultLocale messages if resolvedLocale is somehow unexpected\r\n        // (should ideally be caught by locales.includes check earlier)\r\n        console.warn(\r\n          `Unexpected resolvedLocale: ${resolvedLocale}, loading default ${defaultLocale} messages.`\r\n        );\r\n        messages = (await import(`@/i18n/locales/${defaultLocale}.json`))\r\n          .default;\r\n    }\r\n  } catch (error) {\r\n    console.error(\r\n      `Failed to load translations for ${resolvedLocale}, falling back to default. Error:`,\r\n      error\r\n    );\r\n    // Fallback to default locale messages on any error\r\n    try {\r\n      messages = (await import(`@/i18n/locales/${defaultLocale}.json`)).default;\r\n    } catch (fallbackError) {\r\n      console.error(\r\n        `Failed to load default locale messages for ${defaultLocale}:`,\r\n        fallbackError\r\n      );\r\n      messages = {\r\n        common: { loading: \"Loading...\", error: \"An error occurred\" },\r\n      }; // Absolute fallback\r\n    }\r\n  }\r\n\r\n  // Get locale configuration\r\n  const localeConfig = getLocaleConfig(resolvedLocale);\r\n\r\n  return {\r\n    locale: resolvedLocale,\r\n    messages,\r\n    timeZone: \"UTC\",\r\n    now: new Date(),\r\n    // Note: These functions are handled client-side for client components\r\n    // Server-side components will use these configurations\r\n    onError: handleError,\r\n    getMessageFallback,\r\n    formats: {\r\n      dateTime: {\r\n        short: {\r\n          day: \"2-digit\",\r\n          month: \"2-digit\",\r\n          year: \"numeric\",\r\n        },\r\n        medium: {\r\n          day: \"numeric\",\r\n          month: \"short\",\r\n          year: \"numeric\",\r\n        },\r\n        long: {\r\n          day: \"numeric\",\r\n          month: \"long\",\r\n          year: \"numeric\",\r\n        },\r\n        full: {\r\n          weekday: \"long\",\r\n          day: \"numeric\",\r\n          month: \"long\",\r\n          year: \"numeric\",\r\n        },\r\n        time: {\r\n          hour: \"2-digit\",\r\n          minute: \"2-digit\",\r\n          hour12: localeConfig.htmlLang === \"en\",\r\n        },\r\n      },\r\n      number: {\r\n        precise: {\r\n          maximumFractionDigits: 2,\r\n          minimumFractionDigits: 2,\r\n        },\r\n        compact: {\r\n          notation: \"compact\",\r\n        },\r\n        percent: {\r\n          style: \"percent\",\r\n          maximumFractionDigits: 2,\r\n        },\r\n        currency: {\r\n          style: \"currency\",\r\n          currency: \"USD\",\r\n        },\r\n      },\r\n      list: {\r\n        enumeration: {\r\n          style: \"long\",\r\n          type: \"conjunction\",\r\n        },\r\n        or: {\r\n          style: \"long\",\r\n          type: \"disjunction\",\r\n        },\r\n      },\r\n      relative: {\r\n        days: {\r\n          style: \"long\",\r\n        },\r\n        quarters: {\r\n          style: \"long\",\r\n        },\r\n        months: {\r\n          style: \"long\",\r\n        },\r\n        years: {\r\n          style: \"long\",\r\n        },\r\n      },\r\n    },\r\n  };\r\n});\r\n","import{notFound as e}from\"next/navigation\";import{cache as t}from\"react\";import{_createIntlFormatters as n,_createCache as o,initializeConfig as r}from\"use-intl/core\";import{isPromise as i}from\"../../shared/utils.js\";import{getRequestLocale as a}from\"./RequestLocale.js\";import{getRequestLocale as l}from\"./RequestLocaleLegacy.js\";import s from\"next-intl/config\";let c=!1,u=!1;const f=t((function(){return new Date}));const d=t((function(){return Intl.DateTimeFormat().resolvedOptions().timeZone}));const m=t((async function(t,n){if(\"function\"!=typeof t)throw new Error(\"Invalid i18n request configuration detected.\\n\\nPlease verify that:\\n1. In case you've specified a custom location in your Next.js config, make sure that the path is correct.\\n2. You have a default export in your i18n request configuration file.\\n\\nSee also: https://next-intl.dev/docs/usage/configuration#i18n-request\\n\");const o={get locale(){return u||(console.warn(\"\\nThe `locale` parameter in `getRequestConfig` is deprecated, please switch to `await requestLocale`. See https://next-intl.dev/blog/next-intl-3-22#await-request-locale\\n\"),u=!0),n||l()},get requestLocale(){return n?Promise.resolve(n):a()}};let r=t(o);i(r)&&(r=await r);let s=r.locale;return s||(c||(console.error(\"\\nA `locale` is expected to be returned from `getRequestConfig`, but none was returned. This will be an error in the next major version of next-intl.\\n\\nSee: https://next-intl.dev/blog/next-intl-3-22#await-request-locale\\n\"),c=!0),s=await o.requestLocale,s||(console.error(\"\\nUnable to find `next-intl` locale because the middleware didn't run on this request and no `locale` was returned in `getRequestConfig`. See https://next-intl.dev/docs/routing/middleware#unable-to-find-locale. The `notFound()` function will be called as a result.\\n\"),e())),{...r,locale:s,now:r.now||f(),timeZone:r.timeZone||d()}})),p=t(n),g=t(o);const w=t((async function(e){const t=await m(s,e);return{...r(t),_formatters:p(g())}}));export{w as default};\n","import{cache as o}from\"react\";import t from\"./getConfig.js\";const r=o((async function(){const o=await t();return Promise.resolve(o.locale)}));export{r as default};\n","import{extends as e}from\"../../_virtual/_rollupPluginBabelHelpers.js\";import r from\"react\";import{getLocalePrefix as o}from\"../../shared/utils.js\";import a from\"../shared/LegacyBaseLink.js\";import t from\"../../server/react-server/getLocale.js\";async function l(l){let{locale:s,localePrefix:i,...c}=l;const m=s||await t(),f=o(m,i);return r.createElement(a,e({locale:m,localePrefixMode:i.mode,prefix:f},c))}export{l as default};\n","import{redirect as e,permanentRedirect as n}from\"next/navigation\";import{getLocalePrefix as r,isLocalizableHref as t,prefixPathname as o}from\"../../shared/utils.js\";function a(e){return function(n){const a=r(n.locale,n.localePrefix),i=\"never\"!==n.localePrefix.mode&&t(n.pathname)?o(a,n.pathname):n.pathname;for(var l=arguments.length,m=new Array(l>1?l-1:0),c=1;c<l;c++)m[c-1]=arguments[c];return e(i,...m)}}const i=a(e),l=a(n);export{l as basePermanentRedirect,i as baseRedirect};\n","import{getRequestLocale as r}from\"../../server/react-server/RequestLocaleLegacy.js\";import{baseRedirect as e,basePermanentRedirect as t}from\"../shared/redirects.js\";function o(e){return function(t){const o=r();for(var n=arguments.length,c=new Array(n>1?n-1:0),s=1;s<n;s++)c[s-1]=arguments[s];return e({...t,locale:o},...c)}}const n=o(e),c=o(t);export{c as serverPermanentRedirect,n as serverRedirect};\n","import{extends as e}from\"../../_virtual/_rollupPluginBabelHelpers.js\";import r from\"react\";import{receiveLocalePrefixConfig as o,receiveLocaleCookie as n}from\"../../routing/config.js\";import t from\"./ServerLink.js\";import{serverRedirect as i,serverPermanentRedirect as a}from\"./redirects.js\";function l(l){const u=o(null==l?void 0:l.localePrefix),c=n(null==l?void 0:l.localeCookie);function f(e){return()=>{throw new Error(\"`\".concat(e,\"` is not supported in Server Components. You can use this hook if you convert the component to a Client Component.\"))}}return{Link:function(o){return r.createElement(t,e({localeCookie:c,localePrefix:u},o))},redirect:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),n=1;n<r;n++)o[n-1]=arguments[n];return i({pathname:e,localePrefix:u},...o)},permanentRedirect:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),n=1;n<r;n++)o[n-1]=arguments[n];return a({pathname:e,localePrefix:u},...o)},usePathname:f(\"usePathname\"),useRouter:f(\"useRouter\")}}export{l as default};\n","import { createSharedPathnamesNavigation } from \"next-intl/navigation\";\r\n\r\nimport { locales } from \"@/i18n/i18n\";\r\n\r\nexport const { Link, redirect, usePathname, useRouter } =\r\n  createSharedPathnamesNavigation({\r\n    locales,\r\n  });\r\n","/**\r\n * Server-side i18n functionality\r\n * IMPORTANT: This file should NEVER be imported in client components\r\n */\r\n\r\nimport { getMessages as getNextIntlMessages } from \"next-intl/server\";\r\n\r\nimport requestConfig from \"./request\";\r\n\r\nexport default requestConfig;\r\n\r\nexport const getMessages = async () => {\r\n  return getNextIntlMessages();\r\n};\r\n","/**\r\n * Export all i18n functionality from the shared location\r\n */\r\nexport * from \"./i18n\";\r\n\r\n/**\r\n * Export navigation helpers for Next.js routes\r\n */\r\nexport * from \"./navigation\";\r\n\r\n/**\r\n * Export hooks for client-side i18n usage\r\n */\r\nexport * from \"./hooks\";\r\n\r\n/**\r\n * Re-export request configuration for server components only\r\n * Note: This should not be imported in client components\r\n */\r\n// Export this from a separate file to avoid client components\r\n// importing server-only code\r\nexport { default as getI18nConfig } from \"./server\";\r\n","import { Context, MiddlewareHandler, Next } from \"hono\";\r\nimport { languageDetector as honoLanguageDetector } from \"hono/language\";\r\nimport type { DetectorOptions as HonoDetectorOptions } from \"hono/language\";\r\nimport { Locale, locales, defaultLocale } from \"@/i18n\";\r\n\r\n// Extended options interface to match Hono's underlying implementation\r\ninterface DetectorOptions extends HonoDetectorOptions {\r\n  // Add any custom options\r\n}\r\n\r\n/**\r\n * Middleware for language detection in API routes\r\n */\r\nexport function languageDetectionMiddleware(\r\n  options: Partial<DetectorOptions> = {}\r\n): MiddlewareHandler {\r\n  // Set up default options\r\n  const defaultOptions: Partial<DetectorOptions> = {\r\n    order: [\"querystring\", \"cookie\", \"header\", \"path\"],\r\n    lookupQueryString: \"lang\",\r\n    lookupCookie: \"NEXT_LOCALE\",\r\n    lookupFromPathIndex: 0,\r\n    lookupFromHeaderKey: \"accept-language\",\r\n    ignoreCase: true,\r\n    supportedLanguages: [...locales], // Convert readonly array to mutable array\r\n    fallbackLanguage: defaultLocale,\r\n    caches: false, // Explicitly disable language detector's own caching\r\n    cookieOptions: {\r\n      sameSite: \"Lax\",\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      maxAge: 365 * 24 * 60 * 60, // 1 year\r\n      httpOnly: true,\r\n    },\r\n  };\r\n\r\n  // Merge options with defaults\r\n  const mergedOptions = { ...defaultOptions, ...options };\r\n\r\n  // Apply the Hono language detector\r\n  const detector = honoLanguageDetector(mergedOptions);\r\n\r\n  // Wrap the detector to set the locale in Hono context\r\n  return async (c: Context, next: Next) => {\r\n    // Apply the built-in detector\r\n    await detector(c, next);\r\n\r\n    // Get the detected language\r\n    const detectedLanguage = c.get(\"language\") as string;\r\n\r\n    // Set locale in the context as well (for convenience)\r\n    c.set(\"locale\", detectedLanguage as Locale);\r\n\r\n    // Optionally add response headers\r\n    c.header(\"Content-Language\", detectedLanguage);\r\n  };\r\n}\r\n","module.exports = require(\"next/dist/server/app-render/after-task-async-storage.external.js\");","// src/middleware/pretty-json/index.ts\nvar prettyJSON = (options) => {\n  const targetQuery = options?.query ?? \"pretty\";\n  return async function prettyJSON2(c, next) {\n    const pretty = c.req.query(targetQuery) || c.req.query(targetQuery) === \"\";\n    await next();\n    if (pretty && c.res.headers.get(\"Content-Type\")?.startsWith(\"application/json\")) {\n      const obj = await c.res.json();\n      c.res = new Response(JSON.stringify(obj, null, options?.space ?? 2), c.res);\n    }\n  };\n};\nexport {\n  prettyJSON\n};\n","import { zValidator } from '@hono/zod-validator';\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport { Hono } from 'hono';\r\nimport { HTTPException } from 'hono/http-exception';\r\nimport { z } from 'zod';\r\n\r\nimport type { Context } from 'hono';\r\n\r\n/**\r\n * Authentication routes for user management\r\n */\r\nexport function setupAuthRoutes(app: Hono) {\r\n  // Validation schemas\r\n  const loginSchema = z.object({\r\n    email: z.string().email(),\r\n    password: z.string().min(6),\r\n  });\r\n\r\n  const registerSchema = z.object({\r\n    email: z.string().email(),\r\n    password: z.string().min(6),\r\n    firstName: z.string().min(2).optional(),\r\n    lastName: z.string().min(2).optional(),\r\n  });\r\n\r\n  const resetPasswordSchema = z.object({\r\n    email: z.string().email(),\r\n  });\r\n\r\n  // Initialize Supabase client\r\n  const getSupabase = () => {\r\n    return createClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL || '',\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY || ''\r\n    );\r\n  };\r\n\r\n  // Login route\r\n  app.post('/auth/login', \r\n    async (c: Context) => {\r\n      try {\r\n        // Manual validation\r\n        const body = await c.req.json();\r\n        const result = loginSchema.safeParse(body);\r\n        \r\n        if (!result.success) {\r\n          throw new HTTPException(400, { message: 'Invalid login credentials' });\r\n        }\r\n        \r\n        const { email, password } = result.data;\r\n        const supabase = getSupabase();\r\n        \r\n        const { data, error } = await supabase.auth.signInWithPassword({\r\n          email,\r\n          password,\r\n        });\r\n        \r\n        if (error) throw error;\r\n        \r\n        return c.json({\r\n          success: true,\r\n          session: data.session,\r\n          user: data.user,\r\n        });\r\n      } catch (error: any) {\r\n        console.error('Login error:', error);\r\n        if (error instanceof HTTPException) {\r\n          throw error;\r\n        }\r\n        throw new HTTPException(401, { message: error.message || 'Login failed' });\r\n      }\r\n    }\r\n  );\r\n  \r\n  // Register route\r\n  app.post('/auth/register', \r\n    async (c: Context) => {\r\n      try {\r\n        // Manual validation\r\n        const body = await c.req.json();\r\n        const result = registerSchema.safeParse(body);\r\n        \r\n        if (!result.success) {\r\n          throw new HTTPException(400, { message: 'Invalid registration data' });\r\n        }\r\n        \r\n        const { email, password, firstName, lastName } = result.data;\r\n        const supabase = getSupabase();\r\n        \r\n        const { data: authData, error: authError } = await supabase.auth.signUp({\r\n          email,\r\n          password,\r\n        });\r\n        \r\n        if (authError) throw authError;\r\n        \r\n        if (authData.user && (firstName || lastName)) {\r\n          // Create profile record with additional data\r\n          const { error: profileError } = await supabase\r\n            .from('profiles')\r\n            .upsert({\r\n              id: authData.user.id,\r\n              first_name: firstName,\r\n              last_name: lastName,\r\n              updated_at: new Date().toISOString(),\r\n            });\r\n            \r\n          if (profileError) throw profileError;\r\n        }\r\n        \r\n        return c.json({\r\n          success: true,\r\n          message: 'Registration successful',\r\n          user: authData.user,\r\n        });\r\n      } catch (error: any) {\r\n        console.error('Registration error:', error);\r\n        if (error instanceof HTTPException) {\r\n          throw error;\r\n        }\r\n        throw new HTTPException(400, { message: error.message || 'Registration failed' });\r\n      }\r\n    }\r\n  );\r\n  \r\n  // Logout route - doesn't need middleware as it just has to invalidate token\r\n  app.post('/auth/logout', async (c: Context) => {\r\n    try {\r\n      const supabase = getSupabase();\r\n      \r\n      const authHeader = c.req.header('Authorization');\r\n      if (authHeader?.startsWith('Bearer ')) {\r\n        const token = authHeader.split(' ')[1];\r\n        await supabase.auth.signOut({ scope: 'global' });\r\n      }\r\n      \r\n      return c.json({\r\n        success: true,\r\n        message: 'Logged out successfully',\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Logout error:', error);\r\n      // Always return success even if there's an error\r\n      return c.json({\r\n        success: true,\r\n        message: 'Logged out successfully',\r\n      });\r\n    }\r\n  });\r\n  \r\n  // Password reset request\r\n  app.post('/auth/reset-password', \r\n    async (c: Context) => {\r\n      try {\r\n        // Manual validation\r\n        const body = await c.req.json();\r\n        const result = resetPasswordSchema.safeParse(body);\r\n        \r\n        if (!result.success) {\r\n          throw new HTTPException(400, { message: 'Invalid email' });\r\n        }\r\n        \r\n        const { email } = result.data;\r\n        const supabase = getSupabase();\r\n        \r\n        const { error } = await supabase.auth.resetPasswordForEmail(email, {\r\n          redirectTo: `${process.env.NEXT_PUBLIC_APP_URL}/reset-password`,\r\n        });\r\n        \r\n        if (error) throw error;\r\n        \r\n        return c.json({\r\n          success: true,\r\n          message: 'Password reset email sent',\r\n        });\r\n      } catch (error: any) {\r\n        console.error('Password reset error:', error);\r\n        // Don't reveal if email exists for security reasons\r\n        return c.json({\r\n          success: true,\r\n          message: 'If the email exists, a password reset link has been sent',\r\n        });\r\n      }\r\n    }\r\n  );\r\n\r\n  return app;\r\n}","module.exports = require(\"module\");","module.exports = require(\"next/dist/compiled/next-server/app-page.runtime.prod.js\");","import { SupabaseClient, User } from \"@supabase/supabase-js\";\r\nimport { Ratelimit } from \"@upstash/ratelimit\";\r\nimport { Redis } from \"@upstash/redis\";\r\nimport { Context, MiddlewareHandler, Next } from \"hono\";\r\n\r\nimport { AppEnv } from \"@/app/api/[[...route]]/route\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n// Initialize Redis client\r\nconst redis = Redis.fromEnv();\r\n\r\n// Define resource types for rate limiting\r\nexport enum ResourceType {\r\n  API = \"api\",\r\n  SCRAPING = \"scraping\",\r\n  VECTOR = \"vector\",\r\n  RESEARCH = \"research\",\r\n}\r\n\r\n// Define subscription tiers\r\nexport enum SubscriptionTier {\r\n  FREE = \"free\",\r\n  PRO = \"pro\",\r\n  ENTERPRISE = \"enterprise\",\r\n}\r\n\r\n// Supported rate limit actions (from config.ts)\r\nexport type RateLimitAction =\r\n  | \"ocr\"\r\n  | \"documentQA\"\r\n  | \"batchProcessing\"\r\n  | \"api\" // Note: \"api\" action also exists in ResourceType. Ensure distinct usage if necessary.\r\n  | \"caseManagement\"\r\n  | \"documentUpload\";\r\n\r\n// Type for action-specific rate limit settings (window in seconds, includes tokens)\r\nexport type ActionRateLimitConfig = {\r\n  requests: number;\r\n  window: number; // seconds\r\n  tokens: number;\r\n};\r\n\r\n// Action-specific rate limit configurations (adapted from config.ts rateLimits)\r\n// Mapping 'standard' -> FREE, 'premium' -> PRO, 'enterprise' -> ENTERPRISE\r\nexport const ACTION_SPECIFIC_RATE_LIMITS: {\r\n  [key in RateLimitAction]?: {\r\n    // Action might not be defined for all tiers\r\n    [key in SubscriptionTier]?: ActionRateLimitConfig;\r\n  };\r\n} = {\r\n  ocr: {\r\n    [SubscriptionTier.FREE]: { requests: 50, window: 86400, tokens: 3 },\r\n    [SubscriptionTier.PRO]: { requests: 500, window: 86400, tokens: 2 },\r\n    [SubscriptionTier.ENTERPRISE]: { requests: 5000, window: 86400, tokens: 1 },\r\n  },\r\n  documentQA: {\r\n    [SubscriptionTier.FREE]: { requests: 20, window: 86400, tokens: 5 },\r\n    [SubscriptionTier.PRO]: { requests: 200, window: 86400, tokens: 3 },\r\n    [SubscriptionTier.ENTERPRISE]: { requests: 2000, window: 86400, tokens: 2 },\r\n  },\r\n  batchProcessing: {\r\n    [SubscriptionTier.FREE]: { requests: 5, window: 86400, tokens: 10 },\r\n    [SubscriptionTier.PRO]: { requests: 50, window: 86400, tokens: 5 },\r\n    [SubscriptionTier.ENTERPRISE]: { requests: 500, window: 86400, tokens: 3 },\r\n  },\r\n  api: {\r\n    // This is the 'api' action from config.ts, distinct from ResourceType.API\r\n    [SubscriptionTier.FREE]: { requests: 100, window: 60, tokens: 1 },\r\n    [SubscriptionTier.PRO]: { requests: 500, window: 60, tokens: 1 },\r\n    [SubscriptionTier.ENTERPRISE]: { requests: 2000, window: 60, tokens: 1 },\r\n  },\r\n  caseManagement: {\r\n    [SubscriptionTier.FREE]: { requests: 100, window: 60, tokens: 1 },\r\n    [SubscriptionTier.PRO]: { requests: 500, window: 60, tokens: 1 },\r\n    [SubscriptionTier.ENTERPRISE]: { requests: 2000, window: 60, tokens: 1 },\r\n  },\r\n  documentUpload: {\r\n    [SubscriptionTier.FREE]: { requests: 30, window: 60, tokens: 2 },\r\n    [SubscriptionTier.PRO]: { requests: 100, window: 60, tokens: 1 },\r\n    [SubscriptionTier.ENTERPRISE]: { requests: 500, window: 60, tokens: 1 },\r\n  },\r\n};\r\n\r\n/**\r\n * Create a rate limiter for a specific action and tier (adapted from config.ts)\r\n */\r\nfunction createActionRateLimiter(\r\n  action: RateLimitAction,\r\n  tier: SubscriptionTier\r\n): Ratelimit | null {\r\n  const actionLimitsTiered = ACTION_SPECIFIC_RATE_LIMITS[action];\r\n  if (!actionLimitsTiered) return null;\r\n\r\n  const config = actionLimitsTiered[tier];\r\n  if (!config) return null; // Tier might not be defined for this action\r\n\r\n  return new Ratelimit({\r\n    redis,\r\n    limiter: Ratelimit.slidingWindow(config.requests, `${config.window} s`),\r\n    analytics: true,\r\n    prefix: `ratelimit:action:${action}:${tier}`,\r\n  });\r\n}\r\n\r\n// Pre-create rate limiters for each action and tier (adapted from config.ts limiters)\r\n// Using a nested record for easier access: ACTION_SPECIFIC_LIMITERS[action][tier]\r\nexport const ACTION_SPECIFIC_LIMITERS: Partial<\r\n  Record<RateLimitAction, Partial<Record<SubscriptionTier, Ratelimit | null>>>\r\n> = {};\r\n\r\nfor (const action in ACTION_SPECIFIC_RATE_LIMITS) {\r\n  const typedAction = action as RateLimitAction;\r\n  ACTION_SPECIFIC_LIMITERS[typedAction] = {};\r\n  const tierConfigs = ACTION_SPECIFIC_RATE_LIMITS[typedAction];\r\n  if (tierConfigs) {\r\n    for (const tier in tierConfigs) {\r\n      const typedTier = tier as SubscriptionTier;\r\n      ACTION_SPECIFIC_LIMITERS[typedAction]![typedTier] =\r\n        createActionRateLimiter(typedAction, typedTier);\r\n    }\r\n  }\r\n}\r\n\r\n// Define rate limit configuration type with specific window strings\r\n// Using the formats accepted by Upstash Ratelimit\r\ntype TimeUnit = \"s\" | \"m\" | \"h\" | \"d\";\r\ntype WindowFormat = `${number} ${TimeUnit}`;\r\n\r\nexport type RateLimit = {\r\n  requests: number;\r\n  window: WindowFormat; // e.g., '1 h', '10 s', '1 d'\r\n};\r\n\r\n// Rate limit configurations by tier and resource type\r\nexport type SubscriptionLimits = {\r\n  [key in ResourceType]: RateLimit;\r\n};\r\n\r\nexport type SubscriptionRateLimits = {\r\n  [key in SubscriptionTier]: SubscriptionLimits;\r\n};\r\n\r\n// Define subscription rate limits\r\nexport const SUBSCRIPTION_RATE_LIMITS: SubscriptionRateLimits = {\r\n  [SubscriptionTier.FREE]: {\r\n    [ResourceType.API]: { requests: 1000, window: \"1 h\" },\r\n    [ResourceType.SCRAPING]: { requests: 100, window: \"1 h\" },\r\n    [ResourceType.VECTOR]: { requests: 100, window: \"1 h\" },\r\n    [ResourceType.RESEARCH]: { requests: 50, window: \"1 h\" },\r\n  },\r\n  [SubscriptionTier.PRO]: {\r\n    [ResourceType.API]: { requests: 10000, window: \"1 h\" },\r\n    [ResourceType.SCRAPING]: { requests: 1000, window: \"1 h\" },\r\n    [ResourceType.VECTOR]: { requests: 1000, window: \"1 h\" },\r\n    [ResourceType.RESEARCH]: { requests: 500, window: \"1 h\" },\r\n  },\r\n  [SubscriptionTier.ENTERPRISE]: {\r\n    [ResourceType.API]: { requests: 100000, window: \"1 h\" },\r\n    [ResourceType.SCRAPING]: { requests: 10000, window: \"1 h\" },\r\n    [ResourceType.VECTOR]: { requests: 10000, window: \"1 h\" },\r\n    [ResourceType.RESEARCH]: { requests: 5000, window: \"1 h\" },\r\n  },\r\n};\r\n\r\n// Cache of rate limiters to avoid recreating them\r\nconst rateLimiterCache = new Map<string, Ratelimit>();\r\n\r\n/**\r\n * Get the proper rate limiter for a tier and resource type\r\n */\r\nfunction getRateLimiter(\r\n  tier: SubscriptionTier,\r\n  resourceType: ResourceType\r\n): Ratelimit {\r\n  const cacheKey = `${tier}:${resourceType}`;\r\n\r\n  if (rateLimiterCache.has(cacheKey)) {\r\n    return rateLimiterCache.get(cacheKey)!;\r\n  }\r\n\r\n  const { requests, window } = SUBSCRIPTION_RATE_LIMITS[tier][resourceType];\r\n\r\n  const limiter = new Ratelimit({\r\n    redis,\r\n    limiter: Ratelimit.slidingWindow(requests, window),\r\n    prefix: `ratelimit:${tier}:${resourceType}`,\r\n    analytics: true,\r\n  });\r\n\r\n  rateLimiterCache.set(cacheKey, limiter);\r\n  return limiter;\r\n}\r\n\r\n/**\r\n * Get user's subscription tier from Supabase database\r\n * @param supabase Supabase client instance\r\n * @param userId User ID\r\n */\r\nexport async function getUserTier(\r\n  supabaseClient: SupabaseClient,\r\n  userId: string\r\n): Promise<SubscriptionTier> {\r\n  try {\r\n    const { data, error } = await supabaseClient\r\n      .from(\"subscriptions\")\r\n      .select(\"tier\")\r\n      .eq(\"user_id\", userId)\r\n      .maybeSingle();\r\n\r\n    if (error) throw error;\r\n    if (!data || !data.tier) {\r\n      console.debug(\r\n        `No subscription found for user ${userId}, defaulting to free tier`\r\n      );\r\n      return SubscriptionTier.FREE;\r\n    }\r\n\r\n    // Map subscription tier to rate limit tier\r\n    switch (data.tier.toLowerCase()) {\r\n      case \"pro\":\r\n      case \"premium\":\r\n        return SubscriptionTier.PRO;\r\n      case \"enterprise\":\r\n      case \"business\":\r\n        return SubscriptionTier.ENTERPRISE;\r\n      default:\r\n        return SubscriptionTier.FREE;\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error getting user tier for ${userId}:`, error);\r\n    return SubscriptionTier.FREE; // Default to free tier on error\r\n  }\r\n}\r\n\r\n// Interface for subscription rate limit options\r\ninterface SubscriptionRateLimitOptions {\r\n  resourceType: ResourceType;\r\n  errorMessage?: string;\r\n}\r\n\r\n/**\r\n * Subscription-aware rate limiting middleware\r\n */\r\nexport function subscriptionRateLimit(\r\n  options: SubscriptionRateLimitOptions\r\n): MiddlewareHandler<AppEnv> {\r\n  const { resourceType, errorMessage } = options;\r\n\r\n  return async (c: Context<AppEnv>, next: Next) => {\r\n    let user: User | null = null;\r\n    let identifier: string = \"anonymous\";\r\n    let tier: SubscriptionTier = SubscriptionTier.FREE; // Default tier\r\n\r\n    try {\r\n      // 1. Get User\r\n      user = c.get(\"user\");\r\n\r\n      // 2. Determine Identifier and Tier\r\n      if (user && user.id) {\r\n        identifier = user.id;\r\n\r\n        // 3. Get user's subscription tier if available\r\n        try {\r\n          // Use the imported Supabase client directly\r\n          tier = await getUserTier(supabase, identifier);\r\n        } catch (error) {\r\n          console.error(\"Error getting user tier:\", error);\r\n          // Continue with default tier\r\n        }\r\n      } else {\r\n        // Use IP address for anonymous users\r\n        identifier =\r\n          c.req.header(\"x-forwarded-for\") ||\r\n          c.req.header(\"x-real-ip\") ||\r\n          \"anonymous\";\r\n      }\r\n\r\n      // 4. Get the appropriate rate limiter\r\n      const rateLimiter = getRateLimiter(tier, resourceType);\r\n\r\n      // 5. Check Rate Limit\r\n      const result = await rateLimiter.limit(identifier);\r\n\r\n      // 6. Set Headers\r\n      c.header(\"X-RateLimit-Limit\", String(result.limit));\r\n      c.header(\"X-RateLimit-Remaining\", String(result.remaining));\r\n      c.header(\"X-RateLimit-Reset\", String(Math.floor(result.reset / 1000))); // Convert MS to seconds\r\n      c.header(\"X-RateLimit-Tier\", tier);\r\n      c.header(\"X-RateLimit-Resource\", resourceType);\r\n\r\n      // 7. Handle Limit Exceeded\r\n      if (!result.success) {\r\n        return c.json(\r\n          {\r\n            success: false,\r\n            error: \"Rate limit exceeded\",\r\n            message:\r\n              errorMessage ||\r\n              `You have exceeded your ${resourceType} request limit for your ${tier} subscription.`,\r\n            details: {\r\n              tier,\r\n              resourceType,\r\n              limit: result.limit,\r\n              remaining: result.remaining,\r\n              reset: new Date(result.reset).toISOString(),\r\n            },\r\n          },\r\n          429\r\n        );\r\n      }\r\n\r\n      // 8. Proceed with the request if allowed\r\n      await next();\r\n\r\n      // 9. Wait for analytics to be submitted if needed\r\n      if (result.pending) {\r\n        await result.pending;\r\n      }\r\n    } catch (error) {\r\n      console.error(`Rate limiting error (Resource: ${resourceType}):`, error);\r\n      // Continue without rate limiting if there's an error\r\n      await next();\r\n    }\r\n  };\r\n}\r\n","module.exports = require(\"punycode\");","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n","\"use server\";\r\n\r\nimport { cookies } from \"next/headers\";\r\n\r\nimport { createSupabaseServiceClient } from \"@/lib/supabase/client\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\n\r\n/**\r\n * Server action to check if a user is an admin by querying the admin_users table.\r\n * This uses the service role key (only on server) to securely check the user's role.\r\n */\r\nexport async function verifyUserIsAdmin(\r\n  userId: string | undefined\r\n): Promise<boolean> {\r\n  if (!userId) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Create a Supabase client using the service role for admin access\r\n    const supabase = createSupabaseServiceClient();\r\n\r\n    // Query the admin_users table to check admin status\r\n    const { data, error } = await supabase\r\n      .from(\"admin_users\")\r\n      .select(\"is_admin\")\r\n      .eq(\"user_id\", userId)\r\n      .maybeSingle();\r\n\r\n    if (error) {\r\n      console.error(\r\n        `Error checking admin_users table for user ${userId}:`,\r\n        error.message\r\n      );\r\n      return false;\r\n    }\r\n\r\n    return !!data?.is_admin;\r\n  } catch (error: any) {\r\n    console.error(\r\n      `Exception during admin status check for user ${userId}:`,\r\n      error.message\r\n    );\r\n    return false;\r\n  }\r\n}\r\n","export var ErrorKind;\n(function (ErrorKind) {\n    /** Argument is unclosed (e.g. `{0`) */\n    ErrorKind[ErrorKind[\"EXPECT_ARGUMENT_CLOSING_BRACE\"] = 1] = \"EXPECT_ARGUMENT_CLOSING_BRACE\";\n    /** Argument is empty (e.g. `{}`). */\n    ErrorKind[ErrorKind[\"EMPTY_ARGUMENT\"] = 2] = \"EMPTY_ARGUMENT\";\n    /** Argument is malformed (e.g. `{foo!}``) */\n    ErrorKind[ErrorKind[\"MALFORMED_ARGUMENT\"] = 3] = \"MALFORMED_ARGUMENT\";\n    /** Expect an argument type (e.g. `{foo,}`) */\n    ErrorKind[ErrorKind[\"EXPECT_ARGUMENT_TYPE\"] = 4] = \"EXPECT_ARGUMENT_TYPE\";\n    /** Unsupported argument type (e.g. `{foo,foo}`) */\n    ErrorKind[ErrorKind[\"INVALID_ARGUMENT_TYPE\"] = 5] = \"INVALID_ARGUMENT_TYPE\";\n    /** Expect an argument style (e.g. `{foo, number, }`) */\n    ErrorKind[ErrorKind[\"EXPECT_ARGUMENT_STYLE\"] = 6] = \"EXPECT_ARGUMENT_STYLE\";\n    /** The number skeleton is invalid. */\n    ErrorKind[ErrorKind[\"INVALID_NUMBER_SKELETON\"] = 7] = \"INVALID_NUMBER_SKELETON\";\n    /** The date time skeleton is invalid. */\n    ErrorKind[ErrorKind[\"INVALID_DATE_TIME_SKELETON\"] = 8] = \"INVALID_DATE_TIME_SKELETON\";\n    /** Exepct a number skeleton following the `::` (e.g. `{foo, number, ::}`) */\n    ErrorKind[ErrorKind[\"EXPECT_NUMBER_SKELETON\"] = 9] = \"EXPECT_NUMBER_SKELETON\";\n    /** Exepct a date time skeleton following the `::` (e.g. `{foo, date, ::}`) */\n    ErrorKind[ErrorKind[\"EXPECT_DATE_TIME_SKELETON\"] = 10] = \"EXPECT_DATE_TIME_SKELETON\";\n    /** Unmatched apostrophes in the argument style (e.g. `{foo, number, 'test`) */\n    ErrorKind[ErrorKind[\"UNCLOSED_QUOTE_IN_ARGUMENT_STYLE\"] = 11] = \"UNCLOSED_QUOTE_IN_ARGUMENT_STYLE\";\n    /** Missing select argument options (e.g. `{foo, select}`) */\n    ErrorKind[ErrorKind[\"EXPECT_SELECT_ARGUMENT_OPTIONS\"] = 12] = \"EXPECT_SELECT_ARGUMENT_OPTIONS\";\n    /** Expecting an offset value in `plural` or `selectordinal` argument (e.g `{foo, plural, offset}`) */\n    ErrorKind[ErrorKind[\"EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE\"] = 13] = \"EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE\";\n    /** Offset value in `plural` or `selectordinal` is invalid (e.g. `{foo, plural, offset: x}`) */\n    ErrorKind[ErrorKind[\"INVALID_PLURAL_ARGUMENT_OFFSET_VALUE\"] = 14] = \"INVALID_PLURAL_ARGUMENT_OFFSET_VALUE\";\n    /** Expecting a selector in `select` argument (e.g `{foo, select}`) */\n    ErrorKind[ErrorKind[\"EXPECT_SELECT_ARGUMENT_SELECTOR\"] = 15] = \"EXPECT_SELECT_ARGUMENT_SELECTOR\";\n    /** Expecting a selector in `plural` or `selectordinal` argument (e.g `{foo, plural}`) */\n    ErrorKind[ErrorKind[\"EXPECT_PLURAL_ARGUMENT_SELECTOR\"] = 16] = \"EXPECT_PLURAL_ARGUMENT_SELECTOR\";\n    /** Expecting a message fragment after the `select` selector (e.g. `{foo, select, apple}`) */\n    ErrorKind[ErrorKind[\"EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT\"] = 17] = \"EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT\";\n    /**\n     * Expecting a message fragment after the `plural` or `selectordinal` selector\n     * (e.g. `{foo, plural, one}`)\n     */\n    ErrorKind[ErrorKind[\"EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT\"] = 18] = \"EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT\";\n    /** Selector in `plural` or `selectordinal` is malformed (e.g. `{foo, plural, =x {#}}`) */\n    ErrorKind[ErrorKind[\"INVALID_PLURAL_ARGUMENT_SELECTOR\"] = 19] = \"INVALID_PLURAL_ARGUMENT_SELECTOR\";\n    /**\n     * Duplicate selectors in `plural` or `selectordinal` argument.\n     * (e.g. {foo, plural, one {#} one {#}})\n     */\n    ErrorKind[ErrorKind[\"DUPLICATE_PLURAL_ARGUMENT_SELECTOR\"] = 20] = \"DUPLICATE_PLURAL_ARGUMENT_SELECTOR\";\n    /** Duplicate selectors in `select` argument.\n     * (e.g. {foo, select, apple {apple} apple {apple}})\n     */\n    ErrorKind[ErrorKind[\"DUPLICATE_SELECT_ARGUMENT_SELECTOR\"] = 21] = \"DUPLICATE_SELECT_ARGUMENT_SELECTOR\";\n    /** Plural or select argument option must have `other` clause. */\n    ErrorKind[ErrorKind[\"MISSING_OTHER_CLAUSE\"] = 22] = \"MISSING_OTHER_CLAUSE\";\n    /** The tag is malformed. (e.g. `<bold!>foo</bold!>) */\n    ErrorKind[ErrorKind[\"INVALID_TAG\"] = 23] = \"INVALID_TAG\";\n    /** The tag name is invalid. (e.g. `<123>foo</123>`) */\n    ErrorKind[ErrorKind[\"INVALID_TAG_NAME\"] = 25] = \"INVALID_TAG_NAME\";\n    /** The closing tag does not match the opening tag. (e.g. `<bold>foo</italic>`) */\n    ErrorKind[ErrorKind[\"UNMATCHED_CLOSING_TAG\"] = 26] = \"UNMATCHED_CLOSING_TAG\";\n    /** The opening tag has unmatched closing tag. (e.g. `<bold>foo`) */\n    ErrorKind[ErrorKind[\"UNCLOSED_TAG\"] = 27] = \"UNCLOSED_TAG\";\n})(ErrorKind || (ErrorKind = {}));\n","export var TYPE;\n(function (TYPE) {\n    /**\n     * Raw text\n     */\n    TYPE[TYPE[\"literal\"] = 0] = \"literal\";\n    /**\n     * Variable w/o any format, e.g `var` in `this is a {var}`\n     */\n    TYPE[TYPE[\"argument\"] = 1] = \"argument\";\n    /**\n     * Variable w/ number format\n     */\n    TYPE[TYPE[\"number\"] = 2] = \"number\";\n    /**\n     * Variable w/ date format\n     */\n    TYPE[TYPE[\"date\"] = 3] = \"date\";\n    /**\n     * Variable w/ time format\n     */\n    TYPE[TYPE[\"time\"] = 4] = \"time\";\n    /**\n     * Variable w/ select format\n     */\n    TYPE[TYPE[\"select\"] = 5] = \"select\";\n    /**\n     * Variable w/ plural format\n     */\n    TYPE[TYPE[\"plural\"] = 6] = \"plural\";\n    /**\n     * Only possible within plural argument.\n     * This is the `#` symbol that will be substituted with the count.\n     */\n    TYPE[TYPE[\"pound\"] = 7] = \"pound\";\n    /**\n     * XML-like tag\n     */\n    TYPE[TYPE[\"tag\"] = 8] = \"tag\";\n})(TYPE || (TYPE = {}));\nexport var SKELETON_TYPE;\n(function (SKELETON_TYPE) {\n    SKELETON_TYPE[SKELETON_TYPE[\"number\"] = 0] = \"number\";\n    SKELETON_TYPE[SKELETON_TYPE[\"dateTime\"] = 1] = \"dateTime\";\n})(SKELETON_TYPE || (SKELETON_TYPE = {}));\n/**\n * Type Guards\n */\nexport function isLiteralElement(el) {\n    return el.type === TYPE.literal;\n}\nexport function isArgumentElement(el) {\n    return el.type === TYPE.argument;\n}\nexport function isNumberElement(el) {\n    return el.type === TYPE.number;\n}\nexport function isDateElement(el) {\n    return el.type === TYPE.date;\n}\nexport function isTimeElement(el) {\n    return el.type === TYPE.time;\n}\nexport function isSelectElement(el) {\n    return el.type === TYPE.select;\n}\nexport function isPluralElement(el) {\n    return el.type === TYPE.plural;\n}\nexport function isPoundElement(el) {\n    return el.type === TYPE.pound;\n}\nexport function isTagElement(el) {\n    return el.type === TYPE.tag;\n}\nexport function isNumberSkeleton(el) {\n    return !!(el && typeof el === 'object' && el.type === SKELETON_TYPE.number);\n}\nexport function isDateTimeSkeleton(el) {\n    return !!(el && typeof el === 'object' && el.type === SKELETON_TYPE.dateTime);\n}\nexport function createLiteralElement(value) {\n    return {\n        type: TYPE.literal,\n        value: value,\n    };\n}\nexport function createNumberElement(value, style) {\n    return {\n        type: TYPE.number,\n        value: value,\n        style: style,\n    };\n}\n","// @generated from regex-gen.ts\nexport var SPACE_SEPARATOR_REGEX = /[ \\xA0\\u1680\\u2000-\\u200A\\u202F\\u205F\\u3000]/;\nexport var WHITE_SPACE_REGEX = /[\\t-\\r \\x85\\u200E\\u200F\\u2028\\u2029]/;\n","/**\n * https://unicode.org/reports/tr35/tr35-dates.html#Date_Field_Symbol_Table\n * Credit: https://github.com/caridy/intl-datetimeformat-pattern/blob/master/index.js\n * with some tweaks\n */\nvar DATE_TIME_REGEX = /(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;\n/**\n * Parse Date time skeleton into Intl.DateTimeFormatOptions\n * Ref: https://unicode.org/reports/tr35/tr35-dates.html#Date_Field_Symbol_Table\n * @public\n * @param skeleton skeleton string\n */\nexport function parseDateTimeSkeleton(skeleton) {\n    var result = {};\n    skeleton.replace(DATE_TIME_REGEX, function (match) {\n        var len = match.length;\n        switch (match[0]) {\n            // Era\n            case 'G':\n                result.era = len === 4 ? 'long' : len === 5 ? 'narrow' : 'short';\n                break;\n            // Year\n            case 'y':\n                result.year = len === 2 ? '2-digit' : 'numeric';\n                break;\n            case 'Y':\n            case 'u':\n            case 'U':\n            case 'r':\n                throw new RangeError('`Y/u/U/r` (year) patterns are not supported, use `y` instead');\n            // Quarter\n            case 'q':\n            case 'Q':\n                throw new RangeError('`q/Q` (quarter) patterns are not supported');\n            // Month\n            case 'M':\n            case 'L':\n                result.month = ['numeric', '2-digit', 'short', 'long', 'narrow'][len - 1];\n                break;\n            // Week\n            case 'w':\n            case 'W':\n                throw new RangeError('`w/W` (week) patterns are not supported');\n            case 'd':\n                result.day = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'D':\n            case 'F':\n            case 'g':\n                throw new RangeError('`D/F/g` (day) patterns are not supported, use `d` instead');\n            // Weekday\n            case 'E':\n                result.weekday = len === 4 ? 'long' : len === 5 ? 'narrow' : 'short';\n                break;\n            case 'e':\n                if (len < 4) {\n                    throw new RangeError('`e..eee` (weekday) patterns are not supported');\n                }\n                result.weekday = ['short', 'long', 'narrow', 'short'][len - 4];\n                break;\n            case 'c':\n                if (len < 4) {\n                    throw new RangeError('`c..ccc` (weekday) patterns are not supported');\n                }\n                result.weekday = ['short', 'long', 'narrow', 'short'][len - 4];\n                break;\n            // Period\n            case 'a': // AM, PM\n                result.hour12 = true;\n                break;\n            case 'b': // am, pm, noon, midnight\n            case 'B': // flexible day periods\n                throw new RangeError('`b/B` (period) patterns are not supported, use `a` instead');\n            // Hour\n            case 'h':\n                result.hourCycle = 'h12';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'H':\n                result.hourCycle = 'h23';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'K':\n                result.hourCycle = 'h11';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'k':\n                result.hourCycle = 'h24';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'j':\n            case 'J':\n            case 'C':\n                throw new RangeError('`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead');\n            // Minute\n            case 'm':\n                result.minute = ['numeric', '2-digit'][len - 1];\n                break;\n            // Second\n            case 's':\n                result.second = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'S':\n            case 'A':\n                throw new RangeError('`S/A` (second) patterns are not supported, use `s` instead');\n            // Zone\n            case 'z': // 1..3, 4: specific non-location format\n                result.timeZoneName = len < 4 ? 'short' : 'long';\n                break;\n            case 'Z': // 1..3, 4, 5: The ISO8601 varios formats\n            case 'O': // 1, 4: milliseconds in day short, long\n            case 'v': // 1, 4: generic non-location format\n            case 'V': // 1, 2, 3, 4: time zone ID or city\n            case 'X': // 1, 2, 3, 4: The ISO8601 varios formats\n            case 'x': // 1, 2, 3, 4: The ISO8601 varios formats\n                throw new RangeError('`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead');\n        }\n        return '';\n    });\n    return result;\n}\n","// @generated from regex-gen.ts\nexport var WHITE_SPACE_REGEX = /[\\t-\\r \\x85\\u200E\\u200F\\u2028\\u2029]/i;\n","import { __assign } from \"tslib\";\nimport { WHITE_SPACE_REGEX } from './regex.generated';\nexport function parseNumberSkeletonFromString(skeleton) {\n    if (skeleton.length === 0) {\n        throw new Error('Number skeleton cannot be empty');\n    }\n    // Parse the skeleton\n    var stringTokens = skeleton\n        .split(WHITE_SPACE_REGEX)\n        .filter(function (x) { return x.length > 0; });\n    var tokens = [];\n    for (var _i = 0, stringTokens_1 = stringTokens; _i < stringTokens_1.length; _i++) {\n        var stringToken = stringTokens_1[_i];\n        var stemAndOptions = stringToken.split('/');\n        if (stemAndOptions.length === 0) {\n            throw new Error('Invalid number skeleton');\n        }\n        var stem = stemAndOptions[0], options = stemAndOptions.slice(1);\n        for (var _a = 0, options_1 = options; _a < options_1.length; _a++) {\n            var option = options_1[_a];\n            if (option.length === 0) {\n                throw new Error('Invalid number skeleton');\n            }\n        }\n        tokens.push({ stem: stem, options: options });\n    }\n    return tokens;\n}\nfunction icuUnitToEcma(unit) {\n    return unit.replace(/^(.*?)-/, '');\n}\nvar FRACTION_PRECISION_REGEX = /^\\.(?:(0+)(\\*)?|(#+)|(0+)(#+))$/g;\nvar SIGNIFICANT_PRECISION_REGEX = /^(@+)?(\\+|#+)?[rs]?$/g;\nvar INTEGER_WIDTH_REGEX = /(\\*)(0+)|(#+)(0+)|(0+)/g;\nvar CONCISE_INTEGER_WIDTH_REGEX = /^(0+)$/;\nfunction parseSignificantPrecision(str) {\n    var result = {};\n    if (str[str.length - 1] === 'r') {\n        result.roundingPriority = 'morePrecision';\n    }\n    else if (str[str.length - 1] === 's') {\n        result.roundingPriority = 'lessPrecision';\n    }\n    str.replace(SIGNIFICANT_PRECISION_REGEX, function (_, g1, g2) {\n        // @@@ case\n        if (typeof g2 !== 'string') {\n            result.minimumSignificantDigits = g1.length;\n            result.maximumSignificantDigits = g1.length;\n        }\n        // @@@+ case\n        else if (g2 === '+') {\n            result.minimumSignificantDigits = g1.length;\n        }\n        // .### case\n        else if (g1[0] === '#') {\n            result.maximumSignificantDigits = g1.length;\n        }\n        // .@@## or .@@@ case\n        else {\n            result.minimumSignificantDigits = g1.length;\n            result.maximumSignificantDigits =\n                g1.length + (typeof g2 === 'string' ? g2.length : 0);\n        }\n        return '';\n    });\n    return result;\n}\nfunction parseSign(str) {\n    switch (str) {\n        case 'sign-auto':\n            return {\n                signDisplay: 'auto',\n            };\n        case 'sign-accounting':\n        case '()':\n            return {\n                currencySign: 'accounting',\n            };\n        case 'sign-always':\n        case '+!':\n            return {\n                signDisplay: 'always',\n            };\n        case 'sign-accounting-always':\n        case '()!':\n            return {\n                signDisplay: 'always',\n                currencySign: 'accounting',\n            };\n        case 'sign-except-zero':\n        case '+?':\n            return {\n                signDisplay: 'exceptZero',\n            };\n        case 'sign-accounting-except-zero':\n        case '()?':\n            return {\n                signDisplay: 'exceptZero',\n                currencySign: 'accounting',\n            };\n        case 'sign-never':\n        case '+_':\n            return {\n                signDisplay: 'never',\n            };\n    }\n}\nfunction parseConciseScientificAndEngineeringStem(stem) {\n    // Engineering\n    var result;\n    if (stem[0] === 'E' && stem[1] === 'E') {\n        result = {\n            notation: 'engineering',\n        };\n        stem = stem.slice(2);\n    }\n    else if (stem[0] === 'E') {\n        result = {\n            notation: 'scientific',\n        };\n        stem = stem.slice(1);\n    }\n    if (result) {\n        var signDisplay = stem.slice(0, 2);\n        if (signDisplay === '+!') {\n            result.signDisplay = 'always';\n            stem = stem.slice(2);\n        }\n        else if (signDisplay === '+?') {\n            result.signDisplay = 'exceptZero';\n            stem = stem.slice(2);\n        }\n        if (!CONCISE_INTEGER_WIDTH_REGEX.test(stem)) {\n            throw new Error('Malformed concise eng/scientific notation');\n        }\n        result.minimumIntegerDigits = stem.length;\n    }\n    return result;\n}\nfunction parseNotationOptions(opt) {\n    var result = {};\n    var signOpts = parseSign(opt);\n    if (signOpts) {\n        return signOpts;\n    }\n    return result;\n}\n/**\n * https://github.com/unicode-org/icu/blob/master/docs/userguide/format_parse/numbers/skeletons.md#skeleton-stems-and-options\n */\nexport function parseNumberSkeleton(tokens) {\n    var result = {};\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        switch (token.stem) {\n            case 'percent':\n            case '%':\n                result.style = 'percent';\n                continue;\n            case '%x100':\n                result.style = 'percent';\n                result.scale = 100;\n                continue;\n            case 'currency':\n                result.style = 'currency';\n                result.currency = token.options[0];\n                continue;\n            case 'group-off':\n            case ',_':\n                result.useGrouping = false;\n                continue;\n            case 'precision-integer':\n            case '.':\n                result.maximumFractionDigits = 0;\n                continue;\n            case 'measure-unit':\n            case 'unit':\n                result.style = 'unit';\n                result.unit = icuUnitToEcma(token.options[0]);\n                continue;\n            case 'compact-short':\n            case 'K':\n                result.notation = 'compact';\n                result.compactDisplay = 'short';\n                continue;\n            case 'compact-long':\n            case 'KK':\n                result.notation = 'compact';\n                result.compactDisplay = 'long';\n                continue;\n            case 'scientific':\n                result = __assign(__assign(__assign({}, result), { notation: 'scientific' }), token.options.reduce(function (all, opt) { return (__assign(__assign({}, all), parseNotationOptions(opt))); }, {}));\n                continue;\n            case 'engineering':\n                result = __assign(__assign(__assign({}, result), { notation: 'engineering' }), token.options.reduce(function (all, opt) { return (__assign(__assign({}, all), parseNotationOptions(opt))); }, {}));\n                continue;\n            case 'notation-simple':\n                result.notation = 'standard';\n                continue;\n            // https://github.com/unicode-org/icu/blob/master/icu4c/source/i18n/unicode/unumberformatter.h\n            case 'unit-width-narrow':\n                result.currencyDisplay = 'narrowSymbol';\n                result.unitDisplay = 'narrow';\n                continue;\n            case 'unit-width-short':\n                result.currencyDisplay = 'code';\n                result.unitDisplay = 'short';\n                continue;\n            case 'unit-width-full-name':\n                result.currencyDisplay = 'name';\n                result.unitDisplay = 'long';\n                continue;\n            case 'unit-width-iso-code':\n                result.currencyDisplay = 'symbol';\n                continue;\n            case 'scale':\n                result.scale = parseFloat(token.options[0]);\n                continue;\n            case 'rounding-mode-floor':\n                result.roundingMode = 'floor';\n                continue;\n            case 'rounding-mode-ceiling':\n                result.roundingMode = 'ceil';\n                continue;\n            case 'rounding-mode-down':\n                result.roundingMode = 'trunc';\n                continue;\n            case 'rounding-mode-up':\n                result.roundingMode = 'expand';\n                continue;\n            case 'rounding-mode-half-even':\n                result.roundingMode = 'halfEven';\n                continue;\n            case 'rounding-mode-half-down':\n                result.roundingMode = 'halfTrunc';\n                continue;\n            case 'rounding-mode-half-up':\n                result.roundingMode = 'halfExpand';\n                continue;\n            // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#integer-width\n            case 'integer-width':\n                if (token.options.length > 1) {\n                    throw new RangeError('integer-width stems only accept a single optional option');\n                }\n                token.options[0].replace(INTEGER_WIDTH_REGEX, function (_, g1, g2, g3, g4, g5) {\n                    if (g1) {\n                        result.minimumIntegerDigits = g2.length;\n                    }\n                    else if (g3 && g4) {\n                        throw new Error('We currently do not support maximum integer digits');\n                    }\n                    else if (g5) {\n                        throw new Error('We currently do not support exact integer digits');\n                    }\n                    return '';\n                });\n                continue;\n        }\n        // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#integer-width\n        if (CONCISE_INTEGER_WIDTH_REGEX.test(token.stem)) {\n            result.minimumIntegerDigits = token.stem.length;\n            continue;\n        }\n        if (FRACTION_PRECISION_REGEX.test(token.stem)) {\n            // Precision\n            // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#fraction-precision\n            // precision-integer case\n            if (token.options.length > 1) {\n                throw new RangeError('Fraction-precision stems only accept a single optional option');\n            }\n            token.stem.replace(FRACTION_PRECISION_REGEX, function (_, g1, g2, g3, g4, g5) {\n                // .000* case (before ICU67 it was .000+)\n                if (g2 === '*') {\n                    result.minimumFractionDigits = g1.length;\n                }\n                // .### case\n                else if (g3 && g3[0] === '#') {\n                    result.maximumFractionDigits = g3.length;\n                }\n                // .00## case\n                else if (g4 && g5) {\n                    result.minimumFractionDigits = g4.length;\n                    result.maximumFractionDigits = g4.length + g5.length;\n                }\n                else {\n                    result.minimumFractionDigits = g1.length;\n                    result.maximumFractionDigits = g1.length;\n                }\n                return '';\n            });\n            var opt = token.options[0];\n            // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#trailing-zero-display\n            if (opt === 'w') {\n                result = __assign(__assign({}, result), { trailingZeroDisplay: 'stripIfInteger' });\n            }\n            else if (opt) {\n                result = __assign(__assign({}, result), parseSignificantPrecision(opt));\n            }\n            continue;\n        }\n        // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#significant-digits-precision\n        if (SIGNIFICANT_PRECISION_REGEX.test(token.stem)) {\n            result = __assign(__assign({}, result), parseSignificantPrecision(token.stem));\n            continue;\n        }\n        var signOpts = parseSign(token.stem);\n        if (signOpts) {\n            result = __assign(__assign({}, result), signOpts);\n        }\n        var conciseScientificAndEngineeringOpts = parseConciseScientificAndEngineeringStem(token.stem);\n        if (conciseScientificAndEngineeringOpts) {\n            result = __assign(__assign({}, result), conciseScientificAndEngineeringOpts);\n        }\n    }\n    return result;\n}\n","// @generated from time-data-gen.ts\n// prettier-ignore  \nexport var timeData = {\n    \"001\": [\n        \"H\",\n        \"h\"\n    ],\n    \"419\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"AC\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"AD\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"AE\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"AF\": [\n        \"H\",\n        \"hb\",\n        \"hB\",\n        \"h\"\n    ],\n    \"AG\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"AI\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"AL\": [\n        \"h\",\n        \"H\",\n        \"hB\"\n    ],\n    \"AM\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"AO\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"AR\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"AS\": [\n        \"h\",\n        \"H\"\n    ],\n    \"AT\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"AU\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"AW\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"AX\": [\n        \"H\"\n    ],\n    \"AZ\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"BA\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"BB\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"BD\": [\n        \"h\",\n        \"hB\",\n        \"H\"\n    ],\n    \"BE\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"BF\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"BG\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"BH\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"BI\": [\n        \"H\",\n        \"h\"\n    ],\n    \"BJ\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"BL\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"BM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"BN\": [\n        \"hb\",\n        \"hB\",\n        \"h\",\n        \"H\"\n    ],\n    \"BO\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"BQ\": [\n        \"H\"\n    ],\n    \"BR\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"BS\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"BT\": [\n        \"h\",\n        \"H\"\n    ],\n    \"BW\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"BY\": [\n        \"H\",\n        \"h\"\n    ],\n    \"BZ\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"CA\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"CC\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"CD\": [\n        \"hB\",\n        \"H\"\n    ],\n    \"CF\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"CG\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"CH\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"CI\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"CK\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"CL\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"CM\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"CN\": [\n        \"H\",\n        \"hB\",\n        \"hb\",\n        \"h\"\n    ],\n    \"CO\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"CP\": [\n        \"H\"\n    ],\n    \"CR\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"CU\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"CV\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"CW\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"CX\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"CY\": [\n        \"h\",\n        \"H\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"CZ\": [\n        \"H\"\n    ],\n    \"DE\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"DG\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"DJ\": [\n        \"h\",\n        \"H\"\n    ],\n    \"DK\": [\n        \"H\"\n    ],\n    \"DM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"DO\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"DZ\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"EA\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"EC\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"EE\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"EG\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"EH\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"ER\": [\n        \"h\",\n        \"H\"\n    ],\n    \"ES\": [\n        \"H\",\n        \"hB\",\n        \"h\",\n        \"hb\"\n    ],\n    \"ET\": [\n        \"hB\",\n        \"hb\",\n        \"h\",\n        \"H\"\n    ],\n    \"FI\": [\n        \"H\"\n    ],\n    \"FJ\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"FK\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"FM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"FO\": [\n        \"H\",\n        \"h\"\n    ],\n    \"FR\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"GA\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"GB\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"GD\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"GE\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"GF\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"GG\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"GH\": [\n        \"h\",\n        \"H\"\n    ],\n    \"GI\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"GL\": [\n        \"H\",\n        \"h\"\n    ],\n    \"GM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"GN\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"GP\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"GQ\": [\n        \"H\",\n        \"hB\",\n        \"h\",\n        \"hb\"\n    ],\n    \"GR\": [\n        \"h\",\n        \"H\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"GT\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"GU\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"GW\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"GY\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"HK\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"HN\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"HR\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"HU\": [\n        \"H\",\n        \"h\"\n    ],\n    \"IC\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"ID\": [\n        \"H\"\n    ],\n    \"IE\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"IL\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"IM\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"IN\": [\n        \"h\",\n        \"H\"\n    ],\n    \"IO\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"IQ\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"IR\": [\n        \"hB\",\n        \"H\"\n    ],\n    \"IS\": [\n        \"H\"\n    ],\n    \"IT\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"JE\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"JM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"JO\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"JP\": [\n        \"H\",\n        \"K\",\n        \"h\"\n    ],\n    \"KE\": [\n        \"hB\",\n        \"hb\",\n        \"H\",\n        \"h\"\n    ],\n    \"KG\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"KH\": [\n        \"hB\",\n        \"h\",\n        \"H\",\n        \"hb\"\n    ],\n    \"KI\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"KM\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"KN\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"KP\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"KR\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"KW\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"KY\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"KZ\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"LA\": [\n        \"H\",\n        \"hb\",\n        \"hB\",\n        \"h\"\n    ],\n    \"LB\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"LC\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"LI\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"LK\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"LR\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"LS\": [\n        \"h\",\n        \"H\"\n    ],\n    \"LT\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"LU\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"LV\": [\n        \"H\",\n        \"hB\",\n        \"hb\",\n        \"h\"\n    ],\n    \"LY\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"MA\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"MC\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"MD\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"ME\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"MF\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"MG\": [\n        \"H\",\n        \"h\"\n    ],\n    \"MH\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"MK\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"ML\": [\n        \"H\"\n    ],\n    \"MM\": [\n        \"hB\",\n        \"hb\",\n        \"H\",\n        \"h\"\n    ],\n    \"MN\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"MO\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"MP\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"MQ\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"MR\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"MS\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"MT\": [\n        \"H\",\n        \"h\"\n    ],\n    \"MU\": [\n        \"H\",\n        \"h\"\n    ],\n    \"MV\": [\n        \"H\",\n        \"h\"\n    ],\n    \"MW\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"MX\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"MY\": [\n        \"hb\",\n        \"hB\",\n        \"h\",\n        \"H\"\n    ],\n    \"MZ\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"NA\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"NC\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"NE\": [\n        \"H\"\n    ],\n    \"NF\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"NG\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"NI\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"NL\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"NO\": [\n        \"H\",\n        \"h\"\n    ],\n    \"NP\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"NR\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"NU\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"NZ\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"OM\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"PA\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"PE\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"PF\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"PG\": [\n        \"h\",\n        \"H\"\n    ],\n    \"PH\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"PK\": [\n        \"h\",\n        \"hB\",\n        \"H\"\n    ],\n    \"PL\": [\n        \"H\",\n        \"h\"\n    ],\n    \"PM\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"PN\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"PR\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"PS\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"PT\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"PW\": [\n        \"h\",\n        \"H\"\n    ],\n    \"PY\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"QA\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"RE\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"RO\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"RS\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"RU\": [\n        \"H\"\n    ],\n    \"RW\": [\n        \"H\",\n        \"h\"\n    ],\n    \"SA\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"SB\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"SC\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"SD\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"SE\": [\n        \"H\"\n    ],\n    \"SG\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"SH\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"SI\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"SJ\": [\n        \"H\"\n    ],\n    \"SK\": [\n        \"H\"\n    ],\n    \"SL\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"SM\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"SN\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"SO\": [\n        \"h\",\n        \"H\"\n    ],\n    \"SR\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"SS\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"ST\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"SV\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"SX\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"SY\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"SZ\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"TA\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"TC\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"TD\": [\n        \"h\",\n        \"H\",\n        \"hB\"\n    ],\n    \"TF\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"TG\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"TH\": [\n        \"H\",\n        \"h\"\n    ],\n    \"TJ\": [\n        \"H\",\n        \"h\"\n    ],\n    \"TL\": [\n        \"H\",\n        \"hB\",\n        \"hb\",\n        \"h\"\n    ],\n    \"TM\": [\n        \"H\",\n        \"h\"\n    ],\n    \"TN\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"TO\": [\n        \"h\",\n        \"H\"\n    ],\n    \"TR\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"TT\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"TW\": [\n        \"hB\",\n        \"hb\",\n        \"h\",\n        \"H\"\n    ],\n    \"TZ\": [\n        \"hB\",\n        \"hb\",\n        \"H\",\n        \"h\"\n    ],\n    \"UA\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"UG\": [\n        \"hB\",\n        \"hb\",\n        \"H\",\n        \"h\"\n    ],\n    \"UM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"US\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"UY\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"UZ\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"VA\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"VC\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"VE\": [\n        \"h\",\n        \"H\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"VG\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"VI\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"VN\": [\n        \"H\",\n        \"h\"\n    ],\n    \"VU\": [\n        \"h\",\n        \"H\"\n    ],\n    \"WF\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"WS\": [\n        \"h\",\n        \"H\"\n    ],\n    \"XK\": [\n        \"H\",\n        \"hB\",\n        \"h\"\n    ],\n    \"YE\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"YT\": [\n        \"H\",\n        \"hB\"\n    ],\n    \"ZA\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"ZM\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"ZW\": [\n        \"H\",\n        \"h\"\n    ],\n    \"af-ZA\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"ar-001\": [\n        \"h\",\n        \"hB\",\n        \"hb\",\n        \"H\"\n    ],\n    \"ca-ES\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"en-001\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"en-HK\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"en-IL\": [\n        \"H\",\n        \"h\",\n        \"hb\",\n        \"hB\"\n    ],\n    \"en-MY\": [\n        \"h\",\n        \"hb\",\n        \"H\",\n        \"hB\"\n    ],\n    \"es-BR\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"es-ES\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"es-GQ\": [\n        \"H\",\n        \"h\",\n        \"hB\",\n        \"hb\"\n    ],\n    \"fr-CA\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"gl-ES\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"gu-IN\": [\n        \"hB\",\n        \"hb\",\n        \"h\",\n        \"H\"\n    ],\n    \"hi-IN\": [\n        \"hB\",\n        \"h\",\n        \"H\"\n    ],\n    \"it-CH\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"it-IT\": [\n        \"H\",\n        \"h\",\n        \"hB\"\n    ],\n    \"kn-IN\": [\n        \"hB\",\n        \"h\",\n        \"H\"\n    ],\n    \"ml-IN\": [\n        \"hB\",\n        \"h\",\n        \"H\"\n    ],\n    \"mr-IN\": [\n        \"hB\",\n        \"hb\",\n        \"h\",\n        \"H\"\n    ],\n    \"pa-IN\": [\n        \"hB\",\n        \"hb\",\n        \"h\",\n        \"H\"\n    ],\n    \"ta-IN\": [\n        \"hB\",\n        \"h\",\n        \"hb\",\n        \"H\"\n    ],\n    \"te-IN\": [\n        \"hB\",\n        \"h\",\n        \"H\"\n    ],\n    \"zu-ZA\": [\n        \"H\",\n        \"hB\",\n        \"hb\",\n        \"h\"\n    ]\n};\n","import { timeData } from './time-data.generated';\n/**\n * Returns the best matching date time pattern if a date time skeleton\n * pattern is provided with a locale. Follows the Unicode specification:\n * https://www.unicode.org/reports/tr35/tr35-dates.html#table-mapping-requested-time-skeletons-to-patterns\n * @param skeleton date time skeleton pattern that possibly includes j, J or C\n * @param locale\n */\nexport function getBestPattern(skeleton, locale) {\n    var skeletonCopy = '';\n    for (var patternPos = 0; patternPos < skeleton.length; patternPos++) {\n        var patternChar = skeleton.charAt(patternPos);\n        if (patternChar === 'j') {\n            var extraLength = 0;\n            while (patternPos + 1 < skeleton.length &&\n                skeleton.charAt(patternPos + 1) === patternChar) {\n                extraLength++;\n                patternPos++;\n            }\n            var hourLen = 1 + (extraLength & 1);\n            var dayPeriodLen = extraLength < 2 ? 1 : 3 + (extraLength >> 1);\n            var dayPeriodChar = 'a';\n            var hourChar = getDefaultHourSymbolFromLocale(locale);\n            if (hourChar == 'H' || hourChar == 'k') {\n                dayPeriodLen = 0;\n            }\n            while (dayPeriodLen-- > 0) {\n                skeletonCopy += dayPeriodChar;\n            }\n            while (hourLen-- > 0) {\n                skeletonCopy = hourChar + skeletonCopy;\n            }\n        }\n        else if (patternChar === 'J') {\n            skeletonCopy += 'H';\n        }\n        else {\n            skeletonCopy += patternChar;\n        }\n    }\n    return skeletonCopy;\n}\n/**\n * Maps the [hour cycle type](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Locale/hourCycle)\n * of the given `locale` to the corresponding time pattern.\n * @param locale\n */\nfunction getDefaultHourSymbolFromLocale(locale) {\n    var hourCycle = locale.hourCycle;\n    if (hourCycle === undefined &&\n        // @ts-ignore hourCycle(s) is not identified yet\n        locale.hourCycles &&\n        // @ts-ignore\n        locale.hourCycles.length) {\n        // @ts-ignore\n        hourCycle = locale.hourCycles[0];\n    }\n    if (hourCycle) {\n        switch (hourCycle) {\n            case 'h24':\n                return 'k';\n            case 'h23':\n                return 'H';\n            case 'h12':\n                return 'h';\n            case 'h11':\n                return 'K';\n            default:\n                throw new Error('Invalid hourCycle');\n        }\n    }\n    // TODO: Once hourCycle is fully supported remove the following with data generation\n    var languageTag = locale.language;\n    var regionTag;\n    if (languageTag !== 'root') {\n        regionTag = locale.maximize().region;\n    }\n    var hourCycles = timeData[regionTag || ''] ||\n        timeData[languageTag || ''] ||\n        timeData[\"\".concat(languageTag, \"-001\")] ||\n        timeData['001'];\n    return hourCycles[0];\n}\n","var _a;\nimport { __assign } from \"tslib\";\nimport { ErrorKind } from './error';\nimport { SKELETON_TYPE, TYPE, } from './types';\nimport { SPACE_SEPARATOR_REGEX } from './regex.generated';\nimport { parseNumberSkeleton, parseNumberSkeletonFromString, parseDateTimeSkeleton, } from '@formatjs/icu-skeleton-parser';\nimport { getBestPattern } from './date-time-pattern-generator';\nvar SPACE_SEPARATOR_START_REGEX = new RegExp(\"^\".concat(SPACE_SEPARATOR_REGEX.source, \"*\"));\nvar SPACE_SEPARATOR_END_REGEX = new RegExp(\"\".concat(SPACE_SEPARATOR_REGEX.source, \"*$\"));\nfunction createLocation(start, end) {\n    return { start: start, end: end };\n}\n// #region Ponyfills\n// Consolidate these variables up top for easier toggling during debugging\nvar hasNativeStartsWith = !!String.prototype.startsWith && '_a'.startsWith('a', 1);\nvar hasNativeFromCodePoint = !!String.fromCodePoint;\nvar hasNativeFromEntries = !!Object.fromEntries;\nvar hasNativeCodePointAt = !!String.prototype.codePointAt;\nvar hasTrimStart = !!String.prototype.trimStart;\nvar hasTrimEnd = !!String.prototype.trimEnd;\nvar hasNativeIsSafeInteger = !!Number.isSafeInteger;\nvar isSafeInteger = hasNativeIsSafeInteger\n    ? Number.isSafeInteger\n    : function (n) {\n        return (typeof n === 'number' &&\n            isFinite(n) &&\n            Math.floor(n) === n &&\n            Math.abs(n) <= 0x1fffffffffffff);\n    };\n// IE11 does not support y and u.\nvar REGEX_SUPPORTS_U_AND_Y = true;\ntry {\n    var re = RE('([^\\\\p{White_Space}\\\\p{Pattern_Syntax}]*)', 'yu');\n    /**\n     * legacy Edge or Xbox One browser\n     * Unicode flag support: supported\n     * Pattern_Syntax support: not supported\n     * See https://github.com/formatjs/formatjs/issues/2822\n     */\n    REGEX_SUPPORTS_U_AND_Y = ((_a = re.exec('a')) === null || _a === void 0 ? void 0 : _a[0]) === 'a';\n}\ncatch (_) {\n    REGEX_SUPPORTS_U_AND_Y = false;\n}\nvar startsWith = hasNativeStartsWith\n    ? // Native\n        function startsWith(s, search, position) {\n            return s.startsWith(search, position);\n        }\n    : // For IE11\n        function startsWith(s, search, position) {\n            return s.slice(position, position + search.length) === search;\n        };\nvar fromCodePoint = hasNativeFromCodePoint\n    ? String.fromCodePoint\n    : // IE11\n        function fromCodePoint() {\n            var codePoints = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                codePoints[_i] = arguments[_i];\n            }\n            var elements = '';\n            var length = codePoints.length;\n            var i = 0;\n            var code;\n            while (length > i) {\n                code = codePoints[i++];\n                if (code > 0x10ffff)\n                    throw RangeError(code + ' is not a valid code point');\n                elements +=\n                    code < 0x10000\n                        ? String.fromCharCode(code)\n                        : String.fromCharCode(((code -= 0x10000) >> 10) + 0xd800, (code % 0x400) + 0xdc00);\n            }\n            return elements;\n        };\nvar fromEntries = \n// native\nhasNativeFromEntries\n    ? Object.fromEntries\n    : // Ponyfill\n        function fromEntries(entries) {\n            var obj = {};\n            for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {\n                var _a = entries_1[_i], k = _a[0], v = _a[1];\n                obj[k] = v;\n            }\n            return obj;\n        };\nvar codePointAt = hasNativeCodePointAt\n    ? // Native\n        function codePointAt(s, index) {\n            return s.codePointAt(index);\n        }\n    : // IE 11\n        function codePointAt(s, index) {\n            var size = s.length;\n            if (index < 0 || index >= size) {\n                return undefined;\n            }\n            var first = s.charCodeAt(index);\n            var second;\n            return first < 0xd800 ||\n                first > 0xdbff ||\n                index + 1 === size ||\n                (second = s.charCodeAt(index + 1)) < 0xdc00 ||\n                second > 0xdfff\n                ? first\n                : ((first - 0xd800) << 10) + (second - 0xdc00) + 0x10000;\n        };\nvar trimStart = hasTrimStart\n    ? // Native\n        function trimStart(s) {\n            return s.trimStart();\n        }\n    : // Ponyfill\n        function trimStart(s) {\n            return s.replace(SPACE_SEPARATOR_START_REGEX, '');\n        };\nvar trimEnd = hasTrimEnd\n    ? // Native\n        function trimEnd(s) {\n            return s.trimEnd();\n        }\n    : // Ponyfill\n        function trimEnd(s) {\n            return s.replace(SPACE_SEPARATOR_END_REGEX, '');\n        };\n// Prevent minifier to translate new RegExp to literal form that might cause syntax error on IE11.\nfunction RE(s, flag) {\n    return new RegExp(s, flag);\n}\n// #endregion\nvar matchIdentifierAtIndex;\nif (REGEX_SUPPORTS_U_AND_Y) {\n    // Native\n    var IDENTIFIER_PREFIX_RE_1 = RE('([^\\\\p{White_Space}\\\\p{Pattern_Syntax}]*)', 'yu');\n    matchIdentifierAtIndex = function matchIdentifierAtIndex(s, index) {\n        var _a;\n        IDENTIFIER_PREFIX_RE_1.lastIndex = index;\n        var match = IDENTIFIER_PREFIX_RE_1.exec(s);\n        return (_a = match[1]) !== null && _a !== void 0 ? _a : '';\n    };\n}\nelse {\n    // IE11\n    matchIdentifierAtIndex = function matchIdentifierAtIndex(s, index) {\n        var match = [];\n        while (true) {\n            var c = codePointAt(s, index);\n            if (c === undefined || _isWhiteSpace(c) || _isPatternSyntax(c)) {\n                break;\n            }\n            match.push(c);\n            index += c >= 0x10000 ? 2 : 1;\n        }\n        return fromCodePoint.apply(void 0, match);\n    };\n}\nvar Parser = /** @class */ (function () {\n    function Parser(message, options) {\n        if (options === void 0) { options = {}; }\n        this.message = message;\n        this.position = { offset: 0, line: 1, column: 1 };\n        this.ignoreTag = !!options.ignoreTag;\n        this.locale = options.locale;\n        this.requiresOtherClause = !!options.requiresOtherClause;\n        this.shouldParseSkeletons = !!options.shouldParseSkeletons;\n    }\n    Parser.prototype.parse = function () {\n        if (this.offset() !== 0) {\n            throw Error('parser can only be used once');\n        }\n        return this.parseMessage(0, '', false);\n    };\n    Parser.prototype.parseMessage = function (nestingLevel, parentArgType, expectingCloseTag) {\n        var elements = [];\n        while (!this.isEOF()) {\n            var char = this.char();\n            if (char === 123 /* `{` */) {\n                var result = this.parseArgument(nestingLevel, expectingCloseTag);\n                if (result.err) {\n                    return result;\n                }\n                elements.push(result.val);\n            }\n            else if (char === 125 /* `}` */ && nestingLevel > 0) {\n                break;\n            }\n            else if (char === 35 /* `#` */ &&\n                (parentArgType === 'plural' || parentArgType === 'selectordinal')) {\n                var position = this.clonePosition();\n                this.bump();\n                elements.push({\n                    type: TYPE.pound,\n                    location: createLocation(position, this.clonePosition()),\n                });\n            }\n            else if (char === 60 /* `<` */ &&\n                !this.ignoreTag &&\n                this.peek() === 47 // char code for '/'\n            ) {\n                if (expectingCloseTag) {\n                    break;\n                }\n                else {\n                    return this.error(ErrorKind.UNMATCHED_CLOSING_TAG, createLocation(this.clonePosition(), this.clonePosition()));\n                }\n            }\n            else if (char === 60 /* `<` */ &&\n                !this.ignoreTag &&\n                _isAlpha(this.peek() || 0)) {\n                var result = this.parseTag(nestingLevel, parentArgType);\n                if (result.err) {\n                    return result;\n                }\n                elements.push(result.val);\n            }\n            else {\n                var result = this.parseLiteral(nestingLevel, parentArgType);\n                if (result.err) {\n                    return result;\n                }\n                elements.push(result.val);\n            }\n        }\n        return { val: elements, err: null };\n    };\n    /**\n     * A tag name must start with an ASCII lower/upper case letter. The grammar is based on the\n     * [custom element name][] except that a dash is NOT always mandatory and uppercase letters\n     * are accepted:\n     *\n     * ```\n     * tag ::= \"<\" tagName (whitespace)* \"/>\" | \"<\" tagName (whitespace)* \">\" message \"</\" tagName (whitespace)* \">\"\n     * tagName ::= [a-z] (PENChar)*\n     * PENChar ::=\n     *     \"-\" | \".\" | [0-9] | \"_\" | [a-z] | [A-Z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x37D] |\n     *     [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] | [#x2C00-#x2FEF] |\n     *     [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\n     * ```\n     *\n     * [custom element name]: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name\n     * NOTE: We're a bit more lax here since HTML technically does not allow uppercase HTML element but we do\n     * since other tag-based engines like React allow it\n     */\n    Parser.prototype.parseTag = function (nestingLevel, parentArgType) {\n        var startPosition = this.clonePosition();\n        this.bump(); // `<`\n        var tagName = this.parseTagName();\n        this.bumpSpace();\n        if (this.bumpIf('/>')) {\n            // Self closing tag\n            return {\n                val: {\n                    type: TYPE.literal,\n                    value: \"<\".concat(tagName, \"/>\"),\n                    location: createLocation(startPosition, this.clonePosition()),\n                },\n                err: null,\n            };\n        }\n        else if (this.bumpIf('>')) {\n            var childrenResult = this.parseMessage(nestingLevel + 1, parentArgType, true);\n            if (childrenResult.err) {\n                return childrenResult;\n            }\n            var children = childrenResult.val;\n            // Expecting a close tag\n            var endTagStartPosition = this.clonePosition();\n            if (this.bumpIf('</')) {\n                if (this.isEOF() || !_isAlpha(this.char())) {\n                    return this.error(ErrorKind.INVALID_TAG, createLocation(endTagStartPosition, this.clonePosition()));\n                }\n                var closingTagNameStartPosition = this.clonePosition();\n                var closingTagName = this.parseTagName();\n                if (tagName !== closingTagName) {\n                    return this.error(ErrorKind.UNMATCHED_CLOSING_TAG, createLocation(closingTagNameStartPosition, this.clonePosition()));\n                }\n                this.bumpSpace();\n                if (!this.bumpIf('>')) {\n                    return this.error(ErrorKind.INVALID_TAG, createLocation(endTagStartPosition, this.clonePosition()));\n                }\n                return {\n                    val: {\n                        type: TYPE.tag,\n                        value: tagName,\n                        children: children,\n                        location: createLocation(startPosition, this.clonePosition()),\n                    },\n                    err: null,\n                };\n            }\n            else {\n                return this.error(ErrorKind.UNCLOSED_TAG, createLocation(startPosition, this.clonePosition()));\n            }\n        }\n        else {\n            return this.error(ErrorKind.INVALID_TAG, createLocation(startPosition, this.clonePosition()));\n        }\n    };\n    /**\n     * This method assumes that the caller has peeked ahead for the first tag character.\n     */\n    Parser.prototype.parseTagName = function () {\n        var startOffset = this.offset();\n        this.bump(); // the first tag name character\n        while (!this.isEOF() && _isPotentialElementNameChar(this.char())) {\n            this.bump();\n        }\n        return this.message.slice(startOffset, this.offset());\n    };\n    Parser.prototype.parseLiteral = function (nestingLevel, parentArgType) {\n        var start = this.clonePosition();\n        var value = '';\n        while (true) {\n            var parseQuoteResult = this.tryParseQuote(parentArgType);\n            if (parseQuoteResult) {\n                value += parseQuoteResult;\n                continue;\n            }\n            var parseUnquotedResult = this.tryParseUnquoted(nestingLevel, parentArgType);\n            if (parseUnquotedResult) {\n                value += parseUnquotedResult;\n                continue;\n            }\n            var parseLeftAngleResult = this.tryParseLeftAngleBracket();\n            if (parseLeftAngleResult) {\n                value += parseLeftAngleResult;\n                continue;\n            }\n            break;\n        }\n        var location = createLocation(start, this.clonePosition());\n        return {\n            val: { type: TYPE.literal, value: value, location: location },\n            err: null,\n        };\n    };\n    Parser.prototype.tryParseLeftAngleBracket = function () {\n        if (!this.isEOF() &&\n            this.char() === 60 /* `<` */ &&\n            (this.ignoreTag ||\n                // If at the opening tag or closing tag position, bail.\n                !_isAlphaOrSlash(this.peek() || 0))) {\n            this.bump(); // `<`\n            return '<';\n        }\n        return null;\n    };\n    /**\n     * Starting with ICU 4.8, an ASCII apostrophe only starts quoted text if it immediately precedes\n     * a character that requires quoting (that is, \"only where needed\"), and works the same in\n     * nested messages as on the top level of the pattern. The new behavior is otherwise compatible.\n     */\n    Parser.prototype.tryParseQuote = function (parentArgType) {\n        if (this.isEOF() || this.char() !== 39 /* `'` */) {\n            return null;\n        }\n        // Parse escaped char following the apostrophe, or early return if there is no escaped char.\n        // Check if is valid escaped character\n        switch (this.peek()) {\n            case 39 /* `'` */:\n                // double quote, should return as a single quote.\n                this.bump();\n                this.bump();\n                return \"'\";\n            // '{', '<', '>', '}'\n            case 123:\n            case 60:\n            case 62:\n            case 125:\n                break;\n            case 35: // '#'\n                if (parentArgType === 'plural' || parentArgType === 'selectordinal') {\n                    break;\n                }\n                return null;\n            default:\n                return null;\n        }\n        this.bump(); // apostrophe\n        var codePoints = [this.char()]; // escaped char\n        this.bump();\n        // read chars until the optional closing apostrophe is found\n        while (!this.isEOF()) {\n            var ch = this.char();\n            if (ch === 39 /* `'` */) {\n                if (this.peek() === 39 /* `'` */) {\n                    codePoints.push(39);\n                    // Bump one more time because we need to skip 2 characters.\n                    this.bump();\n                }\n                else {\n                    // Optional closing apostrophe.\n                    this.bump();\n                    break;\n                }\n            }\n            else {\n                codePoints.push(ch);\n            }\n            this.bump();\n        }\n        return fromCodePoint.apply(void 0, codePoints);\n    };\n    Parser.prototype.tryParseUnquoted = function (nestingLevel, parentArgType) {\n        if (this.isEOF()) {\n            return null;\n        }\n        var ch = this.char();\n        if (ch === 60 /* `<` */ ||\n            ch === 123 /* `{` */ ||\n            (ch === 35 /* `#` */ &&\n                (parentArgType === 'plural' || parentArgType === 'selectordinal')) ||\n            (ch === 125 /* `}` */ && nestingLevel > 0)) {\n            return null;\n        }\n        else {\n            this.bump();\n            return fromCodePoint(ch);\n        }\n    };\n    Parser.prototype.parseArgument = function (nestingLevel, expectingCloseTag) {\n        var openingBracePosition = this.clonePosition();\n        this.bump(); // `{`\n        this.bumpSpace();\n        if (this.isEOF()) {\n            return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        if (this.char() === 125 /* `}` */) {\n            this.bump();\n            return this.error(ErrorKind.EMPTY_ARGUMENT, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        // argument name\n        var value = this.parseIdentifierIfPossible().value;\n        if (!value) {\n            return this.error(ErrorKind.MALFORMED_ARGUMENT, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        this.bumpSpace();\n        if (this.isEOF()) {\n            return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        switch (this.char()) {\n            // Simple argument: `{name}`\n            case 125 /* `}` */: {\n                this.bump(); // `}`\n                return {\n                    val: {\n                        type: TYPE.argument,\n                        // value does not include the opening and closing braces.\n                        value: value,\n                        location: createLocation(openingBracePosition, this.clonePosition()),\n                    },\n                    err: null,\n                };\n            }\n            // Argument with options: `{name, format, ...}`\n            case 44 /* `,` */: {\n                this.bump(); // `,`\n                this.bumpSpace();\n                if (this.isEOF()) {\n                    return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n                }\n                return this.parseArgumentOptions(nestingLevel, expectingCloseTag, value, openingBracePosition);\n            }\n            default:\n                return this.error(ErrorKind.MALFORMED_ARGUMENT, createLocation(openingBracePosition, this.clonePosition()));\n        }\n    };\n    /**\n     * Advance the parser until the end of the identifier, if it is currently on\n     * an identifier character. Return an empty string otherwise.\n     */\n    Parser.prototype.parseIdentifierIfPossible = function () {\n        var startingPosition = this.clonePosition();\n        var startOffset = this.offset();\n        var value = matchIdentifierAtIndex(this.message, startOffset);\n        var endOffset = startOffset + value.length;\n        this.bumpTo(endOffset);\n        var endPosition = this.clonePosition();\n        var location = createLocation(startingPosition, endPosition);\n        return { value: value, location: location };\n    };\n    Parser.prototype.parseArgumentOptions = function (nestingLevel, expectingCloseTag, value, openingBracePosition) {\n        var _a;\n        // Parse this range:\n        // {name, type, style}\n        //        ^---^\n        var typeStartPosition = this.clonePosition();\n        var argType = this.parseIdentifierIfPossible().value;\n        var typeEndPosition = this.clonePosition();\n        switch (argType) {\n            case '':\n                // Expecting a style string number, date, time, plural, selectordinal, or select.\n                return this.error(ErrorKind.EXPECT_ARGUMENT_TYPE, createLocation(typeStartPosition, typeEndPosition));\n            case 'number':\n            case 'date':\n            case 'time': {\n                // Parse this range:\n                // {name, number, style}\n                //              ^-------^\n                this.bumpSpace();\n                var styleAndLocation = null;\n                if (this.bumpIf(',')) {\n                    this.bumpSpace();\n                    var styleStartPosition = this.clonePosition();\n                    var result = this.parseSimpleArgStyleIfPossible();\n                    if (result.err) {\n                        return result;\n                    }\n                    var style = trimEnd(result.val);\n                    if (style.length === 0) {\n                        return this.error(ErrorKind.EXPECT_ARGUMENT_STYLE, createLocation(this.clonePosition(), this.clonePosition()));\n                    }\n                    var styleLocation = createLocation(styleStartPosition, this.clonePosition());\n                    styleAndLocation = { style: style, styleLocation: styleLocation };\n                }\n                var argCloseResult = this.tryParseArgumentClose(openingBracePosition);\n                if (argCloseResult.err) {\n                    return argCloseResult;\n                }\n                var location_1 = createLocation(openingBracePosition, this.clonePosition());\n                // Extract style or skeleton\n                if (styleAndLocation && startsWith(styleAndLocation === null || styleAndLocation === void 0 ? void 0 : styleAndLocation.style, '::', 0)) {\n                    // Skeleton starts with `::`.\n                    var skeleton = trimStart(styleAndLocation.style.slice(2));\n                    if (argType === 'number') {\n                        var result = this.parseNumberSkeletonFromString(skeleton, styleAndLocation.styleLocation);\n                        if (result.err) {\n                            return result;\n                        }\n                        return {\n                            val: { type: TYPE.number, value: value, location: location_1, style: result.val },\n                            err: null,\n                        };\n                    }\n                    else {\n                        if (skeleton.length === 0) {\n                            return this.error(ErrorKind.EXPECT_DATE_TIME_SKELETON, location_1);\n                        }\n                        var dateTimePattern = skeleton;\n                        // Get \"best match\" pattern only if locale is passed, if not, let it\n                        // pass as-is where `parseDateTimeSkeleton()` will throw an error\n                        // for unsupported patterns.\n                        if (this.locale) {\n                            dateTimePattern = getBestPattern(skeleton, this.locale);\n                        }\n                        var style = {\n                            type: SKELETON_TYPE.dateTime,\n                            pattern: dateTimePattern,\n                            location: styleAndLocation.styleLocation,\n                            parsedOptions: this.shouldParseSkeletons\n                                ? parseDateTimeSkeleton(dateTimePattern)\n                                : {},\n                        };\n                        var type = argType === 'date' ? TYPE.date : TYPE.time;\n                        return {\n                            val: { type: type, value: value, location: location_1, style: style },\n                            err: null,\n                        };\n                    }\n                }\n                // Regular style or no style.\n                return {\n                    val: {\n                        type: argType === 'number'\n                            ? TYPE.number\n                            : argType === 'date'\n                                ? TYPE.date\n                                : TYPE.time,\n                        value: value,\n                        location: location_1,\n                        style: (_a = styleAndLocation === null || styleAndLocation === void 0 ? void 0 : styleAndLocation.style) !== null && _a !== void 0 ? _a : null,\n                    },\n                    err: null,\n                };\n            }\n            case 'plural':\n            case 'selectordinal':\n            case 'select': {\n                // Parse this range:\n                // {name, plural, options}\n                //              ^---------^\n                var typeEndPosition_1 = this.clonePosition();\n                this.bumpSpace();\n                if (!this.bumpIf(',')) {\n                    return this.error(ErrorKind.EXPECT_SELECT_ARGUMENT_OPTIONS, createLocation(typeEndPosition_1, __assign({}, typeEndPosition_1)));\n                }\n                this.bumpSpace();\n                // Parse offset:\n                // {name, plural, offset:1, options}\n                //                ^-----^\n                //\n                // or the first option:\n                //\n                // {name, plural, one {...} other {...}}\n                //                ^--^\n                var identifierAndLocation = this.parseIdentifierIfPossible();\n                var pluralOffset = 0;\n                if (argType !== 'select' && identifierAndLocation.value === 'offset') {\n                    if (!this.bumpIf(':')) {\n                        return this.error(ErrorKind.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE, createLocation(this.clonePosition(), this.clonePosition()));\n                    }\n                    this.bumpSpace();\n                    var result = this.tryParseDecimalInteger(ErrorKind.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE, ErrorKind.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);\n                    if (result.err) {\n                        return result;\n                    }\n                    // Parse another identifier for option parsing\n                    this.bumpSpace();\n                    identifierAndLocation = this.parseIdentifierIfPossible();\n                    pluralOffset = result.val;\n                }\n                var optionsResult = this.tryParsePluralOrSelectOptions(nestingLevel, argType, expectingCloseTag, identifierAndLocation);\n                if (optionsResult.err) {\n                    return optionsResult;\n                }\n                var argCloseResult = this.tryParseArgumentClose(openingBracePosition);\n                if (argCloseResult.err) {\n                    return argCloseResult;\n                }\n                var location_2 = createLocation(openingBracePosition, this.clonePosition());\n                if (argType === 'select') {\n                    return {\n                        val: {\n                            type: TYPE.select,\n                            value: value,\n                            options: fromEntries(optionsResult.val),\n                            location: location_2,\n                        },\n                        err: null,\n                    };\n                }\n                else {\n                    return {\n                        val: {\n                            type: TYPE.plural,\n                            value: value,\n                            options: fromEntries(optionsResult.val),\n                            offset: pluralOffset,\n                            pluralType: argType === 'plural' ? 'cardinal' : 'ordinal',\n                            location: location_2,\n                        },\n                        err: null,\n                    };\n                }\n            }\n            default:\n                return this.error(ErrorKind.INVALID_ARGUMENT_TYPE, createLocation(typeStartPosition, typeEndPosition));\n        }\n    };\n    Parser.prototype.tryParseArgumentClose = function (openingBracePosition) {\n        // Parse: {value, number, ::currency/GBP }\n        //\n        if (this.isEOF() || this.char() !== 125 /* `}` */) {\n            return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        this.bump(); // `}`\n        return { val: true, err: null };\n    };\n    /**\n     * See: https://github.com/unicode-org/icu/blob/af7ed1f6d2298013dc303628438ec4abe1f16479/icu4c/source/common/messagepattern.cpp#L659\n     */\n    Parser.prototype.parseSimpleArgStyleIfPossible = function () {\n        var nestedBraces = 0;\n        var startPosition = this.clonePosition();\n        while (!this.isEOF()) {\n            var ch = this.char();\n            switch (ch) {\n                case 39 /* `'` */: {\n                    // Treat apostrophe as quoting but include it in the style part.\n                    // Find the end of the quoted literal text.\n                    this.bump();\n                    var apostrophePosition = this.clonePosition();\n                    if (!this.bumpUntil(\"'\")) {\n                        return this.error(ErrorKind.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE, createLocation(apostrophePosition, this.clonePosition()));\n                    }\n                    this.bump();\n                    break;\n                }\n                case 123 /* `{` */: {\n                    nestedBraces += 1;\n                    this.bump();\n                    break;\n                }\n                case 125 /* `}` */: {\n                    if (nestedBraces > 0) {\n                        nestedBraces -= 1;\n                    }\n                    else {\n                        return {\n                            val: this.message.slice(startPosition.offset, this.offset()),\n                            err: null,\n                        };\n                    }\n                    break;\n                }\n                default:\n                    this.bump();\n                    break;\n            }\n        }\n        return {\n            val: this.message.slice(startPosition.offset, this.offset()),\n            err: null,\n        };\n    };\n    Parser.prototype.parseNumberSkeletonFromString = function (skeleton, location) {\n        var tokens = [];\n        try {\n            tokens = parseNumberSkeletonFromString(skeleton);\n        }\n        catch (e) {\n            return this.error(ErrorKind.INVALID_NUMBER_SKELETON, location);\n        }\n        return {\n            val: {\n                type: SKELETON_TYPE.number,\n                tokens: tokens,\n                location: location,\n                parsedOptions: this.shouldParseSkeletons\n                    ? parseNumberSkeleton(tokens)\n                    : {},\n            },\n            err: null,\n        };\n    };\n    /**\n     * @param nesting_level The current nesting level of messages.\n     *     This can be positive when parsing message fragment in select or plural argument options.\n     * @param parent_arg_type The parent argument's type.\n     * @param parsed_first_identifier If provided, this is the first identifier-like selector of\n     *     the argument. It is a by-product of a previous parsing attempt.\n     * @param expecting_close_tag If true, this message is directly or indirectly nested inside\n     *     between a pair of opening and closing tags. The nested message will not parse beyond\n     *     the closing tag boundary.\n     */\n    Parser.prototype.tryParsePluralOrSelectOptions = function (nestingLevel, parentArgType, expectCloseTag, parsedFirstIdentifier) {\n        var _a;\n        var hasOtherClause = false;\n        var options = [];\n        var parsedSelectors = new Set();\n        var selector = parsedFirstIdentifier.value, selectorLocation = parsedFirstIdentifier.location;\n        // Parse:\n        // one {one apple}\n        // ^--^\n        while (true) {\n            if (selector.length === 0) {\n                var startPosition = this.clonePosition();\n                if (parentArgType !== 'select' && this.bumpIf('=')) {\n                    // Try parse `={number}` selector\n                    var result = this.tryParseDecimalInteger(ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR, ErrorKind.INVALID_PLURAL_ARGUMENT_SELECTOR);\n                    if (result.err) {\n                        return result;\n                    }\n                    selectorLocation = createLocation(startPosition, this.clonePosition());\n                    selector = this.message.slice(startPosition.offset, this.offset());\n                }\n                else {\n                    break;\n                }\n            }\n            // Duplicate selector clauses\n            if (parsedSelectors.has(selector)) {\n                return this.error(parentArgType === 'select'\n                    ? ErrorKind.DUPLICATE_SELECT_ARGUMENT_SELECTOR\n                    : ErrorKind.DUPLICATE_PLURAL_ARGUMENT_SELECTOR, selectorLocation);\n            }\n            if (selector === 'other') {\n                hasOtherClause = true;\n            }\n            // Parse:\n            // one {one apple}\n            //     ^----------^\n            this.bumpSpace();\n            var openingBracePosition = this.clonePosition();\n            if (!this.bumpIf('{')) {\n                return this.error(parentArgType === 'select'\n                    ? ErrorKind.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT\n                    : ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT, createLocation(this.clonePosition(), this.clonePosition()));\n            }\n            var fragmentResult = this.parseMessage(nestingLevel + 1, parentArgType, expectCloseTag);\n            if (fragmentResult.err) {\n                return fragmentResult;\n            }\n            var argCloseResult = this.tryParseArgumentClose(openingBracePosition);\n            if (argCloseResult.err) {\n                return argCloseResult;\n            }\n            options.push([\n                selector,\n                {\n                    value: fragmentResult.val,\n                    location: createLocation(openingBracePosition, this.clonePosition()),\n                },\n            ]);\n            // Keep track of the existing selectors\n            parsedSelectors.add(selector);\n            // Prep next selector clause.\n            this.bumpSpace();\n            (_a = this.parseIdentifierIfPossible(), selector = _a.value, selectorLocation = _a.location);\n        }\n        if (options.length === 0) {\n            return this.error(parentArgType === 'select'\n                ? ErrorKind.EXPECT_SELECT_ARGUMENT_SELECTOR\n                : ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR, createLocation(this.clonePosition(), this.clonePosition()));\n        }\n        if (this.requiresOtherClause && !hasOtherClause) {\n            return this.error(ErrorKind.MISSING_OTHER_CLAUSE, createLocation(this.clonePosition(), this.clonePosition()));\n        }\n        return { val: options, err: null };\n    };\n    Parser.prototype.tryParseDecimalInteger = function (expectNumberError, invalidNumberError) {\n        var sign = 1;\n        var startingPosition = this.clonePosition();\n        if (this.bumpIf('+')) {\n        }\n        else if (this.bumpIf('-')) {\n            sign = -1;\n        }\n        var hasDigits = false;\n        var decimal = 0;\n        while (!this.isEOF()) {\n            var ch = this.char();\n            if (ch >= 48 /* `0` */ && ch <= 57 /* `9` */) {\n                hasDigits = true;\n                decimal = decimal * 10 + (ch - 48);\n                this.bump();\n            }\n            else {\n                break;\n            }\n        }\n        var location = createLocation(startingPosition, this.clonePosition());\n        if (!hasDigits) {\n            return this.error(expectNumberError, location);\n        }\n        decimal *= sign;\n        if (!isSafeInteger(decimal)) {\n            return this.error(invalidNumberError, location);\n        }\n        return { val: decimal, err: null };\n    };\n    Parser.prototype.offset = function () {\n        return this.position.offset;\n    };\n    Parser.prototype.isEOF = function () {\n        return this.offset() === this.message.length;\n    };\n    Parser.prototype.clonePosition = function () {\n        // This is much faster than `Object.assign` or spread.\n        return {\n            offset: this.position.offset,\n            line: this.position.line,\n            column: this.position.column,\n        };\n    };\n    /**\n     * Return the code point at the current position of the parser.\n     * Throws if the index is out of bound.\n     */\n    Parser.prototype.char = function () {\n        var offset = this.position.offset;\n        if (offset >= this.message.length) {\n            throw Error('out of bound');\n        }\n        var code = codePointAt(this.message, offset);\n        if (code === undefined) {\n            throw Error(\"Offset \".concat(offset, \" is at invalid UTF-16 code unit boundary\"));\n        }\n        return code;\n    };\n    Parser.prototype.error = function (kind, location) {\n        return {\n            val: null,\n            err: {\n                kind: kind,\n                message: this.message,\n                location: location,\n            },\n        };\n    };\n    /** Bump the parser to the next UTF-16 code unit. */\n    Parser.prototype.bump = function () {\n        if (this.isEOF()) {\n            return;\n        }\n        var code = this.char();\n        if (code === 10 /* '\\n' */) {\n            this.position.line += 1;\n            this.position.column = 1;\n            this.position.offset += 1;\n        }\n        else {\n            this.position.column += 1;\n            // 0 ~ 0x10000 -> unicode BMP, otherwise skip the surrogate pair.\n            this.position.offset += code < 0x10000 ? 1 : 2;\n        }\n    };\n    /**\n     * If the substring starting at the current position of the parser has\n     * the given prefix, then bump the parser to the character immediately\n     * following the prefix and return true. Otherwise, don't bump the parser\n     * and return false.\n     */\n    Parser.prototype.bumpIf = function (prefix) {\n        if (startsWith(this.message, prefix, this.offset())) {\n            for (var i = 0; i < prefix.length; i++) {\n                this.bump();\n            }\n            return true;\n        }\n        return false;\n    };\n    /**\n     * Bump the parser until the pattern character is found and return `true`.\n     * Otherwise bump to the end of the file and return `false`.\n     */\n    Parser.prototype.bumpUntil = function (pattern) {\n        var currentOffset = this.offset();\n        var index = this.message.indexOf(pattern, currentOffset);\n        if (index >= 0) {\n            this.bumpTo(index);\n            return true;\n        }\n        else {\n            this.bumpTo(this.message.length);\n            return false;\n        }\n    };\n    /**\n     * Bump the parser to the target offset.\n     * If target offset is beyond the end of the input, bump the parser to the end of the input.\n     */\n    Parser.prototype.bumpTo = function (targetOffset) {\n        if (this.offset() > targetOffset) {\n            throw Error(\"targetOffset \".concat(targetOffset, \" must be greater than or equal to the current offset \").concat(this.offset()));\n        }\n        targetOffset = Math.min(targetOffset, this.message.length);\n        while (true) {\n            var offset = this.offset();\n            if (offset === targetOffset) {\n                break;\n            }\n            if (offset > targetOffset) {\n                throw Error(\"targetOffset \".concat(targetOffset, \" is at invalid UTF-16 code unit boundary\"));\n            }\n            this.bump();\n            if (this.isEOF()) {\n                break;\n            }\n        }\n    };\n    /** advance the parser through all whitespace to the next non-whitespace code unit. */\n    Parser.prototype.bumpSpace = function () {\n        while (!this.isEOF() && _isWhiteSpace(this.char())) {\n            this.bump();\n        }\n    };\n    /**\n     * Peek at the *next* Unicode codepoint in the input without advancing the parser.\n     * If the input has been exhausted, then this returns null.\n     */\n    Parser.prototype.peek = function () {\n        if (this.isEOF()) {\n            return null;\n        }\n        var code = this.char();\n        var offset = this.offset();\n        var nextCode = this.message.charCodeAt(offset + (code >= 0x10000 ? 2 : 1));\n        return nextCode !== null && nextCode !== void 0 ? nextCode : null;\n    };\n    return Parser;\n}());\nexport { Parser };\n/**\n * This check if codepoint is alphabet (lower & uppercase)\n * @param codepoint\n * @returns\n */\nfunction _isAlpha(codepoint) {\n    return ((codepoint >= 97 && codepoint <= 122) ||\n        (codepoint >= 65 && codepoint <= 90));\n}\nfunction _isAlphaOrSlash(codepoint) {\n    return _isAlpha(codepoint) || codepoint === 47; /* '/' */\n}\n/** See `parseTag` function docs. */\nfunction _isPotentialElementNameChar(c) {\n    return (c === 45 /* '-' */ ||\n        c === 46 /* '.' */ ||\n        (c >= 48 && c <= 57) /* 0..9 */ ||\n        c === 95 /* '_' */ ||\n        (c >= 97 && c <= 122) /** a..z */ ||\n        (c >= 65 && c <= 90) /* A..Z */ ||\n        c == 0xb7 ||\n        (c >= 0xc0 && c <= 0xd6) ||\n        (c >= 0xd8 && c <= 0xf6) ||\n        (c >= 0xf8 && c <= 0x37d) ||\n        (c >= 0x37f && c <= 0x1fff) ||\n        (c >= 0x200c && c <= 0x200d) ||\n        (c >= 0x203f && c <= 0x2040) ||\n        (c >= 0x2070 && c <= 0x218f) ||\n        (c >= 0x2c00 && c <= 0x2fef) ||\n        (c >= 0x3001 && c <= 0xd7ff) ||\n        (c >= 0xf900 && c <= 0xfdcf) ||\n        (c >= 0xfdf0 && c <= 0xfffd) ||\n        (c >= 0x10000 && c <= 0xeffff));\n}\n/**\n * Code point equivalent of regex `\\p{White_Space}`.\n * From: https://www.unicode.org/Public/UCD/latest/ucd/PropList.txt\n */\nfunction _isWhiteSpace(c) {\n    return ((c >= 0x0009 && c <= 0x000d) ||\n        c === 0x0020 ||\n        c === 0x0085 ||\n        (c >= 0x200e && c <= 0x200f) ||\n        c === 0x2028 ||\n        c === 0x2029);\n}\n/**\n * Code point equivalent of regex `\\p{Pattern_Syntax}`.\n * See https://www.unicode.org/Public/UCD/latest/ucd/PropList.txt\n */\nfunction _isPatternSyntax(c) {\n    return ((c >= 0x0021 && c <= 0x0023) ||\n        c === 0x0024 ||\n        (c >= 0x0025 && c <= 0x0027) ||\n        c === 0x0028 ||\n        c === 0x0029 ||\n        c === 0x002a ||\n        c === 0x002b ||\n        c === 0x002c ||\n        c === 0x002d ||\n        (c >= 0x002e && c <= 0x002f) ||\n        (c >= 0x003a && c <= 0x003b) ||\n        (c >= 0x003c && c <= 0x003e) ||\n        (c >= 0x003f && c <= 0x0040) ||\n        c === 0x005b ||\n        c === 0x005c ||\n        c === 0x005d ||\n        c === 0x005e ||\n        c === 0x0060 ||\n        c === 0x007b ||\n        c === 0x007c ||\n        c === 0x007d ||\n        c === 0x007e ||\n        c === 0x00a1 ||\n        (c >= 0x00a2 && c <= 0x00a5) ||\n        c === 0x00a6 ||\n        c === 0x00a7 ||\n        c === 0x00a9 ||\n        c === 0x00ab ||\n        c === 0x00ac ||\n        c === 0x00ae ||\n        c === 0x00b0 ||\n        c === 0x00b1 ||\n        c === 0x00b6 ||\n        c === 0x00bb ||\n        c === 0x00bf ||\n        c === 0x00d7 ||\n        c === 0x00f7 ||\n        (c >= 0x2010 && c <= 0x2015) ||\n        (c >= 0x2016 && c <= 0x2017) ||\n        c === 0x2018 ||\n        c === 0x2019 ||\n        c === 0x201a ||\n        (c >= 0x201b && c <= 0x201c) ||\n        c === 0x201d ||\n        c === 0x201e ||\n        c === 0x201f ||\n        (c >= 0x2020 && c <= 0x2027) ||\n        (c >= 0x2030 && c <= 0x2038) ||\n        c === 0x2039 ||\n        c === 0x203a ||\n        (c >= 0x203b && c <= 0x203e) ||\n        (c >= 0x2041 && c <= 0x2043) ||\n        c === 0x2044 ||\n        c === 0x2045 ||\n        c === 0x2046 ||\n        (c >= 0x2047 && c <= 0x2051) ||\n        c === 0x2052 ||\n        c === 0x2053 ||\n        (c >= 0x2055 && c <= 0x205e) ||\n        (c >= 0x2190 && c <= 0x2194) ||\n        (c >= 0x2195 && c <= 0x2199) ||\n        (c >= 0x219a && c <= 0x219b) ||\n        (c >= 0x219c && c <= 0x219f) ||\n        c === 0x21a0 ||\n        (c >= 0x21a1 && c <= 0x21a2) ||\n        c === 0x21a3 ||\n        (c >= 0x21a4 && c <= 0x21a5) ||\n        c === 0x21a6 ||\n        (c >= 0x21a7 && c <= 0x21ad) ||\n        c === 0x21ae ||\n        (c >= 0x21af && c <= 0x21cd) ||\n        (c >= 0x21ce && c <= 0x21cf) ||\n        (c >= 0x21d0 && c <= 0x21d1) ||\n        c === 0x21d2 ||\n        c === 0x21d3 ||\n        c === 0x21d4 ||\n        (c >= 0x21d5 && c <= 0x21f3) ||\n        (c >= 0x21f4 && c <= 0x22ff) ||\n        (c >= 0x2300 && c <= 0x2307) ||\n        c === 0x2308 ||\n        c === 0x2309 ||\n        c === 0x230a ||\n        c === 0x230b ||\n        (c >= 0x230c && c <= 0x231f) ||\n        (c >= 0x2320 && c <= 0x2321) ||\n        (c >= 0x2322 && c <= 0x2328) ||\n        c === 0x2329 ||\n        c === 0x232a ||\n        (c >= 0x232b && c <= 0x237b) ||\n        c === 0x237c ||\n        (c >= 0x237d && c <= 0x239a) ||\n        (c >= 0x239b && c <= 0x23b3) ||\n        (c >= 0x23b4 && c <= 0x23db) ||\n        (c >= 0x23dc && c <= 0x23e1) ||\n        (c >= 0x23e2 && c <= 0x2426) ||\n        (c >= 0x2427 && c <= 0x243f) ||\n        (c >= 0x2440 && c <= 0x244a) ||\n        (c >= 0x244b && c <= 0x245f) ||\n        (c >= 0x2500 && c <= 0x25b6) ||\n        c === 0x25b7 ||\n        (c >= 0x25b8 && c <= 0x25c0) ||\n        c === 0x25c1 ||\n        (c >= 0x25c2 && c <= 0x25f7) ||\n        (c >= 0x25f8 && c <= 0x25ff) ||\n        (c >= 0x2600 && c <= 0x266e) ||\n        c === 0x266f ||\n        (c >= 0x2670 && c <= 0x2767) ||\n        c === 0x2768 ||\n        c === 0x2769 ||\n        c === 0x276a ||\n        c === 0x276b ||\n        c === 0x276c ||\n        c === 0x276d ||\n        c === 0x276e ||\n        c === 0x276f ||\n        c === 0x2770 ||\n        c === 0x2771 ||\n        c === 0x2772 ||\n        c === 0x2773 ||\n        c === 0x2774 ||\n        c === 0x2775 ||\n        (c >= 0x2794 && c <= 0x27bf) ||\n        (c >= 0x27c0 && c <= 0x27c4) ||\n        c === 0x27c5 ||\n        c === 0x27c6 ||\n        (c >= 0x27c7 && c <= 0x27e5) ||\n        c === 0x27e6 ||\n        c === 0x27e7 ||\n        c === 0x27e8 ||\n        c === 0x27e9 ||\n        c === 0x27ea ||\n        c === 0x27eb ||\n        c === 0x27ec ||\n        c === 0x27ed ||\n        c === 0x27ee ||\n        c === 0x27ef ||\n        (c >= 0x27f0 && c <= 0x27ff) ||\n        (c >= 0x2800 && c <= 0x28ff) ||\n        (c >= 0x2900 && c <= 0x2982) ||\n        c === 0x2983 ||\n        c === 0x2984 ||\n        c === 0x2985 ||\n        c === 0x2986 ||\n        c === 0x2987 ||\n        c === 0x2988 ||\n        c === 0x2989 ||\n        c === 0x298a ||\n        c === 0x298b ||\n        c === 0x298c ||\n        c === 0x298d ||\n        c === 0x298e ||\n        c === 0x298f ||\n        c === 0x2990 ||\n        c === 0x2991 ||\n        c === 0x2992 ||\n        c === 0x2993 ||\n        c === 0x2994 ||\n        c === 0x2995 ||\n        c === 0x2996 ||\n        c === 0x2997 ||\n        c === 0x2998 ||\n        (c >= 0x2999 && c <= 0x29d7) ||\n        c === 0x29d8 ||\n        c === 0x29d9 ||\n        c === 0x29da ||\n        c === 0x29db ||\n        (c >= 0x29dc && c <= 0x29fb) ||\n        c === 0x29fc ||\n        c === 0x29fd ||\n        (c >= 0x29fe && c <= 0x2aff) ||\n        (c >= 0x2b00 && c <= 0x2b2f) ||\n        (c >= 0x2b30 && c <= 0x2b44) ||\n        (c >= 0x2b45 && c <= 0x2b46) ||\n        (c >= 0x2b47 && c <= 0x2b4c) ||\n        (c >= 0x2b4d && c <= 0x2b73) ||\n        (c >= 0x2b74 && c <= 0x2b75) ||\n        (c >= 0x2b76 && c <= 0x2b95) ||\n        c === 0x2b96 ||\n        (c >= 0x2b97 && c <= 0x2bff) ||\n        (c >= 0x2e00 && c <= 0x2e01) ||\n        c === 0x2e02 ||\n        c === 0x2e03 ||\n        c === 0x2e04 ||\n        c === 0x2e05 ||\n        (c >= 0x2e06 && c <= 0x2e08) ||\n        c === 0x2e09 ||\n        c === 0x2e0a ||\n        c === 0x2e0b ||\n        c === 0x2e0c ||\n        c === 0x2e0d ||\n        (c >= 0x2e0e && c <= 0x2e16) ||\n        c === 0x2e17 ||\n        (c >= 0x2e18 && c <= 0x2e19) ||\n        c === 0x2e1a ||\n        c === 0x2e1b ||\n        c === 0x2e1c ||\n        c === 0x2e1d ||\n        (c >= 0x2e1e && c <= 0x2e1f) ||\n        c === 0x2e20 ||\n        c === 0x2e21 ||\n        c === 0x2e22 ||\n        c === 0x2e23 ||\n        c === 0x2e24 ||\n        c === 0x2e25 ||\n        c === 0x2e26 ||\n        c === 0x2e27 ||\n        c === 0x2e28 ||\n        c === 0x2e29 ||\n        (c >= 0x2e2a && c <= 0x2e2e) ||\n        c === 0x2e2f ||\n        (c >= 0x2e30 && c <= 0x2e39) ||\n        (c >= 0x2e3a && c <= 0x2e3b) ||\n        (c >= 0x2e3c && c <= 0x2e3f) ||\n        c === 0x2e40 ||\n        c === 0x2e41 ||\n        c === 0x2e42 ||\n        (c >= 0x2e43 && c <= 0x2e4f) ||\n        (c >= 0x2e50 && c <= 0x2e51) ||\n        c === 0x2e52 ||\n        (c >= 0x2e53 && c <= 0x2e7f) ||\n        (c >= 0x3001 && c <= 0x3003) ||\n        c === 0x3008 ||\n        c === 0x3009 ||\n        c === 0x300a ||\n        c === 0x300b ||\n        c === 0x300c ||\n        c === 0x300d ||\n        c === 0x300e ||\n        c === 0x300f ||\n        c === 0x3010 ||\n        c === 0x3011 ||\n        (c >= 0x3012 && c <= 0x3013) ||\n        c === 0x3014 ||\n        c === 0x3015 ||\n        c === 0x3016 ||\n        c === 0x3017 ||\n        c === 0x3018 ||\n        c === 0x3019 ||\n        c === 0x301a ||\n        c === 0x301b ||\n        c === 0x301c ||\n        c === 0x301d ||\n        (c >= 0x301e && c <= 0x301f) ||\n        c === 0x3020 ||\n        c === 0x3030 ||\n        c === 0xfd3e ||\n        c === 0xfd3f ||\n        (c >= 0xfe45 && c <= 0xfe46));\n}\n","import { __spreadArray } from \"tslib\";\nimport { isArgumentElement, isDateElement, isNumberElement, isPluralElement, isSelectElement, isTagElement, isTimeElement, TYPE, } from './types';\nfunction cloneDeep(obj) {\n    if (Array.isArray(obj)) {\n        // @ts-expect-error meh\n        return __spreadArray([], obj.map(cloneDeep), true);\n    }\n    if (obj !== null && typeof obj === 'object') {\n        // @ts-expect-error meh\n        return Object.keys(obj).reduce(function (cloned, k) {\n            // @ts-expect-error meh\n            cloned[k] = cloneDeep(obj[k]);\n            return cloned;\n        }, {});\n    }\n    return obj;\n}\nfunction hoistPluralOrSelectElement(ast, el, positionToInject) {\n    // pull this out of the ast and move it to the top\n    var cloned = cloneDeep(el);\n    var options = cloned.options;\n    cloned.options = Object.keys(options).reduce(function (all, k) {\n        var newValue = hoistSelectors(__spreadArray(__spreadArray(__spreadArray([], ast.slice(0, positionToInject), true), options[k].value, true), ast.slice(positionToInject + 1), true));\n        all[k] = {\n            value: newValue,\n        };\n        return all;\n    }, {});\n    return cloned;\n}\nfunction isPluralOrSelectElement(el) {\n    return isPluralElement(el) || isSelectElement(el);\n}\nfunction findPluralOrSelectElement(ast) {\n    return !!ast.find(function (el) {\n        if (isPluralOrSelectElement(el)) {\n            return true;\n        }\n        if (isTagElement(el)) {\n            return findPluralOrSelectElement(el.children);\n        }\n        return false;\n    });\n}\n/**\n * Hoist all selectors to the beginning of the AST & flatten the\n * resulting options. E.g:\n * \"I have {count, plural, one{a dog} other{many dogs}}\"\n * becomes \"{count, plural, one{I have a dog} other{I have many dogs}}\".\n * If there are multiple selectors, the order of which one is hoisted 1st\n * is non-deterministic.\n * The goal is to provide as many full sentences as possible since fragmented\n * sentences are not translator-friendly\n * @param ast AST\n */\nexport function hoistSelectors(ast) {\n    for (var i = 0; i < ast.length; i++) {\n        var el = ast[i];\n        if (isPluralOrSelectElement(el)) {\n            return [hoistPluralOrSelectElement(ast, el, i)];\n        }\n        if (isTagElement(el) && findPluralOrSelectElement([el])) {\n            throw new Error('Cannot hoist plural/select within a tag element. Please put the tag element inside each plural/select option');\n        }\n    }\n    return ast;\n}\n/**\n * Collect all variables in an AST to Record<string, TYPE>\n * @param ast AST to collect variables from\n * @param vars Record of variable name to variable type\n */\nfunction collectVariables(ast, vars) {\n    if (vars === void 0) { vars = new Map(); }\n    ast.forEach(function (el) {\n        if (isArgumentElement(el) ||\n            isDateElement(el) ||\n            isTimeElement(el) ||\n            isNumberElement(el)) {\n            if (el.value in vars && vars.get(el.value) !== el.type) {\n                throw new Error(\"Variable \".concat(el.value, \" has conflicting types\"));\n            }\n            vars.set(el.value, el.type);\n        }\n        if (isPluralElement(el) || isSelectElement(el)) {\n            vars.set(el.value, el.type);\n            Object.keys(el.options).forEach(function (k) {\n                collectVariables(el.options[k].value, vars);\n            });\n        }\n        if (isTagElement(el)) {\n            vars.set(el.value, el.type);\n            collectVariables(el.children, vars);\n        }\n    });\n}\n/**\n * Check if 2 ASTs are structurally the same. This primarily means that\n * they have the same variables with the same type\n * @param a\n * @param b\n * @returns\n */\nexport function isStructurallySame(a, b) {\n    var aVars = new Map();\n    var bVars = new Map();\n    collectVariables(a, aVars);\n    collectVariables(b, bVars);\n    if (aVars.size !== bVars.size) {\n        return {\n            success: false,\n            error: new Error(\"Different number of variables: [\".concat(Array.from(aVars.keys()).join(', '), \"] vs [\").concat(Array.from(bVars.keys()).join(', '), \"]\")),\n        };\n    }\n    return Array.from(aVars.entries()).reduce(function (result, _a) {\n        var key = _a[0], type = _a[1];\n        if (!result.success) {\n            return result;\n        }\n        var bType = bVars.get(key);\n        if (bType == null) {\n            return {\n                success: false,\n                error: new Error(\"Missing variable \".concat(key, \" in message\")),\n            };\n        }\n        if (bType !== type) {\n            return {\n                success: false,\n                error: new Error(\"Variable \".concat(key, \" has conflicting types: \").concat(TYPE[type], \" vs \").concat(TYPE[bType])),\n            };\n        }\n        return result;\n    }, { success: true });\n}\n","import { __assign } from \"tslib\";\nimport { ErrorKind } from './error';\nimport { Parser } from './parser';\nimport { isDateElement, isDateTimeSkeleton, isNumberElement, isNumberSkeleton, isPluralElement, isSelectElement, isTagElement, isTimeElement, } from './types';\nfunction pruneLocation(els) {\n    els.forEach(function (el) {\n        delete el.location;\n        if (isSelectElement(el) || isPluralElement(el)) {\n            for (var k in el.options) {\n                delete el.options[k].location;\n                pruneLocation(el.options[k].value);\n            }\n        }\n        else if (isNumberElement(el) && isNumberSkeleton(el.style)) {\n            delete el.style.location;\n        }\n        else if ((isDateElement(el) || isTimeElement(el)) &&\n            isDateTimeSkeleton(el.style)) {\n            delete el.style.location;\n        }\n        else if (isTagElement(el)) {\n            pruneLocation(el.children);\n        }\n    });\n}\nexport function parse(message, opts) {\n    if (opts === void 0) { opts = {}; }\n    opts = __assign({ shouldParseSkeletons: true, requiresOtherClause: true }, opts);\n    var result = new Parser(message, opts).parse();\n    if (result.err) {\n        var error = SyntaxError(ErrorKind[result.err.kind]);\n        // @ts-expect-error Assign to error object\n        error.location = result.err.location;\n        // @ts-expect-error Assign to error object\n        error.originalMessage = result.err.message;\n        throw error;\n    }\n    if (!(opts === null || opts === void 0 ? void 0 : opts.captureLocation)) {\n        pruneLocation(result.val);\n    }\n    return result.val;\n}\nexport * from './types';\n// only for testing\nexport var _Parser = Parser;\nexport { isStructurallySame } from './manipulator';\n","import { __extends } from \"tslib\";\nexport var ErrorCode;\n(function (ErrorCode) {\n    // When we have a placeholder but no value to format\n    ErrorCode[\"MISSING_VALUE\"] = \"MISSING_VALUE\";\n    // When value supplied is invalid\n    ErrorCode[\"INVALID_VALUE\"] = \"INVALID_VALUE\";\n    // When we need specific Intl API but it's not available\n    ErrorCode[\"MISSING_INTL_API\"] = \"MISSING_INTL_API\";\n})(ErrorCode || (ErrorCode = {}));\nvar FormatError = /** @class */ (function (_super) {\n    __extends(FormatError, _super);\n    function FormatError(msg, code, originalMessage) {\n        var _this = _super.call(this, msg) || this;\n        _this.code = code;\n        _this.originalMessage = originalMessage;\n        return _this;\n    }\n    FormatError.prototype.toString = function () {\n        return \"[formatjs Error: \".concat(this.code, \"] \").concat(this.message);\n    };\n    return FormatError;\n}(Error));\nexport { FormatError };\nvar InvalidValueError = /** @class */ (function (_super) {\n    __extends(InvalidValueError, _super);\n    function InvalidValueError(variableId, value, options, originalMessage) {\n        return _super.call(this, \"Invalid values for \\\"\".concat(variableId, \"\\\": \\\"\").concat(value, \"\\\". Options are \\\"\").concat(Object.keys(options).join('\", \"'), \"\\\"\"), ErrorCode.INVALID_VALUE, originalMessage) || this;\n    }\n    return InvalidValueError;\n}(FormatError));\nexport { InvalidValueError };\nvar InvalidValueTypeError = /** @class */ (function (_super) {\n    __extends(InvalidValueTypeError, _super);\n    function InvalidValueTypeError(value, type, originalMessage) {\n        return _super.call(this, \"Value for \\\"\".concat(value, \"\\\" must be of type \").concat(type), ErrorCode.INVALID_VALUE, originalMessage) || this;\n    }\n    return InvalidValueTypeError;\n}(FormatError));\nexport { InvalidValueTypeError };\nvar MissingValueError = /** @class */ (function (_super) {\n    __extends(MissingValueError, _super);\n    function MissingValueError(variableId, originalMessage) {\n        return _super.call(this, \"The intl string context variable \\\"\".concat(variableId, \"\\\" was not provided to the string \\\"\").concat(originalMessage, \"\\\"\"), ErrorCode.MISSING_VALUE, originalMessage) || this;\n    }\n    return MissingValueError;\n}(FormatError));\nexport { MissingValueError };\n","import { isArgumentElement, isDateElement, isDateTimeSkeleton, isLiteralElement, isNumberElement, isNumberSkeleton, isPluralElement, isPoundElement, isSelectElement, isTagElement, isTimeElement, } from '@formatjs/icu-messageformat-parser';\nimport { ErrorCode, FormatError, InvalidValueError, InvalidValueTypeError, MissingValueError, } from './error';\nexport var PART_TYPE;\n(function (PART_TYPE) {\n    PART_TYPE[PART_TYPE[\"literal\"] = 0] = \"literal\";\n    PART_TYPE[PART_TYPE[\"object\"] = 1] = \"object\";\n})(PART_TYPE || (PART_TYPE = {}));\nfunction mergeLiteral(parts) {\n    if (parts.length < 2) {\n        return parts;\n    }\n    return parts.reduce(function (all, part) {\n        var lastPart = all[all.length - 1];\n        if (!lastPart ||\n            lastPart.type !== PART_TYPE.literal ||\n            part.type !== PART_TYPE.literal) {\n            all.push(part);\n        }\n        else {\n            lastPart.value += part.value;\n        }\n        return all;\n    }, []);\n}\nexport function isFormatXMLElementFn(el) {\n    return typeof el === 'function';\n}\n// TODO(skeleton): add skeleton support\nexport function formatToParts(els, locales, formatters, formats, values, currentPluralValue, \n// For debugging\noriginalMessage) {\n    // Hot path for straight simple msg translations\n    if (els.length === 1 && isLiteralElement(els[0])) {\n        return [\n            {\n                type: PART_TYPE.literal,\n                value: els[0].value,\n            },\n        ];\n    }\n    var result = [];\n    for (var _i = 0, els_1 = els; _i < els_1.length; _i++) {\n        var el = els_1[_i];\n        // Exit early for string parts.\n        if (isLiteralElement(el)) {\n            result.push({\n                type: PART_TYPE.literal,\n                value: el.value,\n            });\n            continue;\n        }\n        // TODO: should this part be literal type?\n        // Replace `#` in plural rules with the actual numeric value.\n        if (isPoundElement(el)) {\n            if (typeof currentPluralValue === 'number') {\n                result.push({\n                    type: PART_TYPE.literal,\n                    value: formatters.getNumberFormat(locales).format(currentPluralValue),\n                });\n            }\n            continue;\n        }\n        var varName = el.value;\n        // Enforce that all required values are provided by the caller.\n        if (!(values && varName in values)) {\n            throw new MissingValueError(varName, originalMessage);\n        }\n        var value = values[varName];\n        if (isArgumentElement(el)) {\n            if (!value || typeof value === 'string' || typeof value === 'number') {\n                value =\n                    typeof value === 'string' || typeof value === 'number'\n                        ? String(value)\n                        : '';\n            }\n            result.push({\n                type: typeof value === 'string' ? PART_TYPE.literal : PART_TYPE.object,\n                value: value,\n            });\n            continue;\n        }\n        // Recursively format plural and select parts' option  which can be a\n        // nested pattern structure. The choosing of the option to use is\n        // abstracted-by and delegated-to the part helper object.\n        if (isDateElement(el)) {\n            var style = typeof el.style === 'string'\n                ? formats.date[el.style]\n                : isDateTimeSkeleton(el.style)\n                    ? el.style.parsedOptions\n                    : undefined;\n            result.push({\n                type: PART_TYPE.literal,\n                value: formatters\n                    .getDateTimeFormat(locales, style)\n                    .format(value),\n            });\n            continue;\n        }\n        if (isTimeElement(el)) {\n            var style = typeof el.style === 'string'\n                ? formats.time[el.style]\n                : isDateTimeSkeleton(el.style)\n                    ? el.style.parsedOptions\n                    : formats.time.medium;\n            result.push({\n                type: PART_TYPE.literal,\n                value: formatters\n                    .getDateTimeFormat(locales, style)\n                    .format(value),\n            });\n            continue;\n        }\n        if (isNumberElement(el)) {\n            var style = typeof el.style === 'string'\n                ? formats.number[el.style]\n                : isNumberSkeleton(el.style)\n                    ? el.style.parsedOptions\n                    : undefined;\n            if (style && style.scale) {\n                value =\n                    value *\n                        (style.scale || 1);\n            }\n            result.push({\n                type: PART_TYPE.literal,\n                value: formatters\n                    .getNumberFormat(locales, style)\n                    .format(value),\n            });\n            continue;\n        }\n        if (isTagElement(el)) {\n            var children = el.children, value_1 = el.value;\n            var formatFn = values[value_1];\n            if (!isFormatXMLElementFn(formatFn)) {\n                throw new InvalidValueTypeError(value_1, 'function', originalMessage);\n            }\n            var parts = formatToParts(children, locales, formatters, formats, values, currentPluralValue);\n            var chunks = formatFn(parts.map(function (p) { return p.value; }));\n            if (!Array.isArray(chunks)) {\n                chunks = [chunks];\n            }\n            result.push.apply(result, chunks.map(function (c) {\n                return {\n                    type: typeof c === 'string' ? PART_TYPE.literal : PART_TYPE.object,\n                    value: c,\n                };\n            }));\n        }\n        if (isSelectElement(el)) {\n            var opt = el.options[value] || el.options.other;\n            if (!opt) {\n                throw new InvalidValueError(el.value, value, Object.keys(el.options), originalMessage);\n            }\n            result.push.apply(result, formatToParts(opt.value, locales, formatters, formats, values));\n            continue;\n        }\n        if (isPluralElement(el)) {\n            var opt = el.options[\"=\".concat(value)];\n            if (!opt) {\n                if (!Intl.PluralRules) {\n                    throw new FormatError(\"Intl.PluralRules is not available in this environment.\\nTry polyfilling it using \\\"@formatjs/intl-pluralrules\\\"\\n\", ErrorCode.MISSING_INTL_API, originalMessage);\n                }\n                var rule = formatters\n                    .getPluralRules(locales, { type: el.pluralType })\n                    .select(value - (el.offset || 0));\n                opt = el.options[rule] || el.options.other;\n            }\n            if (!opt) {\n                throw new InvalidValueError(el.value, value, Object.keys(el.options), originalMessage);\n            }\n            result.push.apply(result, formatToParts(opt.value, locales, formatters, formats, values, value - (el.offset || 0)));\n            continue;\n        }\n    }\n    return mergeLiteral(result);\n}\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\nimport { __assign, __rest, __spreadArray } from \"tslib\";\nimport { memoize, strategies } from '@formatjs/fast-memoize';\nimport { parse, } from '@formatjs/icu-messageformat-parser';\nimport { formatToParts, PART_TYPE, } from './formatters';\n// -- MessageFormat --------------------------------------------------------\nfunction mergeConfig(c1, c2) {\n    if (!c2) {\n        return c1;\n    }\n    return __assign(__assign(__assign({}, (c1 || {})), (c2 || {})), Object.keys(c1).reduce(function (all, k) {\n        all[k] = __assign(__assign({}, c1[k]), (c2[k] || {}));\n        return all;\n    }, {}));\n}\nfunction mergeConfigs(defaultConfig, configs) {\n    if (!configs) {\n        return defaultConfig;\n    }\n    return Object.keys(defaultConfig).reduce(function (all, k) {\n        all[k] = mergeConfig(defaultConfig[k], configs[k]);\n        return all;\n    }, __assign({}, defaultConfig));\n}\nfunction createFastMemoizeCache(store) {\n    return {\n        create: function () {\n            return {\n                get: function (key) {\n                    return store[key];\n                },\n                set: function (key, value) {\n                    store[key] = value;\n                },\n            };\n        },\n    };\n}\nfunction createDefaultFormatters(cache) {\n    if (cache === void 0) { cache = {\n        number: {},\n        dateTime: {},\n        pluralRules: {},\n    }; }\n    return {\n        getNumberFormat: memoize(function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return new ((_a = Intl.NumberFormat).bind.apply(_a, __spreadArray([void 0], args, false)))();\n        }, {\n            cache: createFastMemoizeCache(cache.number),\n            strategy: strategies.variadic,\n        }),\n        getDateTimeFormat: memoize(function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return new ((_a = Intl.DateTimeFormat).bind.apply(_a, __spreadArray([void 0], args, false)))();\n        }, {\n            cache: createFastMemoizeCache(cache.dateTime),\n            strategy: strategies.variadic,\n        }),\n        getPluralRules: memoize(function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return new ((_a = Intl.PluralRules).bind.apply(_a, __spreadArray([void 0], args, false)))();\n        }, {\n            cache: createFastMemoizeCache(cache.pluralRules),\n            strategy: strategies.variadic,\n        }),\n    };\n}\nvar IntlMessageFormat = /** @class */ (function () {\n    function IntlMessageFormat(message, locales, overrideFormats, opts) {\n        if (locales === void 0) { locales = IntlMessageFormat.defaultLocale; }\n        var _this = this;\n        this.formatterCache = {\n            number: {},\n            dateTime: {},\n            pluralRules: {},\n        };\n        this.format = function (values) {\n            var parts = _this.formatToParts(values);\n            // Hot path for straight simple msg translations\n            if (parts.length === 1) {\n                return parts[0].value;\n            }\n            var result = parts.reduce(function (all, part) {\n                if (!all.length ||\n                    part.type !== PART_TYPE.literal ||\n                    typeof all[all.length - 1] !== 'string') {\n                    all.push(part.value);\n                }\n                else {\n                    all[all.length - 1] += part.value;\n                }\n                return all;\n            }, []);\n            if (result.length <= 1) {\n                return result[0] || '';\n            }\n            return result;\n        };\n        this.formatToParts = function (values) {\n            return formatToParts(_this.ast, _this.locales, _this.formatters, _this.formats, values, undefined, _this.message);\n        };\n        this.resolvedOptions = function () {\n            var _a;\n            return ({\n                locale: ((_a = _this.resolvedLocale) === null || _a === void 0 ? void 0 : _a.toString()) ||\n                    Intl.NumberFormat.supportedLocalesOf(_this.locales)[0],\n            });\n        };\n        this.getAst = function () { return _this.ast; };\n        // Defined first because it's used to build the format pattern.\n        this.locales = locales;\n        this.resolvedLocale = IntlMessageFormat.resolveLocale(locales);\n        if (typeof message === 'string') {\n            this.message = message;\n            if (!IntlMessageFormat.__parse) {\n                throw new TypeError('IntlMessageFormat.__parse must be set to process `message` of type `string`');\n            }\n            var _a = opts || {}, formatters = _a.formatters, parseOpts = __rest(_a, [\"formatters\"]);\n            // Parse string messages into an AST.\n            this.ast = IntlMessageFormat.__parse(message, __assign(__assign({}, parseOpts), { locale: this.resolvedLocale }));\n        }\n        else {\n            this.ast = message;\n        }\n        if (!Array.isArray(this.ast)) {\n            throw new TypeError('A message must be provided as a String or AST.');\n        }\n        // Creates a new object with the specified `formats` merged with the default\n        // formats.\n        this.formats = mergeConfigs(IntlMessageFormat.formats, overrideFormats);\n        this.formatters =\n            (opts && opts.formatters) || createDefaultFormatters(this.formatterCache);\n    }\n    Object.defineProperty(IntlMessageFormat, \"defaultLocale\", {\n        get: function () {\n            if (!IntlMessageFormat.memoizedDefaultLocale) {\n                IntlMessageFormat.memoizedDefaultLocale =\n                    new Intl.NumberFormat().resolvedOptions().locale;\n            }\n            return IntlMessageFormat.memoizedDefaultLocale;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    IntlMessageFormat.memoizedDefaultLocale = null;\n    IntlMessageFormat.resolveLocale = function (locales) {\n        if (typeof Intl.Locale === 'undefined') {\n            return;\n        }\n        var supportedLocales = Intl.NumberFormat.supportedLocalesOf(locales);\n        if (supportedLocales.length > 0) {\n            return new Intl.Locale(supportedLocales[0]);\n        }\n        return new Intl.Locale(typeof locales === 'string' ? locales : locales[0]);\n    };\n    IntlMessageFormat.__parse = parse;\n    // Default format options used as the prototype of the `formats` provided to the\n    // constructor. These are used when constructing the internal Intl.NumberFormat\n    // and Intl.DateTimeFormat instances.\n    IntlMessageFormat.formats = {\n        number: {\n            integer: {\n                maximumFractionDigits: 0,\n            },\n            currency: {\n                style: 'currency',\n            },\n            percent: {\n                style: 'percent',\n            },\n        },\n        date: {\n            short: {\n                month: 'numeric',\n                day: 'numeric',\n                year: '2-digit',\n            },\n            medium: {\n                month: 'short',\n                day: 'numeric',\n                year: 'numeric',\n            },\n            long: {\n                month: 'long',\n                day: 'numeric',\n                year: 'numeric',\n            },\n            full: {\n                weekday: 'long',\n                month: 'long',\n                day: 'numeric',\n                year: 'numeric',\n            },\n        },\n        time: {\n            short: {\n                hour: 'numeric',\n                minute: 'numeric',\n            },\n            medium: {\n                hour: 'numeric',\n                minute: 'numeric',\n                second: 'numeric',\n            },\n            long: {\n                hour: 'numeric',\n                minute: 'numeric',\n                second: 'numeric',\n                timeZoneName: 'short',\n            },\n            full: {\n                hour: 'numeric',\n                minute: 'numeric',\n                second: 'numeric',\n                timeZoneName: 'short',\n            },\n        },\n    };\n    return IntlMessageFormat;\n}());\nexport { IntlMessageFormat };\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\nimport { IntlMessageFormat } from './src/core';\nexport * from './src/core';\nexport * from './src/error';\nexport * from './src/formatters';\nexport { IntlMessageFormat };\nexport default IntlMessageFormat;\n","module.exports = require(\"next/dist/server/app-render/action-async-storage.external.js\");","module.exports = require(\"process\");","//\n// Main\n//\nexport function memoize(fn, options) {\n    var cache = options && options.cache ? options.cache : cacheDefault;\n    var serializer = options && options.serializer ? options.serializer : serializerDefault;\n    var strategy = options && options.strategy ? options.strategy : strategyDefault;\n    return strategy(fn, {\n        cache: cache,\n        serializer: serializer,\n    });\n}\n//\n// Strategy\n//\nfunction isPrimitive(value) {\n    return (value == null || typeof value === 'number' || typeof value === 'boolean'); // || typeof value === \"string\" 'unsafe' primitive for our needs\n}\nfunction monadic(fn, cache, serializer, arg) {\n    var cacheKey = isPrimitive(arg) ? arg : serializer(arg);\n    var computedValue = cache.get(cacheKey);\n    if (typeof computedValue === 'undefined') {\n        computedValue = fn.call(this, arg);\n        cache.set(cacheKey, computedValue);\n    }\n    return computedValue;\n}\nfunction variadic(fn, cache, serializer) {\n    var args = Array.prototype.slice.call(arguments, 3);\n    var cacheKey = serializer(args);\n    var computedValue = cache.get(cacheKey);\n    if (typeof computedValue === 'undefined') {\n        computedValue = fn.apply(this, args);\n        cache.set(cacheKey, computedValue);\n    }\n    return computedValue;\n}\nfunction assemble(fn, context, strategy, cache, serialize) {\n    return strategy.bind(context, fn, cache, serialize);\n}\nfunction strategyDefault(fn, options) {\n    var strategy = fn.length === 1 ? monadic : variadic;\n    return assemble(fn, this, strategy, options.cache.create(), options.serializer);\n}\nfunction strategyVariadic(fn, options) {\n    return assemble(fn, this, variadic, options.cache.create(), options.serializer);\n}\nfunction strategyMonadic(fn, options) {\n    return assemble(fn, this, monadic, options.cache.create(), options.serializer);\n}\n//\n// Serializer\n//\nvar serializerDefault = function () {\n    return JSON.stringify(arguments);\n};\n//\n// Cache\n//\nvar ObjectWithoutPrototypeCache = /** @class */ (function () {\n    function ObjectWithoutPrototypeCache() {\n        this.cache = Object.create(null);\n    }\n    ObjectWithoutPrototypeCache.prototype.get = function (key) {\n        return this.cache[key];\n    };\n    ObjectWithoutPrototypeCache.prototype.set = function (key, value) {\n        this.cache[key] = value;\n    };\n    return ObjectWithoutPrototypeCache;\n}());\nvar cacheDefault = {\n    create: function create() {\n        return new ObjectWithoutPrototypeCache();\n    },\n};\nexport var strategies = {\n    variadic: strategyVariadic,\n    monadic: strategyMonadic,\n};\n","import { zValidator } from \"@hono/zod-validator\";\r\nimport { Hono } from \"hono\";\r\nimport { HTTPException } from \"hono/http-exception\";\r\nimport { z } from \"zod\";\r\n\r\nimport { createServiceClient } from \"@/lib/supabase/client\";\r\n\r\n/**\r\n * Admin routes for platform administration\r\n * All routes here should be behind the adminOnly middleware\r\n */\r\nexport function setupAdminRoutes(app: Hono) {\r\n  // Validation schemas\r\n  const userUpdateSchema = z.object({\r\n    userId: z.string().uuid(),\r\n    role: z.enum([\"user\", \"admin\", \"moderator\"]).optional(),\r\n    isActive: z.boolean().optional(),\r\n    subscriptionTier: z\r\n      .enum([\"free\", \"basic\", \"premium\", \"enterprise\"])\r\n      .optional(),\r\n  });\r\n\r\n  const bulkUserSchema = z.object({\r\n    userIds: z.array(z.string().uuid()).min(1),\r\n    action: z.enum([\"activate\", \"deactivate\", \"delete\"]),\r\n  });\r\n\r\n  // Get all users with pagination\r\n  app.get(\"/admin/users\", async (c) => {\r\n    const page = Number(c.req.query(\"page\") || \"1\");\r\n    const limit = Number(c.req.query(\"limit\") || \"50\");\r\n    const offset = (page - 1) * limit;\r\n\r\n    try {\r\n      const supabase = createServiceClient();\r\n\r\n      // Get users with count\r\n      const { data, error, count } = await supabase\r\n        .from(\"users\")\r\n        .select(\"*, profiles(*)\", { count: \"exact\" })\r\n        .range(offset, offset + limit - 1);\r\n\r\n      if (error) throw error;\r\n\r\n      return c.json({\r\n        success: true,\r\n        users: data,\r\n        pagination: {\r\n          total: count || 0,\r\n          page,\r\n          limit,\r\n          totalPages: count ? Math.ceil(count / limit) : 0,\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Admin users fetch error:\", error);\r\n      throw new HTTPException(500, { message: \"Failed to fetch users\" });\r\n    }\r\n  });\r\n\r\n  // Get a specific user by ID\r\n  app.get(\"/admin/users/:id\", async (c) => {\r\n    const id = c.req.param(\"id\");\r\n    try {\r\n      const supabase = createServiceClient();\r\n      const { data: user, error } = await supabase\r\n        .from(\"users\")\r\n        .select(\"*, profiles(*)\")\r\n        .eq(\"id\", id)\r\n        .single();\r\n\r\n      if (error?.code === \"PGRST116\" || !user) {\r\n        throw new HTTPException(404, { message: \"User not found\" });\r\n      }\r\n      if (error) throw error;\r\n\r\n      return c.json({ success: true, user });\r\n    } catch (error: any) {\r\n      console.error(`Admin user fetch error (ID: ${id}):`, error);\r\n      if (error instanceof HTTPException) throw error;\r\n      throw new HTTPException(500, { message: \"Failed to fetch user\" });\r\n    }\r\n  });\r\n\r\n  // Update a specific user (more granular than the existing PATCH /admin/users)\r\n  app.patch(\r\n    \"/admin/users/:id\",\r\n    zValidator(\r\n      \"json\",\r\n      z\r\n        .object({\r\n          name: z.string().min(2).optional(),\r\n          email: z.string().email().optional(),\r\n        })\r\n        .refine((data) => Object.keys(data).length > 0, {\r\n          message: \"At least one field must be provided\",\r\n        })\r\n    ),\r\n    async (c) => {\r\n      const id = c.req.param(\"id\");\r\n      const data = c.req.valid(\"json\");\r\n      try {\r\n        const supabase = createServiceClient();\r\n\r\n        const { error: checkError } = await supabase\r\n          .from(\"users\")\r\n          .select(\"id\")\r\n          .eq(\"id\", id)\r\n          .single();\r\n        if (checkError)\r\n          throw new HTTPException(404, { message: \"User not found\" });\r\n\r\n        if (data.email) {\r\n          const { data: emailExists, error: emailCheckError } = await supabase\r\n            .from(\"users\")\r\n            .select(\"id\")\r\n            .eq(\"email\", data.email)\r\n            .neq(\"id\", id)\r\n            .maybeSingle();\r\n\r\n          if (emailCheckError) throw emailCheckError;\r\n          if (emailExists)\r\n            throw new HTTPException(409, {\r\n              message: \"Email already in use by another user\",\r\n            });\r\n        }\r\n\r\n        const { data: updatedUser, error: updateError } = await supabase\r\n          .from(\"users\")\r\n          .update({\r\n            ...data,\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .eq(\"id\", id)\r\n          .select(\"*, profiles(*)\")\r\n          .single();\r\n\r\n        if (updateError) throw updateError;\r\n\r\n        return c.json({ success: true, user: updatedUser });\r\n      } catch (error: any) {\r\n        console.error(`Admin user update error (ID: ${id}):`, error);\r\n        if (error instanceof HTTPException) throw error;\r\n        throw new HTTPException(500, { message: \"Failed to update user\" });\r\n      }\r\n    }\r\n  );\r\n\r\n  // Delete a specific user (consider soft vs hard delete)\r\n  app.delete(\"/admin/users/:id\", async (c) => {\r\n    const id = c.req.param(\"id\");\r\n    try {\r\n      const supabase = createServiceClient();\r\n\r\n      const { error: checkError } = await supabase\r\n        .from(\"users\")\r\n        .select(\"id\")\r\n        .eq(\"id\", id)\r\n        .single();\r\n      if (checkError)\r\n        throw new HTTPException(404, { message: \"User not found\" });\r\n\r\n      const { error: deleteError } = await supabase\r\n        .from(\"users\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      return c.body(null, 204);\r\n    } catch (error: any) {\r\n      console.error(`Admin user delete error (ID: ${id}):`, error);\r\n      if (error instanceof HTTPException) throw error;\r\n      throw new HTTPException(500, { message: \"Failed to delete user\" });\r\n    }\r\n  });\r\n\r\n  // Update a user\r\n  app.patch(\"/admin/users\", zValidator(\"json\", userUpdateSchema), async (c) => {\r\n    const { userId, role, isActive, subscriptionTier } = c.req.valid(\"json\");\r\n\r\n    try {\r\n      const supabase = createServiceClient();\r\n\r\n      // Update user roles if provided\r\n      if (role) {\r\n        const { error: roleError } = await supabase.from(\"user_roles\").upsert({\r\n          user_id: userId,\r\n          role,\r\n          updated_at: new Date().toISOString(),\r\n        });\r\n\r\n        if (roleError) throw roleError;\r\n      }\r\n\r\n      // Update user status if provided\r\n      if (isActive !== undefined) {\r\n        const { error: statusError } = await supabase\r\n          .from(\"users\")\r\n          .update({\r\n            is_active: isActive,\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .eq(\"id\", userId);\r\n\r\n        if (statusError) throw statusError;\r\n      }\r\n\r\n      // Update subscription tier if provided\r\n      if (subscriptionTier) {\r\n        const { error: subscriptionError } = await supabase\r\n          .from(\"subscriptions\")\r\n          .upsert({\r\n            user_id: userId,\r\n            tier: subscriptionTier,\r\n            updated_at: new Date().toISOString(),\r\n          });\r\n\r\n        if (subscriptionError) throw subscriptionError;\r\n      }\r\n\r\n      return c.json({\r\n        success: true,\r\n        message: \"User updated successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Admin user update error:\", error);\r\n      throw new HTTPException(500, { message: \"Failed to update user\" });\r\n    }\r\n  });\r\n\r\n  // Bulk user actions\r\n  app.post(\r\n    \"/admin/users/bulk\",\r\n    zValidator(\"json\", bulkUserSchema),\r\n    async (c) => {\r\n      const { userIds, action } = c.req.valid(\"json\");\r\n\r\n      try {\r\n        const supabase = createServiceClient();\r\n\r\n        if (action === \"activate\" || action === \"deactivate\") {\r\n          const { error } = await supabase\r\n            .from(\"users\")\r\n            .update({\r\n              is_active: action === \"activate\",\r\n              updated_at: new Date().toISOString(),\r\n            })\r\n            .in(\"id\", userIds);\r\n\r\n          if (error) throw error;\r\n        } else if (action === \"delete\") {\r\n          // Soft delete users\r\n          const { error } = await supabase\r\n            .from(\"users\")\r\n            .update({\r\n              deleted_at: new Date().toISOString(),\r\n              is_active: false,\r\n            })\r\n            .in(\"id\", userIds);\r\n\r\n          if (error) throw error;\r\n        }\r\n\r\n        return c.json({\r\n          success: true,\r\n          message: `Bulk action '${action}' completed successfully`,\r\n          affected: userIds.length,\r\n        });\r\n      } catch (error: any) {\r\n        console.error(\"Admin bulk action error:\", error);\r\n        throw new HTTPException(500, {\r\n          message: \"Failed to perform bulk action\",\r\n        });\r\n      }\r\n    }\r\n  );\r\n\r\n  // Get system stats\r\n  app.get(\"/admin/stats\", async (c) => {\r\n    try {\r\n      const supabase = createServiceClient();\r\n\r\n      // Get user count\r\n      const { count: userCount, error: userError } = await supabase\r\n        .from(\"users\")\r\n        .select(\"*\", { count: \"exact\", head: true });\r\n\r\n      // Get document count\r\n      const { count: documentCount, error: documentError } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"*\", { count: \"exact\", head: true });\r\n\r\n      // Get active subscriptions count\r\n      const { count: subscriptionCount, error: subscriptionError } =\r\n        await supabase\r\n          .from(\"subscriptions\")\r\n          .select(\"*\", { count: \"exact\", head: true })\r\n          .eq(\"status\", \"active\");\r\n\r\n      if (userError || documentError || subscriptionError) {\r\n        throw userError || documentError || subscriptionError;\r\n      }\r\n\r\n      return c.json({\r\n        success: true,\r\n        stats: {\r\n          users: userCount || 0,\r\n          documents: documentCount || 0,\r\n          activeSubscriptions: subscriptionCount || 0,\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Admin stats error:\", error);\r\n      throw new HTTPException(500, { message: \"Failed to fetch admin stats\" });\r\n    }\r\n  });\r\n\r\n  return app;\r\n}\r\n","module.exports = require(\"os\");","// src/middleware/timing/timing.ts\nimport \"../../context.js\";\nvar getTime = () => {\n  try {\n    return performance.now();\n  } catch {\n  }\n  return Date.now();\n};\nvar timing = (config) => {\n  const options = {\n    total: true,\n    enabled: true,\n    totalDescription: \"Total Response Time\",\n    autoEnd: true,\n    crossOrigin: false,\n    ...config\n  };\n  return async function timing2(c, next) {\n    const headers = [];\n    const timers = /* @__PURE__ */ new Map();\n    if (c.get(\"metric\")) {\n      return await next();\n    }\n    c.set(\"metric\", { headers, timers });\n    if (options.total) {\n      startTime(c, \"total\", options.totalDescription);\n    }\n    await next();\n    if (options.total) {\n      endTime(c, \"total\");\n    }\n    if (options.autoEnd) {\n      timers.forEach((_, key) => endTime(c, key));\n    }\n    const enabled = typeof options.enabled === \"function\" ? options.enabled(c) : options.enabled;\n    if (enabled) {\n      c.res.headers.append(\"Server-Timing\", headers.join(\",\"));\n      const crossOrigin = typeof options.crossOrigin === \"function\" ? options.crossOrigin(c) : options.crossOrigin;\n      if (crossOrigin) {\n        c.res.headers.append(\n          \"Timing-Allow-Origin\",\n          typeof crossOrigin === \"string\" ? crossOrigin : \"*\"\n        );\n      }\n    }\n  };\n};\nvar setMetric = (c, name, valueDescription, description, precision) => {\n  const metrics = c.get(\"metric\");\n  if (!metrics) {\n    console.warn(\"Metrics not initialized! Please add the `timing()` middleware to this route!\");\n    return;\n  }\n  if (typeof valueDescription === \"number\") {\n    const dur = valueDescription.toFixed(precision || 1);\n    const metric = description ? `${name};dur=${dur};desc=\"${description}\"` : `${name};dur=${dur}`;\n    metrics.headers.push(metric);\n  } else {\n    const metric = valueDescription ? `${name};desc=\"${valueDescription}\"` : `${name}`;\n    metrics.headers.push(metric);\n  }\n};\nvar startTime = (c, name, description) => {\n  const metrics = c.get(\"metric\");\n  if (!metrics) {\n    console.warn(\"Metrics not initialized! Please add the `timing()` middleware to this route!\");\n    return;\n  }\n  metrics.timers.set(name, { description, start: getTime() });\n};\nvar endTime = (c, name, precision) => {\n  const metrics = c.get(\"metric\");\n  if (!metrics) {\n    console.warn(\"Metrics not initialized! Please add the `timing()` middleware to this route!\");\n    return;\n  }\n  const timer = metrics.timers.get(name);\n  if (!timer) {\n    console.warn(`Timer \"${name}\" does not exist!`);\n    return;\n  }\n  const { description, start } = timer;\n  const duration = getTime() - start;\n  setMetric(c, name, duration, description, precision);\n  metrics.timers.delete(name);\n};\nexport {\n  endTime,\n  setMetric,\n  startTime,\n  timing\n};\n","// src/middleware/timing/index.ts\nimport { timing, setMetric, startTime, endTime } from \"./timing.js\";\nexport {\n  endTime,\n  setMetric,\n  startTime,\n  timing\n};\n","/* eslint-disable import/no-extraneous-dependencies */ \"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n0 && (module.exports = {\n    decryptActionBoundArgs: null,\n    encryptActionBoundArgs: null\n});\nfunction _export(target, all) {\n    for(var name in all)Object.defineProperty(target, name, {\n        enumerable: true,\n        get: all[name]\n    });\n}\n_export(exports, {\n    decryptActionBoundArgs: function() {\n        return decryptActionBoundArgs;\n    },\n    encryptActionBoundArgs: function() {\n        return encryptActionBoundArgs;\n    }\n});\nrequire(\"server-only\");\nconst _serveredge = require(\"react-server-dom-webpack/server.edge\");\nconst _clientedge = require(\"react-server-dom-webpack/client.edge\");\nconst _nodewebstreamshelper = require(\"../stream-utils/node-web-streams-helper\");\nconst _encryptionutils = require(\"./encryption-utils\");\nconst _workunitasyncstorageexternal = require(\"./work-unit-async-storage.external\");\nconst _dynamicrendering = require(\"./dynamic-rendering\");\nconst _react = /*#__PURE__*/ _interop_require_default(require(\"react\"));\nfunction _interop_require_default(obj) {\n    return obj && obj.__esModule ? obj : {\n        default: obj\n    };\n}\nconst isEdgeRuntime = process.env.NEXT_RUNTIME === 'edge';\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n/**\n * Decrypt the serialized string with the action id as the salt.\n */ async function decodeActionBoundArg(actionId, arg) {\n    const key = await (0, _encryptionutils.getActionEncryptionKey)();\n    if (typeof key === 'undefined') {\n        throw Object.defineProperty(new Error(`Missing encryption key for Server Action. This is a bug in Next.js`), \"__NEXT_ERROR_CODE\", {\n            value: \"E65\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    // Get the iv (16 bytes) and the payload from the arg.\n    const originalPayload = atob(arg);\n    const ivValue = originalPayload.slice(0, 16);\n    const payload = originalPayload.slice(16);\n    const decrypted = textDecoder.decode(await (0, _encryptionutils.decrypt)(key, (0, _encryptionutils.stringToUint8Array)(ivValue), (0, _encryptionutils.stringToUint8Array)(payload)));\n    if (!decrypted.startsWith(actionId)) {\n        throw Object.defineProperty(new Error('Invalid Server Action payload: failed to decrypt.'), \"__NEXT_ERROR_CODE\", {\n            value: \"E191\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    return decrypted.slice(actionId.length);\n}\n/**\n * Encrypt the serialized string with the action id as the salt. Add a prefix to\n * later ensure that the payload is correctly decrypted, similar to a checksum.\n */ async function encodeActionBoundArg(actionId, arg) {\n    const key = await (0, _encryptionutils.getActionEncryptionKey)();\n    if (key === undefined) {\n        throw Object.defineProperty(new Error(`Missing encryption key for Server Action. This is a bug in Next.js`), \"__NEXT_ERROR_CODE\", {\n            value: \"E65\",\n            enumerable: false,\n            configurable: true\n        });\n    }\n    // Get 16 random bytes as iv.\n    const randomBytes = new Uint8Array(16);\n    _workunitasyncstorageexternal.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(randomBytes));\n    const ivValue = (0, _encryptionutils.arrayBufferToString)(randomBytes.buffer);\n    const encrypted = await (0, _encryptionutils.encrypt)(key, randomBytes, textEncoder.encode(actionId + arg));\n    return btoa(ivValue + (0, _encryptionutils.arrayBufferToString)(encrypted));\n}\nconst encryptActionBoundArgs = _react.default.cache(async function encryptActionBoundArgs(actionId, ...args) {\n    const { clientModules } = (0, _encryptionutils.getClientReferenceManifestForRsc)();\n    // Create an error before any asynchronous calls, to capture the original\n    // call stack in case we need it when the serialization errors.\n    const error = new Error();\n    Error.captureStackTrace(error, encryptActionBoundArgs);\n    let didCatchError = false;\n    const workUnitStore = _workunitasyncstorageexternal.workUnitAsyncStorage.getStore();\n    const hangingInputAbortSignal = (workUnitStore == null ? void 0 : workUnitStore.type) === 'prerender' ? (0, _dynamicrendering.createHangingInputAbortSignal)(workUnitStore) : undefined;\n    // Using Flight to serialize the args into a string.\n    const serialized = await (0, _nodewebstreamshelper.streamToString)((0, _serveredge.renderToReadableStream)(args, clientModules, {\n        signal: hangingInputAbortSignal,\n        onError (err) {\n            if (hangingInputAbortSignal == null ? void 0 : hangingInputAbortSignal.aborted) {\n                return;\n            }\n            // We're only reporting one error at a time, starting with the first.\n            if (didCatchError) {\n                return;\n            }\n            didCatchError = true;\n            // Use the original error message together with the previously created\n            // stack, because err.stack is a useless Flight Server call stack.\n            error.message = err instanceof Error ? err.message : String(err);\n        }\n    }), // We pass the abort signal to `streamToString` so that no chunks are\n    // included that are emitted after the signal was already aborted. This\n    // ensures that we can encode hanging promises.\n    hangingInputAbortSignal);\n    if (didCatchError) {\n        if (process.env.NODE_ENV === 'development') {\n            // Logging the error is needed for server functions that are passed to the\n            // client where the decryption is not done during rendering. Console\n            // replaying allows us to still show the error dev overlay in this case.\n            console.error(error);\n        }\n        throw error;\n    }\n    if (!workUnitStore) {\n        return encodeActionBoundArg(actionId, serialized);\n    }\n    const prerenderResumeDataCache = (0, _workunitasyncstorageexternal.getPrerenderResumeDataCache)(workUnitStore);\n    const renderResumeDataCache = (0, _workunitasyncstorageexternal.getRenderResumeDataCache)(workUnitStore);\n    const cacheKey = actionId + serialized;\n    const cachedEncrypted = (prerenderResumeDataCache == null ? void 0 : prerenderResumeDataCache.encryptedBoundArgs.get(cacheKey)) ?? (renderResumeDataCache == null ? void 0 : renderResumeDataCache.encryptedBoundArgs.get(cacheKey));\n    if (cachedEncrypted) {\n        return cachedEncrypted;\n    }\n    const cacheSignal = workUnitStore.type === 'prerender' ? workUnitStore.cacheSignal : undefined;\n    cacheSignal == null ? void 0 : cacheSignal.beginRead();\n    const encrypted = await encodeActionBoundArg(actionId, serialized);\n    cacheSignal == null ? void 0 : cacheSignal.endRead();\n    prerenderResumeDataCache == null ? void 0 : prerenderResumeDataCache.encryptedBoundArgs.set(cacheKey, encrypted);\n    return encrypted;\n});\nasync function decryptActionBoundArgs(actionId, encryptedPromise) {\n    const encrypted = await encryptedPromise;\n    const workUnitStore = _workunitasyncstorageexternal.workUnitAsyncStorage.getStore();\n    let decrypted;\n    if (workUnitStore) {\n        const cacheSignal = workUnitStore.type === 'prerender' ? workUnitStore.cacheSignal : undefined;\n        const prerenderResumeDataCache = (0, _workunitasyncstorageexternal.getPrerenderResumeDataCache)(workUnitStore);\n        const renderResumeDataCache = (0, _workunitasyncstorageexternal.getRenderResumeDataCache)(workUnitStore);\n        decrypted = (prerenderResumeDataCache == null ? void 0 : prerenderResumeDataCache.decryptedBoundArgs.get(encrypted)) ?? (renderResumeDataCache == null ? void 0 : renderResumeDataCache.decryptedBoundArgs.get(encrypted));\n        if (!decrypted) {\n            cacheSignal == null ? void 0 : cacheSignal.beginRead();\n            decrypted = await decodeActionBoundArg(actionId, encrypted);\n            cacheSignal == null ? void 0 : cacheSignal.endRead();\n            prerenderResumeDataCache == null ? void 0 : prerenderResumeDataCache.decryptedBoundArgs.set(encrypted, decrypted);\n        }\n    } else {\n        decrypted = await decodeActionBoundArg(actionId, encrypted);\n    }\n    const { edgeRscModuleMapping, rscModuleMapping } = (0, _encryptionutils.getClientReferenceManifestForRsc)();\n    // Using Flight to deserialize the args from the string.\n    const deserialized = await (0, _clientedge.createFromReadableStream)(new ReadableStream({\n        start (controller) {\n            controller.enqueue(textEncoder.encode(decrypted));\n            if ((workUnitStore == null ? void 0 : workUnitStore.type) === 'prerender') {\n                // Explicitly don't close the stream here (until prerendering is\n                // complete) so that hanging promises are not rejected.\n                if (workUnitStore.renderSignal.aborted) {\n                    controller.close();\n                } else {\n                    workUnitStore.renderSignal.addEventListener('abort', ()=>controller.close(), {\n                        once: true\n                    });\n                }\n            } else {\n                controller.close();\n            }\n        }\n    }), {\n        serverConsumerManifest: {\n            // moduleLoading must be null because we don't want to trigger preloads of ClientReferences\n            // to be added to the current execution. Instead, we'll wait for any ClientReference\n            // to be emitted which themselves will handle the preloading.\n            moduleLoading: null,\n            moduleMap: isEdgeRuntime ? edgeRscModuleMapping : rscModuleMapping,\n            serverModuleMap: (0, _encryptionutils.getServerModuleMap)()\n        }\n    });\n    return deserialized;\n}\n\n//# sourceMappingURL=encryption.js.map","import(/* webpackMode: \"eager\" */ \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\i18n\\\\hooks.ts\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"E:\\\\downloads\\\\Hijraah\\\\node_modules\\\\.pnpm\\\\next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596\\\\node_modules\\\\next-intl\\\\dist\\\\esm\\\\navigation\\\\shared\\\\BaseLink.js\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"E:\\\\downloads\\\\Hijraah\\\\node_modules\\\\.pnpm\\\\next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596\\\\node_modules\\\\next-intl\\\\dist\\\\esm\\\\navigation\\\\shared\\\\LegacyBaseLink.js\");\n","module.exports = require(\"stream\");","module.exports = require(\"util\");","/* eslint-disable import/no-extraneous-dependencies */ \"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"registerServerReference\", {\n    enumerable: true,\n    get: function() {\n        return _serveredge.registerServerReference;\n    }\n});\nconst _serveredge = require(\"react-server-dom-webpack/server.edge\");\n\n//# sourceMappingURL=server-reference.js.map","/**\r\n * List of supported locales\r\n */\r\nexport const locales = ['en', 'ar', 'es', 'fr'] as const;\r\n\r\n/**\r\n * Type representing the supported locales\r\n */\r\nexport type Locale = (typeof locales)[number];\r\n\r\n/**\r\n * Default locale when no preference is detected\r\n */\r\nexport const defaultLocale: Locale = 'en';\r\n\r\n/**\r\n * Configuration for each locale\r\n */\r\nexport interface LocaleConfig {\r\n  /** Native name of the language */\r\n  nativeName: string;\r\n  /** English name of the language */\r\n  englishName: string;\r\n  /** Text direction (ltr or rtl) */\r\n  direction: 'ltr' | 'rtl';\r\n  /** Date format pattern */\r\n  dateFormat: string;\r\n  /** Flag emoji or code for the language */\r\n  flag: string;\r\n  /** HTML lang attribute value */\r\n  htmlLang: string;\r\n  /** Number formatting options */\r\n  number: {\r\n    /** Decimal separator */\r\n    decimal: string;\r\n    /** Thousands separator */\r\n    thousands: string;\r\n  };\r\n  /** Calendar system */\r\n  calendar?: 'gregory' | 'islamic';\r\n  /** Font class for language-specific typography */\r\n  fontClass?: string;\r\n}\r\n\r\n/**\r\n * Configuration for all supported locales\r\n */\r\nexport const localeConfigs: Record<Locale, LocaleConfig> = {\r\n  en: {\r\n    nativeName: 'English',\r\n    englishName: 'English',\r\n    direction: 'ltr',\r\n    dateFormat: 'MM/DD/YYYY',\r\n    flag: '',\r\n    htmlLang: 'en',\r\n    calendar: 'gregory',\r\n    number: {\r\n      decimal: '.',\r\n      thousands: ',',\r\n    }\r\n  },\r\n  ar: {\r\n    nativeName: '',\r\n    englishName: 'Arabic',\r\n    direction: 'rtl',\r\n    dateFormat: 'DD/MM/YYYY',\r\n    flag: '',\r\n    htmlLang: 'ar',\r\n    calendar: 'islamic',\r\n    fontClass: 'font-arabic',\r\n    number: {\r\n      decimal: '',\r\n      thousands: '',\r\n    }\r\n  },\r\n  fr: {\r\n    nativeName: 'Franais',\r\n    englishName: 'French',\r\n    direction: 'ltr',\r\n    dateFormat: 'DD/MM/YYYY',\r\n    flag: '',\r\n    htmlLang: 'fr',\r\n    calendar: 'gregory',\r\n    number: {\r\n      decimal: ',',\r\n      thousands: ' ',\r\n    }\r\n  },\r\n  es: {\r\n    nativeName: 'Espaol',\r\n    englishName: 'Spanish',\r\n    direction: 'ltr',\r\n    dateFormat: 'DD/MM/YYYY',\r\n    flag: '',\r\n    htmlLang: 'es',\r\n    calendar: 'gregory',\r\n    number: {\r\n      decimal: ',',\r\n      thousands: '.',\r\n    }\r\n  },\r\n};\r\n\r\n/**\r\n * Get configuration for a specific locale\r\n */\r\nexport function getLocaleConfig(locale: Locale | string): LocaleConfig {\r\n  return localeConfigs[locale as Locale] || localeConfigs[defaultLocale];\r\n}\r\n\r\n/**\r\n * Check if a locale is RTL\r\n */\r\nexport function isRTL(locale: Locale | string): boolean {\r\n  return getLocaleConfig(locale).direction === 'rtl';\r\n}\r\n\r\n/**\r\n * Get font class for a locale\r\n */\r\nexport function getLocaleFont(locale: Locale | string): string | undefined {\r\n  return getLocaleConfig(locale).fontClass;\r\n}\r\n\r\n/**\r\n * Get calendar system for a locale\r\n */\r\nexport function getCalendarSystem(locale: Locale | string): 'gregory' | 'islamic' {\r\n  return getLocaleConfig(locale).calendar || 'gregory';\r\n}\r\n\r\n/**\r\n * Get HTML lang attribute value for a locale\r\n */\r\nexport function getHtmlLang(locale: Locale | string): string {\r\n  return getLocaleConfig(locale).htmlLang;\r\n}\r\n\r\n/**\r\n * Get date format for a locale\r\n */\r\nexport function getDateFormat(locale: Locale | string): string {\r\n  return getLocaleConfig(locale).dateFormat;\r\n}","module.exports = require(\"fs\");","module.exports = require(\"next/dist/server/app-render/work-async-storage.external.js\");","// src/middleware/cors/index.ts\nvar cors = (options) => {\n  const defaults = {\n    origin: \"*\",\n    allowMethods: [\"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"],\n    allowHeaders: [],\n    exposeHeaders: []\n  };\n  const opts = {\n    ...defaults,\n    ...options\n  };\n  const findAllowOrigin = ((optsOrigin) => {\n    if (typeof optsOrigin === \"string\") {\n      if (optsOrigin === \"*\") {\n        return () => optsOrigin;\n      } else {\n        return (origin) => optsOrigin === origin ? origin : null;\n      }\n    } else if (typeof optsOrigin === \"function\") {\n      return optsOrigin;\n    } else {\n      return (origin) => optsOrigin.includes(origin) ? origin : null;\n    }\n  })(opts.origin);\n  const findAllowMethods = ((optsAllowMethods) => {\n    if (typeof optsAllowMethods === \"function\") {\n      return optsAllowMethods;\n    } else if (Array.isArray(optsAllowMethods)) {\n      return () => optsAllowMethods;\n    } else {\n      return () => [];\n    }\n  })(opts.allowMethods);\n  return async function cors2(c, next) {\n    function set(key, value) {\n      c.res.headers.set(key, value);\n    }\n    const allowOrigin = findAllowOrigin(c.req.header(\"origin\") || \"\", c);\n    if (allowOrigin) {\n      set(\"Access-Control-Allow-Origin\", allowOrigin);\n    }\n    if (opts.origin !== \"*\") {\n      const existingVary = c.req.header(\"Vary\");\n      if (existingVary) {\n        set(\"Vary\", existingVary);\n      } else {\n        set(\"Vary\", \"Origin\");\n      }\n    }\n    if (opts.credentials) {\n      set(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n    if (opts.exposeHeaders?.length) {\n      set(\"Access-Control-Expose-Headers\", opts.exposeHeaders.join(\",\"));\n    }\n    if (c.req.method === \"OPTIONS\") {\n      if (opts.maxAge != null) {\n        set(\"Access-Control-Max-Age\", opts.maxAge.toString());\n      }\n      const allowMethods = findAllowMethods(c.req.header(\"origin\") || \"\", c);\n      if (allowMethods.length) {\n        set(\"Access-Control-Allow-Methods\", allowMethods.join(\",\"));\n      }\n      let headers = opts.allowHeaders;\n      if (!headers?.length) {\n        const requestHeaders = c.req.header(\"Access-Control-Request-Headers\");\n        if (requestHeaders) {\n          headers = requestHeaders.split(/\\s*,\\s*/);\n        }\n      }\n      if (headers?.length) {\n        set(\"Access-Control-Allow-Headers\", headers.join(\",\"));\n        c.res.headers.append(\"Vary\", \"Access-Control-Request-Headers\");\n      }\n      c.res.headers.delete(\"Content-Length\");\n      c.res.headers.delete(\"Content-Type\");\n      return new Response(null, {\n        headers: c.res.headers,\n        status: 204,\n        statusText: \"No Content\"\n      });\n    }\n    await next();\n  };\n};\nexport {\n  cors\n};\n","// src/adapter/vercel/handler.ts\nvar handle = (app) => (req) => {\n  return app.fetch(req);\n};\nexport {\n  handle\n};\n","// src/middleware/cache/index.ts\nvar defaultCacheableStatusCodes = [200];\nvar cache = (options) => {\n  if (!globalThis.caches) {\n    console.log(\"Cache Middleware is not enabled because caches is not defined.\");\n    return async (_c, next) => await next();\n  }\n  if (options.wait === void 0) {\n    options.wait = false;\n  }\n  const cacheControlDirectives = options.cacheControl?.split(\",\").map((directive) => directive.toLowerCase());\n  const varyDirectives = Array.isArray(options.vary) ? options.vary : options.vary?.split(\",\").map((directive) => directive.trim());\n  if (options.vary?.includes(\"*\")) {\n    throw new Error(\n      'Middleware vary configuration cannot include \"*\", as it disallows effective caching.'\n    );\n  }\n  const cacheableStatusCodes = new Set(\n    options.cacheableStatusCodes ?? defaultCacheableStatusCodes\n  );\n  const addHeader = (c) => {\n    if (cacheControlDirectives) {\n      const existingDirectives = c.res.headers.get(\"Cache-Control\")?.split(\",\").map((d) => d.trim().split(\"=\", 1)[0]) ?? [];\n      for (const directive of cacheControlDirectives) {\n        let [name, value] = directive.trim().split(\"=\", 2);\n        name = name.toLowerCase();\n        if (!existingDirectives.includes(name)) {\n          c.header(\"Cache-Control\", `${name}${value ? `=${value}` : \"\"}`, { append: true });\n        }\n      }\n    }\n    if (varyDirectives) {\n      const existingDirectives = c.res.headers.get(\"Vary\")?.split(\",\").map((d) => d.trim()) ?? [];\n      const vary = Array.from(\n        new Set(\n          [...existingDirectives, ...varyDirectives].map((directive) => directive.toLowerCase())\n        )\n      ).sort();\n      if (vary.includes(\"*\")) {\n        c.header(\"Vary\", \"*\");\n      } else {\n        c.header(\"Vary\", vary.join(\", \"));\n      }\n    }\n  };\n  return async function cache2(c, next) {\n    let key = c.req.url;\n    if (options.keyGenerator) {\n      key = await options.keyGenerator(c);\n    }\n    const cacheName = typeof options.cacheName === \"function\" ? await options.cacheName(c) : options.cacheName;\n    const cache3 = await caches.open(cacheName);\n    const response = await cache3.match(key);\n    if (response) {\n      return new Response(response.body, response);\n    }\n    await next();\n    if (!cacheableStatusCodes.has(c.res.status)) {\n      return;\n    }\n    addHeader(c);\n    const res = c.res.clone();\n    if (options.wait) {\n      await cache3.put(key, res);\n    } else {\n      c.executionCtx.waitUntil(cache3.put(key, res));\n    }\n  };\n};\nexport {\n  cache\n};\n","module.exports = require(\"node:child_process\");","import { Hono } from \"hono\";\r\nimport { HTTPException } from \"hono/http-exception\";\r\nimport { z } from \"zod\";\r\n\r\nimport type { AppEnv } from \"@/app/api/[[...route]]/route\"; // Adjust if AppEnv moves\r\nimport type { User, PaginatedResponse, ApiResponse } from \"@/app/api/types\"; // Adjust if types move\r\n\r\n// --- Schemas (ported from src/app/api/core/route.ts) ---\r\nconst querySchema = z.object({\r\n  page: z.coerce.number().int().min(1).optional().default(1),\r\n  limit: z.coerce.number().int().min(1).max(100).optional().default(10),\r\n  search: z.string().optional(),\r\n});\r\n\r\nconst createUserSchema = z.object({\r\n  name: z\r\n    .string()\r\n    .min(2, { message: \"Name must be at least 2 characters long\" }),\r\n  email: z.string().email({ message: \"Invalid email address\" }),\r\n});\r\n\r\nconst updateUserSchema = z\r\n  .object({\r\n    name: z\r\n      .string()\r\n      .min(2, { message: \"Name must be at least 2 characters long\" })\r\n      .optional(),\r\n    email: z.string().email({ message: \"Invalid email address\" }).optional(),\r\n  })\r\n  .refine((data) => Object.keys(data).length > 0, {\r\n    message: \"At least one field (name or email) must be provided for update\",\r\n  });\r\n\r\n// --- Error Handling Helper (adapted for Hono) ---\r\nconst handleRouteError = (error: any, defaultMessage: string, c: any) => {\r\n  console.error(`Error: ${defaultMessage}:`, error);\r\n  let message = defaultMessage;\r\n  let status = 500;\r\n\r\n  if (error?.code === \"PGRST116\" || error?.message?.includes(\"PGRST116\")) {\r\n    // Suabase v2/v3 check\r\n    message = \"Resource not found\";\r\n    status = 404;\r\n  } else if (error?.code === \"23505\" || error?.message?.includes(\"23505\")) {\r\n    // Uniqueness violation\r\n    message = \"Resource already exists or conflicts with existing data\";\r\n    status = 409;\r\n  } else if (error instanceof z.ZodError) {\r\n    throw new HTTPException(400, {\r\n      message: \"Invalid input\",\r\n      cause: error.errors,\r\n    });\r\n  }\r\n  throw new HTTPException(status, { message });\r\n};\r\n\r\n// --- Hono Router for Users ---\r\nexport const setupUserRoutes = (app: Hono<AppEnv>) => {\r\n  const users = new Hono<AppEnv>();\r\n\r\n  // Middleware: Check for authenticated user for all user routes\r\n  users.use(\"*\", async (c, next) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized\" });\r\n    }\r\n    await next();\r\n  });\r\n\r\n  // GET / (List Users)\r\n  users.get(\"/\", async (c) => {\r\n    try {\r\n      const validationResult = querySchema.safeParse(c.req.query());\r\n      if (!validationResult.success) {\r\n        throw new HTTPException(400, {\r\n          message: \"Invalid query parameters\",\r\n          cause: validationResult.error.errors,\r\n        });\r\n      }\r\n      const { page, limit, search } = validationResult.data;\r\n      const offset = (page - 1) * limit;\r\n      const db = c.get(\"db\");\r\n\r\n      let query = db\r\n        .from(\"users\")\r\n        .select(\"id, name, email, created_at\", { count: \"exact\" });\r\n\r\n      if (search) {\r\n        query = query.ilike(\"name\", `%${search}%`); // Ensure your 'users' table and RLS allow this\r\n      }\r\n\r\n      const { data, count, error } = await query\r\n        .range(offset, offset + limit - 1)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      const responseData: PaginatedResponse<Partial<User>> = {\r\n        data: data || [],\r\n        pagination: {\r\n          total: count || 0,\r\n          page,\r\n          limit,\r\n          hasMore: (count || 0) > offset + (data?.length || 0),\r\n        },\r\n      };\r\n      const apiResponse: ApiResponse<PaginatedResponse<Partial<User>>> = {\r\n        data: responseData,\r\n      };\r\n      return c.json(apiResponse);\r\n    } catch (error) {\r\n      return handleRouteError(error, \"Error fetching users\", c);\r\n    }\r\n  });\r\n\r\n  // POST / (Create User)\r\n  users.post(\"/\", async (c) => {\r\n    try {\r\n      const rawBody = await c.req.json();\r\n      const validationResult = createUserSchema.safeParse(rawBody);\r\n      if (!validationResult.success) {\r\n        throw new HTTPException(400, {\r\n          message: \"Invalid request body\",\r\n          cause: validationResult.error.errors,\r\n        });\r\n      }\r\n      const { name, email } = validationResult.data;\r\n      const db = c.get(\"db\");\r\n\r\n      const { data: existingUser, error: checkError } = await db\r\n        .from(\"users\")\r\n        .select(\"id\")\r\n        .eq(\"email\", email)\r\n        .maybeSingle();\r\n\r\n      if (checkError && checkError.code !== \"PGRST116\") {\r\n        // Ignore not found for maybeSingle\r\n        console.error(\"Error checking for existing user:\", checkError);\r\n        // Potentially throw, but be careful not to mask the 409 below\r\n      }\r\n      if (existingUser) {\r\n        return handleRouteError({ code: \"23505\" }, \"User already exists\", c);\r\n      }\r\n\r\n      const { data: newUser, error: insertError } = await db\r\n        .from(\"users\")\r\n        .insert({ name, email })\r\n        .select(\"id, name, email, created_at\")\r\n        .single();\r\n\r\n      if (insertError) throw insertError;\r\n      if (!newUser) throw new Error(\"User data was not returned after insert.\");\r\n\r\n      const apiResponse: ApiResponse<Partial<User>> = { data: newUser };\r\n      return c.json(apiResponse, 201);\r\n    } catch (error) {\r\n      return handleRouteError(error, \"Error creating user\", c);\r\n    }\r\n  });\r\n\r\n  // GET /:id (Get User by ID)\r\n  users.get(\"/:id\", async (c) => {\r\n    try {\r\n      const id = c.req.param(\"id\");\r\n      if (!id) {\r\n        throw new HTTPException(400, { message: \"User ID is required\" });\r\n      }\r\n      const db = c.get(\"db\");\r\n      const { data: user, error } = await db\r\n        .from(\"users\")\r\n        .select(\"id, name, email, created_at\")\r\n        .eq(\"id\", id)\r\n        .single();\r\n\r\n      if (error) throw error; // This will be caught by handleRouteError, PGRST116 for not found\r\n\r\n      const apiResponse: ApiResponse<Partial<User>> = { data: user };\r\n      return c.json(apiResponse);\r\n    } catch (error) {\r\n      return handleRouteError(error, \"Error fetching user\", c);\r\n    }\r\n  });\r\n\r\n  // PATCH /:id (Update User)\r\n  users.patch(\"/:id\", async (c) => {\r\n    try {\r\n      const id = c.req.param(\"id\");\r\n      if (!id) {\r\n        throw new HTTPException(400, { message: \"User ID is required\" });\r\n      }\r\n\r\n      const rawBody = await c.req.json();\r\n      const validationResult = updateUserSchema.safeParse(rawBody);\r\n      if (!validationResult.success) {\r\n        throw new HTTPException(400, {\r\n          message: \"Invalid request body\",\r\n          cause: validationResult.error.errors,\r\n        });\r\n      }\r\n      const updateData = validationResult.data;\r\n      const db = c.get(\"db\");\r\n\r\n      const { data: updatedUser, error } = await db\r\n        .from(\"users\")\r\n        .update(updateData)\r\n        .eq(\"id\", id)\r\n        .select(\"id, name, email, created_at\")\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      if (!updatedUser)\r\n        throw new Error(\"User data was not returned after update.\"); // Should be caught by PGRST116 if not found\r\n\r\n      const apiResponse: ApiResponse<Partial<User>> = { data: updatedUser };\r\n      return c.json(apiResponse);\r\n    } catch (error) {\r\n      return handleRouteError(error, \"Error updating user\", c);\r\n    }\r\n  });\r\n\r\n  // DELETE /:id (Delete User)\r\n  users.delete(\"/:id\", async (c) => {\r\n    try {\r\n      const id = c.req.param(\"id\");\r\n      if (!id) {\r\n        throw new HTTPException(400, { message: \"User ID is required\" });\r\n      }\r\n      const db = c.get(\"db\");\r\n\r\n      // Check if user exists before deleting, to return 404 if not found\r\n      const { data: existingUser, error: checkError } = await db\r\n        .from(\"users\")\r\n        .select(\"id\")\r\n        .eq(\"id\", id)\r\n        .maybeSingle();\r\n\r\n      if (checkError && checkError.code !== \"PGRST116\") throw checkError;\r\n      if (!existingUser) {\r\n        throw new HTTPException(404, { message: \"User not found\" });\r\n      }\r\n\r\n      const { error: deleteError } = await db\r\n        .from(\"users\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      return c.json({ message: \"User deleted successfully\" }, 200);\r\n    } catch (error) {\r\n      return handleRouteError(error, \"Error deleting user\", c);\r\n    }\r\n  });\r\n\r\n  return users;\r\n};\r\n","module.exports = require(\"path\");","import { ensureLeadingSlash } from '../../page-path/ensure-leading-slash'\nimport { isGroupSegment } from '../../segment'\n\n/**\n * Normalizes an app route so it represents the actual request path. Essentially\n * performing the following transformations:\n *\n * - `/(dashboard)/user/[id]/page` to `/user/[id]`\n * - `/(dashboard)/account/page` to `/account`\n * - `/user/[id]/page` to `/user/[id]`\n * - `/account/page` to `/account`\n * - `/page` to `/`\n * - `/(dashboard)/user/[id]/route` to `/user/[id]`\n * - `/(dashboard)/account/route` to `/account`\n * - `/user/[id]/route` to `/user/[id]`\n * - `/account/route` to `/account`\n * - `/route` to `/`\n * - `/` to `/`\n *\n * @param route the app route to normalize\n * @returns the normalized pathname\n */\nexport function normalizeAppPath(route: string) {\n  return ensureLeadingSlash(\n    route.split('/').reduce((pathname, segment, index, segments) => {\n      // Empty segments are ignored.\n      if (!segment) {\n        return pathname\n      }\n\n      // Groups are ignored.\n      if (isGroupSegment(segment)) {\n        return pathname\n      }\n\n      // Parallel segments are ignored.\n      if (segment[0] === '@') {\n        return pathname\n      }\n\n      // The last segment (if it's a leaf) should be ignored.\n      if (\n        (segment === 'page' || segment === 'route') &&\n        index === segments.length - 1\n      ) {\n        return pathname\n      }\n\n      return `${pathname}/${segment}`\n    }, '')\n  )\n}\n\n/**\n * Strips the `.rsc` extension if it's in the pathname.\n * Since this function is used on full urls it checks `?` for searchParams handling.\n */\nexport function normalizeRscURL(url: string) {\n  return url.replace(\n    /\\.rsc($|\\?)/,\n    // $1 ensures `?` is preserved\n    '$1'\n  )\n}\n","import { zValidator } from \"@hono/zod-validator\";\r\nimport { Hono } from \"hono\";\r\nimport { cache } from \"hono/cache\";\r\nimport { HTTPException } from \"hono/http-exception\";\r\nimport { z } from \"zod\";\r\n\r\nimport { createServiceClient } from \"@/lib/supabase/client\";\r\n\r\n\r\n/**\r\n * Immigration routes for immigration-related operations\r\n */\r\nexport function setupImmigrationRoutes(app: Hono) {\r\n  // Validation schemas\r\n  const countryQuerySchema = z.object({\r\n    country: z.string().min(2).max(100),\r\n  });\r\n\r\n  const compareQuerySchema = z.object({\r\n    countries: z.array(z.string().min(2).max(100)).min(2).max(5),\r\n    category: z\r\n      .enum([\r\n        \"visa\",\r\n        \"citizenship\",\r\n        \"residence\",\r\n        \"business\",\r\n        \"tax\",\r\n        \"education\",\r\n        \"healthcare\",\r\n      ])\r\n      .optional(),\r\n  });\r\n\r\n  // Get immigration information for a specific country\r\n  app.get(\r\n    \"/immigration/country\",\r\n    zValidator(\"query\", countryQuerySchema),\r\n    cache({\r\n      cacheName: \"immigration-country\",\r\n      cacheControl: \"public, max-age=86400\", // 24 hours\r\n    }),\r\n    async (c) => {\r\n      const { country } = c.req.valid(\"query\");\r\n\r\n      try {\r\n        const supabase = createServiceClient();\r\n        const { data, error } = await supabase\r\n          .from(\"immigration_data\")\r\n          .select(\"*\")\r\n          .eq(\"country\", country)\r\n          .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return c.json({\r\n          success: true,\r\n          data,\r\n        });\r\n      } catch (error: any) {\r\n        console.error(\"Immigration data fetch error:\", error);\r\n        throw new HTTPException(500, {\r\n          message: \"Failed to fetch immigration data\",\r\n        });\r\n      }\r\n    }\r\n  );\r\n\r\n  // Compare immigration policies between countries\r\n  app.post(\r\n    \"/immigration/compare\",\r\n    zValidator(\"json\", compareQuerySchema),\r\n    cache({\r\n      cacheName: \"immigration-compare\",\r\n      cacheControl: \"public, max-age=86400\", // 24 hours\r\n    }),\r\n    async (c) => {\r\n      const { countries, category } = c.req.valid(\"json\");\r\n\r\n      try {\r\n        const supabase = createServiceClient();\r\n        const { data, error } = await supabase\r\n          .from(\"immigration_data\")\r\n          .select(\"*\")\r\n          .in(\"country\", countries);\r\n\r\n        if (error) throw error;\r\n\r\n        // Filter by category if provided\r\n        let filteredData = data;\r\n        if (category) {\r\n          filteredData = data.filter((item) => item.category === category);\r\n        }\r\n\r\n        return c.json({\r\n          success: true,\r\n          data: filteredData,\r\n        });\r\n      } catch (error: any) {\r\n        console.error(\"Immigration comparison error:\", error);\r\n        throw new HTTPException(500, {\r\n          message: \"Failed to compare immigration data\",\r\n        });\r\n      }\r\n    }\r\n  );\r\n\r\n  // Get all available countries for immigration\r\n  app.get(\r\n    \"/immigration/countries\",\r\n    cache({\r\n      cacheName: \"immigration-countries\",\r\n      cacheControl: \"public, max-age=86400\", // 24 hours\r\n    }),\r\n    async (c) => {\r\n      try {\r\n        const supabase = createServiceClient();\r\n        const { data, error } = await supabase\r\n          .from(\"immigration_data\")\r\n          .select(\"country\")\r\n          .order(\"country\");\r\n\r\n        if (error) throw error;\r\n\r\n        // Extract unique countries\r\n        const countries = [...new Set(data.map((item) => item.country))];\r\n\r\n        return c.json({\r\n          success: true,\r\n          countries,\r\n        });\r\n      } catch (error: any) {\r\n        console.error(\"Countries fetch error:\", error);\r\n        throw new HTTPException(500, { message: \"Failed to fetch countries\" });\r\n      }\r\n    }\r\n  );\r\n\r\n  return app;\r\n}\r\n","module.exports = require(\"tls\");","import(/* webpackMode: \"eager\" */ \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\i18n\\\\hooks.ts\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"E:\\\\downloads\\\\Hijraah\\\\node_modules\\\\.pnpm\\\\next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596\\\\node_modules\\\\next-intl\\\\dist\\\\esm\\\\navigation\\\\shared\\\\BaseLink.js\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"E:\\\\downloads\\\\Hijraah\\\\node_modules\\\\.pnpm\\\\next-intl@3.26.5_next@15.3._7e4e666345518ee87977d0efacc37596\\\\node_modules\\\\next-intl\\\\dist\\\\esm\\\\navigation\\\\shared\\\\LegacyBaseLink.js\");\n","import * as Sentry from \"@sentry/nextjs\"; // New import for the main Sentry SDK\r\nimport { Context, Next } from \"hono\";\r\n// import * as SentryLib from '../lib/sentry'; // Old import removed\r\n\r\n// Define a common error structure\r\nexport interface ErrorLogData {\r\n  message: string;\r\n  path: string;\r\n  method: string;\r\n  timestamp: string;\r\n  userId?: string;\r\n  statusCode: number;\r\n  stack?: string;\r\n  details?: any;\r\n  requestId?: string;\r\n  component?: string;\r\n  tags?: Record<string, string>;\r\n}\r\n\r\n// Configure error logging based on environment\r\nconst IS_PRODUCTION = process.env.NODE_ENV === \"production\";\r\n\r\n// Error log storage for development (in-memory for local dev only)\r\nconst ERROR_LOGS: ErrorLogData[] = [];\r\n\r\n// Helper function (recreated from the deleted SentryLib)\r\nfunction getRequestData(c: Context): Record<string, any> {\r\n  const headers: Record<string, string> = {};\r\n  c.req.raw.headers.forEach((value, key) => {\r\n    headers[key] = value;\r\n  });\r\n\r\n  return {\r\n    url: c.req.url,\r\n    method: c.req.method,\r\n    path: c.req.path,\r\n    headers,\r\n    query_params: c.req.query(),\r\n    // Avoid logging large request bodies by default for performance and privacy\r\n    // body: c.req.header('content-type')?.includes('application/json') ? await c.req.json().catch(() => ({})) : undefined,\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize Sentry client - REMOVED (handled by global Sentry setup)\r\n * Call this at app startup\r\n */\r\n// export function initializeErrorLogging(): void { // Entire function removed\r\n//   SentryLib.initSentry();\r\n// }\r\n\r\n/**\r\n * Middleware to handle errors and log them centrally with Sentry\r\n */\r\nexport function sentryErrorLoggerMiddleware(\r\n  options: { component?: string } = {}\r\n) {\r\n  return async (c: Context, next: Next) => {\r\n    try {\r\n      // Add request breadcrumb\r\n      Sentry.addBreadcrumb({\r\n        // Changed from SentryLib.addBreadcrumb\r\n        type: \"http\",\r\n        category: \"http\",\r\n        data: {\r\n          url: c.req.url,\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        },\r\n        level: \"info\",\r\n      });\r\n\r\n      // Generate a unique request ID for tracking\r\n      const requestId = c.get(\"requestId\") || generateRequestId();\r\n      c.set(\"requestId\" as any, requestId);\r\n\r\n      // Set user context if available\r\n      const user = c.get(\"user\");\r\n      if (user) {\r\n        Sentry.setUser({\r\n          // Changed from SentryLib.setUser\r\n          id: user.id,\r\n          email: user.email,\r\n          ip_address:\r\n            c.req.header(\"x-forwarded-for\") ||\r\n            c.req.header(\"x-real-ip\") ||\r\n            \"unknown\",\r\n        });\r\n      } else {\r\n        // Set anonymous context\r\n        Sentry.setUser({\r\n          // Changed from SentryLib.setUser\r\n          id: \"anonymous\",\r\n          ip_address:\r\n            c.req.header(\"x-forwarded-for\") ||\r\n            c.req.header(\"x-real-ip\") ||\r\n            \"unknown\",\r\n        });\r\n      }\r\n\r\n      // Add request data to Sentry context\r\n      Sentry.setContext(\"request\", getRequestData(c)); // Changed from SentryLib.setContext and SentryLib.getRequestData\r\n\r\n      await next();\r\n    } catch (err: any) {\r\n      // Create structured error log\r\n      const errorLog: ErrorLogData = {\r\n        message: err.message || \"Unknown error\",\r\n        path: c.req.path,\r\n        method: c.req.method,\r\n        timestamp: new Date().toISOString(),\r\n        statusCode: err.status || 500,\r\n        userId: c.get(\"user\")?.id,\r\n        details: err.details,\r\n        requestId: c.get(\"requestId\" as any),\r\n        component: options.component || \"api\",\r\n      };\r\n\r\n      // In development, include stack trace\r\n      if (!IS_PRODUCTION) {\r\n        errorLog.stack = err.stack;\r\n      }\r\n\r\n      // Log error\r\n      logError(errorLog);\r\n\r\n      // Return appropriate response to client\r\n      const responseBody = {\r\n        success: false,\r\n        error: IS_PRODUCTION\r\n          ? \"Internal Server Error\"\r\n          : err.message || \"Unknown error\",\r\n        ...(IS_PRODUCTION ? {} : { stack: err.stack }),\r\n        requestId: errorLog.requestId, // Always include the request ID for support reference\r\n      };\r\n\r\n      // If headers aren't sent yet, add a request ID header\r\n      c.header(\"X-Request-ID\", errorLog.requestId || \"unknown\");\r\n\r\n      // Convert numeric status code to Hono compatible status\r\n      const status = errorLog.statusCode as 400 | 401 | 403 | 404 | 500;\r\n      return c.json(responseBody, status);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Function to log errors to Sentry and local systems\r\n */\r\nexport function logError(errorLog: ErrorLogData): void {\r\n  if (IS_PRODUCTION) {\r\n    // In production, send to Sentry\r\n    const sentryContext = {\r\n      ...errorLog,\r\n      timestamp: errorLog.timestamp,\r\n      userAgent: errorLog.details?.userAgent,\r\n    };\r\n\r\n    // Create a proper Error object for Sentry\r\n    const error = new Error(errorLog.message);\r\n    if (errorLog.stack) {\r\n      error.stack = errorLog.stack;\r\n    }\r\n\r\n    // Set specific error metadata\r\n    if (errorLog.component) {\r\n      // SentryLib.setContext('component', { name: errorLog.component }); // Old way\r\n      Sentry.setTag(\"component\", errorLog.component); // New, more direct way for tags\r\n    }\r\n\r\n    if (errorLog.tags) {\r\n      Object.entries(errorLog.tags).forEach(([key, value]) => {\r\n        // SentryLib.setContext(key, { value }); // Old way\r\n        Sentry.setTag(key, value); // New, more direct way for tags\r\n      });\r\n    }\r\n\r\n    // Send to Sentry\r\n    // SentryLib.captureException(error, sentryContext); // Old way\r\n    Sentry.captureException(error, {\r\n      // New way, pass context as second arg options\r\n      extra: sentryContext,\r\n    });\r\n\r\n    // Also log to console for server logs\r\n    console.error(\" API Error:\", JSON.stringify(errorLog));\r\n  } else {\r\n    // In development, pretty print error and store locally\r\n    console.error(\" API Error:\");\r\n    console.error(errorLog);\r\n\r\n    // Store in memory for development debugging\r\n    ERROR_LOGS.unshift(errorLog);\r\n\r\n    // Keep only the last 100 errors in memory\r\n    if (ERROR_LOGS.length > 100) {\r\n      ERROR_LOGS.pop();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Utility to manually log errors from anywhere in the code\r\n */\r\nexport function captureError(\r\n  error: Error | string,\r\n  details?: any,\r\n  userId?: string,\r\n  component?: string\r\n): void {\r\n  const errorLog: ErrorLogData = {\r\n    message: error instanceof Error ? error.message : error,\r\n    path: \"manual-capture\",\r\n    method: \"NONE\",\r\n    timestamp: new Date().toISOString(),\r\n    statusCode: 500,\r\n    userId,\r\n    details,\r\n    stack: error instanceof Error ? error.stack : undefined,\r\n    requestId: generateRequestId(),\r\n    component: component || \"unknown\",\r\n  };\r\n\r\n  logError(errorLog);\r\n}\r\n\r\n/**\r\n * Get recent error logs (development only)\r\n */\r\nexport function getRecentErrors(limit: number = 20): ErrorLogData[] {\r\n  if (IS_PRODUCTION) {\r\n    return [];\r\n  }\r\n\r\n  return ERROR_LOGS.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Generate a unique request ID\r\n */\r\nfunction generateRequestId(): string {\r\n  return Date.now().toString(36) + Math.random().toString(36).substring(2, 12);\r\n}\r\n\r\n/**\r\n * Debugging endpoint that returns recent errors (development only)\r\n */\r\nexport function errorDebugHandler(c: Context) {\r\n  if (IS_PRODUCTION) {\r\n    return c.json(\r\n      {\r\n        success: false,\r\n        error: \"This endpoint is only available in development mode\",\r\n      },\r\n      403\r\n    );\r\n  }\r\n\r\n  const limit = Number(c.req.query(\"limit\") || \"20\");\r\n  return c.json({\r\n    success: true,\r\n    errors: getRecentErrors(limit),\r\n    count: ERROR_LOGS.length,\r\n  });\r\n}\r\n","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\api\\\\[[...route]]\\\\route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/[[...route]]/route\",\n        pathname: \"/api/[[...route]]\",\n        filename: \"route\",\n        bundlePath: \"app/api/[[...route]]/route\"\n    },\n    resolvedPagePath: \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\api\\\\[[...route]]\\\\route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","module.exports = require(\"diagnostics_channel\");","module.exports = require(\"node:http\");","const o=\"X-NEXT-INTL-LOCALE\",L=\"locale\";export{o as HEADER_LOCALE_NAME,L as LOCALE_SEGMENT_NAME};\n","import{useParams as e}from\"next/navigation\";import{useLocale as t}from\"use-intl/_useLocale\";import{LOCALE_SEGMENT_NAME as n}from\"../shared/constants.js\";let o=!1;function r(){const r=e();let a;try{a=t()}catch(e){if(\"string\"!=typeof(null==r?void 0:r[n]))throw e;o||(console.warn(\"Deprecation warning: `useLocale` has returned a default from `useParams().locale` since no `NextIntlClientProvider` ancestor was found for the calling component. This behavior will be removed in the next major version. Please ensure all Client Components that use `next-intl` are wrapped in a `NextIntlClientProvider`.\"),o=!0),a=r[n]}return a}export{r as default};\n","module.exports = require(\"node:zlib\");","// src/utils/color.ts\nfunction getColorEnabled() {\n  const { process, Deno } = globalThis;\n  const isNoColor = typeof Deno?.noColor === \"boolean\" ? Deno.noColor : process !== void 0 ? \"NO_COLOR\" in process?.env : false;\n  return !isNoColor;\n}\nasync function getColorEnabledAsync() {\n  const { navigator } = globalThis;\n  const cfWorkers = \"cloudflare:workers\";\n  const isNoColor = navigator !== void 0 && navigator.userAgent === \"Cloudflare-Workers\" ? await (async () => {\n    try {\n      return \"NO_COLOR\" in ((await import(cfWorkers)).env ?? {});\n    } catch {\n      return false;\n    }\n  })() : !getColorEnabled();\n  return !isNoColor;\n}\nexport {\n  getColorEnabled,\n  getColorEnabledAsync\n};\n","// src/middleware/logger/index.ts\nimport { getColorEnabledAsync } from \"../../utils/color.js\";\nvar humanize = (times) => {\n  const [delimiter, separator] = [\",\", \".\"];\n  const orderTimes = times.map((v) => v.replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, \"$1\" + delimiter));\n  return orderTimes.join(separator);\n};\nvar time = (start) => {\n  const delta = Date.now() - start;\n  return humanize([delta < 1e3 ? delta + \"ms\" : Math.round(delta / 1e3) + \"s\"]);\n};\nvar colorStatus = async (status) => {\n  const colorEnabled = await getColorEnabledAsync();\n  if (colorEnabled) {\n    switch (status / 100 | 0) {\n      case 5:\n        return `\\x1B[31m${status}\\x1B[0m`;\n      case 4:\n        return `\\x1B[33m${status}\\x1B[0m`;\n      case 3:\n        return `\\x1B[36m${status}\\x1B[0m`;\n      case 2:\n        return `\\x1B[32m${status}\\x1B[0m`;\n    }\n  }\n  return `${status}`;\n};\nasync function log(fn, prefix, method, path, status = 0, elapsed) {\n  const out = prefix === \"<--\" /* Incoming */ ? `${prefix} ${method} ${path}` : `${prefix} ${method} ${path} ${await colorStatus(status)} ${elapsed}`;\n  fn(out);\n}\nvar logger = (fn = console.log) => {\n  return async function logger2(c, next) {\n    const { method, url } = c.req;\n    const path = url.slice(url.indexOf(\"/\", 8));\n    await log(fn, \"<--\" /* Incoming */, method, path);\n    const start = Date.now();\n    await next();\n    await log(fn, \"-->\" /* Outgoing */, method, path, c.res.status, time(start));\n  };\n};\nexport {\n  logger\n};\n","/**\r\n * Redis Module - Centralized Redis functionality\r\n *\r\n * This module serves as the single source of truth for all Redis operations\r\n * in the application. It provides:\r\n *\r\n * 1. A singleton Redis client instance with connection management\r\n * 2. Cache middleware for Hono API routes\r\n * 3. Translation cache utilities\r\n * 4. Cache invalidation and statistics\r\n * 5. Testing utilities\r\n */\r\n\r\n// Add a mock Cache API for Hono's built-in cache middleware\r\n// This prevents the \"Cache Middleware is not enabled because caches is not defined\" error\r\nif (typeof globalThis.caches === \"undefined\") {\r\n  // Create a minimal mock of the Cache API that Hono expects\r\n  globalThis.caches = {\r\n    open: () => {\r\n      return Promise.resolve({\r\n        match: () => Promise.resolve(null),\r\n        put: () => Promise.resolve(),\r\n        delete: () => Promise.resolve(false),\r\n      });\r\n    },\r\n    has: () => Promise.resolve(false),\r\n    delete: () => Promise.resolve(false),\r\n  } as any;\r\n  console.log(\"Added Cache API mock for Hono middleware\");\r\n}\r\n\r\nimport { Redis } from \"@upstash/redis\";\r\nimport { Context, MiddlewareHandler, Next } from \"hono\";\r\nimport { LRUCache } from \"lru-cache\";\r\n\r\n// Environment variables for Upstash Redis\r\nconst UPSTASH_REDIS_REST_URL = process.env.UPSTASH_REDIS_REST_URL;\r\nconst UPSTASH_REDIS_REST_TOKEN = process.env.UPSTASH_REDIS_REST_TOKEN;\r\n\r\n// Constants for cache stats\r\nconst STATS_KEYS = {\r\n  HITS: \"cache:stats:hits\",\r\n  MISSES: \"cache:stats:misses\",\r\n  KEYS: \"cache:stats:keys\",\r\n};\r\n\r\n// Interface for cache options\r\ninterface CacheOptions {\r\n  ttl?: number; // Time to live in seconds (default: 300 seconds)\r\n  key?: (c: Context<any>) => string; // Custom key generator\r\n  ignoreQuery?: boolean; // Whether to ignore query parameters in the cache key\r\n  varyByAuth?: boolean; // Whether to create different cache entries based on authentication status\r\n  caches?: string[]; // Routes or patterns to cache, if not provided all routes will be cached\r\n}\r\n\r\n// Singleton pattern for Redis client\r\nlet redisClient: Redis | null = null;\r\nlet redisInitializationAttempted = false;\r\n\r\n/**\r\n * Create a new Redis client\r\n */\r\nfunction createRedisClient(): Redis | null {\r\n  console.log(\"[Redis Client] Attempting to use URL:\", UPSTASH_REDIS_REST_URL);\r\n\r\n  if (!UPSTASH_REDIS_REST_URL || !UPSTASH_REDIS_REST_TOKEN) {\r\n    console.warn(\r\n      \"[Redis Client] Missing Redis URL or Token in environment variables. Redis client will not be initialized.\"\r\n    );\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    return new Redis({\r\n      url: UPSTASH_REDIS_REST_URL,\r\n      token: UPSTASH_REDIS_REST_TOKEN,\r\n      retry: {\r\n        retries: 3,\r\n        backoff: (retryCount) => Math.min(retryCount * 50, 1000),\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\r\n      \"[Redis Client] Error during Redis client instantiation:\",\r\n      error\r\n    );\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get Redis client (singleton pattern)\r\n */\r\nexport function getRedisClient(): Redis | null {\r\n  if (!redisInitializationAttempted) {\r\n    redisClient = createRedisClient();\r\n    if (redisClient) {\r\n      console.log(\"Upstash Redis client initialized successfully.\");\r\n    } else {\r\n      console.warn(\r\n        \"Upstash Redis client could not be initialized. Features requiring Redis may not work.\"\r\n      );\r\n    }\r\n    redisInitializationAttempted = true;\r\n  }\r\n  return redisClient;\r\n}\r\n\r\n/**\r\n * Sets a custom Redis client (for testing)\r\n */\r\nexport function setRedisClient(client: Redis): void {\r\n  redisClient = client;\r\n}\r\n\r\n/**\r\n * Resets the Redis client (for testing)\r\n */\r\nexport function resetRedisClient(): void {\r\n  if (redisClient && typeof (redisClient as any).quit === \"function\") {\r\n    try {\r\n      (redisClient as any).quit();\r\n    } catch (e) {\r\n      console.error(\"Error quitting existing redis client during reset:\", e);\r\n    }\r\n  }\r\n  redisClient = null;\r\n  redisInitializationAttempted = false;\r\n}\r\n\r\n// Export Redis client for direct access\r\nexport const redis: Redis | null = getRedisClient();\r\n\r\n/**\r\n * Health check function for Redis\r\n */\r\nexport async function isRedisHealthy(): Promise<boolean> {\r\n  if (!redis) {\r\n    console.warn(\r\n      \"[isRedisHealthy] Redis client not initialized. Health check returning false.\"\r\n    );\r\n    return false;\r\n  }\r\n  try {\r\n    const result = await redis.ping();\r\n    return result === \"PONG\";\r\n  } catch (error) {\r\n    console.error(\"Redis health check failed:\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Translation cache helper functions\r\n */\r\nexport const translationCache = {\r\n  async get(locale: string): Promise<Record<string, any> | null> {\r\n    if (!redis) {\r\n      console.warn(\"[translationCache.get] Redis client not available.\");\r\n      return null;\r\n    }\r\n    try {\r\n      const cached = await redis.get(`i18n:${locale}`);\r\n      return cached ? JSON.parse(cached as string) : null;\r\n    } catch (error) {\r\n      console.error(\"Translation cache get error:\", error);\r\n      return null;\r\n    }\r\n  },\r\n\r\n  async set(\r\n    locale: string,\r\n    translations: Record<string, any>,\r\n    ttl: number = 3600\r\n  ): Promise<void> {\r\n    if (!redis) {\r\n      console.warn(\"[translationCache.set] Redis client not available.\");\r\n      return;\r\n    }\r\n    try {\r\n      await redis.setex(`i18n:${locale}`, ttl, JSON.stringify(translations));\r\n    } catch (error) {\r\n      console.error(\"Translation cache set error:\", error);\r\n    }\r\n  },\r\n\r\n  async invalidate(locale: string): Promise<void> {\r\n    if (!redis) {\r\n      console.warn(\"[translationCache.invalidate] Redis client not available.\");\r\n      return;\r\n    }\r\n    try {\r\n      await redis.del(`i18n:${locale}`);\r\n    } catch (error) {\r\n      console.error(\"Translation cache invalidate error:\", error);\r\n    }\r\n  },\r\n\r\n  async invalidateAll(): Promise<void> {\r\n    if (!redis) {\r\n      console.warn(\r\n        \"[translationCache.invalidateAll] Redis client not available.\"\r\n      );\r\n      return;\r\n    }\r\n    try {\r\n      const keys = await redis.keys(\"i18n:*\");\r\n      if (keys.length > 0) {\r\n        await redis.del(...keys);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Translation cache invalidate all error:\", error);\r\n    }\r\n  },\r\n};\r\n\r\n/**\r\n * Default cache key generator based on URL, path, and user ID\r\n */\r\nfunction defaultKeyGenerator(c: Context<any>): string {\r\n  const url = new URL(c.req.url);\r\n\r\n  // Get user info for personalized caching\r\n  const user = c.get(\"user\");\r\n  const userId = user?.id || \"anonymous\";\r\n\r\n  // Construct path with query parameters\r\n  const pathWithQuery = url.pathname + url.search;\r\n\r\n  return `cache:${userId}:${pathWithQuery}`;\r\n}\r\n\r\n/**\r\n * Middleware for Redis-backed caching with user-specific keys\r\n *\r\n * @deprecated Use redisApiCacheMiddleware instead to avoid conflicts with Hono's built-in cache\r\n * @param options Cache options\r\n * @returns Hono middleware\r\n */\r\nexport function redisCacheMiddleware(\r\n  options: CacheOptions = {}\r\n): MiddlewareHandler<any> {\r\n  // Set default values for options to avoid Hono warnings\r\n  options.caches = options.caches || []; // Always provide a caches array to avoid Hono built-in middleware warnings\r\n\r\n  return async (c: Context<any>, next: Next) => {\r\n    if (!redis) {\r\n      console.warn(\r\n        \"[redisCacheMiddleware] Redis client not available. Skipping cache.\"\r\n      );\r\n      return next();\r\n    }\r\n    // Only cache GET requests\r\n    if (c.req.method !== \"GET\") {\r\n      return next();\r\n    }\r\n\r\n    // Log incoming Cache-Control header\r\n    const requestCacheControl = c.req.header(\"Cache-Control\");\r\n    console.log(\r\n      `[redisCacheMiddleware] Incoming Cache-Control: ${requestCacheControl}`\r\n    );\r\n\r\n    // If caches is not defined, continue with caching\r\n    // This removes the error message and allows the middleware to be used without the caches parameter\r\n    if (options.caches === undefined) {\r\n      // If caches is undefined, we'll cache everything by default\r\n      // No need to log a warning as this is a valid configuration\r\n    }\r\n\r\n    // Generate cache key\r\n    const generateKey = options.key || defaultKeyGenerator;\r\n    const cacheKey = generateKey(c);\r\n\r\n    // Check if cached response exists\r\n    try {\r\n      const cachedData = await redis.get(cacheKey);\r\n\r\n      if (cachedData) {\r\n        // Track cache hit\r\n        await redis.incr(STATS_KEYS.HITS);\r\n\r\n        // Add cache headers\r\n        c.header(\"X-Cache\", \"HIT\");\r\n        c.header(\"X-Cache-Key\", cacheKey);\r\n\r\n        // Use a default TTL of 300 seconds if none is provided\r\n        const maxAge = options.ttl ? options.ttl.toString() : \"300\";\r\n        c.header(\"Cache-Control\", `public, max-age=${maxAge}`);\r\n\r\n        return c.json(JSON.parse(cachedData as string));\r\n      }\r\n\r\n      // Track cache miss\r\n      await redis.incr(STATS_KEYS.MISSES);\r\n    } catch (error) {\r\n      console.error(\"Redis cache read error:\", error);\r\n      // Continue without caching on error\r\n    }\r\n\r\n    // Set header to indicate cache miss\r\n    c.header(\"X-Cache\", \"MISS\");\r\n    c.header(\"X-Cache-Key\", cacheKey);\r\n\r\n    // Continue to the next middleware/handler\r\n    await next();\r\n\r\n    // Store the response in cache only if status is success\r\n    if (c.res && c.res.status >= 200 && c.res.status < 300) {\r\n      try {\r\n        const responseData = await c.res.clone().json();\r\n\r\n        // Store in Redis with TTL\r\n        const ttl = options.ttl || 300; // Default 5 minutes\r\n        await redis.set(cacheKey, JSON.stringify(responseData), { ex: ttl });\r\n\r\n        // Track cache keys\r\n        await redis.sadd(STATS_KEYS.KEYS, cacheKey);\r\n\r\n        // Add cache-related headers to the response\r\n        c.header(\"Cache-Control\", `public, max-age=${ttl}`);\r\n      } catch (error) {\r\n        console.error(\"Redis cache write error:\", error);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Renamed middleware for Redis-backed caching to avoid conflicts with Hono's built-in cache\r\n * Use this version instead of redisCacheMiddleware to prevent \"Cache Middleware is not enabled\" errors\r\n *\r\n * @param options Cache options\r\n * @returns Hono middleware\r\n */\r\nexport function redisApiCacheMiddleware(\r\n  options: CacheOptions = {}\r\n): MiddlewareHandler<any> {\r\n  return async (c: Context<any>, next: Next) => {\r\n    if (!redis) {\r\n      console.warn(\r\n        \"[redisApiCacheMiddleware] Redis client not available. Skipping cache.\"\r\n      );\r\n      return next();\r\n    }\r\n    // Only cache GET requests\r\n    if (c.req.method !== \"GET\") {\r\n      return next();\r\n    }\r\n\r\n    // Log incoming Cache-Control header\r\n    const requestCacheControl = c.req.header(\"Cache-Control\");\r\n    console.log(\r\n      `[redisApiCacheMiddleware] Incoming Cache-Control: ${requestCacheControl}`\r\n    );\r\n\r\n    // Generate cache key\r\n    const generateKey = options.key || defaultKeyGenerator;\r\n    const cacheKey = generateKey(c);\r\n\r\n    // Check if cached response exists\r\n    try {\r\n      const cachedData = await redis.get(cacheKey);\r\n\r\n      if (cachedData) {\r\n        // Track cache hit\r\n        await redis.incr(STATS_KEYS.HITS);\r\n\r\n        // Add cache headers\r\n        c.header(\"X-Cache\", \"HIT\");\r\n        c.header(\"X-Cache-Key\", cacheKey);\r\n\r\n        // Use a default TTL of 300 seconds if none is provided\r\n        const maxAge = options.ttl ? options.ttl.toString() : \"300\";\r\n        c.header(\"Cache-Control\", `public, max-age=${maxAge}`);\r\n\r\n        return c.json(JSON.parse(cachedData as string));\r\n      }\r\n\r\n      // Track cache miss\r\n      await redis.incr(STATS_KEYS.MISSES);\r\n    } catch (error) {\r\n      console.error(\"Redis cache read error:\", error);\r\n      // Continue without caching on error\r\n    }\r\n\r\n    // Set header to indicate cache miss\r\n    c.header(\"X-Cache\", \"MISS\");\r\n    c.header(\"X-Cache-Key\", cacheKey);\r\n\r\n    // Continue to the next middleware/handler\r\n    await next();\r\n\r\n    // Store the response in cache only if status is success\r\n    if (c.res && c.res.status >= 200 && c.res.status < 300) {\r\n      try {\r\n        const responseData = await c.res.clone().json();\r\n\r\n        // Store in Redis with TTL\r\n        const ttl = options.ttl || 300; // Default 5 minutes\r\n        await redis.set(cacheKey, JSON.stringify(responseData), { ex: ttl });\r\n\r\n        // Track cache keys\r\n        await redis.sadd(STATS_KEYS.KEYS, cacheKey);\r\n\r\n        // Add cache-related headers to the response\r\n        c.header(\"Cache-Control\", `public, max-age=${ttl}`);\r\n      } catch (error) {\r\n        console.error(\"Redis cache write error:\", error);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Invalidate cache entries matching a pattern\r\n * @param pattern String pattern to match against cache keys\r\n */\r\nexport async function invalidateRedisCache(pattern: string): Promise<number> {\r\n  if (!redis) {\r\n    console.warn(\"[invalidateRedisCache] Redis client not available.\");\r\n    return 0;\r\n  }\r\n  try {\r\n    // Find all keys matching the pattern\r\n    let cursor = 0;\r\n    const matchingKeys: string[] = [];\r\n\r\n    do {\r\n      // The scan function returns [cursor, keys] where cursor might be a string depending on the implementation\r\n      // Cast it to unknown first then to the type we need\r\n      const scanResult = await redis.scan(cursor, {\r\n        match: pattern,\r\n        count: 100,\r\n      });\r\n      const nextCursor = Number(scanResult[0]);\r\n      const keys = scanResult[1] as string[];\r\n\r\n      cursor = nextCursor;\r\n      matchingKeys.push(...keys);\r\n    } while (cursor !== 0);\r\n\r\n    if (matchingKeys.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    // Delete all matching keys\r\n    await Promise.all(matchingKeys.map((key) => redis.del(key)));\r\n\r\n    console.log(\r\n      `Invalidated ${matchingKeys.length} cache entries matching \"${pattern}\"`\r\n    );\r\n    return matchingKeys.length;\r\n  } catch (error) {\r\n    console.error(\"Error invalidating cache:\", error);\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all cache entries\r\n */\r\nexport async function clearRedisCache(): Promise<number> {\r\n  if (!redis) {\r\n    console.warn(\"[clearRedisCache] Redis client not available.\");\r\n    return 0;\r\n  }\r\n  try {\r\n    // Get all cache keys\r\n    const keys = (await redis.smembers(STATS_KEYS.KEYS)) as string[];\r\n\r\n    if (keys.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    // Delete all keys and reset stats\r\n    await Promise.all([\r\n      ...keys.map((key) => redis.del(key)),\r\n      redis.del(STATS_KEYS.HITS),\r\n      redis.del(STATS_KEYS.MISSES),\r\n      redis.del(STATS_KEYS.KEYS),\r\n    ]);\r\n\r\n    console.log(`Cleared ${keys.length} cache entries`);\r\n    return keys.length;\r\n  } catch (error) {\r\n    console.error(\"Error clearing cache:\", error);\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nexport async function getRedisStats(): Promise<{\r\n  hits: number;\r\n  misses: number;\r\n  keys: number;\r\n  hitRatio: number;\r\n}> {\r\n  if (!redis) {\r\n    console.warn(\"[getRedisStats] Redis client not available.\");\r\n    return {\r\n      hits: 0,\r\n      misses: 0,\r\n      keys: 0,\r\n      hitRatio: 0,\r\n    };\r\n  }\r\n  try {\r\n    // Get stats from Redis\r\n    const [hits, misses, keys] = (await Promise.all([\r\n      redis.get(STATS_KEYS.HITS),\r\n      redis.get(STATS_KEYS.MISSES),\r\n      redis.scard(STATS_KEYS.KEYS),\r\n    ])) as [string | null, string | null, number];\r\n\r\n    // Parse stats\r\n    const hitCount = hits ? parseInt(hits) : 0;\r\n    const missCount = misses ? parseInt(misses) : 0;\r\n    const total = hitCount + missCount;\r\n\r\n    return {\r\n      hits: hitCount,\r\n      misses: missCount,\r\n      keys: keys || 0,\r\n      hitRatio: total > 0 ? hitCount / total : 0,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error getting cache stats:\", error);\r\n    return {\r\n      hits: 0,\r\n      misses: 0,\r\n      keys: 0,\r\n      hitRatio: 0,\r\n    };\r\n  }\r\n}\r\n\r\n// --- Start of CacheManager consolidation ---\r\n\r\ninterface CacheManagerOptions {\r\n  ttl?: number; // Default TTL for LRU cache in milliseconds\r\n  maxSize?: number; // Max number of items in LRU cache\r\n  redisKeyPrefix?: string; // Prefix for all keys stored in Redis by this manager\r\n}\r\n\r\nclass CacheManager {\r\n  private redisClientInternal: Redis | null = null;\r\n  private lruCache: LRUCache<string, string>;\r\n  private redisKeyPrefix: string;\r\n\r\n  constructor(options: CacheManagerOptions = {}) {\r\n    this.redisClientInternal = getRedisClient();\r\n    if (!this.redisClientInternal) {\r\n      console.warn(\r\n        \"[CacheManager] Redis client is not available. CacheManager will operate in LRU-only mode.\"\r\n      );\r\n    }\r\n\r\n    this.redisKeyPrefix = options.redisKeyPrefix || \"cacheManager:\";\r\n\r\n    this.lruCache = new LRUCache({\r\n      max: options.maxSize || 500, // Use provided maxSize or default\r\n      ttl: options.ttl || 3600 * 1000, // Use provided ttl (in ms) or default 1 hour\r\n    });\r\n  }\r\n\r\n  private getPrefixedKey(key: string): string {\r\n    return `${this.redisKeyPrefix}${key}`;\r\n  }\r\n\r\n  async get(key: string): Promise<string | null> {\r\n    if (this.redisClientInternal) {\r\n      const prefixedKey = this.getPrefixedKey(key);\r\n      try {\r\n        const value = await this.redisClientInternal.get<string>(prefixedKey);\r\n        if (value !== null && value !== undefined) {\r\n          return value;\r\n        }\r\n      } catch (error) {\r\n        console.error(\r\n          `CacheManager: Redis get error for key ${prefixedKey}:`,\r\n          error\r\n        );\r\n      }\r\n    }\r\n    return this.lruCache.get(key) || null;\r\n  }\r\n\r\n  async set(key: string, value: string, ttlInSeconds?: number): Promise<void> {\r\n    if (this.redisClientInternal) {\r\n      const prefixedKey = this.getPrefixedKey(key);\r\n      try {\r\n        await this.redisClientInternal.set(prefixedKey, value, {\r\n          ex: ttlInSeconds || 3600, // Default 1 hour for Redis\r\n        });\r\n      } catch (error) {\r\n        console.error(\r\n          `CacheManager: Redis set error for key ${prefixedKey}:`,\r\n          error\r\n        );\r\n      }\r\n    }\r\n    this.lruCache.set(key, value, {\r\n      ttl: ttlInSeconds ? ttlInSeconds * 1000 : undefined,\r\n    });\r\n  }\r\n\r\n  async delete(key: string): Promise<void> {\r\n    if (this.redisClientInternal) {\r\n      const prefixedKey = this.getPrefixedKey(key);\r\n      try {\r\n        await this.redisClientInternal.del(prefixedKey);\r\n      } catch (error) {\r\n        console.error(\r\n          `CacheManager: Redis delete error for key ${prefixedKey}:`,\r\n          error\r\n        );\r\n      }\r\n    }\r\n    this.lruCache.delete(key);\r\n  }\r\n\r\n  async clear(): Promise<void> {\r\n    // Clear Redis keys matching the prefix\r\n    if (this.redisClientInternal) {\r\n      console.log(\r\n        `CacheManager: Attempting to clear Redis keys with prefix \"${this.redisKeyPrefix}\"...`\r\n      );\r\n      let cursor = 0;\r\n      let keysDeletedCount = 0;\r\n      try {\r\n        do {\r\n          const scanResult = await this.redisClientInternal.scan(cursor, {\r\n            match: `${this.redisKeyPrefix}*`,\r\n            count: 100, // Process in batches\r\n          });\r\n          const nextCursor = Number(scanResult[0]);\r\n          const keys = scanResult[1] as string[];\r\n\r\n          if (keys.length > 0) {\r\n            const deleted = await this.redisClientInternal.del(...keys);\r\n            keysDeletedCount += deleted;\r\n          }\r\n          cursor = nextCursor;\r\n        } while (cursor !== 0);\r\n        console.log(\r\n          `CacheManager: Cleared ${keysDeletedCount} keys from Redis with prefix \"${this.redisKeyPrefix}\".`\r\n        );\r\n      } catch (error) {\r\n        console.error(\r\n          `CacheManager: Error clearing Redis keys with prefix \"${this.redisKeyPrefix}\":`,\r\n          error\r\n        );\r\n      }\r\n    }\r\n\r\n    // Clear LRU cache\r\n    this.lruCache.clear();\r\n    console.log(\"CacheManager: LRU cache cleared.\");\r\n  }\r\n}\r\n\r\n// Export singleton instance of CacheManager\r\n// You can configure the global 'cache' instance here if needed, e.g.:\r\n// export const cache = new CacheManager({\r\n//   redisKeyPrefix: process.env.CACHE_MANAGER_REDIS_PREFIX || 'globalCache:',\r\n//   ttl: process.env.CACHE_MANAGER_LRU_TTL_MS ? parseInt(process.env.CACHE_MANAGER_LRU_TTL_MS) : 3600 * 1000,\r\n//   maxSize: process.env.CACHE_MANAGER_LRU_MAX_SIZE ? parseInt(process.env.CACHE_MANAGER_LRU_MAX_SIZE) : 500,\r\n// });\r\n// For now, using defaults:\r\nexport const cache = new CacheManager();\r\n\r\n// --- End of CacheManager consolidation ---\r\n","module.exports = require(\"node:tls\");","module.exports = require(\"node:https\");","module.exports = require(\"next/dist/compiled/next-server/app-route.runtime.prod.js\");","module.exports = require(\"node:os\");","/**\r\n * Document domain entity\r\n * \r\n * This entity represents a document in the domain model.\r\n */\r\n\r\n/**\r\n * Document entity representing files and attachments within the system\r\n */\r\n\r\nexport enum DocumentType {\r\n  PASSPORT = 'passport',\r\n  VISA = 'visa',\r\n  BIRTH_CERTIFICATE = 'birth_certificate',\r\n  MARRIAGE_CERTIFICATE = 'marriage_certificate',\r\n  ACADEMIC_RECORD = 'academic_record',\r\n  EMPLOYMENT_RECORD = 'employment_record',\r\n  FINANCIAL_RECORD = 'financial_record',\r\n  MEDICAL_RECORD = 'medical_record',\r\n  LEGAL_DOCUMENT = 'legal_document',\r\n  TRAVEL_DOCUMENT = 'travel_document',\r\n  IDENTIFICATION = 'identification',\r\n  SUPPORTING_DOCUMENT = 'supporting_document',\r\n  OTHER = 'other'\r\n}\r\n\r\nexport enum DocumentStatus {\r\n  DRAFT = 'draft',\r\n  PENDING_REVIEW = 'pending_review',\r\n  APPROVED = 'approved',\r\n  REJECTED = 'rejected',\r\n  EXPIRED = 'expired',\r\n  REVOKED = 'revoked'\r\n}\r\n\r\nexport interface DocumentVersion {\r\n  id: string;\r\n  documentId: string;\r\n  storageKey: string;\r\n  fileName: string;\r\n  fileSize: number;\r\n  mimeType: string;\r\n  createdBy: string;\r\n  createdAt: Date;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface DocumentAccess {\r\n  id: string;\r\n  documentId: string;\r\n  userId: string;\r\n  permission: 'view' | 'edit' | 'delete' | 'admin';\r\n  grantedBy: string;\r\n  grantedAt: Date;\r\n  expiresAt?: Date;\r\n}\r\n\r\n/**\r\n * Document entity\r\n */\r\nexport class Document {\r\n  id: string;\r\n  name: string;\r\n  description: string | null;\r\n  type: DocumentType;\r\n  status: DocumentStatus;\r\n  ownerId: string;\r\n  versions: DocumentVersion[];\r\n  access: DocumentAccess[];\r\n  caseIds: string[];\r\n  expiryDate: Date | null;\r\n  issuedBy: string | null;\r\n  issuedDate: Date | null;\r\n  documentNumber: string | null;\r\n  tags: string[];\r\n  metadata: Record<string, any>;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n\r\n  constructor(data: {\r\n    id: string;\r\n    name: string;\r\n    description: string | null;\r\n    type: DocumentType;\r\n    status: DocumentStatus;\r\n    ownerId: string;\r\n    versions?: DocumentVersion[];\r\n    access?: DocumentAccess[];\r\n    caseIds?: string[];\r\n    expiryDate?: Date | null;\r\n    issuedBy?: string | null;\r\n    issuedDate?: Date | null;\r\n    documentNumber?: string | null;\r\n    tags?: string[];\r\n    metadata?: Record<string, any>;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n  }) {\r\n    this.id = data.id;\r\n    this.name = data.name;\r\n    this.description = data.description;\r\n    this.type = data.type;\r\n    this.status = data.status;\r\n    this.ownerId = data.ownerId;\r\n    this.versions = data.versions || [];\r\n    this.access = data.access || [];\r\n    this.caseIds = data.caseIds || [];\r\n    this.expiryDate = data.expiryDate || null;\r\n    this.issuedBy = data.issuedBy || null;\r\n    this.issuedDate = data.issuedDate || null;\r\n    this.documentNumber = data.documentNumber || null;\r\n    this.tags = data.tags || [];\r\n    this.metadata = data.metadata || {};\r\n    this.createdAt = data.createdAt || new Date();\r\n    this.updatedAt = data.updatedAt || new Date();\r\n  }\r\n\r\n  /**\r\n   * Check if a user has specific access to the document\r\n   */\r\n  hasAccess(userId: string, permission: 'view' | 'edit' | 'delete' | 'admin'): boolean {\r\n    // Owner always has full access\r\n    if (this.ownerId === userId) {\r\n      return true;\r\n    }\r\n\r\n    // Check access records\r\n    const userAccess = this.access.find(access => \r\n      access.userId === userId && \r\n      (!access.expiresAt || access.expiresAt > new Date())\r\n    );\r\n\r\n    if (!userAccess) {\r\n      return false;\r\n    }\r\n\r\n    // Admin permission grants all access\r\n    if (userAccess.permission === 'admin') {\r\n      return true;\r\n    }\r\n\r\n    // Match specific permission\r\n    if (permission === 'view') {\r\n      // Any permission level grants view access\r\n      return true;\r\n    } else if (permission === 'edit') {\r\n      // Edit or admin permission grants edit access\r\n      return ['edit', 'admin'].includes(userAccess.permission);\r\n    } else if (permission === 'delete') {\r\n      // Only delete or admin permission grants delete access\r\n      return ['delete', 'admin'].includes(userAccess.permission);\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Add a new version to the document\r\n   */\r\n  addVersion(version: Omit<DocumentVersion, 'documentId'>): Document {\r\n    const newVersion: DocumentVersion = {\r\n      ...version,\r\n      documentId: this.id\r\n    };\r\n\r\n    this.versions.push(newVersion);\r\n    this.updatedAt = new Date();\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Get the latest version of the document\r\n   */\r\n  getLatestVersion(): DocumentVersion | null {\r\n    if (this.versions.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    // Sort versions by creation date (newest first)\r\n    const sortedVersions = [...this.versions].sort((a, b) => \r\n      b.createdAt.getTime() - a.createdAt.getTime()\r\n    );\r\n\r\n    return sortedVersions[0];\r\n  }\r\n\r\n  /**\r\n   * Grant access to a user\r\n   */\r\n  grantAccess(access: Omit<DocumentAccess, 'documentId'>): Document {\r\n    // Check if access already exists\r\n    const existingAccessIndex = this.access.findIndex(a => a.userId === access.userId);\r\n    \r\n    const newAccess: DocumentAccess = {\r\n      ...access,\r\n      documentId: this.id\r\n    };\r\n\r\n    if (existingAccessIndex >= 0) {\r\n      // Update existing access\r\n      this.access[existingAccessIndex] = newAccess;\r\n    } else {\r\n      // Add new access\r\n      this.access.push(newAccess);\r\n    }\r\n\r\n    this.updatedAt = new Date();\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Revoke access from a user\r\n   */\r\n  revokeAccess(userId: string): Document {\r\n    this.access = this.access.filter(access => access.userId !== userId);\r\n    this.updatedAt = new Date();\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Associate document with a case\r\n   */\r\n  addToCase(caseId: string): Document {\r\n    if (!this.caseIds.includes(caseId)) {\r\n      this.caseIds.push(caseId);\r\n      this.updatedAt = new Date();\r\n    }\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove document from a case\r\n   */\r\n  removeFromCase(caseId: string): Document {\r\n    this.caseIds = this.caseIds.filter(id => id !== caseId);\r\n    this.updatedAt = new Date();\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Update document metadata\r\n   */\r\n  updateMetadata(metadata: Record<string, any>): Document {\r\n    this.metadata = {\r\n      ...this.metadata,\r\n      ...metadata\r\n    };\r\n    this.updatedAt = new Date();\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Change document status\r\n   */\r\n  changeStatus(status: DocumentStatus, userId: string): Document {\r\n    // Could add validation here if needed\r\n    this.status = status;\r\n    this.updatedAt = new Date();\r\n    \r\n    // Add audit info to metadata\r\n    this.metadata.statusHistory = this.metadata.statusHistory || [];\r\n    this.metadata.statusHistory.push({\r\n      from: this.status,\r\n      to: status,\r\n      changedBy: userId,\r\n      changedAt: new Date()\r\n    });\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Update document basic information\r\n   */\r\n  update(data: {\r\n    name?: string;\r\n    description?: string | null;\r\n    type?: DocumentType;\r\n    expiryDate?: Date | null;\r\n    issuedBy?: string | null;\r\n    issuedDate?: Date | null;\r\n    documentNumber?: string | null;\r\n    tags?: string[];\r\n  }): Document {\r\n    if (data.name !== undefined) this.name = data.name;\r\n    if (data.description !== undefined) this.description = data.description;\r\n    if (data.type !== undefined) this.type = data.type;\r\n    if (data.expiryDate !== undefined) this.expiryDate = data.expiryDate;\r\n    if (data.issuedBy !== undefined) this.issuedBy = data.issuedBy;\r\n    if (data.issuedDate !== undefined) this.issuedDate = data.issuedDate;\r\n    if (data.documentNumber !== undefined) this.documentNumber = data.documentNumber;\r\n    if (data.tags !== undefined) this.tags = data.tags;\r\n    \r\n    this.updatedAt = new Date();\r\n    \r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Convert the document to a plain object\r\n   */\r\n  toObject(): Record<string, any> {\r\n    return {\r\n      id: this.id,\r\n      name: this.name,\r\n      description: this.description,\r\n      type: this.type,\r\n      status: this.status,\r\n      ownerId: this.ownerId,\r\n      versions: this.versions,\r\n      access: this.access,\r\n      caseIds: this.caseIds,\r\n      expiryDate: this.expiryDate,\r\n      issuedBy: this.issuedBy,\r\n      issuedDate: this.issuedDate,\r\n      documentNumber: this.documentNumber,\r\n      tags: this.tags,\r\n      metadata: this.metadata,\r\n      createdAt: this.createdAt,\r\n      updatedAt: this.updatedAt,\r\n      latestVersion: this.getLatestVersion()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a Document instance from database record\r\n   */\r\n  static fromDatabase(data: any): Document {\r\n    // Parse dates from ISO strings if they're strings\r\n    const parseDate = (dateStr: string | Date | null | undefined) => {\r\n      if (!dateStr) return null;\r\n      return dateStr instanceof Date ? dateStr : new Date(dateStr);\r\n    };\r\n\r\n    // Parse versions\r\n    const versions = Array.isArray(data.versions) \r\n      ? data.versions.map((v: any) => ({\r\n          ...v,\r\n          createdAt: parseDate(v.createdAt) || new Date()\r\n        }))\r\n      : [];\r\n\r\n    // Parse access records\r\n    const access = Array.isArray(data.access)\r\n      ? data.access.map((a: any) => ({\r\n          ...a,\r\n          grantedAt: parseDate(a.grantedAt) || new Date(),\r\n          expiresAt: parseDate(a.expiresAt)\r\n        }))\r\n      : [];\r\n\r\n    return new Document({\r\n      id: data.id,\r\n      name: data.name,\r\n      description: data.description,\r\n      type: data.type as DocumentType,\r\n      status: data.status as DocumentStatus,\r\n      ownerId: data.owner_id || data.ownerId,\r\n      versions,\r\n      access,\r\n      caseIds: data.case_ids || data.caseIds || [],\r\n      expiryDate: parseDate(data.expiry_date || data.expiryDate),\r\n      issuedBy: data.issued_by || data.issuedBy,\r\n      issuedDate: parseDate(data.issued_date || data.issuedDate),\r\n      documentNumber: data.document_number || data.documentNumber,\r\n      tags: data.tags || [],\r\n      metadata: data.metadata || {},\r\n      createdAt: parseDate(data.created_at || data.createdAt) || new Date(),\r\n      updatedAt: parseDate(data.updated_at || data.updatedAt) || new Date()\r\n    });\r\n  }\r\n} ","import { Document } from \"@/core/documents/entities/document\";\r\nimport {\r\n  Case,\r\n  CaseStatus,\r\n  CaseType,\r\n  TimelineEvent,\r\n} from \"@/core/immigration/entities/case\";\r\nimport { CaseService } from \"@/core/immigration/services/case-service\";\r\nimport {\r\n  caseRepository,\r\n  documentRepository,\r\n} from \"@/_infrastructure/repositories\";\r\n\r\n/**\r\n * Case Application Service\r\n *\r\n * Orchestrates domain and infrastructure layers for case operations.\r\n * This service acts as a facade for the application layer.\r\n */\r\nexport class CaseApplicationService {\r\n  private caseService: CaseService;\r\n\r\n  constructor() {\r\n    this.caseService = new CaseService();\r\n  }\r\n\r\n  /**\r\n   * Get a case by ID\r\n   */\r\n  async getCaseById(caseId: string, userId?: string): Promise<Case | null> {\r\n    // If userId is provided, check access\r\n    if (userId) {\r\n      const hasAccess = await caseRepository.userHasAccess(caseId, userId);\r\n      if (!hasAccess) {\r\n        throw new Error(\"Access denied\");\r\n      }\r\n    }\r\n\r\n    const caseData = await caseRepository.getById(caseId);\r\n    if (!caseData) {\r\n      return null;\r\n    }\r\n\r\n    return caseRepository.toDomainEntity(caseData);\r\n  }\r\n\r\n  /**\r\n   * Get cases for a user\r\n   */\r\n  async getCasesByUser(\r\n    userId: string,\r\n    options?: {\r\n      includeAssigned?: boolean;\r\n      status?: string[];\r\n      limit?: number;\r\n      offset?: number;\r\n    }\r\n  ): Promise<Case[]> {\r\n    const casesData = await caseRepository.getByUserId(userId, options);\r\n\r\n    return casesData.map((caseData) => caseRepository.toDomainEntity(caseData));\r\n  }\r\n\r\n  /**\r\n   * Create a new case\r\n   */\r\n  async createCase(data: {\r\n    title: string;\r\n    description?: string;\r\n    caseType: CaseType;\r\n    clientId: string;\r\n    createdBy: string;\r\n    priority?: \"low\" | \"medium\" | \"high\" | \"urgent\";\r\n    dueDate?: Date | null;\r\n    tags?: string[];\r\n    metadata?: Record<string, any>;\r\n  }): Promise<Case> {\r\n    // Generate a unique case number\r\n    const caseNumber = this.caseService.generateCaseNumber(data.caseType);\r\n\r\n    // Create initial timeline event\r\n    const creationEvent: TimelineEvent = {\r\n      id: crypto.randomUUID(),\r\n      eventType: \"case_created\",\r\n      title: \"Case created\",\r\n      description: `Case was created by ${data.createdBy}`,\r\n      createdBy: data.createdBy,\r\n      timestamp: new Date(),\r\n      metadata: {\r\n        caseType: data.caseType,\r\n      },\r\n    };\r\n\r\n    // Initial assignments - make creator the owner\r\n    const initialAssignment = {\r\n      userId: data.createdBy,\r\n      role: \"owner\",\r\n      assignedAt: new Date(),\r\n      assignedBy: \"system\",\r\n    };\r\n\r\n    // Create the case record\r\n    const caseRecord = await caseRepository.create({\r\n      case_number: caseNumber,\r\n      title: data.title,\r\n      description: data.description || null,\r\n      status: CaseStatus.DRAFT,\r\n      case_type: data.caseType,\r\n      client_id: data.clientId,\r\n      timeline: [creationEvent],\r\n      assignments: [initialAssignment],\r\n      priority: data.priority || \"medium\",\r\n      due_date: data.dueDate ? new Date(data.dueDate).toISOString() : null,\r\n      tags: data.tags || [],\r\n      metadata: data.metadata || {},\r\n    });\r\n\r\n    // Return as domain entity\r\n    return caseRepository.toDomainEntity(caseRecord);\r\n  }\r\n\r\n  /**\r\n   * Update case details\r\n   */\r\n  async updateCase(\r\n    caseId: string,\r\n    userId: string,\r\n    data: {\r\n      title?: string;\r\n      description?: string | null;\r\n      priority?: \"low\" | \"medium\" | \"high\" | \"urgent\";\r\n      dueDate?: Date | null;\r\n      tags?: string[];\r\n      metadata?: Record<string, any>;\r\n    }\r\n  ): Promise<Case> {\r\n    // Get the case and check access\r\n    const caseInstance = await this.getCaseById(caseId, userId);\r\n\r\n    if (!caseInstance) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    // Verify this user has permission to edit\r\n    const userRole = caseInstance.getUserRole(userId);\r\n\r\n    if (!this.caseService.canPerformAction(userRole, \"edit\")) {\r\n      throw new Error(\"Permission denied: User cannot edit this case\");\r\n    }\r\n\r\n    // Apply the update using domain entity logic\r\n    const updatedCase = caseInstance.update(data, userId);\r\n\r\n    // Save the updated case\r\n    const updatedRecord = await caseRepository.update(caseId, {\r\n      title: updatedCase.title,\r\n      description: updatedCase.description,\r\n      priority: updatedCase.priority,\r\n      due_date: updatedCase.dueDate?.toISOString() || null,\r\n      tags: updatedCase.tags,\r\n      metadata: updatedCase.metadata,\r\n      timeline: updatedCase.timeline.map((event) => ({\r\n        ...event,\r\n        timestamp: event.timestamp.toISOString(),\r\n      })),\r\n    });\r\n\r\n    return caseRepository.toDomainEntity(updatedRecord);\r\n  }\r\n\r\n  /**\r\n   * Change case status\r\n   */\r\n  async changeStatus(\r\n    caseId: string,\r\n    userId: string,\r\n    newStatus: CaseStatus,\r\n    reason?: string\r\n  ): Promise<Case> {\r\n    // Get the case and check access\r\n    const caseInstance = await this.getCaseById(caseId, userId);\r\n\r\n    if (!caseInstance) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    // Verify this user has permission to change status\r\n    const userRole = caseInstance.getUserRole(userId);\r\n\r\n    if (!this.caseService.canPerformAction(userRole, \"change_status\")) {\r\n      throw new Error(\r\n        \"Permission denied: User cannot change the status of this case\"\r\n      );\r\n    }\r\n\r\n    // Verify status transition is valid\r\n    if (\r\n      !this.caseService.isValidStatusTransition(caseInstance.status, newStatus)\r\n    ) {\r\n      throw new Error(\r\n        `Invalid status transition from ${caseInstance.status} to ${newStatus}`\r\n      );\r\n    }\r\n\r\n    // Apply the status change using domain entity logic\r\n    const updatedCase = caseInstance.changeStatus(newStatus, userId, reason);\r\n\r\n    // Save the updated case\r\n    const updatedRecord = await caseRepository.update(caseId, {\r\n      status: newStatus,\r\n      timeline: updatedCase.timeline.map((event) => ({\r\n        ...event,\r\n        timestamp: event.timestamp.toISOString(),\r\n      })),\r\n    });\r\n\r\n    return caseRepository.toDomainEntity(updatedRecord);\r\n  }\r\n\r\n  /**\r\n   * Assign a user to a case\r\n   */\r\n  async assignUser(\r\n    caseId: string,\r\n    assignedUserId: string,\r\n    role: \"owner\" | \"collaborator\" | \"reviewer\" | \"client\",\r\n    assignedByUserId: string\r\n  ): Promise<Case> {\r\n    // Get the case and check access\r\n    const caseInstance = await this.getCaseById(caseId, assignedByUserId);\r\n\r\n    if (!caseInstance) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    // Verify this user has permission to assign others\r\n    const userRole = caseInstance.getUserRole(assignedByUserId);\r\n\r\n    if (!this.caseService.canPerformAction(userRole, \"assign\")) {\r\n      throw new Error(\r\n        \"Permission denied: User cannot assign others to this case\"\r\n      );\r\n    }\r\n\r\n    // Apply the assignment using domain entity logic\r\n    const updatedCase = caseInstance.assignUser(\r\n      assignedUserId,\r\n      role,\r\n      assignedByUserId\r\n    );\r\n\r\n    // Save the updated case\r\n    await caseRepository.assignUser(caseId, assignedUserId, role);\r\n\r\n    // Refresh the case data\r\n    return this.getCaseById(caseId);\r\n  }\r\n\r\n  /**\r\n   * Remove a user assignment from a case\r\n   */\r\n  async removeAssignment(\r\n    caseId: string,\r\n    targetUserId: string,\r\n    removedByUserId: string,\r\n    reason?: string\r\n  ): Promise<Case> {\r\n    // Get the case and check access\r\n    const caseInstance = await this.getCaseById(caseId, removedByUserId);\r\n\r\n    if (!caseInstance) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    // Verify this user has permission to remove assignments\r\n    const userRole = caseInstance.getUserRole(removedByUserId);\r\n\r\n    if (!this.caseService.canPerformAction(userRole, \"assign\")) {\r\n      throw new Error(\r\n        \"Permission denied: User cannot remove assignments from this case\"\r\n      );\r\n    }\r\n\r\n    // Apply the removal using domain entity logic\r\n    const updatedCase = caseInstance.removeAssignment(\r\n      targetUserId,\r\n      removedByUserId,\r\n      reason\r\n    );\r\n\r\n    // Save the updated case\r\n    await caseRepository.removeAssignment(caseId, targetUserId);\r\n\r\n    // Update the timeline\r\n    await caseRepository.updateTimeline(\r\n      caseId,\r\n      updatedCase.timeline.map((event) => ({\r\n        ...event,\r\n        timestamp: event.timestamp.toISOString(),\r\n      }))\r\n    );\r\n\r\n    // Refresh the case data\r\n    return this.getCaseById(caseId);\r\n  }\r\n\r\n  /**\r\n   * Add a document to a case\r\n   */\r\n  async addDocument(\r\n    caseId: string,\r\n    documentId: string,\r\n    userId: string\r\n  ): Promise<Case> {\r\n    // Get the case and document\r\n    const [caseInstance, document] = await Promise.all([\r\n      this.getCaseById(caseId, userId),\r\n      documentRepository.getById(documentId),\r\n    ]);\r\n\r\n    if (!caseInstance) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    if (!document) {\r\n      throw new Error(\"Document not found\");\r\n    }\r\n\r\n    // Verify this user has permission to add documents\r\n    const userRole = caseInstance.getUserRole(userId);\r\n\r\n    if (!this.caseService.canPerformAction(userRole, \"add_document\")) {\r\n      throw new Error(\r\n        \"Permission denied: User cannot add documents to this case\"\r\n      );\r\n    }\r\n\r\n    // Create a timeline event for the document addition\r\n    const documentEvent = this.caseService.createDocumentEvent(\r\n      documentId,\r\n      document.name,\r\n      userId\r\n    );\r\n\r\n    // Add the event to the case timeline\r\n    const updatedCase = caseInstance.addTimelineEvent(documentEvent);\r\n\r\n    // Update the document to link it to the case\r\n    await caseRepository.addDocument(caseId, documentId);\r\n\r\n    // Update the case timeline\r\n    await caseRepository.updateTimeline(\r\n      caseId,\r\n      updatedCase.timeline.map((event) => ({\r\n        ...event,\r\n        timestamp: event.timestamp.toISOString(),\r\n      }))\r\n    );\r\n\r\n    // Refresh the case data\r\n    return this.getCaseById(caseId);\r\n  }\r\n\r\n  /**\r\n   * Get case with all related data\r\n   */\r\n  async getCaseWithDetails(\r\n    caseId: string,\r\n    userId?: string\r\n  ): Promise<{\r\n    case: Case;\r\n    documents: Document[];\r\n    messages: any[];\r\n  }> {\r\n    // If userId is provided, check access\r\n    if (userId) {\r\n      const hasAccess = await caseRepository.userHasAccess(caseId, userId);\r\n      if (!hasAccess) {\r\n        throw new Error(\"Access denied\");\r\n      }\r\n    }\r\n\r\n    // Get case with details\r\n    const details = await caseRepository.getWithDetails(caseId);\r\n\r\n    if (!details) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    // Convert to domain entities\r\n    const caseEntity = caseRepository.toDomainEntity(details.case);\r\n\r\n    // Convert documents to domain entities\r\n    const documents = details.documents.map((doc) =>\r\n      Document.fromDatabase(doc)\r\n    );\r\n\r\n    return {\r\n      case: caseEntity,\r\n      documents,\r\n      messages: details.messages,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate case completion percentage\r\n   */\r\n  async calculateCompletionPercentage(caseId: string): Promise<number> {\r\n    // Get case with documents\r\n    const details = await caseRepository.getWithDetails(caseId);\r\n\r\n    if (!details) {\r\n      throw new Error(\"Case not found\");\r\n    }\r\n\r\n    // Convert to domain entity\r\n    const caseEntity = caseRepository.toDomainEntity(details.case);\r\n\r\n    // Get document names for completion calculation\r\n    const documentNames = details.documents.map((doc) => doc.name);\r\n\r\n    // Calculate completion percentage\r\n    return this.caseService.calculateCompletionPercentage(\r\n      caseEntity,\r\n      documentNames\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get required documents for a case\r\n   */\r\n  getRequiredDocuments(caseType: CaseType): string[] {\r\n    return this.caseService.getRequiredDocuments(caseType);\r\n  }\r\n\r\n  /**\r\n   * Estimate processing time for a case\r\n   */\r\n  estimateProcessingTime(caseType: CaseType): {\r\n    minDays: number;\r\n    maxDays: number;\r\n    averageDays: number;\r\n  } {\r\n    return this.caseService.estimateProcessingTime(caseType);\r\n  }\r\n}\r\n","import { zValidator } from \"@hono/zod-validator\";\r\nimport { Hono } from \"hono\";\r\nimport { z } from \"zod\";\r\n\r\n// Adjust middleware imports based on the main app's structure\r\n// We might need context (`c.get('db')`, `c.get('user')`) provided by main app middleware\r\n// Or we apply middleware directly in the main app when mounting this router\r\n// For now, assume main app provides user context via `c.get('user')`\r\n// import { supabaseMiddleware, requireAuth } from '../middleware/supabase'; // Likely remove/replace\r\nimport type { AppEnv } from \"@/app/api/[[...route]]/route\";\r\nimport { subscriptionRateLimit } from \"@/app/api/middleware/subscription-rate-limit\"; // Import new middleware\r\nimport { CaseStatus, CaseType } from \"@/core/immigration/entities/case\"; // Corrected path\r\nimport { supabase } from \"@/lib/supabase/client\"; // Import the supabase client instance\r\nimport { CaseApplicationService } from \"@/services/case-application-service\"; // Corrected path\r\n\r\n// Validation schemas (keep as is)\r\nconst createCaseSchema = z.object({\r\n  title: z.string().min(3).max(100),\r\n  description: z.string().max(2000).optional(),\r\n  caseType: z.nativeEnum(CaseType),\r\n  clientId: z.string().uuid(),\r\n  priority: z.enum([\"low\", \"medium\", \"high\", \"urgent\"]).optional(),\r\n  dueDate: z.string().datetime().optional().nullable(),\r\n  tags: z.array(z.string()).optional(),\r\n  metadata: z.record(z.any()).optional(),\r\n});\r\n\r\nconst updateCaseSchema = z.object({\r\n  title: z.string().min(3).max(100).optional(),\r\n  description: z.string().max(2000).optional().nullable(),\r\n  priority: z.enum([\"low\", \"medium\", \"high\", \"urgent\"]).optional(),\r\n  dueDate: z.string().datetime().optional().nullable(),\r\n  tags: z.array(z.string()).optional(),\r\n  metadata: z.record(z.any()).optional(),\r\n});\r\n\r\nconst statusChangeSchema = z.object({\r\n  status: z.nativeEnum(CaseStatus),\r\n  reason: z.string().max(500).optional(),\r\n});\r\n\r\nconst assignUserSchema = z.object({\r\n  userId: z.string().uuid(),\r\n  role: z.enum([\"owner\", \"collaborator\", \"reviewer\", \"client\"]),\r\n});\r\n\r\n// Setup function\r\nexport function setupCaseRoutes(app: Hono<AppEnv>) {\r\n  // Use AppContext if defined\r\n  // Initialize application service within the setup function scope\r\n  const caseService = new CaseApplicationService();\r\n\r\n  // Create router instance - mount this under /api/cases in the main app\r\n  const caseApi = new Hono<AppEnv>(); // Use AppContext if defined\r\n\r\n  // Apply specific rate limits using string literals\r\n  const caseManagementLimit = subscriptionRateLimit(\r\n    \"caseManagement\",\r\n    () => supabase\r\n  );\r\n  const documentUploadLimit = subscriptionRateLimit(\r\n    \"documentUpload\",\r\n    () => supabase\r\n  );\r\n\r\n  // Apply general case management limit to most routes\r\n  caseApi.use(\"/*\", caseManagementLimit);\r\n  // Apply specific document upload limit (overrides general limit for this path)\r\n  caseApi.use(\"/:id/documents/:documentId\", documentUploadLimit);\r\n\r\n  // --- Routes (logic remains largely the same, ensure context `c.get('user')` is available) ---\r\n\r\n  caseApi.get(\"/\", async (c) => {\r\n    const user = c.get(\"user\"); // Assumes user is set by middleware in main app\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const { includeAssigned, status, limit, offset } = c.req.query();\r\n    try {\r\n      const cases = await caseService.getCasesByUser(user.id, {\r\n        includeAssigned: includeAssigned === \"true\",\r\n        status: status ? status.split(\",\") : undefined,\r\n        limit: limit ? parseInt(limit) : undefined,\r\n        offset: offset ? parseInt(offset) : undefined,\r\n      });\r\n      return c.json({ success: true, data: cases });\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching cases:\", error);\r\n      return c.json({ error: \"Failed to fetch cases\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.get(\"/:id\", async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseId = c.req.param(\"id\");\r\n    try {\r\n      const caseDetail = await caseService.getCaseById(caseId, user.id);\r\n      if (!caseDetail) {\r\n        return c.json({ error: \"Case not found\" }, 404);\r\n      }\r\n      return c.json({ success: true, data: caseDetail });\r\n    } catch (error: any) {\r\n      if (error.message === \"Access denied\") {\r\n        return c.json({ error: \"Access denied\" }, 403);\r\n      }\r\n      console.error(\"Error fetching case:\", error);\r\n      return c.json({ error: \"Failed to fetch case\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.get(\"/:id/details\", async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseId = c.req.param(\"id\");\r\n    try {\r\n      const details = await caseService.getCaseWithDetails(caseId, user.id);\r\n      return c.json({ success: true, data: details });\r\n    } catch (error: any) {\r\n      if (error.message === \"Access denied\") {\r\n        return c.json({ error: \"Access denied\" }, 403);\r\n      }\r\n      if (error.message === \"Case not found\") {\r\n        return c.json({ error: \"Case not found\" }, 404);\r\n      }\r\n      console.error(\"Error fetching case details:\", error);\r\n      return c.json({ error: \"Failed to fetch case details\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.post(\"/\", zValidator(\"json\", createCaseSchema), async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const body = await c.req.json();\r\n    try {\r\n      let dueDate = null;\r\n      if (body.dueDate) {\r\n        dueDate = new Date(body.dueDate);\r\n      }\r\n      const newCase = await caseService.createCase({\r\n        ...body,\r\n        createdBy: user.id,\r\n        dueDate,\r\n      });\r\n      return c.json({ success: true, data: newCase }, 201);\r\n    } catch (error: any) {\r\n      console.error(\"Error creating case:\", error);\r\n      return c.json({ error: \"Failed to create case\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.patch(\"/:id\", zValidator(\"json\", updateCaseSchema), async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseId = c.req.param(\"id\");\r\n    const body = await c.req.json();\r\n    try {\r\n      let dueDate = undefined;\r\n      if (body.dueDate !== undefined) {\r\n        dueDate = body.dueDate ? new Date(body.dueDate) : null;\r\n      }\r\n      const updatedCase = await caseService.updateCase(caseId, user.id, {\r\n        ...body,\r\n        dueDate,\r\n      });\r\n      return c.json({ success: true, data: updatedCase });\r\n    } catch (error: any) {\r\n      if (error.message.includes(\"Permission denied\")) {\r\n        return c.json({ error: error.message }, 403);\r\n      }\r\n      if (error.message === \"Case not found\") {\r\n        return c.json({ error: \"Case not found\" }, 404);\r\n      }\r\n      console.error(\"Error updating case:\", error);\r\n      return c.json({ error: \"Failed to update case\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.patch(\r\n    \"/:id/status\",\r\n    zValidator(\"json\", statusChangeSchema),\r\n    async (c) => {\r\n      const user = c.get(\"user\");\r\n      if (!user) {\r\n        return c.json({ error: \"Unauthorized\" }, 401);\r\n      }\r\n      const caseId = c.req.param(\"id\");\r\n      const { status, reason } = await c.req.json();\r\n      try {\r\n        const updatedCase = await caseService.changeStatus(\r\n          caseId,\r\n          user.id,\r\n          status,\r\n          reason\r\n        );\r\n        return c.json({ success: true, data: updatedCase });\r\n      } catch (error: any) {\r\n        if (error.message.includes(\"Permission denied\")) {\r\n          return c.json({ error: error.message }, 403);\r\n        }\r\n        if (error.message === \"Case not found\") {\r\n          return c.json({ error: \"Case not found\" }, 404);\r\n        }\r\n        if (error.message.includes(\"Invalid status transition\")) {\r\n          return c.json({ error: error.message }, 400);\r\n        }\r\n        console.error(\"Error changing case status:\", error);\r\n        return c.json({ error: \"Failed to change case status\" }, 500);\r\n      }\r\n    }\r\n  );\r\n\r\n  caseApi.post(\r\n    \"/:id/assign\",\r\n    zValidator(\"json\", assignUserSchema),\r\n    async (c) => {\r\n      const user = c.get(\"user\");\r\n      if (!user) {\r\n        return c.json({ error: \"Unauthorized\" }, 401);\r\n      }\r\n      const caseId = c.req.param(\"id\");\r\n      const { userId, role } = await c.req.json();\r\n      try {\r\n        const updatedCase = await caseService.assignUser(\r\n          caseId,\r\n          userId,\r\n          role,\r\n          user.id\r\n        );\r\n        return c.json({ success: true, data: updatedCase });\r\n      } catch (error: any) {\r\n        if (error.message.includes(\"Permission denied\")) {\r\n          return c.json({ error: error.message }, 403);\r\n        }\r\n        if (error.message === \"Case not found\") {\r\n          return c.json({ error: \"Case not found\" }, 404);\r\n        }\r\n        console.error(\"Error assigning user to case:\", error);\r\n        return c.json({ error: \"Failed to assign user to case\" }, 500);\r\n      }\r\n    }\r\n  );\r\n\r\n  caseApi.delete(\"/:id/assign/:userId\", async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseId = c.req.param(\"id\");\r\n    const targetUserId = c.req.param(\"userId\");\r\n    const reason = c.req.query(\"reason\");\r\n    try {\r\n      const updatedCase = await caseService.removeAssignment(\r\n        caseId,\r\n        targetUserId,\r\n        user.id,\r\n        reason\r\n      );\r\n      return c.json({ success: true, data: updatedCase });\r\n    } catch (error: any) {\r\n      if (error.message.includes(\"Permission denied\")) {\r\n        return c.json({ error: error.message }, 403);\r\n      }\r\n      if (error.message === \"Case not found\") {\r\n        return c.json({ error: \"Case not found\" }, 404);\r\n      }\r\n      console.error(\"Error removing user from case:\", error);\r\n      return c.json({ error: \"Failed to remove user from case\" }, 500);\r\n    }\r\n  });\r\n\r\n  // This route might need adjustment depending on how documents are handled globally\r\n  // It assumes a document ID is passed, likely created via a separate document upload API\r\n  caseApi.post(\"/:id/documents/:documentId\", async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseId = c.req.param(\"id\");\r\n    const documentId = c.req.param(\"documentId\");\r\n    // Add specific rate limit for document linking/uploading here or in main app\r\n    try {\r\n      const updatedCase = await caseService.addDocument(\r\n        caseId,\r\n        documentId,\r\n        user.id\r\n      );\r\n      return c.json({ success: true, data: updatedCase });\r\n    } catch (error: any) {\r\n      if (error.message.includes(\"Permission denied\")) {\r\n        return c.json({ error: error.message }, 403);\r\n      }\r\n      if (\r\n        error.message === \"Case not found\" ||\r\n        error.message === \"Document not found\"\r\n      ) {\r\n        return c.json({ error: error.message }, 404);\r\n      }\r\n      console.error(\"Error adding document to case:\", error);\r\n      return c.json({ error: \"Failed to add document to case\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.get(\"/:id/completion\", async (c) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseId = c.req.param(\"id\");\r\n    try {\r\n      const caseExists = await caseService.getCaseById(caseId, user.id); // Access check\r\n      if (!caseExists) {\r\n        return c.json({ error: \"Case not found\" }, 404);\r\n      }\r\n      const completionPercentage =\r\n        await caseService.calculateCompletionPercentage(caseId);\r\n      return c.json({ success: true, data: { completionPercentage } });\r\n    } catch (error: any) {\r\n      if (error.message === \"Access denied\") {\r\n        return c.json({ error: \"Access denied\" }, 403);\r\n      }\r\n      if (error.message === \"Case not found\") {\r\n        return c.json({ error: \"Case not found\" }, 404);\r\n      }\r\n      console.error(\"Error calculating case completion:\", error);\r\n      return c.json({ error: \"Failed to calculate case completion\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.get(\"/types/:caseType/required-documents\", async (c) => {\r\n    // Changed path slightly for clarity\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseTypeParam = c.req.param(\"caseType\");\r\n    try {\r\n      const caseType = caseTypeParam as CaseType;\r\n      if (!Object.values(CaseType).includes(caseType)) {\r\n        return c.json({ error: \"Invalid case type\" }, 400);\r\n      }\r\n      const requiredDocs = caseService.getRequiredDocuments(caseType);\r\n      return c.json({\r\n        success: true,\r\n        data: { requiredDocuments: requiredDocs },\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Error getting required documents:\", error);\r\n      return c.json({ error: \"Failed to get required documents\" }, 500);\r\n    }\r\n  });\r\n\r\n  caseApi.get(\"/types/:caseType/processing-time\", async (c) => {\r\n    // Changed path slightly for clarity\r\n    const user = c.get(\"user\");\r\n    if (!user) {\r\n      return c.json({ error: \"Unauthorized\" }, 401);\r\n    }\r\n    const caseTypeParam = c.req.param(\"caseType\");\r\n    try {\r\n      const caseType = caseTypeParam as CaseType;\r\n      if (!Object.values(CaseType).includes(caseType)) {\r\n        return c.json({ error: \"Invalid case type\" }, 400);\r\n      }\r\n      const processingTime = caseService.estimateProcessingTime(caseType);\r\n      return c.json({ success: true, data: processingTime });\r\n    } catch (error: any) {\r\n      console.error(\"Error estimating processing time:\", error);\r\n      return c.json({ error: \"Failed to estimate processing time\" }, 500);\r\n    }\r\n  });\r\n\r\n  // Mount the case routes onto the main app instance passed in\r\n  app.route(\"/cases\", caseApi);\r\n}\r\n\r\n// Note: Ensure CaseApplicationService path (@/services/case-application-service)\r\n// and core types path (@/core/immigration/entities/case) are correct relative to this new file location.\r\n// Also, define or import AppContext type if needed for Hono typings.\r\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 48714;\nmodule.exports = webpackEmptyAsyncContext;","/**\n * For a given page path, this function ensures that there is a leading slash.\n * If there is not a leading slash, one is added, otherwise it is noop.\n */\nexport function ensureLeadingSlash(path: string) {\n  return path.startsWith('/') ? path : `/${path}`\n}\n","module.exports = require(\"node:diagnostics_channel\");","import type { ActionManifest } from '../../build/webpack/plugins/flight-client-entry-plugin'\nimport type {\n  ClientReferenceManifest,\n  ClientReferenceManifestForRsc,\n} from '../../build/webpack/plugins/flight-manifest-plugin'\nimport type { DeepReadonly } from '../../shared/lib/deep-readonly'\nimport { InvariantError } from '../../shared/lib/invariant-error'\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\nimport { workAsyncStorage } from './work-async-storage.external'\n\nlet __next_loaded_action_key: CryptoKey\n\nexport function arrayBufferToString(\n  buffer: ArrayBuffer | Uint8Array<ArrayBufferLike>\n) {\n  const bytes = new Uint8Array(buffer)\n  const len = bytes.byteLength\n\n  // @anonrig: V8 has a limit of 65535 arguments in a function.\n  // For len < 65535, this is faster.\n  // https://github.com/vercel/next.js/pull/56377#pullrequestreview-1656181623\n  if (len < 65535) {\n    return String.fromCharCode.apply(null, bytes as unknown as number[])\n  }\n\n  let binary = ''\n  for (let i = 0; i < len; i++) {\n    binary += String.fromCharCode(bytes[i])\n  }\n  return binary\n}\n\nexport function stringToUint8Array(binary: string) {\n  const len = binary.length\n  const arr = new Uint8Array(len)\n\n  for (let i = 0; i < len; i++) {\n    arr[i] = binary.charCodeAt(i)\n  }\n\n  return arr\n}\n\nexport function encrypt(key: CryptoKey, iv: Uint8Array, data: Uint8Array) {\n  return crypto.subtle.encrypt(\n    {\n      name: 'AES-GCM',\n      iv,\n    },\n    key,\n    data\n  )\n}\n\nexport function decrypt(key: CryptoKey, iv: Uint8Array, data: Uint8Array) {\n  return crypto.subtle.decrypt(\n    {\n      name: 'AES-GCM',\n      iv,\n    },\n    key,\n    data\n  )\n}\n\n// This is a global singleton that is used to encode/decode the action bound args from\n// the closure. This can't be using a AsyncLocalStorage as it might happen on the module\n// level. Since the client reference manifest won't be mutated, let's use a global singleton\n// to keep it.\nconst SERVER_ACTION_MANIFESTS_SINGLETON = Symbol.for(\n  'next.server.action-manifests'\n)\n\nexport function setReferenceManifestsSingleton({\n  page,\n  clientReferenceManifest,\n  serverActionsManifest,\n  serverModuleMap,\n}: {\n  page: string\n  clientReferenceManifest: DeepReadonly<ClientReferenceManifest>\n  serverActionsManifest: DeepReadonly<ActionManifest>\n  serverModuleMap: {\n    [id: string]: {\n      id: string\n      chunks: string[]\n      name: string\n    }\n  }\n}) {\n  // @ts-expect-error\n  const clientReferenceManifestsPerPage = globalThis[\n    SERVER_ACTION_MANIFESTS_SINGLETON\n  ]?.clientReferenceManifestsPerPage as\n    | undefined\n    | DeepReadonly<Record<string, ClientReferenceManifest>>\n\n  // @ts-expect-error\n  globalThis[SERVER_ACTION_MANIFESTS_SINGLETON] = {\n    clientReferenceManifestsPerPage: {\n      ...clientReferenceManifestsPerPage,\n      [normalizeAppPath(page)]: clientReferenceManifest,\n    },\n    serverActionsManifest,\n    serverModuleMap,\n  }\n}\n\nexport function getServerModuleMap() {\n  const serverActionsManifestSingleton = (globalThis as any)[\n    SERVER_ACTION_MANIFESTS_SINGLETON\n  ] as {\n    serverModuleMap: {\n      [id: string]: {\n        id: string\n        chunks: string[]\n        name: string\n      }\n    }\n  }\n\n  if (!serverActionsManifestSingleton) {\n    throw new InvariantError('Missing manifest for Server Actions.')\n  }\n\n  return serverActionsManifestSingleton.serverModuleMap\n}\n\nexport function getClientReferenceManifestForRsc(): DeepReadonly<ClientReferenceManifestForRsc> {\n  const serverActionsManifestSingleton = (globalThis as any)[\n    SERVER_ACTION_MANIFESTS_SINGLETON\n  ] as {\n    clientReferenceManifestsPerPage: DeepReadonly<\n      Record<string, ClientReferenceManifest>\n    >\n  }\n\n  if (!serverActionsManifestSingleton) {\n    throw new InvariantError('Missing manifest for Server Actions.')\n  }\n\n  const { clientReferenceManifestsPerPage } = serverActionsManifestSingleton\n  const workStore = workAsyncStorage.getStore()\n\n  if (!workStore) {\n    // If there's no work store defined, we can assume that a client reference\n    // manifest is needed during module evaluation, e.g. to create a server\n    // action using a higher-order function. This might also use client\n    // components which need to be serialized by Flight, and therefore client\n    // references need to be resolvable. To make this work, we're returning a\n    // merged manifest across all pages. This is fine as long as the module IDs\n    // are not page specific, which they are not for Webpack. TODO: Fix this in\n    // Turbopack.\n    return mergeClientReferenceManifests(clientReferenceManifestsPerPage)\n  }\n\n  const clientReferenceManifest =\n    clientReferenceManifestsPerPage[workStore.route]\n\n  if (!clientReferenceManifest) {\n    throw new InvariantError(\n      `Missing Client Reference Manifest for ${workStore.route}.`\n    )\n  }\n\n  return clientReferenceManifest\n}\n\nexport async function getActionEncryptionKey() {\n  if (__next_loaded_action_key) {\n    return __next_loaded_action_key\n  }\n\n  const serverActionsManifestSingleton = (globalThis as any)[\n    SERVER_ACTION_MANIFESTS_SINGLETON\n  ] as {\n    serverActionsManifest: DeepReadonly<ActionManifest>\n  }\n\n  if (!serverActionsManifestSingleton) {\n    throw new InvariantError('Missing manifest for Server Actions.')\n  }\n\n  const rawKey =\n    process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY ||\n    serverActionsManifestSingleton.serverActionsManifest.encryptionKey\n\n  if (rawKey === undefined) {\n    throw new InvariantError('Missing encryption key for Server Actions')\n  }\n\n  __next_loaded_action_key = await crypto.subtle.importKey(\n    'raw',\n    stringToUint8Array(atob(rawKey)),\n    'AES-GCM',\n    true,\n    ['encrypt', 'decrypt']\n  )\n\n  return __next_loaded_action_key\n}\n\nfunction mergeClientReferenceManifests(\n  clientReferenceManifestsPerPage: DeepReadonly<\n    Record<string, ClientReferenceManifest>\n  >\n): ClientReferenceManifestForRsc {\n  const clientReferenceManifests = Object.values(\n    clientReferenceManifestsPerPage as Record<string, ClientReferenceManifest>\n  )\n\n  const mergedClientReferenceManifest: ClientReferenceManifestForRsc = {\n    clientModules: {},\n    edgeRscModuleMapping: {},\n    rscModuleMapping: {},\n  }\n\n  for (const clientReferenceManifest of clientReferenceManifests) {\n    mergedClientReferenceManifest.clientModules = {\n      ...mergedClientReferenceManifest.clientModules,\n      ...clientReferenceManifest.clientModules,\n    }\n    mergedClientReferenceManifest.edgeRscModuleMapping = {\n      ...mergedClientReferenceManifest.edgeRscModuleMapping,\n      ...clientReferenceManifest.edgeRscModuleMapping,\n    }\n    mergedClientReferenceManifest.rscModuleMapping = {\n      ...mergedClientReferenceManifest.rscModuleMapping,\n      ...clientReferenceManifest.rscModuleMapping,\n    }\n  }\n\n  return mergedClientReferenceManifest\n}\n","module.exports = require(\"crypto\");","module.exports = require(\"https\");","module.exports = require(\"node:stream\");","module.exports = require(\"node:util\");","import{getSortedPathnames as e,matchesPathname as n,isLocalizableHref as t,prefixPathname as r,getLocalePrefix as o,normalizeTrailingSlash as a}from\"../../shared/utils.js\";function i(e){return\"string\"==typeof e?{pathname:e}:e}function c(e){function n(e){return String(e)}const t=new URLSearchParams;for(const[r,o]of Object.entries(e))Array.isArray(o)?o.forEach((e=>{t.append(r,n(e))})):t.set(r,n(o));return\"?\"+t.toString()}function f(e){let{pathname:n,locale:t,params:r,pathnames:o,query:i}=e;function f(e){let n=o[e];return n||(n=e),n}function s(e){const n=\"string\"==typeof e?e:e[t];let o=n;if(r&&Object.entries(r).forEach((e=>{let n,t,[r,a]=e;Array.isArray(a)?(n=\"(\\\\[)?\\\\[...\".concat(r,\"\\\\](\\\\])?\"),t=a.map((e=>String(e))).join(\"/\")):(n=\"\\\\[\".concat(r,\"\\\\]\"),t=String(a)),o=o.replace(new RegExp(n,\"g\"),t)})),o=o.replace(/\\[\\[\\.\\.\\..+\\]\\]/g,\"\"),o=a(o),o.includes(\"[\"))throw new Error(\"Insufficient params provided for localized pathname.\\nTemplate: \".concat(n,\"\\nParams: \").concat(JSON.stringify(r)));return i&&(o+=c(i)),o}if(\"string\"==typeof n){return s(f(n))}{const{pathname:e,...t}=n;return{...t,pathname:s(f(e))}}}function s(t,r,o){const a=e(Object.keys(o)),i=decodeURI(r);for(const e of a){const r=o[e];if(\"string\"==typeof r){if(n(r,i))return e}else if(n(r[t],i))return e}return r}function l(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.pathname;return\"/\"===e?n:n.replace(e,\"\")}function d(e,n,a,i,c){const{mode:f}=a.localePrefix;let s;if(void 0!==c)s=c;else if(t(e))if(\"always\"===f)s=!0;else if(\"as-needed\"===f){let e=a.defaultLocale;if(a.domains){const n=a.domains.find((e=>e.domain===i));n?e=n.defaultLocale:i||console.error(\"You're using a routing configuration with `localePrefix: 'as-needed'` in combination with `domains`. In order to compute a correct pathname, you need to provide a `domain` parameter.\\n\\nSee: https://next-intl.dev/docs/routing#domains-localeprefix-asneeded\")}s=e!==n}return s?r(o(n,a.localePrefix),e):e}function u(e){var n;if(\"as-needed\"===(null===(n=e.localePrefix)||void 0===n?void 0:n.mode)&&!(\"defaultLocale\"in e))throw new Error(\"`localePrefix: 'as-needed' requires a `defaultLocale`.\")}export{d as applyPathnamePrefix,f as compileLocalizedPathname,l as getBasePath,s as getRoute,i as normalizeNameOrNameWithParams,c as serializeSearchParams,u as validateReceivedConfig};\n","import{getBasePath as t}from\"./utils.js\";function o(o,e,n,a){if(!o||!(a!==n&&null!=a)||!e)return;const c=t(e),f=\"\"!==c?c:\"/\",{name:r,...i}=o;i.path||(i.path=f);let l=\"\".concat(r,\"=\").concat(a,\";\");for(const[t,o]of Object.entries(i)){l+=\"\".concat(\"maxAge\"===t?\"max-age\":t),\"boolean\"!=typeof o&&(l+=\"=\"+o),l+=\";\"}document.cookie=l}export{o as default};\n","\"use client\";\nimport{extends as e}from\"../../_virtual/_rollupPluginBabelHelpers.js\";import o from\"next/link\";import{usePathname as t}from\"next/navigation\";import r,{forwardRef as n,useState as l,useEffect as i}from\"react\";import c from\"../../react-client/useLocale.js\";import a from\"./syncLocaleCookie.js\";function s(n,s){let{defaultLocale:p,href:f,locale:u,localeCookie:m,onClick:h,prefetch:d,unprefixed:k,...x}=n;const L=c(),g=null!=u&&u!==L,j=u||L,v=function(){const[e,o]=l();return i((()=>{o(window.location.host)}),[]),e}(),w=v&&k&&(k.domains[v]===j||!Object.keys(k.domains).includes(v)&&L===p&&!u)?k.pathname:f,C=t();return g&&(d&&console.error(\"The `prefetch` prop is currently not supported when using the `locale` prop on `Link` to switch the locale.`\"),d=!1),r.createElement(o,e({ref:s,href:w,hrefLang:g?u:void 0,onClick:function(e){a(m,C,L,u),h&&h(e)},prefetch:d},x))}var p=n(s);export{p as default};\n","\"use strict\";var e=require(\"@formatjs/fast-memoize\");function t(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(\".\")}function r(e){return t(e.namespace,e.key)}function a(e){console.error(e)}function n(t,r){return e.memoize(t,{cache:(a=r,{create:()=>({get:e=>a[e],set(e,t){a[e]=t}})}),strategy:e.strategies.variadic});var a}function s(e,t){return n((function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return new e(...r)}),t)}exports.createCache=function(){return{dateTime:{},number:{},message:{},relativeTime:{},pluralRules:{},list:{},displayNames:{}}},exports.createIntlFormatters=function(e){return{getDateTimeFormat:s(Intl.DateTimeFormat,e.dateTime),getNumberFormat:s(Intl.NumberFormat,e.number),getPluralRules:s(Intl.PluralRules,e.pluralRules),getRelativeTimeFormat:s(Intl.RelativeTimeFormat,e.relativeTime),getListFormat:s(Intl.ListFormat,e.list),getDisplayNames:s(Intl.DisplayNames,e.displayNames)}},exports.defaultGetMessageFallback=r,exports.defaultOnError=a,exports.initializeConfig=function(e){let{getMessageFallback:t,messages:n,onError:s,...i}=e;return{...i,messages:n,onError:s||a,getMessageFallback:t||r}},exports.joinPath=t,exports.memoFn=n;\n","import { zValidator } from \"@hono/zod-validator\";\r\nimport { Hono } from \"hono\";\r\nimport { HTTPException } from \"hono/http-exception\";\r\nimport { z } from \"zod\";\r\n\r\nimport { createServiceClient } from \"@/lib/supabase/client\";\r\n\r\nimport type { Context } from \"hono\";\r\n\r\ninterface ProfileUpdate {\r\n  firstName?: string;\r\n  lastName?: string;\r\n  bio?: string;\r\n  avatarUrl?: string;\r\n  timezone?: string;\r\n  language?: string;\r\n  countryOfResidence?: string;\r\n  countryOfInterest?: string;\r\n}\r\n\r\n/**\r\n * Profile routes for user profile management\r\n */\r\nexport function setupProfileRoutes(app: Hono) {\r\n  // Validation schema for profile updates\r\n  const profileUpdateSchema = z.object({\r\n    firstName: z.string().min(2).max(50).optional(),\r\n    lastName: z.string().min(2).max(50).optional(),\r\n    bio: z.string().max(500).optional(),\r\n    avatarUrl: z.string().url().optional(),\r\n    timezone: z.string().optional(),\r\n    language: z.string().optional(),\r\n    countryOfResidence: z.string().optional(),\r\n    countryOfInterest: z.string().optional(),\r\n  });\r\n\r\n  // Get user profile\r\n  app.get(\"/protected/profile\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    try {\r\n      const supabase = createServiceClient();\r\n      const { data, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      return c.json({\r\n        success: true,\r\n        profile: data,\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Profile fetch error:\", error);\r\n      throw new HTTPException(500, { message: \"Failed to fetch profile\" });\r\n    }\r\n  });\r\n\r\n  // Update user profile\r\n  app.patch(\"/protected/profile\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    // Validate the request body manually for now\r\n    const body = await c.req.json();\r\n\r\n    try {\r\n      // Validate the body against our schema\r\n      const result = profileUpdateSchema.safeParse(body);\r\n      if (!result.success) {\r\n        throw new HTTPException(400, { message: \"Invalid profile data\" });\r\n      }\r\n\r\n      const updates = result.data;\r\n      const supabase = createServiceClient();\r\n\r\n      const { error } = await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          ...(updates.firstName !== undefined && {\r\n            first_name: updates.firstName,\r\n          }),\r\n          ...(updates.lastName !== undefined && {\r\n            last_name: updates.lastName,\r\n          }),\r\n          ...(updates.bio !== undefined && { bio: updates.bio }),\r\n          ...(updates.avatarUrl !== undefined && {\r\n            avatar_url: updates.avatarUrl,\r\n          }),\r\n          ...(updates.timezone !== undefined && { timezone: updates.timezone }),\r\n          ...(updates.language !== undefined && { language: updates.language }),\r\n          ...(updates.countryOfResidence !== undefined && {\r\n            country_of_residence: updates.countryOfResidence,\r\n          }),\r\n          ...(updates.countryOfInterest !== undefined && {\r\n            country_of_interest: updates.countryOfInterest,\r\n          }),\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      return c.json({\r\n        success: true,\r\n        message: \"Profile updated successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Profile update error:\", error);\r\n      if (error instanceof HTTPException) {\r\n        throw error;\r\n      }\r\n      throw new HTTPException(500, { message: \"Failed to update profile\" });\r\n    }\r\n  });\r\n\r\n  // Get user documents count for dashboard stats\r\n  app.get(\"/protected/profile/stats\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    try {\r\n      const supabase = createServiceClient();\r\n\r\n      // Get count of user's documents\r\n      const { count: documentsCount, error: documentsError } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"user_id\", user.id);\r\n\r\n      // Get count of user's applications\r\n      const { count: applicationsCount, error: applicationsError } =\r\n        await supabase\r\n          .from(\"applications\")\r\n          .select(\"*\", { count: \"exact\", head: true })\r\n          .eq(\"user_id\", user.id);\r\n\r\n      if (documentsError || applicationsError) {\r\n        throw documentsError || applicationsError;\r\n      }\r\n\r\n      return c.json({\r\n        success: true,\r\n        stats: {\r\n          documentsCount: documentsCount || 0,\r\n          applicationsCount: applicationsCount || 0,\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Stats fetch error:\", error);\r\n      throw new HTTPException(500, { message: \"Failed to fetch user stats\" });\r\n    }\r\n  });\r\n\r\n  return app;\r\n}\r\n","module.exports = require(\"next/dist/server/app-render/work-unit-async-storage.external.js\");","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n","\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"./createFormatter-CZeYe_QF.js\"),r=require(\"./initializeConfig-AbYTngyP.js\");require(\"intl-messageformat\"),require(\"react\"),require(\"@formatjs/fast-memoize\"),exports.IntlError=e.IntlError,exports.IntlErrorCode=e.IntlErrorCode,exports.createFormatter=e.createFormatter,exports._createCache=r.createCache,exports._createIntlFormatters=r.createIntlFormatters,exports.initializeConfig=r.initializeConfig,exports.createTranslator=function(t){let{_cache:a=r.createCache(),_formatters:s=r.createIntlFormatters(a),getMessageFallback:o=r.defaultGetMessageFallback,messages:c,namespace:n,onError:i=r.defaultOnError,...l}=t;return function(r,t){let{messages:a,namespace:s,...o}=r;return a=a[t],s=e.resolveNamespace(s,t),e.createBaseTranslator({...o,messages:a,namespace:s})}({...l,onError:i,cache:a,formatters:s,getMessageFallback:o,messages:{\"!\":c},namespace:n?\"!.\".concat(n):\"!\"},\"!\")};\n","\"use client\";\r\n\r\nimport {\r\n  useFormatter,\r\n  useLocale,\r\n  useNow,\r\n  useTimeZone,\r\n  useTranslations,\r\n} from \"next-intl\";\r\n\r\nimport { getLocaleConfig, Locale } from \"@/i18n/i18n\";\r\n\r\n/**\r\n * Extended hook for i18n utilities combining multiple next-intl hooks\r\n * @returns Various i18n utilities for use in client components\r\n */\r\nexport function useI18n() {\r\n  const locale = useLocale() as Locale;\r\n  const t = useTranslations();\r\n  const format = useFormatter();\r\n  const timeZone = useTimeZone();\r\n  const now = useNow();\r\n\r\n  // Get locale configuration\r\n  const config = getLocaleConfig(locale);\r\n\r\n  // Direction utility\r\n  const direction = config.direction;\r\n  const isRtl = direction === \"rtl\";\r\n\r\n  // Date formatting helper using locale preferences\r\n  const formatDate = (date: Date | number, options?: any) => {\r\n    return format.dateTime(date, options);\r\n  };\r\n\r\n  // Relative time formatting\r\n  const formatRelativeTime = (date: Date | number) => {\r\n    return format.relativeTime(date);\r\n  };\r\n\r\n  // Currency formatting with locale preferences\r\n  const formatCurrency = (value: number, currency = \"USD\") => {\r\n    return format.number(value, {\r\n      style: \"currency\",\r\n      currency,\r\n    } as any);\r\n  };\r\n\r\n  // Number formatting according to locale\r\n  const formatNumber = (value: number, options?: any) => {\r\n    return format.number(value, options);\r\n  };\r\n\r\n  return {\r\n    // Original hooks\r\n    t,\r\n    format,\r\n    locale,\r\n    timeZone,\r\n    now,\r\n\r\n    // Derived utilities\r\n    config,\r\n    direction,\r\n    isRtl,\r\n\r\n    // Helper functions\r\n    formatDate,\r\n    formatRelativeTime,\r\n    formatCurrency,\r\n    formatNumber,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook to access translations for a specific namespace\r\n * @param namespace The translation namespace\r\n * @returns Translation function for the specified namespace\r\n */\r\nexport function useTranslate(namespace: string) {\r\n  return useTranslations(namespace);\r\n}\r\n\r\n/**\r\n * Hook to access global translations (no namespace)\r\n * @returns Translation function for the global namespace\r\n */\r\nexport function useGlobalTranslate() {\r\n  return useTranslations();\r\n}\r\n","module.exports = require(\"node:fs\");","\nexport { verifyUserIsAdmin as \"4055c9f9dce3c849928e65e87017b3609674121d00\" } from \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\lib\\\\actions\\\\admin.ts\"\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","module.exports = require(\"worker_threads\");","module.exports = require(\"zlib\");","module.exports = require(\"perf_hooks\");","function n(){return n=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)({}).hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},n.apply(null,arguments)}export{n as extends};\n","module.exports = require(\"node:worker_threads\");","import { Hono } from \"hono\";\r\nimport { cors } from \"hono/cors\";\r\nimport { HTTPException } from \"hono/http-exception\";\r\nimport { logger } from \"hono/logger\";\r\nimport { prettyJSON } from \"hono/pretty-json\";\r\nimport { timing } from \"hono/timing\";\r\nimport { handle } from \"hono/vercel\";\r\n\r\n// Import route handlers\r\n// These will be created progressively as needed\r\nimport { languageDetectionMiddleware } from \"@/app/api/middleware/language\";\r\nimport { redisCacheMiddleware, redisApiCacheMiddleware } from \"@/lib/redis\";\r\nimport {\r\n  subscriptionRateLimit,\r\n  ResourceType,\r\n} from \"@/app/api/middleware/subscription-rate-limit\";\r\nimport { setupAdminRoutes } from \"@/app/api/routes/admin\";\r\nimport { setupAuthRoutes } from \"@/app/api/routes/auth\";\r\nimport { setupCaseRoutes } from \"@/app/api/routes/cases\";\r\nimport { setupDocumentRoutes } from \"@/app/api/routes/documents\";\r\nimport { setupImmigrationRoutes } from \"@/app/api/routes/immigration\";\r\nimport { setupProfileRoutes } from \"@/app/api/routes/profile\";\r\nimport { setupSubscriptionRoutes } from \"@/app/api/routes/subscription\";\r\nimport { setupUserRoutes } from \"@/app/api/routes/users\";\r\n\r\n// Import application services (placeholder paths - adjust if needed)\r\nimport { ChatService as DomainChatService } from \"@/_core/chat/services/chat-service\";\r\nimport type { Locale } from \"@/i18n\";\r\nimport { repositoryFactory } from \"@/_infrastructure/repositories\";\r\n\r\n// Import language middleware\r\n\r\n// Import advanced middleware from our new implementations\r\nimport { verifyUserIsAdmin } from \"@/lib/actions/admin\"; // Import the server action\r\nimport {\r\n  createEdgeClient,\r\n  TypedSSRSupabaseClient,\r\n  createSupabaseServiceClient,\r\n} from \"@/lib/supabase/client\";\r\nimport { ChatApplicationService } from \"@/services/chat-service-consolidated\";\r\n\r\n// New import for the active Sentry middleware\r\nimport { sentryErrorLoggerMiddleware } from \"../hono/middleware/sentry-error-logger\";\r\n\r\nimport type { User } from \"@supabase/supabase-js\";\r\nimport type { Context } from \"hono\";\r\n\r\n// --- Define App Environment (Bindings & Variables) ---\r\nexport type AppEnv = {\r\n  Bindings: {\r\n    OPENAI_API_KEY: string;\r\n    // Add other env vars if needed\r\n  };\r\n  Variables: {\r\n    user: User | null;\r\n    chatService: ChatApplicationService;\r\n    locale: Locale;\r\n    translations: Record<string, any>;\r\n    db: TypedSSRSupabaseClient;\r\n    // Add other context variables (e.g., dbClient, services)\r\n  };\r\n};\r\n\r\n// Create Hono app with typed environment\r\nconst app = new Hono<AppEnv>();\r\n\r\n// SIMPLE TEST ROUTE\r\napp.get(\"/ping\", (c) => {\r\n  console.log(\"[HONO /api/ping] Received request\");\r\n  return c.json({\r\n    message: \"pong from /api/ping\",\r\n    timestamp: new Date().toISOString(),\r\n  });\r\n});\r\n\r\n// -----------------------------\r\n// Initialize Advanced Services - Sentry init removed\r\n// -----------------------------\r\n// // Initialize Sentry for error tracking - REMOVED\r\n// initializeSentry();\r\n\r\n// // Add shutdown handler for graceful exit - REMOVED\r\n// process.on(\"SIGTERM\", async () => {\r\n//   console.log(\"SIGTERM received, closing connections\");\r\n//   await closeSentry();\r\n//   process.exit(0);\r\n// });\r\n\r\n// -----------------------------\r\n// Instantiate Services\r\n// -----------------------------\r\n// const repositoryFactory = new RepositoryFactory(supabase); // Example if needed\r\nconst domainChatService = new DomainChatService();\r\nconst openaiApiKey = process.env.OPENAI_API_KEY || \"\";\r\nif (!openaiApiKey) {\r\n  console.warn(\"OPENAI_API_KEY is not set!\");\r\n  // Potentially throw error or handle gracefully\r\n}\r\nconst chatServiceInstance = new ChatApplicationService(\r\n  repositoryFactory,\r\n  domainChatService,\r\n  openaiApiKey\r\n);\r\n\r\n// -----------------------------\r\n// Middleware\r\n// -----------------------------\r\n// Apply Sentry error logging first to capture errors in all other middleware\r\napp.use(\"*\", sentryErrorLoggerMiddleware({ component: \"api\" }));\r\n\r\n// Standard middleware\r\napp.use(\"*\", logger());\r\napp.use(\"*\", timing());\r\napp.use(\"*\", prettyJSON());\r\napp.use(\r\n  \"*\",\r\n  cors({\r\n    origin: process.env.NEXT_PUBLIC_APP_URL || \"*\",\r\n    allowMethods: [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\r\n    allowHeaders: [\"Content-Type\", \"Authorization\"],\r\n    exposeHeaders: [\"Content-Length\", \"X-Request-Id\"],\r\n    maxAge: 600,\r\n    credentials: true,\r\n  })\r\n);\r\n\r\n// Apply Language Detection early in the pipeline\r\napp.use(\r\n  \"*\",\r\n  languageDetectionMiddleware({\r\n    // Add options if needed, e.g., cookieName: 'MY_APP_LOCALE'\r\n  })\r\n);\r\n\r\n// Add middleware to set services in context\r\napp.use(\"*\", async (c, next) => {\r\n  c.set(\"chatService\", chatServiceInstance); // Set the instantiated service\r\n  await next();\r\n});\r\n\r\n// Add middleware to set Supabase client in context\r\napp.use(\"*\", async (c, next) => {\r\n  try {\r\n    const dbClient = createEdgeClient(c.req.raw);\r\n    c.set(\"db\", dbClient);\r\n  } catch (error) {\r\n    console.error(\"Failed to create Supabase client for context:\", error);\r\n    // Depending on strictness, you might throw or set db to null/undefined\r\n    // For now, let's proceed, but requests needing db might fail if it's not set.\r\n    // Consider throwing an HTTPException if db is critical for all subsequent routes.\r\n  }\r\n  await next();\r\n});\r\n\r\n// -----------------------------\r\n// Advanced Caching Strategy\r\n// -----------------------------\r\n// Use Redis-backed caching for GET requests with user-specific keys\r\n// Initialize Redis caching\r\napp.use(\r\n  \"*\",\r\n  redisApiCacheMiddleware({\r\n    ttl: 300, // 5 minutes cache time\r\n    varyByAuth: true, // Create different cache entries based on user\r\n  })\r\n);\r\n\r\n// Fallback to standard caching for better performance\r\n/* // Commented out Hono's standard cache\r\napp.use(\r\n  \"*\",\r\n  cache({\r\n    cacheName: \"api-cache\",\r\n    cacheControl: \"max-age=300, stale-while-revalidate=60\",\r\n    wait: true, // Ensure cache is set before responding\r\n  })\r\n);\r\n*/\r\n\r\n// -----------------------------\r\n// Error handling middleware\r\n// -----------------------------\r\napp.onError((err, c) => {\r\n  console.error(`[${c.req.method}] ${c.req.url}:`, err);\r\n\r\n  if (err instanceof HTTPException) {\r\n    return c.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          message: err.message,\r\n          status: err.status,\r\n        },\r\n      },\r\n      err.status\r\n    );\r\n  }\r\n\r\n  return c.json(\r\n    {\r\n      success: false,\r\n      error: {\r\n        message:\r\n          process.env.NODE_ENV === \"development\"\r\n            ? err.message || \"Internal Server Error\"\r\n            : \"Internal Server Error\",\r\n        status: 500,\r\n      },\r\n    },\r\n    500\r\n  );\r\n});\r\n\r\n// -----------------------------\r\n// Health check & public routes\r\n// -----------------------------\r\napp.get(\"/\", (c) => {\r\n  return c.json({\r\n    success: true,\r\n    status: \"ok\",\r\n    timestamp: new Date().toISOString(),\r\n    version: process.env.NEXT_PUBLIC_APP_VERSION || \"1.0.0\",\r\n  });\r\n});\r\n\r\n// -----------------------------\r\n// Auth middleware (updated to use typed context and set user)\r\n// -----------------------------\r\nconst auth = async (c: Context<AppEnv>, next: () => Promise<any>) => {\r\n  try {\r\n    const authHeader = c.req.header(\"Authorization\");\r\n    console.log(\r\n      `[HONO AUTH] Processing auth for: ${c.req.url}, Auth header present: ${!!authHeader}`\r\n    );\r\n\r\n    if (!authHeader?.startsWith(\"Bearer \")) {\r\n      c.set(\"user\", null); // Ensure user is null if auth fails early\r\n      console.log(\r\n        `[HONO AUTH] Missing or invalid Bearer token format: ${authHeader?.substring(0, 15) || \"undefined\"}`\r\n      );\r\n      throw new HTTPException(401, {\r\n        message: \"Unauthorized: Missing Bearer token\",\r\n      });\r\n    }\r\n\r\n    const token = authHeader.split(\" \")[1];\r\n    console.log(\r\n      `[HONO AUTH] Attempting to validate token with Service Client: ${token.substring(0, 10)}...`\r\n    );\r\n\r\n    // Use the Service Role Client for validating the Bearer token\r\n    const serviceClient = createSupabaseServiceClient();\r\n    const {\r\n      data: { user },\r\n      error,\r\n    } = await serviceClient.auth.getUser(token);\r\n\r\n    if (error || !user) {\r\n      c.set(\"user\", null); // Set user to null on error\r\n      console.error(\"[HONO AUTH] Supabase auth error:\", error);\r\n      throw new HTTPException(401, { message: \"Invalid token\" });\r\n    }\r\n\r\n    // Add user to context\r\n    console.log(\r\n      `[HONO AUTH] Authentication successful for user: ${user.id.substring(0, 8)}...`\r\n    );\r\n    c.set(\"user\", user);\r\n    await next(); // Call next *after* setting user\r\n  } catch (error) {\r\n    c.set(\"user\", null); // Ensure user is null if any auth error occurs\r\n    if (error instanceof HTTPException) throw error; // Re-throw known HTTP exceptions\r\n    console.error(\"[HONO AUTH] Unhandled auth middleware error:\", error);\r\n    throw new HTTPException(401, { message: \"Authentication failed\" });\r\n  }\r\n};\r\n\r\n// -----------------------------\r\n// Admin-only middleware for protected routes\r\n// -----------------------------\r\nconst adminOnly = async (c: Context<AppEnv>, next: () => Promise<any>) => {\r\n  try {\r\n    const user = c.get(\"user\");\r\n    // Ensure user was authenticated\r\n    if (!user || !user.id) {\r\n      // Check for user and user.id\r\n      throw new HTTPException(401, {\r\n        message: \"Authentication required, user not found or ID missing\",\r\n      });\r\n    }\r\n\r\n    // Call the authoritative server action to check admin status\r\n    const isActuallyAdmin = await verifyUserIsAdmin(user.id);\r\n\r\n    if (!isActuallyAdmin) {\r\n      throw new HTTPException(403, {\r\n        message: \"Forbidden: Admin access required\",\r\n      });\r\n    }\r\n\r\n    await next();\r\n  } catch (error) {\r\n    if (error instanceof HTTPException) throw error;\r\n    console.error(\"Admin middleware error:\", error);\r\n    // Ensure user.id is available for logging if user exists\r\n    const userIdForLog = c.get(\"user\")?.id || \"unknown_user\";\r\n    console.error(`Admin middleware error for user: ${userIdForLog}`, error);\r\n    throw new HTTPException(500, {\r\n      // Changed to 500 for unexpected errors\r\n      message: \"Admin access verification failed due to an internal error\",\r\n    });\r\n  }\r\n};\r\n\r\n// -----------------------------\r\n// Apply route-specific rate limiting\r\n// -----------------------------\r\n// Rate limit documents endpoints\r\napp.use(\r\n  \"/documents/*\",\r\n  subscriptionRateLimit({\r\n    resourceType: ResourceType.API,\r\n    errorMessage: \"You have exceeded your documents API request limit.\",\r\n  })\r\n);\r\n\r\n// Apply special rate limits to scraping features\r\napp.use(\r\n  \"/scrape/*\",\r\n  subscriptionRateLimit({\r\n    resourceType: ResourceType.SCRAPING,\r\n    errorMessage: \"You have exceeded your web scraping request limit.\",\r\n  })\r\n);\r\n\r\n// Apply special rate limits to vector operations (embeddings, etc.)\r\napp.use(\r\n  \"/vectors/*\",\r\n  subscriptionRateLimit({\r\n    resourceType: ResourceType.VECTOR,\r\n    errorMessage: \"You have exceeded your vector operations request limit.\",\r\n  })\r\n);\r\n\r\n// Apply special rate limits to research and AI features\r\napp.use(\r\n  \"/research/*\",\r\n  subscriptionRateLimit({\r\n    resourceType: ResourceType.RESEARCH,\r\n    errorMessage: \"You have exceeded your research and AI request limit.\",\r\n  })\r\n);\r\n\r\n// Chat API also consumes research tokens\r\napp.use(\r\n  \"/chat/*\",\r\n  subscriptionRateLimit({\r\n    resourceType: ResourceType.RESEARCH,\r\n    errorMessage: \"You have exceeded your chat API request limit.\",\r\n  })\r\n);\r\n\r\n// -----------------------------\r\n// Protected API routes\r\n// -----------------------------\r\n// Add protected routes that require authentication\r\napp.use(\"/auth/*\", auth);\r\napp.use(\"/documents/*\", auth);\r\napp.use(\"/profile/*\", auth);\r\napp.use(\"/immigration/*\", auth);\r\napp.use(\"/cases/*\", auth);\r\napp.use(\"/chat/*\", auth);\r\napp.use(\"/subscription/*\", auth);\r\n\r\n// Add admin-only routes\r\napp.use(\"/admin/*\", auth, adminOnly);\r\n\r\n// -----------------------------\r\n// Set up all route handlers\r\n// -----------------------------\r\n\r\n// Cast app to any to bypass the type checking for route setup functions\r\n// The route setup functions expect a different environment type\r\nsetupAdminRoutes(app as any);\r\nsetupAuthRoutes(app as any);\r\nsetupCaseRoutes(app as any);\r\nsetupDocumentRoutes(app as any);\r\nsetupImmigrationRoutes(app as any);\r\nsetupProfileRoutes(app as any);\r\nsetupSubscriptionRoutes(app as any);\r\n\r\n// Mount the new User routes\r\n// The app.route('/api/users', setupUserRoutes(app)) pattern is common\r\n// or app.route('/users', userRoutesInstance)\r\n// Given setupUserRoutes takes app and returns a Hono instance,\r\n// we can use app.route directly if setupUserRoutes is modified to return the router,\r\n// or mount it if setupUserRoutes directly adds routes to the passed app instance.\r\n// My created setupUserRoutes returns a Hono instance, so we use app.route.\r\nconst userRoutes = setupUserRoutes(app); // This passes the main app for context types, but returns a new Hono sub-router\r\napp.route(\"/users\", userRoutes);\r\n\r\n// Export the Vercel-compatible handler\r\nexport const GET = handle(app);\r\nexport const POST = handle(app);\r\nexport const PUT = handle(app);\r\nexport const DELETE = handle(app);\r\nexport const PATCH = handle(app);\r\nexport const OPTIONS = handle(app);\r\n","import * as origModule from 'next/dist/server/app-render/work-unit-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport {} from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nimport * as Sentry from '@sentry/nextjs';\n\n// @ts-expect-error Because we cannot be sure if the RequestAsyncStorage module exists (it is not part of the Next.js public\n// API) we use a shim if it doesn't exist. The logic for this is in the wrapping loader.\n\nconst asyncStorageModule = { ...origModule } ;\n\nconst requestAsyncStorage =\n  'workUnitAsyncStorage' in asyncStorageModule\n    ? asyncStorageModule.workUnitAsyncStorage\n    : 'requestAsyncStorage' in asyncStorageModule\n      ? asyncStorageModule.requestAsyncStorage\n      : undefined;\n\nfunction wrapHandler(handler, method) {\n  // Running the instrumentation code during the build phase will mark any function as \"dynamic\" because we're accessing\n  // the Request object. We do not want to turn handlers dynamic so we skip instrumentation in the build phase.\n  if (process.env.NEXT_PHASE === 'phase-production-build') {\n    return handler;\n  }\n\n  if (typeof handler !== 'function') {\n    return handler;\n  }\n\n  return new Proxy(handler, {\n    apply: (originalFunction, thisArg, args) => {\n      let headers = undefined;\n\n      // We try-catch here just in case the API around `requestAsyncStorage` changes unexpectedly since it is not public API\n      try {\n        const requestAsyncStore = requestAsyncStorage?.getStore() ;\n        headers = requestAsyncStore?.headers;\n      } catch (e) {\n        /** empty */\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return Sentry.wrapRouteHandlerWithSentry(originalFunction , {\n        method,\n        parameterizedRoute: '/api/[[...route]]',\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst GET = wrapHandler(serverComponentModule.GET , 'GET');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst POST = wrapHandler(serverComponentModule.POST , 'POST');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PUT = wrapHandler(serverComponentModule.PUT , 'PUT');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PATCH = wrapHandler(serverComponentModule.PATCH , 'PATCH');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst DELETE = wrapHandler(serverComponentModule.DELETE , 'DELETE');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst HEAD = wrapHandler(serverComponentModule.HEAD , 'HEAD');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst OPTIONS = wrapHandler(serverComponentModule.OPTIONS , 'OPTIONS');\n\nexport { DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT };\n","module.exports = require(\"node:path\");","module.exports = require(\"node:net\");","\"use strict\";var e=require(\"intl-messageformat\"),t=require(\"react\"),r=require(\"./initializeConfig-AbYTngyP.js\");function n(e){return e&&e.__esModule?e:{default:e}}var o=n(e);function a(e,t,r){return(t=function(e){var t=function(e,t){if(\"object\"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||\"default\");if(\"object\"!=typeof n)return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===t?String:Number)(e)}(e,\"string\");return\"symbol\"==typeof t?t:t+\"\"}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let i=function(e){return e.MISSING_MESSAGE=\"MISSING_MESSAGE\",e.MISSING_FORMAT=\"MISSING_FORMAT\",e.ENVIRONMENT_FALLBACK=\"ENVIRONMENT_FALLBACK\",e.INSUFFICIENT_PATH=\"INSUFFICIENT_PATH\",e.INVALID_MESSAGE=\"INVALID_MESSAGE\",e.INVALID_KEY=\"INVALID_KEY\",e.FORMATTING_ERROR=\"FORMATTING_ERROR\",e}({});class s extends Error{constructor(e,t){let r=e;t&&(r+=\": \"+t),super(r),a(this,\"code\",void 0),a(this,\"originalMessage\",void 0),this.code=e,t&&(this.originalMessage=t)}}function u(e,t){return e?Object.keys(e).reduce(((r,n)=>(r[n]={timeZone:t,...e[n]},r)),{}):e}function c(e,t,n,o){const a=r.joinPath(o,n);if(!t)throw new Error(a);let i=t;return n.split(\".\").forEach((t=>{const r=i[t];if(null==t||null==r)throw new Error(a+\" (\".concat(e,\")\"));i=r})),i}const l=60,m=60*l,f=24*m,g=7*f,E=f*(365/12),d=3*E,I=365*f,S={second:1,seconds:1,minute:l,minutes:l,hour:m,hours:m,day:f,days:f,week:g,weeks:g,month:E,months:E,quarter:d,quarters:d,year:I,years:I};exports.IntlError=s,exports.IntlErrorCode=i,exports.createBaseTranslator=function(e){const n=function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.defaultOnError;try{if(!t)throw new Error(void 0);const r=n?c(e,t,n):t;if(!r)throw new Error(n);return r}catch(e){const t=new s(i.MISSING_MESSAGE,e.message);return o(t),t}}(e.locale,e.messages,e.namespace,e.onError);return function(e){let{cache:n,defaultTranslationValues:a,formats:l,formatters:m,getMessageFallback:f=r.defaultGetMessageFallback,locale:g,messagesOrError:E,namespace:d,onError:I,timeZone:S}=e;const y=E instanceof s;function T(e,t,r){const n=new s(t,r);return I(n),f({error:n,key:e,namespace:d})}function h(e,s,I){if(y)return f({error:E,key:e,namespace:d});const h=E;let M,N;try{M=c(g,h,e,d)}catch(t){return T(e,i.MISSING_MESSAGE,t.message)}if(\"object\"==typeof M){let t,r;return t=Array.isArray(M)?i.INVALID_MESSAGE:i.INSUFFICIENT_PATH,T(e,t,r)}const A=function(e,t){if(t)return;const r=e.replace(/'([{}])/gi,\"$1\");return/<|{/.test(r)?void 0:r}(M,s);if(A)return A;m.getMessageFormat||(m.getMessageFormat=function(e,t){const n=r.memoFn((function(){return new o.default(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],{formatters:t,...arguments.length<=3?void 0:arguments[3]})}),e.message);return n}(n,m));try{N=m.getMessageFormat(M,g,function(e,t){const r=t?{...e,dateTime:u(e.dateTime,t)}:e,n=o.default.formats.date,a=t?u(n,t):n,i=o.default.formats.time,s=t?u(i,t):i;return{...r,date:{...a,...r.dateTime},time:{...s,...r.dateTime}}}({...l,...I},S),{formatters:{...m,getDateTimeFormat:(e,t)=>m.getDateTimeFormat(e,{timeZone:S,...t})}})}catch(t){const r=t;return T(e,i.INVALID_MESSAGE,r.message)}try{const e=N.format(function(e){if(0===Object.keys(e).length)return;const r={};return Object.keys(e).forEach((n=>{let o=0;const a=e[n];let i;i=\"function\"==typeof a?e=>{const r=a(e);return t.isValidElement(r)?t.cloneElement(r,{key:n+o++}):r}:a,r[n]=i})),r}({...a,...s}));if(null==e)throw new Error(void 0);return t.isValidElement(e)||Array.isArray(e)||\"string\"==typeof e?e:String(e)}catch(t){return T(e,i.FORMATTING_ERROR,t.message)}}function M(e,t,r){const n=h(e,t,r);return\"string\"!=typeof n?T(e,i.INVALID_MESSAGE,void 0):n}return M.rich=h,M.markup=(e,t,r)=>{const n=h(e,t,r);if(\"string\"!=typeof n){const t=new s(i.FORMATTING_ERROR,void 0);return I(t),f({error:t,key:e,namespace:d})}return n},M.raw=e=>{if(y)return f({error:E,key:e,namespace:d});const t=E;try{return c(g,t,e,d)}catch(t){return T(e,i.MISSING_MESSAGE,t.message)}},M.has=e=>{if(y)return!1;try{return c(g,E,e,d),!0}catch(e){return!1}},M}({...e,messagesOrError:n})},exports.createFormatter=function(e){let{_cache:t=r.createCache(),_formatters:n=r.createIntlFormatters(t),formats:o,locale:a,now:u,onError:c=r.defaultOnError,timeZone:d}=e;function y(e){var t;return null!==(t=e)&&void 0!==t&&t.timeZone||(d?e={...e,timeZone:d}:c(new s(i.ENVIRONMENT_FALLBACK,void 0))),e}function T(e,t,r,n){let o;try{o=function(e,t){let r;if(\"string\"==typeof t){if(r=null==e?void 0:e[t],!r){const e=new s(i.MISSING_FORMAT,void 0);throw c(e),e}}else r=t;return r}(t,e)}catch(e){return n()}try{return r(o)}catch(e){return c(new s(i.FORMATTING_ERROR,e.message)),n()}}function h(e,t){return T(t,null==o?void 0:o.dateTime,(t=>(t=y(t),n.getDateTimeFormat(a,t).format(e))),(()=>String(e)))}function M(){return u||(c(new s(i.ENVIRONMENT_FALLBACK,void 0)),new Date)}return{dateTime:h,number:function(e,t){return T(t,null==o?void 0:o.number,(t=>n.getNumberFormat(a,t).format(e)),(()=>String(e)))},relativeTime:function(e,t){try{let r,o;const i={};t instanceof Date||\"number\"==typeof t?r=new Date(t):t&&(r=null!=t.now?new Date(t.now):M(),o=t.unit,i.style=t.style,i.numberingSystem=t.numberingSystem),r||(r=M());const s=(new Date(e).getTime()-r.getTime())/1e3;o||(o=function(e){const t=Math.abs(e);return t<l?\"second\":t<m?\"minute\":t<f?\"hour\":t<g?\"day\":t<E?\"week\":t<I?\"month\":\"year\"}(s)),i.numeric=\"second\"===o?\"auto\":\"always\";const u=function(e,t){return Math.round(e/S[t])}(s,o);return n.getRelativeTimeFormat(a,i).format(u,o)}catch(t){return c(new s(i.FORMATTING_ERROR,t.message)),String(e)}},list:function(e,t){const r=[],i=new Map;let s=0;for(const t of e){let e;\"object\"==typeof t?(e=String(s),i.set(e,t)):e=String(t),r.push(e),s++}return T(t,null==o?void 0:o.list,(e=>{const t=n.getListFormat(a,e).formatToParts(r).map((e=>\"literal\"===e.type?e.value:i.get(e.value)||e.value));return i.size>0?t:t.join(\"\")}),(()=>String(e)))},dateTimeRange:function(e,t,r){return T(r,null==o?void 0:o.dateTime,(r=>(r=y(r),n.getDateTimeFormat(a,r).formatRange(e,t))),(()=>[h(e),h(t)].join(\"\")))}}},exports.resolveNamespace=function(e,t){return e===t?void 0:e.slice((t+\".\").length)};\n","module.exports = require(\"node:crypto\");","function n(n){return function(n){return\"object\"==typeof n?null==n.host&&null==n.hostname:!/^[a-z]+:/i.test(n)}(n)&&!function(n){const t=\"object\"==typeof n?n.pathname:n;return null!=t&&!t.startsWith(\"/\")}(n)}function t(t,r){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,o=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;if(!n(t))return t;const f=r!==u,l=i(c,o);return(f||l)&&null!=c?e(t,c):t}function e(n,t){let e;return\"string\"==typeof n?e=u(t,n):(e={...n},n.pathname&&(e.pathname=u(t,n.pathname))),e}function r(n,t){return n.replace(new RegExp(\"^\".concat(t)),\"\")||\"/\"}function u(n,t){let e=n;return/^\\/(\\?.*)?$/.test(t)&&(t=t.slice(1)),e+=t,e}function i(n,t){return t===n||t.startsWith(\"\".concat(n,\"/\"))}function o(n){const t=function(){try{return\"true\"===process.env._next_intl_trailing_slash}catch(n){return!1}}();if(\"/\"!==n){const e=n.endsWith(\"/\");t&&!e?n+=\"/\":!t&&e&&(n=n.slice(0,-1))}return n}function c(n,t){const e=o(n),r=o(t);return s(e).test(r)}function f(n,t){var e;return\"never\"!==t.mode&&(null===(e=t.prefixes)||void 0===e?void 0:e[n])||l(n)}function l(n){return\"/\"+n}function s(n){const t=n.replace(/\\[\\[(\\.\\.\\.[^\\]]+)\\]\\]/g,\"?(.*)\").replace(/\\[(\\.\\.\\.[^\\]]+)\\]/g,\"(.+)\").replace(/\\[([^\\]]+)\\]/g,\"([^/]+)\");return new RegExp(\"^\".concat(t,\"$\"))}function a(n){return n.includes(\"[[...\")}function p(n){return n.includes(\"[...\")}function h(n){return n.includes(\"[\")}function g(n,t){const e=n.split(\"/\"),r=t.split(\"/\"),u=Math.max(e.length,r.length);for(let n=0;n<u;n++){const t=e[n],u=r[n];if(!t&&u)return-1;if(t&&!u)return 1;if(t||u){if(!h(t)&&h(u))return-1;if(h(t)&&!h(u))return 1;if(!p(t)&&p(u))return-1;if(p(t)&&!p(u))return 1;if(!a(t)&&a(u))return-1;if(a(t)&&!a(u))return 1}}return 0}function d(n){return n.sort(g)}function v(n){return\"function\"==typeof n.then}export{l as getLocaleAsPrefix,f as getLocalePrefix,d as getSortedPathnames,i as hasPathnamePrefixed,n as isLocalizableHref,v as isPromise,t as localizeHref,c as matchesPathname,o as normalizeTrailingSlash,e as prefixHref,u as prefixPathname,s as templateToRegex,r as unprefixPathname};\n","\"use client\";\nimport{extends as e}from\"../../_virtual/_rollupPluginBabelHelpers.js\";import{usePathname as o}from\"next/navigation\";import r,{forwardRef as l,useState as t,useEffect as i}from\"react\";import a from\"../../react-client/useLocale.js\";import{isLocalizableHref as n,prefixHref as s,localizeHref as m}from\"../../shared/utils.js\";import c from\"./BaseLink.js\";function f(l,f){let{href:p,locale:u,localeCookie:d,localePrefixMode:x,prefix:j,...k}=l;const h=o(),v=a(),C=u!==v,[L,g]=t((()=>n(p)&&(\"never\"!==x||C)?s(p,j):p));return i((()=>{h&&g(m(p,u,v,h,j))}),[v,p,u,h,j]),r.createElement(c,e({ref:f,href:L,locale:u,localeCookie:d},k))}const p=l(f);p.displayName=\"ClientLink\";export{p as default};\n","module.exports = require(\"buffer\");","module.exports = require(\"url\");","module.exports = require(\"child_process\");","module.exports = require(\"node:readline\");","module.exports = require(\"http\");","module.exports = require(\"tty\");","module.exports = require(\"async_hooks\");","module.exports = import(\"ai\");;","module.exports = require(\"node:inspector\");","import { SupabaseClient } from \"@supabase/supabase-js\";\r\n\r\nimport { Case } from \"@/types/cases\";\r\nimport { Database } from \"@/types/database.types\";\r\nimport { DomainMapper, DBCaseRow, CaseDomain } from \"@/types/domain-mappings\";\r\n\r\nimport { BaseRepository } from \"./base-repository\";\r\n\r\n// Define the database record type for Cases\r\nexport type CaseRecord = DBCaseRow; // Use domain mapping type\r\n\r\n// Define missing types that aren't in the Database definition\r\nexport interface CaseMessage {\r\n  id: string;\r\n  case_id: string;\r\n  user_id: string;\r\n  content: string;\r\n  is_system_message: boolean;\r\n  created_at: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\n// Augment document type with missing fields\r\nexport type DocumentWithCaseId =\r\n  Database[\"public\"][\"Tables\"][\"documents\"][\"Row\"] & {\r\n    case_id?: string | null;\r\n  };\r\n\r\n/**\r\n * Repository for Case entities\r\n */\r\nexport class CaseRepository extends BaseRepository<CaseRecord, string> {\r\n  constructor() {\r\n    super(\"cases\");\r\n  }\r\n\r\n  /**\r\n   * Get all cases for a specific user (as client or assigned)\r\n   */\r\n  async getByUserId(\r\n    userId: string,\r\n    options: {\r\n      includeAssigned?: boolean;\r\n      status?: string[];\r\n      limit?: number;\r\n      offset?: number;\r\n    } = {}\r\n  ): Promise<CaseRecord[]> {\r\n    const client = await this.getClient();\r\n\r\n    let query = client.from(this.tableName).select(\"*\");\r\n\r\n    if (options.includeAssigned) {\r\n      // Include cases where user is client or is assigned to the case\r\n      query = query.or(\r\n        `client_id.eq.${userId},assignments->contain->${userId}`\r\n      );\r\n    } else {\r\n      // Only include cases where user is the client\r\n      query = query.eq(\"client_id\", userId);\r\n    }\r\n\r\n    // Filter by status if provided\r\n    if (options.status && options.status.length > 0) {\r\n      query = query.in(\"status\", options.status);\r\n    }\r\n\r\n    // Add pagination\r\n    query = query.range(\r\n      options.offset || 0,\r\n      (options.offset || 0) + (options.limit || 10) - 1\r\n    );\r\n\r\n    // Order by updated_at descending (most recent first)\r\n    query = query.order(\"updated_at\", { ascending: false });\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) throw error;\r\n    return data as CaseRecord[];\r\n  }\r\n\r\n  /**\r\n   * Get a case with all related data (documents, messages, etc.)\r\n   */\r\n  async getWithDetails(id: string): Promise<{\r\n    case: CaseRecord;\r\n    documents: DocumentWithCaseId[];\r\n    messages: CaseMessage[];\r\n  } | null> {\r\n    const client = await this.getClient();\r\n\r\n    // Get the case\r\n    const { data: caseData, error: caseError } = await client\r\n      .from(this.tableName)\r\n      .select(\"*\")\r\n      .eq(\"id\", id)\r\n      .single();\r\n\r\n    if (caseError) {\r\n      if (caseError.code === \"PGRST116\") return null; // Record not found\r\n      throw caseError;\r\n    }\r\n\r\n    // Get related documents\r\n    const { data: documents, error: documentsError } = await client\r\n      .from(\"documents\")\r\n      .select(\"*\")\r\n      .eq(\"case_id\", id)\r\n      .order(\"created_at\", { ascending: false });\r\n\r\n    if (documentsError) throw documentsError;\r\n\r\n    // Get case messages/comments\r\n    // Using 'as any' to bypass type checking for table that doesn't exist in type definition\r\n    const { data: messages, error: messagesError } = await (client\r\n      .from(\"case_messages\" as any)\r\n      .select(\"*\")\r\n      .eq(\"case_id\", id)\r\n      .order(\"created_at\", { ascending: false }) as any);\r\n\r\n    if (messagesError) throw messagesError;\r\n\r\n    return {\r\n      case: caseData as CaseRecord,\r\n      documents: (documents || []) as DocumentWithCaseId[],\r\n      messages: (messages || []) as CaseMessage[],\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add a document to a case\r\n   */\r\n  async addDocument(caseId: string, documentId: string): Promise<void> {\r\n    const client = await this.getClient();\r\n\r\n    // Update the document to link it to the case\r\n    // Using 'as any' to bypass type checking for fields that don't exist in type definition\r\n    const { error } = await client\r\n      .from(\"documents\")\r\n      .update({ case_id: caseId } as any)\r\n      .eq(\"id\", documentId);\r\n\r\n    if (error) throw error;\r\n  }\r\n\r\n  /**\r\n   * Remove a document from a case\r\n   */\r\n  async removeDocument(documentId: string): Promise<void> {\r\n    const client = await this.getClient();\r\n\r\n    // Update the document to unlink it from the case\r\n    // Using 'as any' to bypass type checking for fields that don't exist in type definition\r\n    const { error } = await client\r\n      .from(\"documents\")\r\n      .update({ case_id: null } as any)\r\n      .eq(\"id\", documentId);\r\n\r\n    if (error) throw error;\r\n  }\r\n\r\n  /**\r\n   * Add a message to a case\r\n   */\r\n  async addMessage(message: {\r\n    case_id: string;\r\n    user_id: string;\r\n    content: string;\r\n    is_system_message?: boolean;\r\n    metadata?: Record<string, any>;\r\n  }): Promise<CaseMessage> {\r\n    const client = await this.getClient();\r\n\r\n    // Using 'as any' to bypass type checking for table that doesn't exist in type definition\r\n    const { data, error } = await (client\r\n      .from(\"case_messages\" as any)\r\n      .insert({\r\n        ...message,\r\n        is_system_message: message.is_system_message || false,\r\n        created_at: new Date().toISOString(),\r\n      })\r\n      .select()\r\n      .single() as any);\r\n\r\n    if (error) throw error;\r\n    return data as CaseMessage;\r\n  }\r\n\r\n  /**\r\n   * Update a case's timeline\r\n   */\r\n  async updateTimeline(id: string, timeline: any[]): Promise<void> {\r\n    const client = await this.getClient();\r\n\r\n    // Using 'as any' to bypass type checking for fields that don't exist in type definition\r\n    const { error } = await client\r\n      .from(this.tableName)\r\n      .update({ timeline } as any)\r\n      .eq(\"id\", id);\r\n\r\n    if (error) throw error;\r\n  }\r\n\r\n  /**\r\n   * Assign a user to a case\r\n   */\r\n  async assignUser(\r\n    caseId: string,\r\n    userId: string,\r\n    role: string\r\n  ): Promise<void> {\r\n    const client = await this.getClient();\r\n\r\n    // First, get the current case to access its assignments\r\n    const { data: caseData, error: caseError } = await client\r\n      .from(this.tableName)\r\n      .select(\"assignments\")\r\n      .eq(\"id\", caseId)\r\n      .single();\r\n\r\n    if (caseError) throw caseError;\r\n\r\n    // Update assignments - use type assertion to work with the data\r\n    const currentAssignments = (caseData as any).assignments || [];\r\n\r\n    // Check if user is already assigned with this role\r\n    const existingAssignmentIndex = currentAssignments.findIndex(\r\n      (a: any) => a.userId === userId && a.role === role\r\n    );\r\n\r\n    if (existingAssignmentIndex >= 0) {\r\n      // User already has this assignment, no update needed\r\n      return;\r\n    }\r\n\r\n    // Remove any existing assignment for this user (to prevent duplicates)\r\n    const filteredAssignments = currentAssignments.filter(\r\n      (a: any) => a.userId !== userId\r\n    );\r\n\r\n    // Add the new assignment\r\n    const newAssignments = [\r\n      ...filteredAssignments,\r\n      {\r\n        userId,\r\n        role,\r\n        assignedAt: new Date().toISOString(),\r\n        assignedBy: \"system\", // This should be parameterized in a real implementation\r\n      },\r\n    ];\r\n\r\n    // Update the case\r\n    const { error: updateError } = await client\r\n      .from(this.tableName)\r\n      .update({ assignments: newAssignments } as any)\r\n      .eq(\"id\", caseId);\r\n\r\n    if (updateError) throw updateError;\r\n  }\r\n\r\n  /**\r\n   * Remove a user assignment from a case\r\n   */\r\n  async removeAssignment(caseId: string, userId: string): Promise<void> {\r\n    const client = await this.getClient();\r\n\r\n    // First, get the current case to access its assignments\r\n    const { data: caseData, error: caseError } = await client\r\n      .from(this.tableName)\r\n      .select(\"assignments\")\r\n      .eq(\"id\", caseId)\r\n      .single();\r\n\r\n    if (caseError) throw caseError;\r\n\r\n    // Update assignments - use type assertion to work with the data\r\n    const currentAssignments = (caseData as any).assignments || [];\r\n\r\n    // Remove assignment for this user\r\n    const newAssignments = currentAssignments.filter(\r\n      (a: any) => a.userId !== userId\r\n    );\r\n\r\n    // If no change, return early\r\n    if (newAssignments.length === currentAssignments.length) {\r\n      return;\r\n    }\r\n\r\n    // Update the case\r\n    const { error: updateError } = await client\r\n      .from(this.tableName)\r\n      .update({ assignments: newAssignments } as any)\r\n      .eq(\"id\", caseId);\r\n\r\n    if (updateError) throw updateError;\r\n  }\r\n\r\n  /**\r\n   * Check if a user has access to a case\r\n   */\r\n  async userHasAccess(\r\n    caseId: string,\r\n    userId: string,\r\n    roles?: string[]\r\n  ): Promise<boolean> {\r\n    const client = await this.getClient();\r\n\r\n    // Get the case\r\n    const { data: caseData, error } = await client\r\n      .from(this.tableName)\r\n      .select(\"client_id, assignments\")\r\n      .eq(\"id\", caseId)\r\n      .single();\r\n\r\n    if (error) {\r\n      if (error.code === \"PGRST116\") return false; // Case not found\r\n      throw error;\r\n    }\r\n\r\n    // Use type assertion to work with the fields\r\n    const typedCaseData = caseData as any;\r\n\r\n    // Check if user is the client\r\n    if (typedCaseData.client_id === userId) {\r\n      // If roles are specified, check if 'client' is included\r\n      return !roles || roles.includes(\"client\");\r\n    }\r\n\r\n    // Check if user has an assignment\r\n    const assignments = typedCaseData.assignments || [];\r\n    const userAssignment = assignments.find((a: any) => a.userId === userId);\r\n\r\n    if (!userAssignment) {\r\n      return false;\r\n    }\r\n\r\n    // If roles are specified, check if user's role is included\r\n    if (roles && !roles.includes(userAssignment.role)) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get cases by status\r\n   */\r\n  async getByStatus(\r\n    status: string | string[],\r\n    options: {\r\n      limit?: number;\r\n      offset?: number;\r\n    } = {}\r\n  ): Promise<CaseRecord[]> {\r\n    const client = await this.getClient();\r\n\r\n    let query = client.from(this.tableName).select(\"*\");\r\n\r\n    // Filter by status\r\n    if (Array.isArray(status)) {\r\n      query = query.in(\"status\", status);\r\n    } else {\r\n      query = query.eq(\"status\", status);\r\n    }\r\n\r\n    // Add pagination\r\n    query = query.range(\r\n      options.offset || 0,\r\n      (options.offset || 0) + (options.limit || 10) - 1\r\n    );\r\n\r\n    // Order by updated_at descending\r\n    query = query.order(\"updated_at\", { ascending: false });\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) throw error;\r\n    return data as CaseRecord[];\r\n  }\r\n\r\n  /**\r\n   * Convert database record to domain entity\r\n   */\r\n  toDomainEntity(record: CaseRecord): Case {\r\n    // CaseRow (aliaed as CaseRecord) is extended by the Case interface.\r\n    // A direct cast should be safe if all additional Case props are optional or handled by consumers.\r\n    return record as Case;\r\n  }\r\n\r\n  /**\r\n   * Convert database record to domain mapping format\r\n   */\r\n  toCaseDomain(record: CaseRecord): CaseDomain {\r\n    return DomainMapper.toCaseDomain(record);\r\n  }\r\n\r\n  /**\r\n   * Prepare case domain entity for database storage\r\n   */\r\n  fromCaseDomain(domain: CaseDomain): Partial<CaseRecord> {\r\n    return DomainMapper.fromCaseDomain(domain);\r\n  }\r\n}\r\n","import { createSupabaseServiceClient } from \"@/lib/supabase/server\";\r\nimport type { Document } from \"@/types/domain/documents\";\r\nimport { Database } from \"@/types/database.types\";\r\nimport { SupabaseClient } from \"@supabase/supabase-js\";\r\nimport {\r\n  DomainMapper,\r\n  DBDocumentRow,\r\n  DocumentDomain,\r\n} from \"@/types/domain-mappings\";\r\n\r\n/**\r\n * Database record structure directly from Supabase\r\n */\r\nexport type DocumentRecord = DBDocumentRow; // Alias for compatibility\r\nexport type DocumentInsert =\r\n  Database[\"public\"][\"Tables\"][\"documents\"][\"Insert\"];\r\nexport type DocumentUpdate =\r\n  Database[\"public\"][\"Tables\"][\"documents\"][\"Update\"];\r\n\r\n/**\r\n * Document access record structure\r\n */\r\nexport interface DocumentAccess {\r\n  userId: string;\r\n  permission: string;\r\n  grantedBy: string;\r\n  expiresAt?: Date;\r\n}\r\n\r\n/**\r\n * Document version record structure\r\n */\r\nexport interface DocumentVersion {\r\n  documentId: string;\r\n  version: number;\r\n  filePath: string;\r\n  fileSize: number;\r\n  fileType: string;\r\n  createdAt: string;\r\n  createdBy: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Structure for document access records from DB\r\n */\r\ninterface DocumentAccessRecord {\r\n  id: string;\r\n  document_id: string;\r\n  user_id: string;\r\n  permission: string;\r\n  granted_by: string;\r\n  granted_at: string;\r\n  expires_at: string | null;\r\n}\r\n\r\n/**\r\n * Structure for document version records from DB\r\n */\r\ninterface DocumentVersionRecord {\r\n  id: string;\r\n  document_id: string;\r\n  version: number;\r\n  file_path: string;\r\n  file_size: number;\r\n  file_type: string;\r\n  created_at: string;\r\n  created_by: string;\r\n  metadata: Record<string, any> | null;\r\n}\r\n\r\n/**\r\n * Configuration options for the document repository\r\n */\r\nexport type DocumentRepositoryOptions = {\r\n  useServiceRole?: boolean;\r\n};\r\n\r\n/**\r\n * Execute SQL statement dynamically\r\n * This is a helper for tables not in the Database type definition\r\n */\r\ntype SqlExecutor = <T>(query: string, values?: any[]) => Promise<T[]>;\r\n\r\n/**\r\n * DocumentRepository provides data access operations for documents\r\n *\r\n * Standalone implementation that doesn't rely on BaseRepository to avoid\r\n * type compatibility issues with tables not in the Supabase schema\r\n */\r\nexport class DocumentRepository {\r\n  private supabase: SupabaseClient<Database> | null = null;\r\n  private readonly tableName = \"documents\";\r\n  private readonly options: DocumentRepositoryOptions;\r\n\r\n  /**\r\n   * Constructor\r\n   */\r\n  constructor(options: DocumentRepositoryOptions = {}) {\r\n    this.options = options;\r\n  }\r\n\r\n  /**\r\n   * Get the Supabase client\r\n   */\r\n  private async getClient(): Promise<SupabaseClient<Database>> {\r\n    if (this.supabase === null) {\r\n      this.supabase = createSupabaseServiceClient();\r\n    }\r\n    return this.supabase;\r\n  }\r\n\r\n  /**\r\n   * Get all documents\r\n   */\r\n  async getAll(\r\n    options: { limit?: number; offset?: number } = {}\r\n  ): Promise<DocumentRecord[]> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(this.tableName)\r\n      .select(\"*\")\r\n      .range(\r\n        options.offset || 0,\r\n        (options.offset || 0) + (options.limit || 100) - 1\r\n      );\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Get a document by ID\r\n   */\r\n  async getById(id: string): Promise<DocumentRecord | null> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(this.tableName)\r\n      .select(\"*\")\r\n      .eq(\"id\", id)\r\n      .single();\r\n\r\n    if (error) {\r\n      if (error.code === \"PGRST116\") return null; // Record not found\r\n      throw error;\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Create a new document\r\n   */\r\n  async create(data: DocumentInsert): Promise<DocumentRecord> {\r\n    const client = await this.getClient();\r\n    const { data: createdData, error } = await client\r\n      .from(this.tableName)\r\n      .insert(data)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return createdData;\r\n  }\r\n\r\n  /**\r\n   * Update a document\r\n   */\r\n  async update(id: string, data: DocumentUpdate): Promise<DocumentRecord> {\r\n    const client = await this.getClient();\r\n    const { data: updatedData, error } = await client\r\n      .from(this.tableName)\r\n      .update(data)\r\n      .eq(\"id\", id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return updatedData;\r\n  }\r\n\r\n  /**\r\n   * Delete a document\r\n   */\r\n  async delete(id: string): Promise<boolean> {\r\n    const client = await this.getClient();\r\n    const { error } = await client.from(this.tableName).delete().eq(\"id\", id);\r\n\r\n    if (error) throw error;\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Execute a raw SQL query safely\r\n   * Used for accessing tables that aren't in the Database type\r\n   */\r\n  private async executeSql<T>(sql: string, values?: any[]): Promise<T[]> {\r\n    const client = await this.getClient();\r\n    // Using any type assertion here since we're working with tables outside the schema\r\n    try {\r\n      const { data, error } = await (client as any).rpc(\"execute_sql\", {\r\n        query: sql,\r\n        params: values || [],\r\n      });\r\n\r\n      if (error) throw error;\r\n      return (data || []) as T[];\r\n    } catch (error) {\r\n      console.error(\"Error executing SQL:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all documents for a user with various filtering options\r\n   */\r\n  async getByUserId(\r\n    userId: string,\r\n    options?: {\r\n      type?: string[];\r\n      status?: string[];\r\n      shared?: boolean;\r\n      limit?: number;\r\n      offset?: number;\r\n      orderBy?: string;\r\n      searchQuery?: string;\r\n    }\r\n  ): Promise<DocumentRecord[]> {\r\n    const client = await this.getClient();\r\n    let query = client\r\n      .from(this.tableName)\r\n      .select(\"*\")\r\n      .or(`user_id.eq.${userId},access->:userId->permission.not.is.null`);\r\n\r\n    // Apply filters\r\n    if (options?.type && options.type.length > 0) {\r\n      query = query.in(\"file_type\", options.type);\r\n    }\r\n\r\n    if (options?.status && options.status.length > 0) {\r\n      query = query.in(\"status\", options.status);\r\n    }\r\n\r\n    // Only get documents owned by the user (exclude shared)\r\n    if (options?.shared === false) {\r\n      query = query.eq(\"user_id\", userId);\r\n    }\r\n\r\n    // Only get documents shared with the user (exclude owned)\r\n    if (options?.shared === true) {\r\n      query = query.neq(\"user_id\", userId);\r\n    }\r\n\r\n    // Search by name or filename\r\n    if (options?.searchQuery) {\r\n      query = query.or(`filename.ilike.%${options.searchQuery}%`);\r\n    }\r\n\r\n    // Apply ordering\r\n    if (options?.orderBy) {\r\n      const [field, direction] = options.orderBy.split(\":\");\r\n\r\n      // Map camelCase field names to snake_case database column names\r\n      const fieldMapping: Record<string, string> = {\r\n        createdAt: \"created_at\",\r\n        updatedAt: \"updated_at\",\r\n        userId: \"user_id\",\r\n        fileName: \"filename\",\r\n        filePath: \"file_path\",\r\n        fileSize: \"file_size\",\r\n        fileType: \"file_type\",\r\n      };\r\n\r\n      const dbField = fieldMapping[field] || field;\r\n      query = query.order(dbField, { ascending: direction !== \"desc\" });\r\n    } else {\r\n      query = query.order(\"updated_at\", { ascending: false });\r\n    }\r\n\r\n    // Apply pagination\r\n    if (options?.limit) {\r\n      query = query.limit(options.limit);\r\n    }\r\n\r\n    if (options?.offset) {\r\n      query = query.range(\r\n        options.offset,\r\n        options.offset + (options.limit || 10) - 1\r\n      );\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error(\"Error fetching documents by user ID:\", error);\r\n      throw new Error(`Failed to fetch documents: ${error.message}`);\r\n    }\r\n\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Get a document with its versions and access records\r\n   */\r\n  async getWithDetails(documentId: string): Promise<{\r\n    document: DocumentRecord;\r\n    versions: DocumentVersionRecord[];\r\n    access: DocumentAccessRecord[];\r\n  } | null> {\r\n    const client = await this.getClient();\r\n\r\n    // Fetch document\r\n    const { data: document, error: documentError } = await client\r\n      .from(this.tableName)\r\n      .select(\"*\")\r\n      .eq(\"id\", documentId)\r\n      .single();\r\n\r\n    if (documentError || !document) {\r\n      console.error(\"Error fetching document:\", documentError);\r\n      return null;\r\n    }\r\n\r\n    // Fetch versions using SQL\r\n    let versions: DocumentVersionRecord[] = [];\r\n    try {\r\n      const versionsSql = `\r\n        SELECT * FROM document_versions \r\n        WHERE document_id = $1\r\n        ORDER BY created_at DESC\r\n      `;\r\n      versions = await this.executeSql<DocumentVersionRecord>(versionsSql, [\r\n        documentId,\r\n      ]);\r\n    } catch (error) {\r\n      console.error(\"Error fetching document versions:\", error);\r\n    }\r\n\r\n    // Fetch access records using SQL\r\n    let access: DocumentAccessRecord[] = [];\r\n    try {\r\n      const accessSql = `\r\n        SELECT * FROM document_access\r\n        WHERE document_id = $1\r\n      `;\r\n      access = await this.executeSql<DocumentAccessRecord>(accessSql, [\r\n        documentId,\r\n      ]);\r\n    } catch (error) {\r\n      console.error(\"Error fetching document access records:\", error);\r\n    }\r\n\r\n    return {\r\n      document,\r\n      versions,\r\n      access,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add a new version to a document\r\n   */\r\n  async addVersion(\r\n    documentId: string,\r\n    version: Omit<DocumentVersion, \"documentId\">\r\n  ): Promise<DocumentVersionRecord | { document_id: string }> {\r\n    const client = await this.getClient();\r\n\r\n    try {\r\n      // Execute SQL to insert version\r\n      const versionSql = `\r\n        INSERT INTO document_versions (\r\n          document_id, version, file_path, file_size, \r\n          file_type, created_by, created_at, metadata\r\n        ) VALUES (\r\n          $1, $2, $3, $4, $5, $6, $7, $8\r\n        )\r\n        RETURNING *\r\n      `;\r\n\r\n      const createdAt = new Date().toISOString();\r\n      const results = await this.executeSql<DocumentVersionRecord>(versionSql, [\r\n        documentId,\r\n        version.version,\r\n        version.filePath,\r\n        version.fileSize,\r\n        version.fileType,\r\n        version.createdBy,\r\n        createdAt,\r\n        JSON.stringify(version.metadata || {}),\r\n      ]);\r\n\r\n      // Update the document's updated_at timestamp\r\n      await client\r\n        .from(this.tableName)\r\n        .update({ updated_at: createdAt })\r\n        .eq(\"id\", documentId);\r\n\r\n      return results[0] || { document_id: documentId };\r\n    } catch (error) {\r\n      console.error(\"Error adding document version:\", error);\r\n\r\n      // Update the document's updated_at timestamp anyway\r\n      await client\r\n        .from(this.tableName)\r\n        .update({ updated_at: new Date().toISOString() })\r\n        .eq(\"id\", documentId);\r\n\r\n      // Return a minimal object with the document_id\r\n      return { document_id: documentId };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Grant access to a document\r\n   */\r\n  async grantAccess(\r\n    documentId: string,\r\n    access: Omit<DocumentAccess, \"documentId\">\r\n  ): Promise<\r\n    | DocumentAccessRecord\r\n    | { document_id: string; user_id: string; permission: string }\r\n  > {\r\n    const client = await this.getClient();\r\n\r\n    try {\r\n      // Check if access record exists\r\n      const checkSql = `\r\n        SELECT id FROM document_access\r\n        WHERE document_id = $1 AND user_id = $2\r\n      `;\r\n\r\n      const existingRecords = await this.executeSql<{ id: string }>(checkSql, [\r\n        documentId,\r\n        access.userId,\r\n      ]);\r\n\r\n      let result: DocumentAccessRecord | null = null;\r\n      const now = new Date().toISOString();\r\n\r\n      if (existingRecords.length > 0) {\r\n        // Update existing record\r\n        const updateSql = `\r\n          UPDATE document_access\r\n          SET \r\n            permission = $3,\r\n            granted_by = $4,\r\n            granted_at = $5,\r\n            expires_at = $6\r\n          WHERE id = $7\r\n          RETURNING *\r\n        `;\r\n\r\n        const updateResults = await this.executeSql<DocumentAccessRecord>(\r\n          updateSql,\r\n          [\r\n            access.permission,\r\n            access.grantedBy,\r\n            now,\r\n            access.expiresAt ? access.expiresAt.toISOString() : null,\r\n            existingRecords[0].id,\r\n          ]\r\n        );\r\n\r\n        if (updateResults.length > 0) {\r\n          result = updateResults[0];\r\n        }\r\n      } else {\r\n        // Insert new record\r\n        const insertSql = `\r\n          INSERT INTO document_access (\r\n            document_id, user_id, permission, \r\n            granted_by, granted_at, expires_at\r\n          ) VALUES (\r\n            $1, $2, $3, $4, $5, $6\r\n          )\r\n          RETURNING *\r\n        `;\r\n\r\n        const insertResults = await this.executeSql<DocumentAccessRecord>(\r\n          insertSql,\r\n          [\r\n            documentId,\r\n            access.userId,\r\n            access.permission,\r\n            access.grantedBy,\r\n            now,\r\n            access.expiresAt ? access.expiresAt.toISOString() : null,\r\n          ]\r\n        );\r\n\r\n        if (insertResults.length > 0) {\r\n          result = insertResults[0];\r\n        }\r\n      }\r\n\r\n      // Update the document's updated_at timestamp\r\n      await client\r\n        .from(this.tableName)\r\n        .update({ updated_at: now })\r\n        .eq(\"id\", documentId);\r\n\r\n      return (\r\n        result || {\r\n          document_id: documentId,\r\n          user_id: access.userId,\r\n          permission: access.permission,\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Error granting document access:\", error);\r\n\r\n      // Update the document's updated_at timestamp anyway\r\n      await client\r\n        .from(this.tableName)\r\n        .update({ updated_at: new Date().toISOString() })\r\n        .eq(\"id\", documentId);\r\n\r\n      // Return minimal information\r\n      return {\r\n        document_id: documentId,\r\n        user_id: access.userId,\r\n        permission: access.permission,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Revoke access to a document\r\n   */\r\n  async revokeAccess(documentId: string, userId: string): Promise<void> {\r\n    const client = await this.getClient();\r\n\r\n    try {\r\n      const deleteSql = `\r\n        DELETE FROM document_access\r\n        WHERE document_id = $1 AND user_id = $2\r\n      `;\r\n\r\n      await this.executeSql(deleteSql, [documentId, userId]);\r\n    } catch (error) {\r\n      console.error(\"Error revoking document access:\", error);\r\n    }\r\n\r\n    // Always update the document's updated_at timestamp\r\n    await client\r\n      .from(this.tableName)\r\n      .update({ updated_at: new Date().toISOString() })\r\n      .eq(\"id\", documentId);\r\n  }\r\n\r\n  /**\r\n   * Add document to a case\r\n   */\r\n  async addToCase(documentId: string, caseId: string): Promise<void> {\r\n    const client = await this.getClient();\r\n    // Get current case IDs from metadata\r\n    const { data: document, error: fetchError } = await client\r\n      .from(this.tableName)\r\n      .select(\"metadata\")\r\n      .eq(\"id\", documentId)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      console.error(\"Error fetching document metadata:\", fetchError);\r\n      throw new Error(\r\n        `Failed to fetch document metadata: ${fetchError.message}`\r\n      );\r\n    }\r\n\r\n    // Add case ID if not already present\r\n    const metadata = (document.metadata as Record<string, any>) || {};\r\n    const caseIds = (metadata.case_ids as string[]) || [];\r\n    if (!caseIds.includes(caseId)) {\r\n      caseIds.push(caseId);\r\n\r\n      // Update metadata\r\n      const updatedMetadata = {\r\n        ...metadata,\r\n        case_ids: caseIds,\r\n      };\r\n\r\n      const { error: updateError } = await client\r\n        .from(this.tableName)\r\n        .update({\r\n          metadata: updatedMetadata,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", documentId);\r\n\r\n      if (updateError) {\r\n        console.error(\"Error adding document to case:\", updateError);\r\n        throw new Error(\r\n          `Failed to add document to case: ${updateError.message}`\r\n        );\r\n      }\r\n\r\n      // Add to case_documents junction table\r\n      try {\r\n        const insertSql = `\r\n          INSERT INTO case_documents (\r\n            case_id, document_id, added_at\r\n          ) VALUES (\r\n            $1, $2, $3\r\n          )\r\n        `;\r\n\r\n        await this.executeSql(insertSql, [\r\n          caseId,\r\n          documentId,\r\n          new Date().toISOString(),\r\n        ]);\r\n      } catch (error) {\r\n        console.error(\"Error updating case_documents:\", error);\r\n        // We don't throw here because the main update already succeeded\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove document from a case\r\n   */\r\n  async removeFromCase(documentId: string, caseId: string): Promise<void> {\r\n    const client = await this.getClient();\r\n    // Get current case IDs from metadata\r\n    const { data: document, error: fetchError } = await client\r\n      .from(this.tableName)\r\n      .select(\"metadata\")\r\n      .eq(\"id\", documentId)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      console.error(\"Error fetching document metadata:\", fetchError);\r\n      throw new Error(\r\n        `Failed to fetch document metadata: ${fetchError.message}`\r\n      );\r\n    }\r\n\r\n    // Remove case ID if present\r\n    const metadata = (document.metadata as Record<string, any>) || {};\r\n    const caseIds = (metadata.case_ids as string[]) || [];\r\n    const updatedCaseIds = caseIds.filter((id) => id !== caseId);\r\n\r\n    if (caseIds.length !== updatedCaseIds.length) {\r\n      // Update metadata\r\n      const updatedMetadata = {\r\n        ...metadata,\r\n        case_ids: updatedCaseIds,\r\n      };\r\n\r\n      const { error: updateError } = await client\r\n        .from(this.tableName)\r\n        .update({\r\n          metadata: updatedMetadata,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", documentId);\r\n\r\n      if (updateError) {\r\n        console.error(\"Error removing document from case:\", updateError);\r\n        throw new Error(\r\n          `Failed to remove document from case: ${updateError.message}`\r\n        );\r\n      }\r\n\r\n      // Remove from case_documents junction table\r\n      try {\r\n        const deleteSql = `\r\n          DELETE FROM case_documents\r\n          WHERE case_id = $1 AND document_id = $2\r\n        `;\r\n\r\n        await this.executeSql(deleteSql, [caseId, documentId]);\r\n      } catch (error) {\r\n        console.error(\"Error updating case_documents:\", error);\r\n        // We don't throw here because the main update already succeeded\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a user has access to a document\r\n   */\r\n  async userHasAccess(\r\n    documentId: string,\r\n    userId: string,\r\n    permission: \"view\" | \"edit\" | \"delete\" | \"admin\" = \"view\"\r\n  ): Promise<boolean> {\r\n    const client = await this.getClient();\r\n\r\n    // First check if user is the owner\r\n    const { data: document, error: documentError } = await client\r\n      .from(this.tableName)\r\n      .select(\"user_id\")\r\n      .eq(\"id\", documentId)\r\n      .single();\r\n\r\n    if (documentError) {\r\n      console.error(\"Error checking document ownership:\", documentError);\r\n      return false;\r\n    }\r\n\r\n    // Owner has all permissions\r\n    if (document.user_id === userId) {\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      // Check access records\r\n      const accessSql = `\r\n        SELECT permission, expires_at\r\n        FROM document_access\r\n        WHERE document_id = $1 AND user_id = $2\r\n      `;\r\n\r\n      const accessRecords = await this.executeSql<{\r\n        permission: string;\r\n        expires_at: string | null;\r\n      }>(accessSql, [documentId, userId]);\r\n\r\n      // No access records\r\n      if (!accessRecords || accessRecords.length === 0) {\r\n        return false;\r\n      }\r\n\r\n      // Check if any access record gives the required permission\r\n      const now = new Date();\r\n      return accessRecords.some((record) => {\r\n        // Check if access has expired\r\n        if (record.expires_at && new Date(record.expires_at) < now) {\r\n          return false;\r\n        }\r\n\r\n        // Admin permission grants all access\r\n        if (record.permission === \"admin\") {\r\n          return true;\r\n        }\r\n\r\n        // Match specific permission\r\n        if (permission === \"view\") {\r\n          // Any permission level grants view access\r\n          return true;\r\n        } else if (permission === \"edit\") {\r\n          // Edit or admin permission grants edit access\r\n          return [\"edit\", \"admin\"].includes(record.permission);\r\n        } else if (permission === \"delete\") {\r\n          // Only delete or admin permission grants delete access\r\n          return [\"delete\", \"admin\"].includes(record.permission);\r\n        }\r\n\r\n        return false;\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error checking document access:\", error);\r\n      // If we can't check access, default to false\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert database record to domain entity\r\n   */\r\n  toDomainEntity(record: DocumentRecord): Document {\r\n    // We need to adapt the Supabase DocumentRecord to our Domain Document\r\n    // This is a mapping function that bridges the database schema with our domain model\r\n    return {\r\n      id: record.id,\r\n      title: record.filename,\r\n      content: record.file_path,\r\n      url: record.file_path,\r\n      country: (record.metadata as any)?.country || \"\",\r\n      category: record.file_type || \"\",\r\n      lastUpdated: record.updated_at || undefined,\r\n      metadata: (record.metadata as Record<string, any>) || {},\r\n      createdAt: record.created_at || new Date().toISOString(),\r\n      updatedAt: record.updated_at || new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Find documents by their content hash\r\n   * Can be used to find duplicate documents\r\n   */\r\n  async findByContentHash(contentHash: string): Promise<DocumentRecord[]> {\r\n    const client = await this.getClient();\r\n\r\n    try {\r\n      // Find document IDs with matching content hash\r\n      const contentHashSql = `\r\n        SELECT document_id\r\n        FROM document_versions\r\n        WHERE metadata->>'contentHash' = $1\r\n      `;\r\n\r\n      const versionData = await this.executeSql<{ document_id: string }>(\r\n        contentHashSql,\r\n        [contentHash]\r\n      );\r\n\r\n      if (!versionData || versionData.length === 0) {\r\n        return [];\r\n      }\r\n\r\n      // Get the actual documents\r\n      const documentIds = versionData.map((v) => v.document_id);\r\n      const { data: documents, error: documentsError } = await client\r\n        .from(this.tableName)\r\n        .select(\"*\")\r\n        .in(\"id\", documentIds);\r\n\r\n      if (documentsError) {\r\n        console.error(\"Error fetching documents by IDs:\", documentsError);\r\n        throw new Error(\r\n          `Failed to fetch documents by IDs: ${documentsError.message}`\r\n        );\r\n      }\r\n\r\n      return documents || [];\r\n    } catch (error) {\r\n      // Handle case where document_versions table might not exist\r\n      console.error(\"Error finding documents by content hash:\", error);\r\n      return [];\r\n    }\r\n  }\r\n}\r\n","import { Database } from \"@/types/database.types\";\r\nimport {\r\n  DomainMapper,\r\n  DBUserProfileRow,\r\n  UserProfileDomain,\r\n} from \"@/types/domain-mappings\";\r\n\r\nimport { BaseRepository } from \"./base-repository\";\r\n\r\n/**\r\n * Type definitions for UserProfile\r\n */\r\nexport type UserProfile = DBUserProfileRow; // Use domain mapping type\r\nexport type UserProfileInsert =\r\n  Database[\"public\"][\"Tables\"][\"profiles\"][\"Insert\"];\r\nexport type UserProfileUpdate =\r\n  Database[\"public\"][\"Tables\"][\"profiles\"][\"Update\"];\r\n\r\n/**\r\n * Type definitions for UserPreferences\r\n */\r\nexport type UserPreferences =\r\n  Database[\"public\"][\"Tables\"][\"user_preferences\"][\"Row\"];\r\nexport type UserPreferencesInsert =\r\n  Database[\"public\"][\"Tables\"][\"user_preferences\"][\"Insert\"];\r\nexport type UserPreferencesUpdate =\r\n  Database[\"public\"][\"Tables\"][\"user_preferences\"][\"Update\"];\r\n\r\n/**\r\n * Repository for user profile operations\r\n */\r\nexport class UserProfileRepository extends BaseRepository<UserProfile> {\r\n  constructor() {\r\n    super(\"profiles\");\r\n  }\r\n\r\n  // Implement the abstract method from BaseRepository\r\n  toDomainEntity(record: UserProfile): UserProfile {\r\n    // Assuming the database record is already in the shape of the domain entity\r\n    return record;\r\n  }\r\n\r\n  /**\r\n   * Convert database record to domain mapping format\r\n   */\r\n  toUserProfileDomain(record: UserProfile): UserProfileDomain {\r\n    return DomainMapper.toUserProfileDomain(record);\r\n  }\r\n\r\n  /**\r\n   * Prepare user profile domain entity for database storage\r\n   */\r\n  fromUserProfileDomain(domain: UserProfileDomain): Partial<UserProfile> {\r\n    return DomainMapper.fromUserProfileDomain(domain);\r\n  }\r\n\r\n  /**\r\n   * Get a profile by user ID\r\n   */\r\n  async getByUserId(userId: string): Promise<UserProfile | null> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(this.tableName)\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .single();\r\n\r\n    if (error) {\r\n      if (error.code === \"PGRST116\") return null; // Record not found\r\n      throw error;\r\n    }\r\n    return data as UserProfile;\r\n  }\r\n\r\n  /**\r\n   * Create or update a user profile\r\n   */\r\n  async upsert(profile: UserProfileInsert): Promise<UserProfile> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(this.tableName)\r\n      .upsert(profile)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data as UserProfile;\r\n  }\r\n\r\n  /**\r\n   * Get user preferences by user ID\r\n   */\r\n  async getPreferences(userId: string): Promise<UserPreferences | null> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(\"user_preferences\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .single();\r\n\r\n    if (error) {\r\n      if (error.code === \"PGRST116\") return null; // Record not found\r\n      throw error;\r\n    }\r\n    return data as UserPreferences;\r\n  }\r\n\r\n  /**\r\n   * Update user theme preference\r\n   */\r\n  async updateTheme(userId: string, theme: string): Promise<UserPreferences> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(\"user_preferences\")\r\n      .update({ theme })\r\n      .eq(\"user_id\", userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data as UserPreferences;\r\n  }\r\n\r\n  /**\r\n   * Update user language/timezone preferences\r\n   */\r\n  async updateLanguage(userId: string, language: string): Promise<UserProfile> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(this.tableName)\r\n      .update({ language })\r\n      .eq(\"user_id\", userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data as UserProfile;\r\n  }\r\n\r\n  /**\r\n   * Update notification settings\r\n   */\r\n  async updateNotificationSettings(\r\n    userId: string,\r\n    settings: {\r\n      emailNotifications?: boolean;\r\n    }\r\n  ): Promise<UserPreferences> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(\"user_preferences\")\r\n      .update({\r\n        notifications_enabled: settings.emailNotifications,\r\n      })\r\n      .eq(\"user_id\", userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data as UserPreferences;\r\n  }\r\n\r\n  /**\r\n   * Update all user preferences at once\r\n   */\r\n  async updatePreferences(\r\n    userId: string,\r\n    preferences: Partial<UserPreferencesUpdate>\r\n  ): Promise<UserPreferences> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(\"user_preferences\")\r\n      .update(preferences)\r\n      .eq(\"user_id\", userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data as UserPreferences;\r\n  }\r\n\r\n  /**\r\n   * Update user avatar URL\r\n   */\r\n  async updateAvatar(userId: string, avatarUrl: string): Promise<UserProfile> {\r\n    const client = await this.getClient();\r\n    const { data, error } = await client\r\n      .from(this.tableName)\r\n      .update({ avatar_url: avatarUrl })\r\n      .eq(\"user_id\", userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data as UserProfile;\r\n  }\r\n}\r\n","/**\r\n * Repository factory module\r\n * Provides singleton access to all repositories\r\n */\r\n\r\nimport { SupabaseClient } from \"@supabase/supabase-js\";\r\nimport { createSupabaseServiceClient } from \"@/lib/supabase/server\";\r\n\r\nimport { Database } from \"@/types/database.types\";\r\n\r\nimport { BaseRepository, type IRepository } from \"./base-repository\";\r\n\r\nimport { CaseRepository } from \"./case-repository\";\r\nimport { ChatRepository } from \"./chat-repository\";\r\nimport { DocumentRepository } from \"./document-repository\";\r\nimport { UserProfileRepository } from \"./user-profile-repository\";\r\n\r\n// Repository singletons\r\nconst userProfileRepository = new UserProfileRepository();\r\nconst documentRepository = new DocumentRepository();\r\nconst caseRepository = new CaseRepository();\r\nconst chatRepository = new ChatRepository();\r\n\r\n/**\r\n * Repository registry to manage all repositories\r\n */\r\nconst repositoryRegistry: Record<string, IRepository<any, any>> = {\r\n  userProfile: userProfileRepository,\r\n  document: documentRepository,\r\n  case: caseRepository,\r\n  chat: chatRepository,\r\n};\r\n\r\n/**\r\n * Repository Factory class\r\n * Provides access to repositories\r\n */\r\nexport class RepositoryFactory {\r\n  private supabase: SupabaseClient<Database>;\r\n  private documentRepository: DocumentRepository | null = null;\r\n  private chatRepository: ChatRepository | null = null;\r\n\r\n  constructor(supabase: SupabaseClient<Database>) {\r\n    this.supabase = supabase;\r\n  }\r\n\r\n  /**\r\n   * Get the UserProfileRepository instance\r\n   */\r\n  getUserProfileRepository(): UserProfileRepository {\r\n    return userProfileRepository;\r\n  }\r\n\r\n  /**\r\n   * Get a document repository instance\r\n   */\r\n  getDocumentRepository(): DocumentRepository {\r\n    if (!this.documentRepository) {\r\n      this.documentRepository = new DocumentRepository();\r\n    }\r\n    return this.documentRepository;\r\n  }\r\n\r\n  /**\r\n   * Get the CaseRepository instance\r\n   */\r\n  getCaseRepository(): CaseRepository {\r\n    return caseRepository;\r\n  }\r\n\r\n  /**\r\n   * Register a custom repository\r\n   */\r\n  registerRepository<T, K = string>(\r\n    name: string,\r\n    repository: BaseRepository<T, K>\r\n  ): void {\r\n    repositoryRegistry[name] = repository;\r\n  }\r\n\r\n  /**\r\n   * Get a repository by name\r\n   */\r\n  getRepository<T extends IRepository<any, any>>(name: string): T {\r\n    const repository = repositoryRegistry[name];\r\n    if (!repository) {\r\n      throw new Error(`Repository \"${name}\" not found`);\r\n    }\r\n    return repository as T;\r\n  }\r\n\r\n  /**\r\n   * Get a chat repository instance\r\n   */\r\n  getChatRepository(): ChatRepository {\r\n    return chatRepository;\r\n  }\r\n}\r\n\r\n// Export a single instance of the repository factory\r\nexport const repositoryFactory = new RepositoryFactory(\r\n  createSupabaseServiceClient()\r\n);\r\n\r\n// Export individual repositories for direct access\r\nexport {\r\n  userProfileRepository,\r\n  documentRepository,\r\n  caseRepository,\r\n  chatRepository,\r\n  UserProfileRepository,\r\n  DocumentRepository,\r\n  CaseRepository,\r\n  ChatRepository,\r\n  BaseRepository,\r\n};\r\n\r\n// Re-export type\r\nexport type { IRepository };\r\n\r\n// Default export\r\nexport default repositoryFactory;\r\n","module.exports = require(\"net\");","module.exports = require(\"events\");","import { zValidator } from \"@hono/zod-validator\";\r\nimport { Hono , Context } from \"hono\";\r\nimport { z } from \"zod\";\r\n\r\nimport type { AppEnv } from \"@/app/api/[[...route]]/route\"; // Import AppEnv\r\nimport { supabase } from \"@/lib/supabase/client\"; // Use main supabase client (check if admin needed)\r\n// Placeholder/Example Tier enum - Adjust based on actual core types\r\n// Might need to import from @/infrastructure/rate-limit/config or core types\r\nenum SubscriptionTier {\r\n  FREE = \"free\",\r\n  BASIC = \"basic\",\r\n  PROFESSIONAL = \"professional\",\r\n  ENTERPRISE = \"enterprise\",\r\n}\r\n\r\n// Define the subscription setup function\r\nexport function setupSubscriptionRoutes(app: Hono<AppEnv>) {\r\n  const subApi = new Hono<AppEnv>();\r\n\r\n  // Auth should be applied in the main app to /subscription/*\r\n\r\n  // Schemas\r\n  const updatePlanSchema = z.object({\r\n    plan: z.nativeEnum(SubscriptionTier),\r\n  });\r\n\r\n  const checkoutSessionSchema = z.object({\r\n    plan: z\r\n      .nativeEnum(SubscriptionTier)\r\n      .refine((p) => p !== SubscriptionTier.FREE), // Exclude FREE\r\n    successUrl: z.string().url().optional(),\r\n    cancelUrl: z.string().url().optional(),\r\n  });\r\n\r\n  /**\r\n   * Get current user's subscription plan\r\n   */\r\n  subApi.get(\"/current\", async (c: Context<AppEnv>) => {\r\n    const user = c.get(\"user\");\r\n    if (!user) return c.json({ error: \"Unauthorized\" }, 401);\r\n\r\n    // Get plan from user metadata (app_metadata is preferred for admin-set data)\r\n    const metadata = user.app_metadata || {};\r\n    const plan = metadata.subscription_tier || SubscriptionTier.FREE;\r\n    const expires = metadata.subscription_expires\r\n      ? new Date(metadata.subscription_expires)\r\n      : null;\r\n    const created = metadata.subscription_created || null;\r\n\r\n    // Determine isActive based on expiration\r\n    const isActive = !expires || expires > new Date();\r\n\r\n    return c.json({\r\n      success: true,\r\n      data: {\r\n        plan,\r\n        isActive,\r\n        subscriptionExpires: expires?.toISOString() ?? null,\r\n        createdAt: created,\r\n      },\r\n    });\r\n  });\r\n\r\n  // /**\r\n  //  * GET /usage - Temporarily removed due to missing helper functions\r\n  //  * Needs re-implementation based on RateLimitService or other tracking mechanism.\r\n  //  */\r\n  // subApi.get('/usage', async (c: Context<AppEnv>) => {\r\n  //   // ... implementation needed ...\r\n  // });\r\n\r\n  /**\r\n   * Update subscription plan (Downgrade to FREE only)\r\n   */\r\n  subApi.put(\r\n    \"/plan\",\r\n    zValidator(\"json\", updatePlanSchema),\r\n    async (c: Context<AppEnv>) => {\r\n      const user = c.get(\"user\");\r\n      if (!user) return c.json({ error: \"Unauthorized\" }, 401);\r\n\r\n      const { plan } = c.req.valid(\"json\") as z.infer<typeof updatePlanSchema>;\r\n\r\n      if (plan !== SubscriptionTier.FREE) {\r\n        return c.json({ error: \"Upgrades require checkout\" }, 400);\r\n      }\r\n\r\n      try {\r\n        // IMPORTANT: Updating app_metadata requires Supabase Admin privileges.\r\n        // The imported `supabase` client might need to be the service_role client.\r\n        // Or this needs to be called from a trusted server environment / edge function.\r\n        // Assuming `supabase` has necessary privileges for now.\r\n        const { error } = await supabase.auth.admin.updateUserById(user.id, {\r\n          app_metadata: {\r\n            ...user.app_metadata,\r\n            subscription_tier: plan,\r\n            subscription_expires: null, // Clear expiration for free tier\r\n            subscription_updated: new Date().toISOString(),\r\n          },\r\n        });\r\n        if (error) throw error;\r\n\r\n        return c.json({ success: true, data: { plan } });\r\n      } catch (error: any) {\r\n        console.error(\"Error updating subscription plan:\", error);\r\n        return c.json({ error: error.message || \"Failed to update plan\" }, 500);\r\n      }\r\n    }\r\n  );\r\n\r\n  /**\r\n   * Create checkout session (Placeholder)\r\n   */\r\n  subApi.post(\r\n    \"/checkout\",\r\n    zValidator(\"json\", checkoutSessionSchema),\r\n    async (c: Context<AppEnv>) => {\r\n      const user = c.get(\"user\");\r\n      if (!user) return c.json({ error: \"Unauthorized\" }, 401);\r\n\r\n      const { plan, successUrl, cancelUrl } = c.req.valid(\"json\") as z.infer<\r\n        typeof checkoutSessionSchema\r\n      >;\r\n\r\n      try {\r\n        // Placeholder: Generate mock checkout URL\r\n        const baseUrl =\r\n          process.env.NEXT_PUBLIC_SITE_URL || \"http://localhost:3000\";\r\n        const checkoutId = Date.now().toString(36);\r\n        const checkoutUrl = `${baseUrl}/mock-checkout?id=${checkoutId}&plan=${plan}&user=${user.id}`;\r\n        // In reality, call Stripe API here\r\n\r\n        console.log(\r\n          `Mock Checkout URL for user ${user.id}, plan ${plan}: ${checkoutUrl}`\r\n        );\r\n\r\n        return c.json({ success: true, data: { checkoutUrl, plan } });\r\n      } catch (error: any) {\r\n        console.error(\"Error creating checkout session:\", error);\r\n        return c.json(\r\n          { error: error.message || \"Failed to create checkout\" },\r\n          500\r\n        );\r\n      }\r\n    }\r\n  );\r\n\r\n  /**\r\n   * List available plans\r\n   */\r\n  subApi.get(\"/plans\", async (c) => {\r\n    // Ideally, plan details (features, limits) should come from a central config\r\n    // Possibly related to `@/infrastructure/rate-limit/config.ts`\r\n    // Returning hardcoded data for now\r\n    return c.json({\r\n      success: true,\r\n      data: {\r\n        plans: [\r\n          {\r\n            id: \"free\",\r\n            name: \"Free\",\r\n            price: 0,\r\n            features: [\"Basic API Access\"],\r\n          },\r\n          {\r\n            id: \"basic\",\r\n            name: \"Basic\",\r\n            price: 19,\r\n            features: [\"Increased Limits\"],\r\n          },\r\n          {\r\n            id: \"professional\",\r\n            name: \"Professional\",\r\n            price: 49,\r\n            features: [\"Higher Limits\", \"Team Features\"],\r\n          },\r\n          {\r\n            id: \"enterprise\",\r\n            name: \"Enterprise\",\r\n            price: null,\r\n            features: [\"Custom Limits\", \"Support\"],\r\n          },\r\n        ],\r\n      },\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Webhook Handler (Placeholder)\r\n   */\r\n  subApi.post(\"/webhook\", async (c: Context<AppEnv>) => {\r\n    // No auth needed for webhook typically (signature verification instead)\r\n    try {\r\n      const rawBody = await c.req.text(); // Need raw body for signature verification\r\n      const signature = c.req.header(\"Stripe-Signature\");\r\n      // TODO: Implement signature verification (e.g., using stripe.webhooks.constructEvent)\r\n      const event = JSON.parse(rawBody); // Parse after verification\r\n\r\n      console.log(\"Received webhook event:\", event.type);\r\n\r\n      // IMPORTANT: Use Admin client for user updates triggered by webhook\r\n      // const adminSupabase = createSupabaseAdminClient(); // Need admin client\r\n\r\n      switch (event.type) {\r\n        case \"checkout.session.completed\":\r\n          const session = event.data.object;\r\n          const userId = session.client_reference_id;\r\n          const plan = session.metadata?.plan as SubscriptionTier | undefined;\r\n          const customerId = session.customer;\r\n          const subscriptionId = session.subscription;\r\n\r\n          if (userId && plan && customerId && subscriptionId) {\r\n            console.log(`Updating user ${userId} to plan ${plan}`);\r\n            // await adminSupabase.auth.admin.updateUserById(userId, { ... });\r\n          } else {\r\n            console.error(\"Webhook missing data for checkout completion\", {\r\n              userId,\r\n              plan,\r\n              customerId,\r\n              subscriptionId,\r\n            });\r\n          }\r\n          break;\r\n        // Add other cases: invoice.paid, customer.subscription.deleted, etc.\r\n      }\r\n\r\n      return c.json({ received: true });\r\n    } catch (error: any) {\r\n      console.error(\"Webhook processing error:\", error);\r\n      return c.json({ error: \"Webhook processing failed\" }, 400);\r\n    }\r\n  });\r\n\r\n  // Mount under /subscription\r\n  app.route(\"/subscription\", subApi);\r\n}\r\n","import { zValidator } from \"@hono/zod-validator\";\r\nimport { Hono } from \"hono\";\r\nimport { cache } from \"hono/cache\";\r\nimport { HTTPException } from \"hono/http-exception\";\r\nimport { z } from \"zod\";\r\n\r\nimport { createServiceClient } from \"@/lib/supabase/client\";\r\n\r\n\r\nimport type { Context } from \"hono\";\r\n\r\n/**\r\n * Document routes for immigration document management\r\n */\r\nexport function setupDocumentRoutes(app: Hono) {\r\n  // Document validation schema\r\n  const documentSchema = z.object({\r\n    title: z.string().min(3).max(100),\r\n    type: z.enum([\r\n      \"passport\",\r\n      \"visa\",\r\n      \"birth_certificate\",\r\n      \"marriage_certificate\",\r\n      \"identification\",\r\n      \"other\",\r\n    ]),\r\n    expiryDate: z.string().optional(),\r\n    countryOfIssue: z.string().optional(),\r\n    description: z.string().optional(),\r\n    fileKey: z.string().optional(),\r\n    fileType: z.string().optional(),\r\n    fileSize: z.number().optional(),\r\n    metadata: z.record(z.any()).optional(),\r\n  });\r\n\r\n  // Create document\r\n  app.post(\"/protected/documents\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    try {\r\n      // Manual validation\r\n      const body = await c.req.json();\r\n      const result = documentSchema.safeParse(body);\r\n\r\n      if (!result.success) {\r\n        console.error(\"Validation error:\", result.error.format());\r\n        throw new HTTPException(400, { message: \"Invalid document data\" });\r\n      }\r\n\r\n      const supabase = createServiceClient();\r\n      const { data, error } = await supabase\r\n        .from(\"documents\")\r\n        .insert({\r\n          user_id: user.id,\r\n          title: result.data.title,\r\n          type: result.data.type,\r\n          expiry_date: result.data.expiryDate,\r\n          country_of_issue: result.data.countryOfIssue,\r\n          description: result.data.description,\r\n          file_key: result.data.fileKey,\r\n          file_type: result.data.fileType,\r\n          file_size: result.data.fileSize,\r\n          metadata: result.data.metadata,\r\n          created_at: new Date().toISOString(),\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      return c.json({\r\n        success: true,\r\n        document: data,\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Document creation error:\", error);\r\n      if (error instanceof HTTPException) {\r\n        throw error;\r\n      }\r\n      throw new HTTPException(500, { message: \"Failed to create document\" });\r\n    }\r\n  });\r\n\r\n  // Get all documents for user\r\n  app.get(\r\n    \"/protected/documents\",\r\n    cache({\r\n      cacheName: \"user-documents\",\r\n      cacheControl: \"private, max-age=60\", // 1 minute\r\n    }),\r\n    async (c: Context) => {\r\n      const user = c.get(\"user\");\r\n\r\n      if (!user) {\r\n        throw new HTTPException(401, {\r\n          message: \"Unauthorized: User not found\",\r\n        });\r\n      }\r\n\r\n      const page = Number(c.req.query(\"page\") || \"1\");\r\n      const limit = Number(c.req.query(\"limit\") || \"20\");\r\n      const offset = (page - 1) * limit;\r\n      const type = c.req.query(\"type\");\r\n\r\n      try {\r\n        const supabase = createServiceClient();\r\n        let query = supabase\r\n          .from(\"documents\")\r\n          .select(\"*\", { count: \"exact\" })\r\n          .eq(\"user_id\", user.id);\r\n\r\n        // Add type filter if specified\r\n        if (type) {\r\n          query = query.eq(\"type\", type);\r\n        }\r\n\r\n        // Add pagination\r\n        query = query.range(offset, offset + limit - 1);\r\n\r\n        const { data, error, count } = await query;\r\n\r\n        if (error) throw error;\r\n\r\n        return c.json({\r\n          success: true,\r\n          documents: data || [],\r\n          pagination: {\r\n            total: count || 0,\r\n            page,\r\n            limit,\r\n            totalPages: count ? Math.ceil(count / limit) : 0,\r\n          },\r\n        });\r\n      } catch (error: any) {\r\n        console.error(\"Documents fetch error:\", error);\r\n        throw new HTTPException(500, { message: \"Failed to fetch documents\" });\r\n      }\r\n    }\r\n  );\r\n\r\n  // Get a specific document\r\n  app.get(\"/protected/documents/:id\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    const documentId = c.req.param(\"id\");\r\n\r\n    try {\r\n      const supabase = createServiceClient();\r\n      const { data, error } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"*\")\r\n        .eq(\"id\", documentId)\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n\r\n      if (error) {\r\n        if (error.code === \"PGRST116\") {\r\n          throw new HTTPException(404, { message: \"Document not found\" });\r\n        }\r\n        throw error;\r\n      }\r\n\r\n      return c.json({\r\n        success: true,\r\n        document: data,\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Document fetch error:\", error);\r\n      if (error instanceof HTTPException) {\r\n        throw error;\r\n      }\r\n      throw new HTTPException(500, { message: \"Failed to fetch document\" });\r\n    }\r\n  });\r\n\r\n  // Update a document\r\n  app.patch(\"/protected/documents/:id\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    const documentId = c.req.param(\"id\");\r\n\r\n    try {\r\n      // Manual validation\r\n      const body = await c.req.json();\r\n      const result = documentSchema.partial().safeParse(body);\r\n\r\n      if (!result.success) {\r\n        console.error(\"Validation error:\", result.error.format());\r\n        throw new HTTPException(400, { message: \"Invalid document data\" });\r\n      }\r\n\r\n      // First check if document exists and belongs to user\r\n      const supabase = createServiceClient();\r\n      const { data: existing, error: fetchError } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"id\")\r\n        .eq(\"id\", documentId)\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n\r\n      if (fetchError || !existing) {\r\n        throw new HTTPException(404, {\r\n          message: \"Document not found or access denied\",\r\n        });\r\n      }\r\n\r\n      // Process the update data - convert camelCase to snake_case\r\n      const updateData: Record<string, any> = {\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n\r\n      if (result.data.title !== undefined) updateData.title = result.data.title;\r\n      if (result.data.type !== undefined) updateData.type = result.data.type;\r\n      if (result.data.expiryDate !== undefined)\r\n        updateData.expiry_date = result.data.expiryDate;\r\n      if (result.data.countryOfIssue !== undefined)\r\n        updateData.country_of_issue = result.data.countryOfIssue;\r\n      if (result.data.description !== undefined)\r\n        updateData.description = result.data.description;\r\n      if (result.data.fileKey !== undefined)\r\n        updateData.file_key = result.data.fileKey;\r\n      if (result.data.fileType !== undefined)\r\n        updateData.file_type = result.data.fileType;\r\n      if (result.data.fileSize !== undefined)\r\n        updateData.file_size = result.data.fileSize;\r\n      if (result.data.metadata !== undefined)\r\n        updateData.metadata = result.data.metadata;\r\n\r\n      // Update the document\r\n      const { error: updateError } = await supabase\r\n        .from(\"documents\")\r\n        .update(updateData)\r\n        .eq(\"id\", documentId)\r\n        .eq(\"user_id\", user.id);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      return c.json({\r\n        success: true,\r\n        message: \"Document updated successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Document update error:\", error);\r\n      if (error instanceof HTTPException) {\r\n        throw error;\r\n      }\r\n      throw new HTTPException(500, { message: \"Failed to update document\" });\r\n    }\r\n  });\r\n\r\n  // Delete a document\r\n  app.delete(\"/protected/documents/:id\", async (c: Context) => {\r\n    const user = c.get(\"user\");\r\n\r\n    if (!user) {\r\n      throw new HTTPException(401, { message: \"Unauthorized: User not found\" });\r\n    }\r\n\r\n    const documentId = c.req.param(\"id\");\r\n\r\n    try {\r\n      const supabase = createServiceClient();\r\n\r\n      // First check if document exists and belongs to user\r\n      const { data: existing, error: fetchError } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"id, file_key\")\r\n        .eq(\"id\", documentId)\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n\r\n      if (fetchError || !existing) {\r\n        throw new HTTPException(404, {\r\n          message: \"Document not found or access denied\",\r\n        });\r\n      }\r\n\r\n      // If document has a file, delete it from storage\r\n      if (existing.file_key) {\r\n        const { error: storageError } = await supabase.storage\r\n          .from(\"documents\")\r\n          .remove([existing.file_key]);\r\n\r\n        if (storageError) {\r\n          console.error(\"Error deleting file from storage:\", storageError);\r\n          // Continue with database deletion even if storage deletion fails\r\n        }\r\n      }\r\n\r\n      // Delete the document from the database\r\n      const { error: deleteError } = await supabase\r\n        .from(\"documents\")\r\n        .delete()\r\n        .eq(\"id\", documentId)\r\n        .eq(\"user_id\", user.id);\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      return c.json({\r\n        success: true,\r\n        message: \"Document deleted successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Document deletion error:\", error);\r\n      if (error instanceof HTTPException) {\r\n        throw error;\r\n      }\r\n      throw new HTTPException(500, { message: \"Failed to delete document\" });\r\n    }\r\n  });\r\n\r\n  return app;\r\n}\r\n","var map = {\n\t\"./ar.json\": [\n\t\t39221,\n\t\t9221\n\t],\n\t\"./en.json\": [\n\t\t28517,\n\t\t8517\n\t],\n\t\"./es.json\": [\n\t\t34026,\n\t\t4026\n\t],\n\t\"./fr.json\": [\n\t\t53586,\n\t\t3586\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(() => {\n\t\treturn __webpack_require__.t(id, 3 | 16);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 98728;\nmodule.exports = webpackAsyncContext;","import { Chat, ChatModelType, ChatMessage } from \"../entities/chat\";\r\n\r\n/**\r\n * Chat Service handles domain logic for chat operations\r\n */\r\nexport class ChatService {\r\n  /**\r\n   * Validate if the chat data is correct\r\n   */\r\n  validateChat(chat: Chat): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n\r\n    // Basic validation\r\n    if (!chat.title || chat.title.trim().length === 0) {\r\n      errors.push(\"Chat title is required\");\r\n    }\r\n\r\n    if (!chat.userId || chat.userId.trim().length === 0) {\r\n      errors.push(\"User ID is required\");\r\n    }\r\n\r\n    if (\r\n      !chat.modelType ||\r\n      !Object.values(ChatModelType).includes(chat.modelType)\r\n    ) {\r\n      errors.push(\"Valid model type is required\");\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate a system prompt for immigration context\r\n   */\r\n  generateImmigrationSystemPrompt(countryCode?: string): string {\r\n    const basePrompt = `You are an AI assistant specialized in immigration matters. \r\nYour goal is to provide accurate, helpful information about immigration processes, requirements, and regulations.\r\nAlways clarify that you're providing general guidance and not legal advice.\r\nWhen you don't know something specific, acknowledge it and suggest reliable sources for more information.`;\r\n\r\n    // Add country-specific guidance if provided\r\n    if (countryCode) {\r\n      return `${basePrompt}\r\n      \r\nSince the user is interested in immigration to ${this.getCountryName(countryCode)}, focus your knowledge on this country's immigration procedures, visa types, residency requirements, citizenship processes, and related information.`;\r\n    }\r\n\r\n    return basePrompt;\r\n  }\r\n\r\n  /**\r\n   * Convert country code to name\r\n   */\r\n  private getCountryName(countryCode: string): string {\r\n    const countries: Record<string, string> = {\r\n      US: \"the United States\",\r\n      CA: \"Canada\",\r\n      UK: \"the United Kingdom\",\r\n      AU: \"Australia\",\r\n      NZ: \"New Zealand\",\r\n      DE: \"Germany\",\r\n      FR: \"France\",\r\n      ES: \"Spain\",\r\n      IT: \"Italy\",\r\n      JP: \"Japan\",\r\n      SG: \"Singapore\",\r\n      AE: \"the United Arab Emirates\",\r\n      // Add more countries as needed\r\n    };\r\n\r\n    return countries[countryCode] || countryCode;\r\n  }\r\n\r\n  /**\r\n   * Validate a message before adding it to a chat\r\n   */\r\n  validateChatMessage(message: Omit<ChatMessage, \"chatId\">): {\r\n    valid: boolean;\r\n    errors: string[];\r\n  } {\r\n    const errors: string[] = [];\r\n\r\n    if (!message.id || message.id.trim().length === 0) {\r\n      errors.push(\"Message ID is required\");\r\n    }\r\n\r\n    if (![\"user\", \"assistant\", \"system\"].includes(message.role)) {\r\n      errors.push(\"Invalid message role\");\r\n    }\r\n\r\n    if (!message.content || message.content.trim().length === 0) {\r\n      errors.push(\"Message content is required\");\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate token estimation for a given text\r\n   * This is a rough estimation: ~4 chars per token for English text\r\n   */\r\n  estimateTokens(text: string): number {\r\n    return Math.ceil(text.length / 4);\r\n  }\r\n\r\n  /**\r\n   * Check if the chat exceeds model token limits\r\n   */\r\n  exceedsTokenLimit(chat: Chat): boolean {\r\n    // Get token limits based on model\r\n    const tokenLimit = this.getModelTokenLimit(chat.modelType);\r\n\r\n    // Estimate tokens in all messages\r\n    const totalTokens = chat.messages.reduce((total, message) => {\r\n      return total + this.estimateTokens(message.content);\r\n    }, 0);\r\n\r\n    return totalTokens > tokenLimit;\r\n  }\r\n\r\n  /**\r\n   * Get token limit for a model\r\n   */\r\n  private getModelTokenLimit(modelType: ChatModelType): number {\r\n    const tokenLimits: Record<ChatModelType, number> = {\r\n      [ChatModelType.GPT_3_5]: 16385,\r\n      [ChatModelType.GPT_4]: 8192,\r\n      [ChatModelType.GPT_4_VISION]: 128000,\r\n      [ChatModelType.CLAUDE_3_HAIKU]: 200000,\r\n      [ChatModelType.CLAUDE_3_SONNET]: 200000,\r\n      [ChatModelType.CLAUDE_3_OPUS]: 200000,\r\n    };\r\n\r\n    return tokenLimits[modelType] || 8000;\r\n  }\r\n\r\n  /**\r\n   * Truncate chat history to fit within token limits\r\n   * Keeps most recent messages and removes oldest ones when needed\r\n   */\r\n  truncateChatHistory(chat: Chat, reserveTokens: number = 1000): Chat {\r\n    const tokenLimit = this.getModelTokenLimit(chat.modelType) - reserveTokens;\r\n\r\n    if (chat.messages.length <= 2) {\r\n      return chat; // Keep at least the system prompt and last user message\r\n    }\r\n\r\n    // Sort messages by creation date (newest first)\r\n    const sortedMessages = [...chat.messages].sort(\r\n      (a, b) => b.createdAt.getTime() - a.createdAt.getTime()\r\n    );\r\n\r\n    let totalTokens = 0;\r\n    const messagesToKeep: ChatMessage[] = [];\r\n\r\n    // Always keep system prompts\r\n    const systemPrompts = sortedMessages.filter((m) => m.role === \"system\");\r\n    systemPrompts.forEach((message) => {\r\n      totalTokens += this.estimateTokens(message.content);\r\n      messagesToKeep.push(message);\r\n    });\r\n\r\n    // Add messages from newest to oldest until we reach the limit\r\n    for (const message of sortedMessages) {\r\n      if (message.role === \"system\") continue; // Already added\r\n\r\n      const messageTokens = this.estimateTokens(message.content);\r\n      if (totalTokens + messageTokens <= tokenLimit) {\r\n        totalTokens += messageTokens;\r\n        messagesToKeep.push(message);\r\n      } else {\r\n        // Stop adding messages once we hit the limit\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Resort messages by creation date (oldest first)\r\n    messagesToKeep.sort(\r\n      (a, b) => a.createdAt.getTime() - b.createdAt.getTime()\r\n    );\r\n\r\n    // Create a truncated copy of the chat\r\n    return new Chat({\r\n      ...chat,\r\n      messages: messagesToKeep,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Generate a title for a chat based on the first user message\r\n   */\r\n  generateChatTitle(userMessage: string): string {\r\n    // Truncate the message if it's too long\r\n    const maxLength = 50;\r\n    let title = userMessage.substring(0, maxLength).trim();\r\n\r\n    if (title.length === maxLength) {\r\n      title += \"...\";\r\n    }\r\n\r\n    return title || \"New Immigration Chat\";\r\n  }\r\n}\r\n"],"names":["handleError","error","code","getMessageFallback","namespace","key","fallback","charAt","toUpperCase","slice","replace","getRequestConfig","messages","localeFromPath","headersList","headers","get","split","filter","Boolean","resolvedLocale","locales","includes","defaultLocale","default","console","warn","fallbackError","common","loading","localeConfig","getLocaleConfig","locale","timeZone","now","Date","onError","formats","dateTime","short","day","month","year","medium","long","full","weekday","time","hour","minute","hour12","htmlLang","number","precise","maximumFractionDigits","minimumFractionDigits","compact","notation","percent","style","currency","list","enumeration","type","or","relative","days","quarters","months","years","redirect","usePathname","useRouter","createSharedPathnamesNavigation","languageDetectionMiddleware","options","detector","honoLanguageDetector","order","mergedOptions","lookupQueryString","lookupCookie","lookupFromPathIndex","lookupFromHeaderKey","ignoreCase","supportedLanguages","fallbackLanguage","caches","cookieOptions","sameSite","secure","process","maxAge","defaultOptions","c","next","detectedLanguage","set","header","setupAuthRoutes","app","loginSchema","z","email","password","min","registerSchema","firstName","optional","lastName","resetPasswordSchema","getSupabase","createClient","env","SUPABASE_SERVICE_ROLE_KEY","post","body","req","json","result","safeParse","success","HTTPException","message","data","supabase","auth","signInWithPassword","session","user","authData","authError","signUp","profileError","from","upsert","id","first_name","last_name","updated_at","toISOString","authHeader","startsWith","signOut","scope","resetPasswordForEmail","redirectTo","NEXT_PUBLIC_APP_URL","redis","Redis","fromEnv","ResourceType","ACTION_SPECIFIC_RATE_LIMITS","ocr","requests","window","tokens","documentQA","batchProcessing","api","caseManagement","documentUpload","action","ACTION_SPECIFIC_LIMITERS","typedAction","tierConfigs","tier","createActionRateLimiter","actionLimitsTiered","typedTier","config","Ratelimit","limiter","slidingWindow","analytics","prefix","SUBSCRIPTION_RATE_LIMITS","Map","getUserTier","supabaseClient","userId","select","eq","maybeSingle","toLowerCase","subscriptionRateLimit","resourceType","errorMessage","identifier","rateLimiter","getRateLimiter","cacheKey","rateLimiterCache","has","limit","String","remaining","Math","floor","reset","details","pending","verifyUserIsAdmin","createSupabaseServiceClient","is_admin","setupAdminRoutes","userUpdateSchema","uuid","role","isActive","subscriptionTier","bulkUserSchema","userIds","page","Number","query","offset","createServiceClient","count","range","users","pagination","total","totalPages","ceil","param","single","patch","zValidator","name","refine","Object","keys","length","valid","checkError","emailExists","emailCheckError","neq","updatedUser","updateError","update","delete","deleteError","roleError","user_id","undefined","statusError","is_active","subscriptionError","in","deleted_at","affected","userCount","userError","head","documentCount","documentError","subscriptionCount","stats","documents","activeSubscriptions","en","nativeName","englishName","direction","dateFormat","flag","calendar","decimal","thousands","ar","fontClass","fr","es","localeConfigs","getLocaleFont","querySchema","int","max","search","createUserSchema","updateUserSchema","handleRouteError","defaultMessage","status","cause","errors","setupUserRoutes","Hono","use","validationResult","ascending","responseData","hasMore","apiResponse","rawBody","db","existingUser","newUser","insertError","insert","updateData","normalizeAppPath","normalizeRscURL","route","ensureLeadingSlash","reduce","pathname","segment","index","segments","isGroupSegment","url","setupImmigrationRoutes","countryQuerySchema","country","compareQuerySchema","countries","category","cache","cacheName","cacheControl","filteredData","item","Set","map","sentryErrorLoggerMiddleware","Sentry","method","path","level","requestId","generateRequestId","toString","random","substring","ip_address","getRequestData","raw","forEach","value","query_params","err","errorLog","timestamp","statusCode","component","logError","sentryContext","userAgent","stack","tags","entries","extra","JSON","stringify","responseBody","IS_PRODUCTION","globalThis","open","Promise","resolve","match","put","UPSTASH_REDIS_REST_URL","UPSTASH_REDIS_REST_TOKEN","STATS_KEYS","HITS","MISSES","KEYS","redisClient","redisInitializationAttempted","getRedisClient","createRedisClient","token","retry","retries","backoff","retryCount","translationCache","cached","parse","translations","ttl","setex","invalidate","del","invalidateAll","redisApiCacheMiddleware","generateKey","defaultKeyGenerator","URL","pathWithQuery","cachedData","incr","res","clone","ex","sadd","CacheManager","constructor","redisClientInternal","redisKeyPrefix","lruCache","LRUCache","maxSize","prefixedKey","getPrefixedKey","ttlInSeconds","clear","cursor","scanResult","scan","nextCursor","Document","description","ownerId","versions","access","caseIds","expiryDate","issuedBy","issuedDate","documentNumber","metadata","createdAt","updatedAt","hasAccess","permission","userAccess","find","expiresAt","addVersion","version","newVersion","documentId","push","getLatestVersion","sort","a","b","getTime","grantAccess","existingAccessIndex","findIndex","newAccess","revokeAccess","addToCase","caseId","removeFromCase","updateMetadata","changeStatus","statusHistory","to","changedBy","changedAt","toObject","latestVersion","fromDatabase","parseDate","dateStr","Array","isArray","v","grantedAt","owner_id","case_ids","expiry_date","issued_by","issued_date","document_number","created_at","CaseApplicationService","caseService","CaseService","getCaseById","caseRepository","userHasAccess","Error","caseData","getById","toDomainEntity","getCasesByUser","casesData","getByUserId","createCase","caseNumber","generateCaseNumber","caseType","creationEvent","crypto","randomUUID","eventType","title","createdBy","initialAssignment","assignedAt","assignedBy","caseRecord","create","case_number","CaseStatus","DRAFT","case_type","client_id","clientId","timeline","assignments","priority","due_date","dueDate","updateCase","caseInstance","userRole","getUserRole","canPerformAction","updatedCase","updatedRecord","event","newStatus","reason","isValidStatusTransition","assignUser","assignedUserId","assignedByUserId","removeAssignment","targetUserId","removedByUserId","updateTimeline","addDocument","document","all","documentRepository","documentEvent","createDocumentEvent","addTimelineEvent","getCaseWithDetails","getWithDetails","case","caseEntity","doc","calculateCompletionPercentage","documentNames","getRequiredDocuments","estimateProcessingTime","createCaseSchema","CaseType","datetime","nullable","updateCaseSchema","statusChangeSchema","assignUserSchema","setupCaseRoutes","caseApi","caseManagementLimit","documentUploadLimit","includeAssigned","cases","parseInt","caseDetail","newCase","completionPercentage","caseTypeParam","values","requiredDocs","requiredDocuments","processingTime","__next_loaded_action_key","arrayBufferToString","decrypt","encrypt","getActionEncryptionKey","getClientReferenceManifestForRsc","getServerModuleMap","setReferenceManifestsSingleton","stringToUint8Array","buffer","bytes","Uint8Array","len","byteLength","fromCharCode","apply","binary","i","arr","charCodeAt","iv","subtle","SERVER_ACTION_MANIFESTS_SINGLETON","Symbol","for","clientReferenceManifest","serverActionsManifest","serverModuleMap","clientReferenceManifestsPerPage","serverActionsManifestSingleton","InvariantError","workStore","workAsyncStorage","getStore","mergeClientReferenceManifests","clientReferenceManifests","mergedClientReferenceManifest","clientModules","edgeRscModuleMapping","rscModuleMapping","rawKey","NEXT_SERVER_ACTIONS_ENCRYPTION_KEY","encryptionKey","importKey","atob","isRTL","p","n","s","href","f","u","localeCookie","m","onClick","h","prefetch","d","unprefixed","k","x","L","g","j","e","o","l","location","host","w","domains","C","t","r","ref","hrefLang","setupProfileRoutes","profileUpdateSchema","bio","avatarUrl","timezone","language","countryOfResidence","countryOfInterest","profile","updates","avatar_url","country_of_residence","country_of_interest","documentsCount","documentsError","applicationsCount","applicationsError","useI18n","useLocale","useTranslations","format","useFormatter","useTimeZone","useNow","isRtl","date","formatRelativeTime","relativeTime","formatCurrency","formatNumber","useTranslate","useGlobalTranslate","ensureServerEntryExports","actions","domainChatService","DomainChatService","openaiApiKey","OPENAI_API_KEY","chatServiceInstance","ChatApplicationService","repositoryFactory","logger","timing","prettyJSON","cors","origin","allowMethods","allowHeaders","exposeHeaders","credentials","dbClient","createEdgeClient","varyByAuth","NEXT_PUBLIC_APP_VERSION","serviceClient","getUser","adminOnly","userIdForLog","API","SCRAPING","VECTOR","RESEARCH","setupDocumentRoutes","setupSubscriptionRoutes","userRoutes","GET","handle","serverComponentModule.GET","serverComponentModule.PUT","serverComponentModule.PATCH","serverComponentModule.DELETE","serverComponentModule.HEAD","serverComponentModule.OPTIONS","localePrefixMode","displayName","CaseRepository","BaseRepository","client","getClient","tableName","caseError","messagesError","case_id","removeDocument","addMessage","is_system_message","currentAssignments","newAssignments","roles","typedCaseData","userAssignment","getByStatus","record","toCaseDomain","DomainMapper","fromCaseDomain","domain","DocumentRepository","getAll","createdData","updatedData","executeSql","sql","rpc","params","shared","searchQuery","orderBy","field","fileName","filePath","fileSize","fileType","versionsSql","accessSql","versionSql","results","document_id","checkSql","existingRecords","updateSql","updateResults","grantedBy","insertSql","insertResults","deleteSql","fetchError","updatedMetadata","updatedCaseIds","accessRecords","some","expires_at","filename","content","file_path","file_type","lastUpdated","findByContentHash","contentHash","contentHashSql","versionData","documentIds","UserProfileRepository","toUserProfileDomain","fromUserProfileDomain","getPreferences","updateTheme","theme","updateLanguage","updateNotificationSettings","settings","notifications_enabled","emailNotifications","updatePreferences","preferences","updateAvatar","userProfileRepository","chatRepository","ChatRepository","repositoryRegistry","userProfile","chat","RepositoryFactory","getUserProfileRepository","getDocumentRepository","getCaseRepository","registerRepository","repository","getRepository","getChatRepository","SubscriptionTier","subApi","updatePlanSchema","plan","checkoutSessionSchema","successUrl","cancelUrl","app_metadata","subscription_tier","expires","subscription_expires","created","subscription_created","subscriptionExpires","admin","updateUserById","subscription_updated","baseUrl","NEXT_PUBLIC_SITE_URL","checkoutId","checkoutUrl","plans","price","features","text","object","client_reference_id","customerId","customer","subscriptionId","subscription","received","documentSchema","countryOfIssue","fileKey","country_of_issue","file_key","file_size","partial","existing","storageError","storage","remove","ChatService","validateChat","trim","modelType","ChatModelType","generateImmigrationSystemPrompt","countryCode","basePrompt","getCountryName","US","CA","UK","AU","NZ","DE","FR","ES","IT","JP","SG","AE","validateChatMessage","estimateTokens","exceedsTokenLimit","tokenLimit","getModelTokenLimit","tokenLimits","GPT_3_5","GPT_4","GPT_4_VISION","CLAUDE_3_HAIKU","CLAUDE_3_SONNET","CLAUDE_3_OPUS","truncateChatHistory","reserveTokens","totalTokens","messagesToKeep","sortedMessages","messageTokens","Chat","generateChatTitle","userMessage","maxLength"],"sourceRoot":""}