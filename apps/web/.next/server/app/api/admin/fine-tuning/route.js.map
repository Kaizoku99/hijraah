{"version":3,"file":"../app/api/admin/fine-tuning/route.js","mappings":"0bACA,qCAA6C,CAC7C,QACA,CAAC,EAAC,OACF,kCAAiD,CACjD,cACA,eACA,QACA,CACA,CAAC,CACD,CADE,MACF,EACA,kBACA,+BACA,qBACA,UAEA,CACA,CACA,oBACA,2BACA,CACA,gBACA,uBACA,CACA,2BACA,kCACA,CACA,yBC3BA,yHCAA,sCCAA,cACA,yCAEA,OADA,0BACA,CACA,CACA,cACA,YACA,UACA,oCCRA,qGCAA,qDCAA,sDCAA,0DC2FIA,gIAzEJ,GAAM,CAAEC,MAAOC,CAAS,CAAE,CAAGC,MAGvBC,EAAcC,wBAAoC,CAClDC,EAAkBD,kBAJkBF,yIAIuB,CAC3DI,EAAiBF,QAAQG,GAAG,CAACC,yBAAyB,CAetDC,EAAuDJ,EACzD,CAAEK,OAAQL,CAAgB,EAC1BM,OAOEC,EAAqDN,EACvD,CAAEI,OAAQJ,CAAe,OACzBK,EAGJ,SAASE,IAeP,GAAI,CAACV,GAAe,CAACE,EAInB,MAHAS,QAAQC,CAD4B,IACvB,CACX,2FAEI,MAAU,uCAEpB,CAQmC,CACjC,IAAMC,EAAIC,WACLD,EAAEE,mBAAmB,EAAE,CAC1BF,EAAEhB,KAAK,CAAGC,EACVe,EAAEE,mBAAmB,EAAG,EAG5B,CAKA,SAASC,UAEP,CADAN,IACId,GACKA,EASTA,EAAwBqB,CAAAA,EAAAA,EAAAA,WAVG,QAUHA,CAAoBA,CAC1CjB,EACAE,EACA,CACEgB,OAAQ,CACNC,QAASb,CACX,CACF,EAQJ,CAaO,SAASc,IAEd,OADAV,IACOO,CAAAA,EAAAA,EAAAA,mBAAAA,CAAoBA,CAAWjB,EAAcE,EAAkB,CACpEgB,OAAQ,CACNC,QAASb,CACX,CACF,EACF,CAUO,SAASe,EACdC,CAAmC,EAGnC,OADAZ,IACOa,CAAAA,EAAAA,EAAAA,kBAAAA,CAAmBA,CAAWvB,EAAcE,EAAkB,CACnEsB,QAAS,CACPC,IAAIC,GACKJ,CADO,CACKG,GAAG,CAACC,IAAOC,MAEhCC,IAAIF,CAAY,CAAEC,CAAa,CAAEE,CAAO,EACtC,GAAI,CACFP,EAAYM,GAAG,CAACF,EAAMC,EAAOE,EAC/B,CAAE,MAAOjB,EAAO,CACdD,QAAQmB,IAAI,CAAC,CAAC,sBAAsB,EAAEJ,EAAK,EAAE,CAAC,CAAEd,EAClD,CACF,EACAmB,OAAOL,CAAY,CAAEG,CAAO,EAC1B,GAAI,CACFP,EAAYM,GAAG,CAACF,EAAM,GAAIG,EAC5B,CAAE,MAAOjB,EAAO,CACdD,QAAQmB,IAAI,CAAC,CAAC,yBAAyB,EAAEJ,EAAK,EAAE,CAAC,CAAEd,EACrD,CACF,CACF,EACAM,OAAQ,CACNrB,MAAOC,EACPqB,QAASb,CACX,CACF,EACF,CAUO,SAAS0B,IACd,GAAI,CAAChC,GAAe,CAACG,EAEnB,MADAQ,QADmC,KACtB,CAAC,+CACJsB,MAAM,wDAGlB,MAAOC,CAAAA,EAAAA,EAAAA,YAAAA,CAAoBA,CAAWlC,EAAaG,EAAgB,CACjEgC,KAAM,CACJC,kBAAkB,EAClBC,eAAgB,EAClB,EACAnB,OAAQ,CACNrB,MAAOC,EACPqB,QAASV,CACX,CACF,EACF,CAsCO,IAAM6B,EAAmB,IAC9B5B,IACA,IAAM6B,EAAeC,EAAQrB,OAAO,CAACM,GAAG,CAAC,WAAa,GAEtD,MAAOF,CAAAA,EAAAA,EAAAA,kBAAAA,CAAmBA,CAAWvB,EAAcE,EAAkB,CACnEsB,QAAS,CACPC,IAAIC,CAAY,EACd,IAAMe,EAAQF,EAAaE,KAAK,CAAC,OAAW,CAAC,OAAQ,EAAEf,EAAK,QAAQ,CAAC,GACrE,OAAOe,GAAO,CAAC,EAAE,EAEnBb,IAAIF,CAAY,CAAEC,CAAa,CAAEE,CAAO,EACtClB,QAAQmB,IAAI,CACV,CAAC,yBAAyB,EAAEJ,EAAK,+EAA+E,CAAC,CAErH,EACAK,OAAOL,CAAY,CAAEG,CAAO,EAC1BlB,QAAQmB,IAAI,CACV,CAAC,4BAA4B,EAAEJ,EAAK,+EAA+E,CAAC,CAExH,CACF,EACAR,OAAQ,CACNrB,MAAOC,EACPqB,QAASb,CACX,CACF,EACF,EAAE,EAO+BU,EAKpB0B,EAAsBV,EAKtBW,EAAW3B,iBAVkC,OAKK,GAKZ,CC9RnD,oDCAA,iDCAA,iDCAA,wGCAA,gECAA,kDCAA,iDCAA,iECAA,uDCAA,6DCAA,uDCAA,mECAA,wDCAA,sGCAA,qDCAA,sECAA,oDCAA,gdC8EO,eAAe4B,EACpBC,CAAiB,CACjBC,EAAY,CAAC,CACbC,EAAQ,GAAI,EAIZ,IAAIC,EAFaC,CAAAA,EAAAA,EAAAA,EAAAA,CAAiBA,GAG/BC,IAAI,CAAC,eACLC,MAAM,CAAC,KACPC,GAAG,CAAC,SAAUN,GACdO,KAAK,CAAC,aAAc,CAAEC,WAAW,CAAM,GACvCP,KAAK,CAACA,GAELF,IACFG,EAAQA,EAAMO,EADF,CACK,WAAYV,EAAAA,EAG/B,GAAM,MAAEW,CAAI,OAAE5C,CAAK,CAAE,CAAG,MAAMoC,EAE9B,GAAIpC,EAEF,KAFS,CACTD,QAAQC,KAAK,CAAC,+BAAgCA,GACxCA,EAMR,OAAO6C,EAFmBC,OAAO,CAACC,GAAQA,EAAKC,cAAc,EAAI,EAAE,CAGrE,CAKO,eAAeC,EAA4BhB,CAAiB,EAcjE,MAVkBY,CAHG,MAAMb,EAA6BC,EAAAA,EAGzBiB,GAAG,CAACC,GAC1BC,KAAKC,SAAS,CAAC,CACpBC,SAAU,CACR,CAAEC,KAAM,SAAUC,QAAS,+IAAgJ,EAC3K,CAAED,KAAM,OAAQC,QAASL,EAAKM,KAAK,EACnC,CAAEF,KAAM,YAAaC,QAASL,EAAKO,MAAO,EAC3C,IAEFC,IAAI,CAAC,KAGV,CAxH8BC,EAAAA,EAAQ,CAAC,CACrCC,UAAWD,EAAAA,EAAQ,GACnBE,OAAQF,EAAAA,EAAQ,GAAGG,GAAG,CAAC,GAAGC,GAAG,CAAC,GAC9BC,SAAUL,EAAAA,EAAQ,GAAGM,QAAQ,GAC7BC,UAAWP,EAAAA,EAAS,GACpB3B,SAAU2B,EAAAA,EAAM,CAAC,CAAC,OAAQ,eAAgB,WAAY,UAAW,cAAe,QAAQ,CAC1F,GAAG,ICDGQ,EAAS,IAAIC,EAAAA,EAAMA,CAAC,CACxBC,OAAQ9E,EAAAA,CAAGA,CAAC+E,QADFH,MACgB,GAMrB,eAAeI,EAAoBvC,CAAiB,EAEzD,IAAMwC,EAAY,MAAMxB,EAA4BhB,GAG9CyC,EAAUC,IAAAA,IAAS,CAACtF,QAAQuF,GAAG,GAAI,MACrC,CAACC,IAAAA,UAAa,CAACH,IACjBG,IAAAA,EAD2B,OACf,CAACH,EAAS,CAAEI,WAAW,CAAK,GAG1C,IAAMC,EAAWJ,IAAAA,IAAS,CAACD,EAAS,CAAC,SAAS,EAAEM,KAAKC,GAAG,GAAG,MAAM,CAAC,EAClEJ,IAAAA,aAAgB,CAACE,EAAUN,GAE3B,GAAI,CAEF,IAAMS,EAAO,MAAMd,EAAOe,KAAK,CAACC,MAAM,CAAC,CACrCF,KAAML,IAAAA,MADiBT,UACE,CAACW,GAC1BM,QAAS,WACX,GAGMC,EAAW,MAAMlB,EAAOmB,UAAU,CAACC,IAAI,CAACJ,MAAM,CAAC,CACnDK,KAD2BrB,SACZc,EAAKQ,EAAE,CACtBC,MAAO,gBACPC,OAAQ,CAAC,YAAY,EAAE3D,GAAY,UAAU,CAAC,EAAE+C,KAAKC,GAAG,IAAI,GAIxDlD,EAAWM,CAAAA,EAAAA,EAAAA,EAAAA,CAAiBA,GAgBlC,CAhBsC,MACtC,MAAMN,EAASO,IAAI,CAAC,oBAAoBuD,MAAM,CAAC,CAC7CH,GAAIJ,EAASI,EAAE,CACfI,OAAQR,EAASQ,MAAM,CACvBH,MAAOL,EAASK,KAAK,CACrBI,iBAAkB,KAClB9D,SAAUA,GAAY,KACtB+D,WAAY,IAAIhB,KAA2B,IAAtBM,EAASU,UAAU,EAASC,WAAW,GAC5DC,YAAa,KACblG,MAAO,KACPmG,SAAU,CACRV,cAAeP,EAAKQ,EAAE,CACtBU,gBAAiBd,EAASc,eAAe,CAE7C,GAEO,CACLC,MAAOf,EAASI,EAAE,CAClBI,OAAQR,EAASQ,MAAM,CAE3B,CAAE,MAAO9F,EAAO,CAEd,MADAD,QAAQC,KAAK,CAAC,kCAAmCA,GAC3CA,CACR,QAAU,CAEJ6E,IAAAA,UAAa,CAACE,IAChBF,IAAAA,GAD2B,OACd,CAACE,EAElB,CACF,sCC/DO,eAAeuB,EACpB1E,CAAgB,EAEhB,IAAMG,EAAWwE,SAiCVA,EACP,IAAM7F,EAAcE,CAAAA,EAAAA,EAAAA,EAAAA,CAAOA,GAE3B,MAAO4F,CAAAA,EAAAA,EAAAA,kBAAAA,CAAkBA,CACvBnH,wBAAoC,CACpCA,2JAAyC,CACzC,CACEuB,QAAS,CACPC,IAAIC,GACKJ,CADO,CACKG,GAAG,CAACC,IAAOC,KAElC,CACF,EAEJ,IA7CQ,CACJ6B,KAAM,MAAE6D,CAAI,CAAE,CACdzG,MAAO0G,CAAS,CACjB,CAAG,MAAM3E,EAASR,IAAI,CAACoF,OAAO,UAE/B,GAAiB,CAACF,GACZC,GADkB,QACP,KACA,CAAC,4DAET,MAG0B,CACjC,GAAGD,CAAI,CACPG,SAAUH,EAAKI,aAAa,EAAEC,WAAaL,EAAKI,aAAa,EAAE/F,KAC/DiG,UAAWN,EAAKI,aAAa,EAAEG,WAC/BzD,KACEkD,EAAKI,aAAa,EAAEtD,OAAS,SAC7BkD,EAAKI,aAAa,EAAEtD,OAAS,OACzBkD,EAAKI,aAAa,CAACtD,IAAI,CACvB,MACR,CAGF,gBC1BO,IAAM0D,EAAU,SACVC,EAAU,gBAGjBC,EAAkBvD,EAAAA,EAAQ,CAAC,CAC/B3B,OADIkF,CACMvD,CAAAA,EAAAA,EAAQ,GAAGM,QAAQ,EAC/B,GAGMkD,EAAcxD,EAAAA,EAAQ,CAAC,CAC3ByC,GADIe,EACJf,CAAOzC,EAAAA,EAAQ,EACjB,GAKO,eAAeyD,EAAIzF,CAAgB,EAApByF,GAChB,CAEF,IAAMZ,EAAO,EAAPA,IAAaH,EAAqB1E,GACxC,GAAI,CADoCA,CAAAA,EAC7B0F,OAAS,CAClB,OAAOC,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,gBACT,EAAE8F,MAAQ,IAAI,GAKlB,IAAMN,EAAO,MAAMiC,CAAAA,EAAAA,EAAAA,EAAAA,CAAAA,EAAAA,CACnB,OAAOF,EAAAA,YAAAA,CAAaC,IAAI,CAAC,CAAEhC,MAAK,EAClC,CAAE,MAAOxF,EAAO,CAEd,EAFc,KACdD,OAAQC,CAAAA,KAAK,CAAC,iCAAmCA,CAAAA,GAC1CuH,EAD0CvH,CAAAA,WAC1CuH,CAAaC,IAAI,CACtB,CAAExH,KAAO,mCACT,EAAE8F,MAAQ,IAAI,EAElB,CACF,CAKO,eAAe4B,EAAK9F,CAAgB,EACzC,CADoB8F,EAChB,CAEF,IAAMjB,EAAO,EAAPA,IAAaH,EAAqB1E,GACxC,GAAI,CADoCA,CAAAA,EAC7B0F,OAAS,CADoB1F,OAE/B2F,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,gBACT,EAAE8F,MAAQ,IAAI,GAKlB,IAAM6B,EAAO,EAAPA,IAAa/F,EAAQ4F,IAAI,CAAZ5F,EACb,UAAEK,CAAQ,CAAE,CAAGkF,EAAgBS,KAAK,CAACD,GAGrCE,CAHqCF,CAAAA,EAAtBR,EAGfU,EAAerD,EAAoBvC,GACzC,KADyCA,CAAAA,CAClCsF,EAAAA,KADkCtF,OAClCsF,CAAaC,IAAI,CAACK,EAC3B,CAAE,GADyBA,CAAAA,EAClB7H,EAAO,CACd,EADc,CACVA,KAAAA,QAAiB4D,EAAAA,CAAU,CAC7B,CAD+B,MACxB2D,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,wBAAwB8H,OAAAA,CAAS9H,EAAM+H,MAAM,GACtD,EAAEjC,MAAQ,IAAI,GAKlB,OADA/F,OAAQC,CAAAA,KAAK,CAAC,iCAAmCA,CAAAA,GAC1CuH,EAAAA,CAD0CvH,WAC1CuH,CAAaC,IAAI,CACtB,CAAExH,KAAO,oCACT,EAAE8F,MAAQ,IAAI,EAElB,CACF,CAKO,eAAekC,EAAMpG,CAAgB,EAC1C,EADoBoG,CAChB,CAEF,IAAMvB,EAAO,EAAPA,IAAaH,EAAqB1E,GACxC,GAAI,CADoCA,CAAAA,EAC7B0F,OAAS,CADoB1F,OAE/B2F,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,gBACT,EAAE8F,MAAQ,IAAI,GAKlB,IAAM6B,EAAO,EAAPA,IAAa/F,EAAQ4F,IAAI,CAAZ5F,EACb,OAAEyE,CAAK,CAAE,CAAGe,EAAYQ,KAAK,CAACD,GAG9B7B,CAH8B6B,CAAAA,IAG9B7B,EAAemC,CAAAA,EAAAA,EAAAA,EAAAA,CAAyB5B,CAAAA,GAC9C,EAD8CA,CAAAA,IACvCkB,EAAAA,YAAAA,CAAaC,IAAI,CAAC1B,EAC3B,CAAE,GADyBA,CAAAA,EAClB9F,EAAO,CACd,EADc,CACVA,KAAAA,QAAiB4D,EAAAA,CAAU,CAC7B,CAD+B,MACxB2D,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,wBAAwB8H,OAAAA,CAAS9H,EAAM+H,MAAM,GACtD,EAAEjC,MAAQ,IAAI,GAKlB,OADA/F,OAAQC,CAAAA,KAAK,CAAC,wCAA0CA,CAAAA,GACjDuH,EADiDvH,CAAAA,WACjDuH,CAAaC,IAAI,CACtB,CAAExH,KAAO,0CACT,EAAE8F,MAAQ,IAAI,EAElB,CACF,CAKO,eAAeoC,EAAOtG,CAAgB,EAC3C,GADoBsG,CAGlB,IAAMzB,EAAO,EAAPA,IAAaH,EAAqB1E,GACxC,GAAI,CADoCA,CAAAA,EAC7B0F,OAAS,CADoB1F,OAE/B2F,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,gBACT,EAAE8F,MAAQ,IAAI,GAMlB,IAAMO,EADM,GACE8B,CADEC,GAAIxG,CAAAA,EAAQuG,GAAG,EAAXvG,YACU,CAACf,GAAG,CAAC,SAEnC,GAAI,CAACwF,EACH,GADU,IACHkB,EAAAA,YAAAA,CAAaC,IAAI,CACtB,CAAExH,KAAO,2BACT,EAAE8F,MAAQ,IAAI,GAKlB,IAAM+B,EAAS,IAATA,EAAeQ,CAAAA,EAAAA,EAAAA,EAAAA,CAAoBhC,CAAAA,GACzC,EADyCA,CAAAA,IAClCkB,EAAAA,YAAAA,CAAaC,IAAI,CAACK,EAC3B,CAAE,GADyBA,CAAAA,EAClB7H,EAAO,CAEd,EAFc,KACdD,OAAQC,CAAAA,KAAK,CAAC,kCAAoCA,CAAAA,GAC3CuH,EAD2CvH,CAAAA,WAC3CuH,CAAaC,IAAI,CACtB,CAAExH,KAAO,oCACT,EAAE8F,MAAQ,IAAI,EAElB,CACF,CC3JA,IAAM,EAAqB,CAAE,GAAG,CAAU,CAAE,CAEtC,EACJ,OAHsB,UAEC,KACD,GAAI,EACtB,EAAmB,gBAAD,IAAC,CACnB,qBAAqB,GAAI,EACvB,EAAmB,gBAAD,GAAC,MACnB,EAER,OAFiB,EAER,EAAY,CAAO,CAAE,CAAM,EAAE,IAAlB,EAGlB,wBAAuD,EAAE,CAArD,OAAO,CAAC,GAAG,CAAC,UAAU,EAIH,UAAU,EAA7B,OAAO,EAHF,EAOF,GAJW,CAIP,CAPK,IAOA,CAAC,EAAS,CACxB,IADsB,CACjB,CAAE,CAAC,EAAkB,EAAS,IAAI,CAAN,IAAW,EAI1C,CAJsB,EAIlB,CACF,CAJS,GAAG,EAIc,GAAqB,IAJ1B,IAIkC,EAAE,CACzD,CADuB,CACb,GAAmB,EAAtB,KAA6B,CACrC,MAD4B,CACnB,CAAE,CAElB,CAGM,OAAO,4BAAiC,CAAC,EAAmB,CAC1D,MAAM,GACN,IAFuD,cAErC,CAAE,wBAAwB,SAC5C,CACR,CAAO,CAAC,CAAC,GADM,EACD,CAAC,EAAS,EACxB,CAAK,CADuB,CAAN,CAMjB,IAAC,EAAM,CAAH,CAAewC,EAA4B,GAAH,EAAQ,EAAlC,EAEV,EAAH,EAA4C,IAAH,EAAS,CAApC,CAElB,EAAM,CAAH,MAAeC,EAA4B,EAA7B,GAAkC,EAAR,EAEnC,EAAYC,CAAf,CAA6C,KAAH,EAA5B,EAEnB,EAAS,EAAYC,EAAf,MAA2C,CAA7B,CAAwC,EAE5D,EAAO,EAAH,KAAeC,EAA6B,EAA9B,IAAoC,CAAT,CAE7C,EAAU,KAAH,EAAeC,EAAgC,EAAjC,KAA8B,EAAY,ECzDrE,MAAwB,qBAAmB,EAC3C,YACA,KAAc,WAAS,WACvB,oCACA,kCACA,iBACA,4CACA,CAAK,CACL,kGACA,iBAVA,GAWA,QAAY,EACZ,CAAC,EAID,kBAAQ,wCAAsD,EAC9D,aACA,MAAW,gBAAW,EACtB,mBACA,sBACA,CAAK,CACL,0BC5BA,yDCAA,oEEAA,mJCMA,IAAMC,EAAYhF,EAAAA,EAAQ,CAAC,CAEzBiF,yBAA0BjF,EAAAA,EAAQ,GAAGuE,GAAG,GACxCW,8BAA+BlF,EAAAA,EAAQ,GAAGG,GAAG,CAAC,GAG9CgF,oBAAqBnF,EAAAA,EAAQ,GAAGuE,GAAG,GAAGjE,QAAQ,GAG9C8E,kBAAmBpF,EAAAA,EAAQ,GAAGM,QAAQ,GACtC+E,sBAAuBrF,EAAAA,EAAQ,GAAGM,QAAQ,GAG1CK,eAAgBX,EAAAA,EAAQ,GAAGM,QAAQ,GACnCgF,kBAAmBtF,EAAAA,EAAQ,GAAGM,QAAQ,GACtCiF,kBAAmBvF,EAAAA,EAAQ,GAAGM,QAAQ,GAGtCkF,yBAA0BxF,EAAAA,EAAQ,GAAGM,QAAQ,EAC/C,GAmBa1E,EAAM6J,CAdF,KACf,IAAMC,CAasB,CAbbV,EAAUW,SAAS,CAAClK,QAAQG,GAAG,EAE9C,GAAI,CAAC8J,EAAOE,OAAO,CAKjB,CALmB,KACnBzJ,QAAQC,KAAK,CACX,mCACAsJ,EAAOtJ,KAAK,CAACyJ,OAAO,GAAGC,WAAW,EAE9B,MAAU,iCAGlB,OAAOJ,EAAO1G,IAAI,CACpB,4BC1CA,qDCAA,4DCAA,iDCAA,yDCAA,uECCA,qCAA6C,CAC7C,QACA,CAAC,EAAC,OACF,+DAA8E,CAC9E,cACA,eACA,QACA,CACA,CAAC,EACD,MASA,cACA,mBACA,SAEA,sDACA,OACA,SACA,EAEA,WACA,eACA,gBAEA,OACA,cACA,EACA,yDACA,eACA,6DACA,iDACA,mBACA,6BAEA,UAQA,OAJA,YACA,GACA,WAEA,CACA,EAzCuD,EAAQ,KAAO,GACtE,SAD8D,EAC9D,GACA,0CACA,kBACA,cACA,qBACA,YACA,EAAK,GACL,CAkCA,OACA,YACA,EAEA,0CAIA,EAAoE,aAWpE,EAXuB,MAA6B,CAWpD,EAXuD,CAAa,EAYpE,sBAkBA,EAjBA,QAmBA,CACA,CA9BA,EACA,IACA,IACA,YACA,EAAM,OACN,cACA,CACA,CAAC,0BCtED,uDCAA,sDCAA,oDCAA,iDCAA,2DCAA,2DCAA,kDCAA,iDCAA,yDCAA,kECCA,qCAA6C,CAC7C,QACA,CAAC,EAAC,CAOF,cACA,0CACA,cACA,SACK,CACL,EACA,GACA,2CACA,QACA,CAAK,CACL,gDACA,QACA,CAAK,CACL,iDACA,QACA,CAAK,CACL,iEACA,QACA,CACA,CAAC,EACD,MAAiC,EAAQ,KAAmD,EAC5F,EAAuC,EAAQ,IAAiD,EAChG,WAD8C,CAC9C,IACA,iEAA4F,GAAO,kDAAkD,EAAW,kJAChK,aACA,cACA,eACA,CAAK,CACL,CACA,gBACA,iEAA4F,GAAO,6EAA6E,EAAW,kJAC3L,aACA,cACA,eACA,CAAK,CACL,CACA,cACA,2CAAmD,GAAO,2WAC1D,aACA,cACA,eACA,CAAK,CACL,CACA,aACA,yCACA,sDACA,oHCjDmCgB,EAAAA,EAAQ,CAAC,CAC1C8B,GAAI9B,EAAAA,EAAQ,GACZkC,OAAQlC,EAAAA,EAAM,CAAC,CAAC,UAAW,UAAW,YAAa,SAAU,YAAY,EACzE+B,MAAO/B,EAAAA,EAAQ,GACfmC,iBAAkBnC,EAAAA,EAAQ,GAAG+F,QAAQ,GACrC1H,SAAU2B,EAAAA,EAAQ,GAAG+F,QAAQ,GAC7B3D,WAAYpC,EAAAA,EAAQ,GACpBsC,YAAatC,EAAAA,EAAQ,GAAG+F,QAAQ,GAChC3J,MAAO4D,EAAAA,EAAQ,GAAG+F,QAAQ,GAC1BxD,SAAUvC,EAAAA,EAAQ,CAACA,EAAAA,EAAK,IAAIM,QAAQ,EACtC,GAAG,IAKGE,EAAS,IAAIC,EAAAA,EAAMA,CAAC,CACxBC,OAAQ9E,EAAAA,CAAGA,CAAC+E,cAAc,GAMrB,eAAe0D,EAAyB5B,CAAa,EAC1D,GAAI,CACF,IAAMf,EAAW,MAAMlB,EAAOmB,UAAU,CAACC,IAAI,CAACoE,QAAQ,CAACvD,GAGjDtE,EAAWM,CAAAA,EAAAA,EAAAA,EAAAA,CAAiBA,GAUlC,CAVsC,MACtC,MAAMN,EAASO,IAAI,CAAC,oBAAoBuH,KAD0C,CACpC,CAAC,CAC7C/D,OAAQR,EAASQ,MAAM,CACvBC,iBAAkBT,EAASS,gBAAgB,CAC3CG,YAAaZ,EAASY,WAAW,CAC7B,IAAIlB,KAA4B,IAAvBM,EAASY,WAAW,EAASD,WAAW,GACjD,KACJjG,MAAOsF,EAAStF,KAAK,CAAGsF,EAAStF,KAAK,CAAC8J,OAAO,CAAG,IACnD,GAAGnH,EAAE,CAAC,KAAM0D,GAEL,CACLP,OAAQR,EAASQ,MAAM,CACvBiE,eAAgBzE,EAASS,gBAAgB,CACzCiE,WAAY1E,EAASY,WAAW,CAC5B,IAAIlB,KAA4B,IAAvBM,EAASY,WAAW,EAASD,WAAW,GACjD,IACN,CACF,CAAE,MAAOjG,EAAO,CAEd,MADAD,QAAQC,KAAK,CAAC,yCAA0CA,GAClDA,CACR,CACF,CAKO,eAAeyH,IACpB,IAAM1F,EAAWM,CAAAA,EAAAA,EAAAA,EAAAA,CAAiBA,GAC5B,CADgC,KAC9BO,CAAI,OAAE5C,CAAK,CAAE,CAAG,MAAM+B,EAC3BO,IAAI,CAAC,eAF0E,KAG/EC,MAAM,CAAC,KACPE,KAAK,CAAC,aAAc,CAAEC,WAAW,CAAM,GAE1C,GAAI1C,EAEF,KAFS,CACTD,QAAQC,KAAK,CAAC,kCAAmCA,GAC3CA,EAGR,OAAO4C,CACT,CAKO,eAAeyF,EAAoBhC,CAAa,EACrD,GAAI,CACF,IAAMf,EAAW,MAAMlB,EAAOmB,UAAU,CAACC,IAAI,CAACyE,MAAM,CAAC5D,GAG/CtE,EAAWM,CAAAA,EAAAA,EAAAA,EAAAA,CAAiBA,GAKlC,CALsC,MACtC,MAAMN,EAASO,IAAI,CAAC,oBAAoBuH,KAD0C,CACpC,CAAC,CAC7C/D,OAAQR,EAASQ,MACnB,GAAGnD,EAAE,CAAC,KAAM0D,GAEL,CACLP,OAAQR,EAASQ,MAAM,CAE3B,CAAE,MAAO9F,EAAO,CAEd,MADAD,QAAQC,KAAK,CAAC,mCAAoCA,GAC5CA,CACR,CACF,0BC/FA,iDCAA,uCCAA,cACA,yCAEA,OADA,0BACA,CACA,CACA,cACA,YACA,WACA,uBCRA,cACA,yCAEA,OADA,0BACA,CACA,CACA,cACA,YACA,WACA","sources":["webpack://@hijraah/web/../../node_modules/.pnpm/next@15.3.0-canary.31_@babe_be67f368de2727c847f3a61f5e6cf4fa/node_modules/next/dist/server/web/spec-extension/adapters/reflect.js","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/after-task-async-storage.external.js\"","webpack://@hijraah/web/external commonjs2 \"module\"","webpack://@hijraah/web/../../node_modules/.pnpm/@opentelemetry+instrumentat_04f370d515cee0be955272f826166073/node_modules/@opentelemetry/instrumentation/build/esm/platform/node/ sync","webpack://@hijraah/web/external commonjs \"next/dist/compiled/next-server/app-page.runtime.prod.js\"","webpack://@hijraah/web/external commonjs2 \"punycode\"","webpack://@hijraah/web/external commonjs2 \"process\"","webpack://@hijraah/web/external commonjs2 \"os\"","webpack://@hijraah/web/./src/lib/supabase/client.ts","webpack://@hijraah/web/external commonjs2 \"stream\"","webpack://@hijraah/web/external commonjs2 \"util\"","webpack://@hijraah/web/external commonjs2 \"fs\"","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/work-async-storage.external.js\"","webpack://@hijraah/web/external node-commonjs \"node:child_process\"","webpack://@hijraah/web/external commonjs2 \"path\"","webpack://@hijraah/web/external commonjs2 \"tls\"","webpack://@hijraah/web/external commonjs2 \"diagnostics_channel\"","webpack://@hijraah/web/external node-commonjs \"node:http\"","webpack://@hijraah/web/external node-commonjs \"node:stream/web\"","webpack://@hijraah/web/external node-commonjs \"node:zlib\"","webpack://@hijraah/web/external node-commonjs \"node:tls\"","webpack://@hijraah/web/external node-commonjs \"node:https\"","webpack://@hijraah/web/external commonjs \"next/dist/compiled/next-server/app-route.runtime.prod.js\"","webpack://@hijraah/web/external node-commonjs \"node:os\"","webpack://@hijraah/web/external node-commonjs \"node:diagnostics_channel\"","webpack://@hijraah/web/external commonjs2 \"crypto\"","webpack://@hijraah/web/external commonjs2 \"https\"","webpack://@hijraah/web/./src/lib/ai/fine-tuning/data-collection.ts","webpack://@hijraah/web/./src/lib/ai/fine-tuning/fine-tuning-service-node.ts","webpack://@hijraah/web/./src/lib/auth/nextjs.ts","webpack://@hijraah/web/src/app/api/admin/fine-tuning/route.ts","webpack://@hijraah/web/sentry-wrapper-module","webpack://@hijraah/web/?cb51","webpack://@hijraah/web/external node-commonjs \"node:stream\"","webpack://@hijraah/web/external node-commonjs \"node:util\"","webpack://@hijraah/web/ignored|E:\\downloads\\Hijraah\\node_modules\\.pnpm\\ws@8.18.2_bufferutil@4.0.9\\node_modules\\ws\\lib|utf-8-validate","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/work-unit-async-storage.external.js\"","webpack://@hijraah/web/./src/_shared/config/env.mjs","webpack://@hijraah/web/external node-commonjs \"node:fs\"","webpack://@hijraah/web/external commonjs2 \"worker_threads\"","webpack://@hijraah/web/external commonjs2 \"zlib\"","webpack://@hijraah/web/external commonjs2 \"perf_hooks\"","webpack://@hijraah/web/external node-commonjs \"node:worker_threads\"","webpack://@hijraah/web/../../node_modules/.pnpm/next@15.3.0-canary.31_@babe_be67f368de2727c847f3a61f5e6cf4fa/node_modules/next/dist/server/create-deduped-by-callsite-server-error-logger.js","webpack://@hijraah/web/external node-commonjs \"node:path\"","webpack://@hijraah/web/external node-commonjs \"node:net\"","webpack://@hijraah/web/external commonjs2 \"buffer\"","webpack://@hijraah/web/external commonjs2 \"url\"","webpack://@hijraah/web/external commonjs2 \"child_process\"","webpack://@hijraah/web/external node-commonjs \"node:readline\"","webpack://@hijraah/web/external commonjs2 \"http\"","webpack://@hijraah/web/external commonjs2 \"tty\"","webpack://@hijraah/web/external commonjs2 \"async_hooks\"","webpack://@hijraah/web/external node-commonjs \"node:inspector\"","webpack://@hijraah/web/../../node_modules/.pnpm/next@15.3.0-canary.31_@babe_be67f368de2727c847f3a61f5e6cf4fa/node_modules/next/dist/server/request/utils.js","webpack://@hijraah/web/./src/lib/ai/fine-tuning/fine-tuning-service-shared.ts","webpack://@hijraah/web/external commonjs2 \"net\"","webpack://@hijraah/web/external commonjs2 \"events\"","webpack://@hijraah/web/../../node_modules/.pnpm/require-in-the-middle@7.5.2/node_modules/require-in-the-middle/ sync","webpack://@hijraah/web/../../node_modules/.pnpm/@supabase+realtime-js@2.11.10_bufferutil@4.0.9/node_modules/@supabase/realtime-js/dist/main/ sync"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"ReflectAdapter\", {\n    enumerable: true,\n    get: function() {\n        return ReflectAdapter;\n    }\n});\nclass ReflectAdapter {\n    static get(target, prop, receiver) {\n        const value = Reflect.get(target, prop, receiver);\n        if (typeof value === 'function') {\n            return value.bind(target);\n        }\n        return value;\n    }\n    static set(target, prop, value, receiver) {\n        return Reflect.set(target, prop, value, receiver);\n    }\n    static has(target, prop) {\n        return Reflect.has(target, prop);\n    }\n    static deleteProperty(target, prop) {\n        return Reflect.deleteProperty(target, prop);\n    }\n}\n\n//# sourceMappingURL=reflect.js.map","module.exports = require(\"next/dist/server/app-render/after-task-async-storage.external.js\");","module.exports = require(\"module\");","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 8963;\nmodule.exports = webpackEmptyContext;","module.exports = require(\"next/dist/compiled/next-server/app-page.runtime.prod.js\");","module.exports = require(\"punycode\");","module.exports = require(\"process\");","module.exports = require(\"os\");","import {\n  createBrowserClient as _createBrowserClient,\n  createServerClient as _createServerClient,\n} from \"@supabase/ssr\";\nimport {\n  createClient as createSupabaseClient,\n  SupabaseClient,\n  type SupabaseClient as CoreSupabaseClient,\n} from \"@supabase/supabase-js\";\nimport fetchPonyfill from \"fetch-ponyfill\";\nimport { useMemo } from \"react\";\n\nimport type { Database } from \"@/types/database.types\";\n\nimport type { ReadonlyRequestCookies } from \"next/dist/server/web/spec-extension/adapters/request-cookies\";\n\n// Get fetch from ponyfill to avoid undici issues like 'Failed to execute 'fetch' on 'Window': Invalid name'\n// See: https://github.com/vercel/next.js/issues/54827\nconst { fetch: ponyfetch } = fetchPonyfill();\n\n// Environment variables for Supabase\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n// Type alias for clarity\nexport type TypedSupabaseClient = SupabaseClient<Database>;\nexport type TypedSSRSupabaseClient = CoreSupabaseClient<Database>;\n\n// --------------------------------------\n// Shared header builders\n// --------------------------------------\n\n/**\n * Default headers that must accompany every request made via a browser or server client\n * which authenticates with the anonymous public key.  This prevents 401 responses from\n * PostgREST that indicate the `apikey` header is missing.\n */\nconst anonymousHeaders: Record<string, string> | undefined = supabaseAnonKey\n  ? { apikey: supabaseAnonKey }\n  : undefined;\n\n/**\n * Default headers for the service-role client.  These include the service key as both the\n * `apikey` header and (where relevant) the `Authorization` header is still injected by the\n * libraryʼs internal `fetchWithAuth` helper.\n */\nconst serviceHeaders: Record<string, string> | undefined = serviceRoleKey\n  ? { apikey: serviceRoleKey }\n  : undefined;\n\n// Helper function to check essential env vars\nfunction checkPublicEnvVars() {\n  if (process.env.NODE_ENV === \"development\") {\n    console.debug(\n      \"[Supabase Env] NEXT_PUBLIC_SUPABASE_URL present?\",\n      !!supabaseUrl\n    );\n    console.debug(\n      \"[Supabase Env] NEXT_PUBLIC_SUPABASE_ANON_KEY present?\",\n      !!supabaseAnonKey\n    );\n    console.debug(\n      \"[Supabase Env] SUPABASE_SERVICE_ROLE_KEY present?\",\n      !!serviceRoleKey\n    );\n  }\n  if (!supabaseUrl || !supabaseAnonKey) {\n    console.error(\n      \"Missing environment variables NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\"\n    );\n    throw new Error(\"Supabase URL or Anon Key is missing.\");\n  }\n}\n\n// --------------------------------------\n// Patch global `fetch` on the **server** to use `ponyfetch`.\n// This avoids the infamous Undici \"Socket closed unexpectedly\" bug on\n// Windows/Node 18-20 without relying on fragile Undici internals.\n// The patch is idempotent and NO-OPs in the browser.\n\nif (typeof window === \"undefined\") {\n  const g = globalThis as any;\n  if (!g.__USING_PONYFETCH__) {\n    g.fetch = ponyfetch as unknown as typeof fetch;\n    g.__USING_PONYFETCH__ = true;\n    console.info(\"[Supabase] Server fetch patched to use ponyfetch ✅\");\n  }\n}\n\n// --- Browser Client (Singleton with Hook) ---\nlet browserClientInstance: TypedSSRSupabaseClient | undefined;\n\nfunction getSupabaseBrowserClient(): TypedSSRSupabaseClient {\n  checkPublicEnvVars();\n  if (browserClientInstance) {\n    return browserClientInstance;\n  }\n\n  // In the browser we rely on the native `fetch` implementation to ensure that\n  // request headers (apikey/Authorization) are preserved. Injecting a ponyfill\n  // here has proven to strip custom headers in certain edge-cases, leading to\n  // 401 \"No API key found\" responses. Therefore we only attach the required\n  // headers and leave `fetch` undefined so @supabase/ssr uses the global one.\n\n  browserClientInstance = _createBrowserClient<Database>(\n    supabaseUrl!,\n    supabaseAnonKey!,\n    {\n      global: {\n        headers: anonymousHeaders,\n      },\n    }\n  );\n\n  if (typeof window !== \"undefined\") {\n    console.debug(\"[Supabase] anon key present?\", !!supabaseAnonKey);\n  }\n\n  return browserClientInstance;\n}\n\n/**\n * Hook to get a Supabase client instance suitable for Browser/Client Components.\n * Uses a singleton pattern to ensure only one client instance is created.\n * Leverages @supabase/ssr for proper session handling with Next.js App Router.\n * @returns Memoized Supabase client instance for browser usage.\n */\nexport function useSupabaseBrowser(): TypedSSRSupabaseClient {\n  return useMemo(getSupabaseBrowserClient, []);\n}\n\n// This is the primary export for creating a browser client directly\nexport function createClient(): TypedSSRSupabaseClient {\n  checkPublicEnvVars();\n  return _createBrowserClient<Database>(supabaseUrl!, supabaseAnonKey!, {\n    global: {\n      headers: anonymousHeaders,\n    },\n  });\n}\n\n// --- Server Client (For Server Components, Route Handlers, Server Actions) ---\n\n/**\n * Creates a Supabase client suitable for use in Server Components, Server Actions,\n * and Route Handlers that require access to cookies.\n * @param cookieStore A ReadonlyRequestCookies instance (e.g., from `next/headers`).\n * @returns Supabase client instance for server-side usage with cookie handling.\n */\nexport function createSupabaseServerClient(\n  cookieStore: ReadonlyRequestCookies\n): TypedSSRSupabaseClient {\n  checkPublicEnvVars();\n  return _createServerClient<Database>(supabaseUrl!, supabaseAnonKey!, {\n    cookies: {\n      get(name: string) {\n        return cookieStore.get(name)?.value;\n      },\n      set(name: string, value: string, options) {\n        try {\n          cookieStore.set(name, value, options);\n        } catch (error) {\n          console.warn(`Failed to set cookie '${name}':`, error);\n        }\n      },\n      remove(name: string, options) {\n        try {\n          cookieStore.set(name, \"\", options);\n        } catch (error) {\n          console.warn(`Failed to remove cookie '${name}':`, error);\n        }\n      },\n    },\n    global: {\n      fetch: ponyfetch,\n      headers: anonymousHeaders,\n    },\n  });\n}\n\n// --- Service Role Client (Admin Operations) ---\n\n/**\n * Creates a Supabase client with the service role key for admin operations.\n * WARNING: This client bypasses RLS. Use only in trusted server-side environments\n * with proper authorization checks. NEVER expose the service role key to the browser.\n * @returns Supabase client instance with service_role privileges.\n */\nexport function createSupabaseServiceClient(): TypedSupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    console.error(\"Supabase URL or Service Role Key is missing\");\n    throw new Error(\"Supabase service client configuration is incomplete.\");\n  }\n\n  return createSupabaseClient<Database>(supabaseUrl, serviceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n    global: {\n      fetch: ponyfetch,\n      headers: serviceHeaders,\n    },\n  });\n}\n\n// --- Client with Custom Auth Token ---\n\n/**\n * Creates a Supabase client authenticated with a custom JWT token.\n * Useful for scenarios like testing or specific server-to-server interactions.\n * @param authToken JWT token for authentication.\n * @returns Authenticated Supabase client instance.\n */\nexport function createClientWithAuth(authToken: string): TypedSupabaseClient {\n  checkPublicEnvVars();\n  return createSupabaseClient<Database>(supabaseUrl!, supabaseAnonKey!, {\n    auth: {\n      persistSession: false,\n      autoRefreshToken: false,\n      detectSessionInUrl: false,\n    },\n    global: {\n      fetch: ponyfetch,\n      headers: {\n        Authorization: `Bearer ${authToken}`,\n        ...(anonymousHeaders ?? {}),\n      },\n    },\n  });\n}\n\n// ======================================\n// EDGE RUNTIME CLIENT\n// ======================================\n\n/**\n * Creates a Supabase client suitable for Edge Runtime environments (e.g., Edge Functions, Middleware).\n * Reads cookies from the Request headers. Requires manual handling for setting/removing cookies\n * via Response headers in the calling Edge function.\n * @param request The Request object from the Edge Function context.\n */\nexport const createEdgeClient = (request: Request): TypedSSRSupabaseClient => {\n  checkPublicEnvVars();\n  const cookieHeader = request.headers.get(\"cookie\") ?? \"\";\n\n  return _createServerClient<Database>(supabaseUrl!, supabaseAnonKey!, {\n    cookies: {\n      get(name: string) {\n        const match = cookieHeader.match(new RegExp(`(^|;)\\s*${name}=([^;]+)`));\n        return match?.[2];\n      },\n      set(name: string, value: string, options) {\n        console.warn(\n          `Attempted to set cookie '${name}' in createEdgeClient. This must be handled by the caller via Response headers.`\n        );\n      },\n      remove(name: string, options) {\n        console.warn(\n          `Attempted to remove cookie '${name}' in createEdgeClient. This must be handled by the caller via Response headers.`\n        );\n      },\n    },\n    global: {\n      fetch: ponyfetch,\n      headers: anonymousHeaders,\n    },\n  });\n};\n\n// --- Remove Deprecated Compatibility Exports ---\n\n/**\n * @deprecated Use `useSupabaseBrowser` in Client Components or `createSupabaseServerClient` in Server Components/Actions/Routes.\n */\nexport const getSupabaseClient = getSupabaseBrowserClient;\n\n/**\n * @deprecated Use `createSupabaseServiceClient` for elevated privilege operations.\n */\nexport const createServiceClient = createSupabaseServiceClient;\n\n/**\n * @deprecated Prefer specific client creation (`useSupabaseBrowser`, `createSupabaseServerClient`, `createSupabaseServiceClient`). Avoid direct default export usage.\n */\nexport const supabase = getSupabaseBrowserClient();\n","module.exports = require(\"stream\");","module.exports = require(\"util\");","module.exports = require(\"fs\");","module.exports = require(\"next/dist/server/app-render/work-async-storage.external.js\");","module.exports = require(\"node:child_process\");","module.exports = require(\"path\");","module.exports = require(\"tls\");","module.exports = require(\"diagnostics_channel\");","module.exports = require(\"node:http\");","module.exports = require(\"node:stream/web\");","module.exports = require(\"node:zlib\");","module.exports = require(\"node:tls\");","module.exports = require(\"node:https\");","module.exports = require(\"next/dist/compiled/next-server/app-route.runtime.prod.js\");","module.exports = require(\"node:os\");","module.exports = require(\"node:diagnostics_channel\");","module.exports = require(\"crypto\");","module.exports = require(\"https\");","import { nanoid } from 'nanoid';\r\nimport { z } from 'zod';\r\n\r\nimport { getSupabaseClient } from '@/lib/supabase/client';\r\nimport { ChatMessage } from '@/types/chat';\r\n\r\n// Schema for validation\r\nexport const FeedbackSchema = z.object({\r\n  sessionId: z.string(),\r\n  rating: z.number().min(1).max(5),\r\n  feedback: z.string().optional(),\r\n  isHelpful: z.boolean(),\r\n  category: z.enum(['visa', 'requirements', 'document', 'process', 'eligibility', 'other']),\r\n});\r\n\r\nexport type FeedbackData = z.infer<typeof FeedbackSchema>;\r\n\r\n/**\r\n * Save user feedback for AI responses to use for fine-tuning\r\n */\r\nexport async function saveResponseFeedback(\r\n  userId: string,\r\n  messages: ChatMessage[],\r\n  feedback: FeedbackData\r\n) {\r\n  const supabase = getSupabaseClient();\r\n  const feedbackId = nanoid();\r\n\r\n  // Extract user query and AI response pairs for fine-tuning\r\n  const trainingPairs = extractTrainingPairs(messages);\r\n\r\n  const { error } = await supabase\r\n    .from('ai_feedback')\r\n    .insert({\r\n      id: feedbackId,\r\n      user_id: userId,\r\n      session_id: feedback.sessionId,\r\n      messages,\r\n      rating: feedback.rating,\r\n      feedback: feedback.feedback || '',\r\n      is_helpful: feedback.isHelpful,\r\n      category: feedback.category,\r\n      training_pairs: trainingPairs,\r\n      created_at: new Date().toISOString(),\r\n    });\r\n\r\n  if (error) {\r\n    console.error('Error saving feedback:', error);\r\n    throw error;\r\n  }\r\n\r\n  return feedbackId;\r\n}\r\n\r\n/**\r\n * Extract training pairs from a conversation for fine-tuning\r\n */\r\nfunction extractTrainingPairs(messages: ChatMessage[]) {\r\n  const pairs = [];\r\n  \r\n  // Skip the first message if it's from the system\r\n  let startIdx = messages[0]?.role === 'system' ? 1 : 0;\r\n  \r\n  for (let i = startIdx; i < messages.length - 1; i++) {\r\n    if (messages[i].role === 'user' && messages[i + 1].role === 'assistant') {\r\n      pairs.push({\r\n        input: messages[i].content,\r\n        output: messages[i + 1].content,\r\n      });\r\n    }\r\n  }\r\n  \r\n  return pairs;\r\n}\r\n\r\n/**\r\n * Get high-quality training pairs for fine-tuning\r\n */\r\nexport async function getTrainingDataForFineTuning(\r\n  category?: string,\r\n  minRating = 4,\r\n  limit = 1000\r\n) {\r\n  const supabase = getSupabaseClient();\r\n  \r\n  let query = supabase\r\n    .from('ai_feedback')\r\n    .select('*')\r\n    .gte('rating', minRating)\r\n    .order('created_at', { ascending: false })\r\n    .limit(limit);\r\n    \r\n  if (category) {\r\n    query = query.eq('category', category);\r\n  }\r\n  \r\n  const { data, error } = await query;\r\n  \r\n  if (error) {\r\n    console.error('Error getting training data:', error);\r\n    throw error;\r\n  }\r\n  \r\n  // Flatten all training pairs\r\n  const trainingData = data.flatMap(item => item.training_pairs || []);\r\n  \r\n  return trainingData;\r\n}\r\n\r\n/**\r\n * Export training data in JSONL format for OpenAI fine-tuning\r\n */\r\nexport async function exportTrainingDataForOpenAI(category?: string) {\r\n  const trainingData = await getTrainingDataForFineTuning(category);\r\n  \r\n  // Format for OpenAI fine-tuning\r\n  const jsonlData = trainingData.map(pair => {\r\n    return JSON.stringify({\r\n      messages: [\r\n        { role: \"system\", content: \"You are a helpful immigration assistant that provides accurate, helpful information about immigration processes, requirements, and deadlines.\" },\r\n        { role: \"user\", content: pair.input },\r\n        { role: \"assistant\", content: pair.output }\r\n      ]\r\n    });\r\n  }).join('\\n');\r\n  \r\n  return jsonlData;\r\n}\r\n\r\n/**\r\n * Get curated examples for few-shot learning\r\n */\r\nexport async function getCuratedExamples(category: string, limit = 5) {\r\n  const data = await getTrainingDataForFineTuning(category, 5, limit);\r\n  return data;\r\n} ","import fs from 'fs';\r\nimport path from 'path';\r\n\r\nimport { OpenAI } from 'openai';\r\nimport { z } from 'zod';\r\n\r\nimport { getSupabaseClient } from '@/lib/supabase/client';\r\nimport { env } from '@/shared/config/env.mjs';\r\n\r\nimport { exportTrainingDataForOpenAI } from './data-collection';\r\n\r\n// OpenAI client initialization\r\nconst openai = new OpenAI({\r\n  apiKey: env.OPENAI_API_KEY,\r\n});\r\n\r\n/**\r\n * Create a new fine-tuning job\r\n */\r\nexport async function createFineTuningJob(category?: string) {\r\n  // Get the training data\r\n  const jsonlData = await exportTrainingDataForOpenAI(category);\r\n  \r\n  // Create a temporary file to store the training data\r\n  const tempDir = path.join(process.cwd(), 'tmp');\r\n  if (!fs.existsSync(tempDir)) {\r\n    fs.mkdirSync(tempDir, { recursive: true });\r\n  }\r\n  \r\n  const tempFile = path.join(tempDir, `training-${Date.now()}.jsonl`);\r\n  fs.writeFileSync(tempFile, jsonlData);\r\n\r\n  try {\r\n    // Upload the file to OpenAI\r\n    const file = await openai.files.create({\r\n      file: fs.createReadStream(tempFile),\r\n      purpose: 'fine-tune',\r\n    });\r\n\r\n    // Create fine-tuning job\r\n    const response = await openai.fineTuning.jobs.create({\r\n      training_file: file.id,\r\n      model: 'gpt-3.5-turbo',\r\n      suffix: `immigration-${category || 'general'}-${Date.now()}`,\r\n    });\r\n\r\n    // Store the job in the database\r\n    const supabase = getSupabaseClient(); // Assumes this client works in Node.js\r\n    await supabase.from('fine_tuning_jobs').insert({\r\n      id: response.id,\r\n      status: response.status,\r\n      model: response.model,\r\n      fine_tuned_model: null,\r\n      category: category || null,\r\n      created_at: new Date(response.created_at * 1000).toISOString(),\r\n      finished_at: null,\r\n      error: null,\r\n      metadata: {\r\n        training_file: file.id,\r\n        hyperparameters: response.hyperparameters,\r\n      },\r\n    });\r\n\r\n    return {\r\n      jobId: response.id,\r\n      status: response.status,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating fine-tuning job:', error);\r\n    throw error;\r\n  } finally {\r\n    // Clean up the temporary file\r\n    if (fs.existsSync(tempFile)) {\r\n      fs.unlinkSync(tempFile);\r\n    }\r\n  }\r\n} ","import { createServerClient, type CookieOptions } from \"@supabase/ssr\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nimport { type Database } from \"@/types/database.types\";\r\n\r\nimport { ExtendedUser } from \"./types\";\r\n\r\nimport type { User } from \"@supabase/supabase-js\";\r\n\r\n/**\r\n * Get the authenticated user from the request\r\n * For Next.js API routes\r\n */\r\nexport async function getAuthenticatedUser(\r\n  request: Request\r\n): Promise<ExtendedUser | null> {\r\n  const supabase = createServerSupabaseClientForApiRoute();\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser();\r\n\r\n  if (userError || !user) {\r\n    if (userError) {\r\n      console.error(\"Error fetching user in getAuthenticatedUser (API route):\");\r\n    }\r\n    return null;\r\n  }\r\n\r\n  const extendedUser: ExtendedUser = {\r\n    ...user,\r\n    fullName: user.user_metadata?.full_name || user.user_metadata?.name,\r\n    avatarUrl: user.user_metadata?.avatar_url,\r\n    role:\r\n      user.user_metadata?.role === \"admin\" ||\r\n      user.user_metadata?.role === \"user\"\r\n        ? user.user_metadata.role\r\n        : \"user\",\r\n  };\r\n\r\n  return extendedUser;\r\n}\r\n\r\n/**\r\n * Create a Supabase client using @supabase/ssr for server-side API routes.\r\n * NOTE: Provides only the `get` cookie method due to limitations in API routes.\r\n * This client might not handle token refreshes automatically.\r\n */\r\nfunction createServerSupabaseClientForApiRoute() {\r\n  const cookieStore = cookies();\r\n\r\n  return createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value;\r\n        },\r\n      },\r\n    }\r\n  );\r\n}\r\n","import { NextResponse } from 'next/server';\r\nimport { z } from 'zod';\r\n\r\nimport { \r\n  createFineTuningJob \r\n} from '@/lib/ai/fine-tuning/fine-tuning-service-node';\r\nimport {\r\n  checkFineTuningJobStatus,\r\n  listFineTuningJobs,\r\n  cancelFineTuningJob,\r\n  listFineTunedModels,\r\n} from '@/lib/ai/fine-tuning/fine-tuning-service-shared';\r\nimport { loadFineTunedModels } from '@/lib/ai/models';\r\nimport { getAuthenticatedUser } from '@/lib/auth/nextjs';\r\n\r\n// Export configuration\r\nexport const runtime = 'nodejs';\r\nexport const dynamic = 'force-dynamic';\r\n\r\n// Input validation schema for creating a job\r\nconst CreateJobSchema = z.object({\r\n  category: z.string().optional(),\r\n});\r\n\r\n// Input validation schema for checking job status\r\nconst JobIdSchema = z.object({\r\n  jobId: z.string(),\r\n});\r\n\r\n/**\r\n * GET handler - list all fine-tuning jobs\r\n */\r\nexport async function GET(request: Request) {\r\n  try {\r\n    // Perform admin authorization check\r\n    const user = await getAuthenticatedUser(request);\r\n    if (!user?.isAdmin) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Get jobs\r\n    const jobs = await listFineTuningJobs();\r\n    return NextResponse.json({ jobs });\r\n  } catch (error) {\r\n    console.error('Error listing fine-tuning jobs:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to list fine-tuning jobs' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * POST handler - create a new fine-tuning job\r\n */\r\nexport async function POST(request: Request) {\r\n  try {\r\n    // Perform admin authorization check\r\n    const user = await getAuthenticatedUser(request);\r\n    if (!user?.isAdmin) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Parse and validate request\r\n    const body = await request.json();\r\n    const { category } = CreateJobSchema.parse(body);\r\n\r\n    // Create job\r\n    const result = await createFineTuningJob(category);\r\n    return NextResponse.json(result);\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid request data', details: error.format() },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    console.error('Error creating fine-tuning job:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create fine-tuning job' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * PATCH handler - check or update job status\r\n */\r\nexport async function PATCH(request: Request) {\r\n  try {\r\n    // Perform admin authorization check\r\n    const user = await getAuthenticatedUser(request);\r\n    if (!user?.isAdmin) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Parse and validate request\r\n    const body = await request.json();\r\n    const { jobId } = JobIdSchema.parse(body);\r\n\r\n    // Check job status\r\n    const status = await checkFineTuningJobStatus(jobId);\r\n    return NextResponse.json(status);\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid request data', details: error.format() },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    console.error('Error checking fine-tuning job status:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to check fine-tuning job status' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE handler - cancel a fine-tuning job\r\n */\r\nexport async function DELETE(request: Request) {\r\n  try {\r\n    // Perform admin authorization check\r\n    const user = await getAuthenticatedUser(request);\r\n    if (!user?.isAdmin) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Parse URL to get job ID\r\n    const url = new URL(request.url);\r\n    const jobId = url.searchParams.get('jobId');\r\n    \r\n    if (!jobId) {\r\n      return NextResponse.json(\r\n        { error: 'Missing jobId parameter' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Cancel job\r\n    const result = await cancelFineTuningJob(jobId);\r\n    return NextResponse.json(result);\r\n  } catch (error) {\r\n    console.error('Error canceling fine-tuning job:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to cancel fine-tuning job' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n} ","import * as origModule from 'next/dist/server/app-render/work-unit-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport {} from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nimport * as Sentry from '@sentry/nextjs';\n\n// @ts-expect-error Because we cannot be sure if the RequestAsyncStorage module exists (it is not part of the Next.js public\n// API) we use a shim if it doesn't exist. The logic for this is in the wrapping loader.\n\nconst asyncStorageModule = { ...origModule } ;\n\nconst requestAsyncStorage =\n  'workUnitAsyncStorage' in asyncStorageModule\n    ? asyncStorageModule.workUnitAsyncStorage\n    : 'requestAsyncStorage' in asyncStorageModule\n      ? asyncStorageModule.requestAsyncStorage\n      : undefined;\n\nfunction wrapHandler(handler, method) {\n  // Running the instrumentation code during the build phase will mark any function as \"dynamic\" because we're accessing\n  // the Request object. We do not want to turn handlers dynamic so we skip instrumentation in the build phase.\n  if (process.env.NEXT_PHASE === 'phase-production-build') {\n    return handler;\n  }\n\n  if (typeof handler !== 'function') {\n    return handler;\n  }\n\n  return new Proxy(handler, {\n    apply: (originalFunction, thisArg, args) => {\n      let headers = undefined;\n\n      // We try-catch here just in case the API around `requestAsyncStorage` changes unexpectedly since it is not public API\n      try {\n        const requestAsyncStore = requestAsyncStorage?.getStore() ;\n        headers = requestAsyncStore?.headers;\n      } catch (e) {\n        /** empty */\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return Sentry.wrapRouteHandlerWithSentry(originalFunction , {\n        method,\n        parameterizedRoute: '/api/admin/fine-tuning',\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst GET = wrapHandler(serverComponentModule.GET , 'GET');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst POST = wrapHandler(serverComponentModule.POST , 'POST');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PUT = wrapHandler(serverComponentModule.PUT , 'PUT');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PATCH = wrapHandler(serverComponentModule.PATCH , 'PATCH');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst DELETE = wrapHandler(serverComponentModule.DELETE , 'DELETE');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst HEAD = wrapHandler(serverComponentModule.HEAD , 'HEAD');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst OPTIONS = wrapHandler(serverComponentModule.OPTIONS , 'OPTIONS');\n\nexport { DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT };\n","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\api\\\\admin\\\\fine-tuning\\\\route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/admin/fine-tuning/route\",\n        pathname: \"/api/admin/fine-tuning\",\n        filename: \"route\",\n        bundlePath: \"app/api/admin/fine-tuning/route\"\n    },\n    resolvedPagePath: \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\api\\\\admin\\\\fine-tuning\\\\route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","module.exports = require(\"node:stream\");","module.exports = require(\"node:util\");","/* (ignored) */","module.exports = require(\"next/dist/server/app-render/work-unit-async-storage.external.js\");","import { z } from 'zod';\r\n\r\n/**\r\n * Environment variable configuration and validation\r\n */\r\n\r\nconst envSchema = z.object({\r\n  // Supabase\r\n  NEXT_PUBLIC_SUPABASE_URL: z.string().url(),\r\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.string().min(1),\r\n  \r\n  // App\r\n  NEXT_PUBLIC_APP_URL: z.string().url().optional(),\r\n  \r\n  // Stripe\r\n  STRIPE_SECRET_KEY: z.string().optional(),\r\n  STRIPE_WEBHOOK_SECRET: z.string().optional(),\r\n  \r\n  // AI Services\r\n  OPENAI_API_KEY: z.string().optional(),\r\n  ANTHROPIC_API_KEY: z.string().optional(),\r\n  GOOGLE_AI_API_KEY: z.string().optional(),\r\n  \r\n  // Analytics\r\n  NEXT_PUBLIC_ANALYTICS_ID: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Parse and validate environment variables\r\n */\r\nconst parseEnv = () => {\r\n  const parsed = envSchema.safeParse(process.env);\r\n  \r\n  if (!parsed.success) {\r\n    console.error(\r\n      \"❌ Invalid environment variables:\",\r\n      parsed.error.flatten().fieldErrors\r\n    );\r\n    throw new Error(\"Invalid environment variables\");\r\n  }\r\n  \r\n  return parsed.data;\r\n};\r\n\r\nexport const env = parseEnv();","module.exports = require(\"node:fs\");","module.exports = require(\"worker_threads\");","module.exports = require(\"zlib\");","module.exports = require(\"perf_hooks\");","module.exports = require(\"node:worker_threads\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"createDedupedByCallsiteServerErrorLoggerDev\", {\n    enumerable: true,\n    get: function() {\n        return createDedupedByCallsiteServerErrorLoggerDev;\n    }\n});\nconst _react = /*#__PURE__*/ _interop_require_wildcard(require(\"react\"));\nfunction _getRequireWildcardCache(nodeInterop) {\n    if (typeof WeakMap !== \"function\") return null;\n    var cacheBabelInterop = new WeakMap();\n    var cacheNodeInterop = new WeakMap();\n    return (_getRequireWildcardCache = function(nodeInterop) {\n        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n    })(nodeInterop);\n}\nfunction _interop_require_wildcard(obj, nodeInterop) {\n    if (!nodeInterop && obj && obj.__esModule) {\n        return obj;\n    }\n    if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n        return {\n            default: obj\n        };\n    }\n    var cache = _getRequireWildcardCache(nodeInterop);\n    if (cache && cache.has(obj)) {\n        return cache.get(obj);\n    }\n    var newObj = {\n        __proto__: null\n    };\n    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n    for(var key in obj){\n        if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n            if (desc && (desc.get || desc.set)) {\n                Object.defineProperty(newObj, key, desc);\n            } else {\n                newObj[key] = obj[key];\n            }\n        }\n    }\n    newObj.default = obj;\n    if (cache) {\n        cache.set(obj, newObj);\n    }\n    return newObj;\n}\nconst errorRef = {\n    current: null\n};\n// React.cache is currently only available in canary/experimental React channels.\nconst cache = typeof _react.cache === 'function' ? _react.cache : (fn)=>fn;\n// When Dynamic IO is enabled, we record these as errors so that they\n// are captured by the dev overlay as it's more critical to fix these\n// when enabled.\nconst logErrorOrWarn = process.env.__NEXT_DYNAMIC_IO ? console.error : console.warn;\n// We don't want to dedupe across requests.\n// The developer might've just attempted to fix the warning so we should warn again if it still happens.\nconst flushCurrentErrorIfNew = cache(// eslint-disable-next-line @typescript-eslint/no-unused-vars -- cache key\n(key)=>{\n    try {\n        logErrorOrWarn(errorRef.current);\n    } finally{\n        errorRef.current = null;\n    }\n});\nfunction createDedupedByCallsiteServerErrorLoggerDev(getMessage) {\n    return function logDedupedError(...args) {\n        const message = getMessage(...args);\n        if (process.env.NODE_ENV !== 'production') {\n            var _stack;\n            const callStackFrames = (_stack = new Error().stack) == null ? void 0 : _stack.split('\\n');\n            if (callStackFrames === undefined || callStackFrames.length < 4) {\n                logErrorOrWarn(message);\n            } else {\n                // Error:\n                //   logDedupedError\n                //   asyncApiBeingAccessedSynchronously\n                //   <userland callsite>\n                // TODO: This breaks if sourcemaps with ignore lists are enabled.\n                const key = callStackFrames[4];\n                errorRef.current = message;\n                flushCurrentErrorIfNew(key);\n            }\n        } else {\n            logErrorOrWarn(message);\n        }\n    };\n}\n\n//# sourceMappingURL=create-deduped-by-callsite-server-error-logger.js.map","module.exports = require(\"node:path\");","module.exports = require(\"node:net\");","module.exports = require(\"buffer\");","module.exports = require(\"url\");","module.exports = require(\"child_process\");","module.exports = require(\"node:readline\");","module.exports = require(\"http\");","module.exports = require(\"tty\");","module.exports = require(\"async_hooks\");","module.exports = require(\"node:inspector\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n0 && (module.exports = {\n    isRequestAPICallableInsideAfter: null,\n    throwForSearchParamsAccessInUseCache: null,\n    throwWithStaticGenerationBailoutError: null,\n    throwWithStaticGenerationBailoutErrorWithDynamicError: null\n});\nfunction _export(target, all) {\n    for(var name in all)Object.defineProperty(target, name, {\n        enumerable: true,\n        get: all[name]\n    });\n}\n_export(exports, {\n    isRequestAPICallableInsideAfter: function() {\n        return isRequestAPICallableInsideAfter;\n    },\n    throwForSearchParamsAccessInUseCache: function() {\n        return throwForSearchParamsAccessInUseCache;\n    },\n    throwWithStaticGenerationBailoutError: function() {\n        return throwWithStaticGenerationBailoutError;\n    },\n    throwWithStaticGenerationBailoutErrorWithDynamicError: function() {\n        return throwWithStaticGenerationBailoutErrorWithDynamicError;\n    }\n});\nconst _staticgenerationbailout = require(\"../../client/components/static-generation-bailout\");\nconst _aftertaskasyncstorageexternal = require(\"../app-render/after-task-async-storage.external\");\nfunction throwWithStaticGenerationBailoutError(route, expression) {\n    throw Object.defineProperty(new _staticgenerationbailout.StaticGenBailoutError(`Route ${route} couldn't be rendered statically because it used ${expression}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`), \"__NEXT_ERROR_CODE\", {\n        value: \"E576\",\n        enumerable: false,\n        configurable: true\n    });\n}\nfunction throwWithStaticGenerationBailoutErrorWithDynamicError(route, expression) {\n    throw Object.defineProperty(new _staticgenerationbailout.StaticGenBailoutError(`Route ${route} with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used ${expression}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`), \"__NEXT_ERROR_CODE\", {\n        value: \"E543\",\n        enumerable: false,\n        configurable: true\n    });\n}\nfunction throwForSearchParamsAccessInUseCache(route) {\n    throw Object.defineProperty(new Error(`Route ${route} used \"searchParams\" inside \"use cache\". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \"searchParams\" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`), \"__NEXT_ERROR_CODE\", {\n        value: \"E634\",\n        enumerable: false,\n        configurable: true\n    });\n}\nfunction isRequestAPICallableInsideAfter() {\n    const afterTaskStore = _aftertaskasyncstorageexternal.afterTaskAsyncStorage.getStore();\n    return (afterTaskStore == null ? void 0 : afterTaskStore.rootTaskSpawnPhase) === 'action';\n}\n\n//# sourceMappingURL=utils.js.map","import { OpenAI } from 'openai';\r\nimport { z } from 'zod';\r\n\r\nimport { getSupabaseClient } from '@/lib/supabase/client';\r\nimport { env } from '@/shared/config/env.mjs';\r\n\r\n// Schema definitions\r\nexport const FineTuningJobSchema = z.object({\r\n  id: z.string(),\r\n  status: z.enum(['pending', 'running', 'succeeded', 'failed', 'cancelled']),\r\n  model: z.string(),\r\n  fine_tuned_model: z.string().nullable(),\r\n  category: z.string().nullable(),\r\n  created_at: z.string(),\r\n  finished_at: z.string().nullable(),\r\n  error: z.string().nullable(),\r\n  metadata: z.record(z.any()).optional(),\r\n});\r\n\r\nexport type FineTuningJob = z.infer<typeof FineTuningJobSchema>;\r\n\r\n// OpenAI client initialization\r\nconst openai = new OpenAI({\r\n  apiKey: env.OPENAI_API_KEY,\r\n});\r\n\r\n/**\r\n * Check the status of a fine-tuning job\r\n */\r\nexport async function checkFineTuningJobStatus(jobId: string) {\r\n  try {\r\n    const response = await openai.fineTuning.jobs.retrieve(jobId);\r\n    \r\n    // Update the job in the database\r\n    const supabase = getSupabaseClient(); // Assumes this client works in Edge/Browser\r\n    await supabase.from('fine_tuning_jobs').update({\r\n      status: response.status,\r\n      fine_tuned_model: response.fine_tuned_model,\r\n      finished_at: response.finished_at \r\n        ? new Date(response.finished_at * 1000).toISOString() \r\n        : null,\r\n      error: response.error ? response.error.message : null,\r\n    }).eq('id', jobId);\r\n\r\n    return {\r\n      status: response.status,\r\n      fineTunedModel: response.fine_tuned_model,\r\n      finishedAt: response.finished_at \r\n        ? new Date(response.finished_at * 1000).toISOString() \r\n        : null,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error checking fine-tuning job status:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * List all fine-tuning jobs\r\n */\r\nexport async function listFineTuningJobs() {\r\n  const supabase = getSupabaseClient(); // Assumes this client works in Edge/Browser\r\n  const { data, error } = await supabase\r\n    .from('fine_tuning_jobs')\r\n    .select('*')\r\n    .order('created_at', { ascending: false });\r\n\r\n  if (error) {\r\n    console.error('Error listing fine-tuning jobs:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data as FineTuningJob[];\r\n}\r\n\r\n/**\r\n * Cancel a fine-tuning job\r\n */\r\nexport async function cancelFineTuningJob(jobId: string) {\r\n  try {\r\n    const response = await openai.fineTuning.jobs.cancel(jobId);\r\n    \r\n    // Update the job in the database\r\n    const supabase = getSupabaseClient(); // Assumes this client works in Edge/Browser\r\n    await supabase.from('fine_tuning_jobs').update({\r\n      status: response.status,\r\n    }).eq('id', jobId);\r\n\r\n    return {\r\n      status: response.status,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error canceling fine-tuning job:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all fine-tuned models\r\n */\r\nexport async function listFineTunedModels() {\r\n  const supabase = getSupabaseClient(); // Assumes this client works in Edge/Browser\r\n  const { data, error } = await supabase\r\n    .from('fine_tuning_jobs')\r\n    .select('*')\r\n    .eq('status', 'succeeded')\r\n    .is('fine_tuned_model', 'not.null')\r\n    .order('created_at', { ascending: false });\r\n\r\n  if (error) {\r\n    console.error('Error listing fine-tuned models:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data as FineTuningJob[];\r\n}\r\n\r\n/**\r\n * Update models list with fine-tuned models\r\n */\r\n// NOTE: This function was removed as it seems specific to the context of the original service file\r\n// and likely belongs elsewhere (e.g., in models.ts or triggered by an API call).\r\n// export async function registerFineTunedModelsInSystem() {\r\n//   const fineTunedModels = await listFineTunedModels();\r\n//   \r\n//   // Logic to register models in the system\r\n//   // This would update your models registry to include the fine-tuned models\r\n//   return fineTunedModels;\r\n// } ","module.exports = require(\"net\");","module.exports = require(\"events\");","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 96708;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 97108;\nmodule.exports = webpackEmptyContext;"],"names":["browserClientInstance","fetch","ponyfetch","fetchPonyfill","supabaseUrl","process","supabaseAnonKey","serviceRoleKey","env","SUPABASE_SERVICE_ROLE_KEY","anonymousHeaders","apikey","undefined","serviceHeaders","checkPublicEnvVars","console","error","g","globalThis","__USING_PONYFETCH__","getSupabaseBrowserClient","_createBrowserClient","global","headers","createClient","createSupabaseServerClient","cookieStore","_createServerClient","cookies","get","name","value","set","options","warn","remove","createSupabaseServiceClient","Error","createSupabaseClient","auth","autoRefreshToken","persistSession","createEdgeClient","cookieHeader","request","match","createServiceClient","supabase","getTrainingDataForFineTuning","category","minRating","limit","query","getSupabaseClient","from","select","gte","order","ascending","eq","data","trainingData","flatMap","item","training_pairs","exportTrainingDataForOpenAI","map","pair","JSON","stringify","messages","role","content","input","output","join","z","sessionId","rating","min","max","feedback","optional","isHelpful","openai","OpenAI","apiKey","OPENAI_API_KEY","createFineTuningJob","jsonlData","tempDir","path","cwd","fs","recursive","tempFile","Date","now","file","files","create","purpose","response","fineTuning","jobs","training_file","id","model","suffix","insert","status","fine_tuned_model","created_at","toISOString","finished_at","metadata","hyperparameters","jobId","getAuthenticatedUser","createServerSupabaseClientForApiRoute","createServerClient","user","userError","getUser","fullName","user_metadata","full_name","avatarUrl","avatar_url","runtime","dynamic","CreateJobSchema","JobIdSchema","GET","isAdmin","NextResponse","json","listFineTuningJobs","POST","body","parse","result","details","format","PATCH","checkFineTuningJobStatus","DELETE","url","URL","cancelFineTuningJob","serverComponentModule.GET","serverComponentModule.PUT","serverComponentModule.PATCH","serverComponentModule.DELETE","serverComponentModule.HEAD","serverComponentModule.OPTIONS","envSchema","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","NEXT_PUBLIC_APP_URL","STRIPE_SECRET_KEY","STRIPE_WEBHOOK_SECRET","ANTHROPIC_API_KEY","GOOGLE_AI_API_KEY","NEXT_PUBLIC_ANALYTICS_ID","parseEnv","parsed","safeParse","success","flatten","fieldErrors","nullable","retrieve","update","message","fineTunedModel","finishedAt","cancel"],"sourceRoot":""}