{"version":3,"file":"../app/(ai-unified)/api/document/route.js","mappings":"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","sources":["webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/after-task-async-storage.external.js\"","webpack://@hijraah/web/external commonjs2 \"module\"","webpack://@hijraah/web/external commonjs \"next/dist/compiled/next-server/app-page.runtime.prod.js\"","webpack://@hijraah/web/external commonjs2 \"punycode\"","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/action-async-storage.external.js\"","webpack://@hijraah/web/external commonjs2 \"process\"","webpack://@hijraah/web/external commonjs2 \"os\"","webpack://@hijraah/web/?07cb","webpack://@hijraah/web/external commonjs2 \"stream\"","webpack://@hijraah/web/external commonjs2 \"util\"","webpack://@hijraah/web/external commonjs2 \"fs\"","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/work-async-storage.external.js\"","webpack://@hijraah/web/external node-commonjs \"node:child_process\"","webpack://@hijraah/web/external commonjs2 \"path\"","webpack://@hijraah/web/external commonjs2 \"tls\"","webpack://@hijraah/web/src/app/(ai-unified)/api/document/route.ts","webpack://@hijraah/web/sentry-wrapper-module","webpack://@hijraah/web/external commonjs2 \"diagnostics_channel\"","webpack://@hijraah/web/external node-commonjs \"node:http\"","webpack://@hijraah/web/external node-commonjs \"node:zlib\"","webpack://@hijraah/web/external node-commonjs \"node:tls\"","webpack://@hijraah/web/external node-commonjs \"node:https\"","webpack://@hijraah/web/external commonjs \"next/dist/compiled/next-server/app-route.runtime.prod.js\"","webpack://@hijraah/web/external node-commonjs \"node:os\"","webpack://@hijraah/web/external node-commonjs \"node:diagnostics_channel\"","webpack://@hijraah/web/external commonjs2 \"crypto\"","webpack://@hijraah/web/external commonjs2 \"https\"","webpack://@hijraah/web/external node-commonjs \"node:stream\"","webpack://@hijraah/web/external node-commonjs \"node:util\"","webpack://@hijraah/web/external commonjs \"next/dist/server/app-render/work-unit-async-storage.external.js\"","webpack://@hijraah/web/external node-commonjs \"node:fs\"","webpack://@hijraah/web/external commonjs2 \"worker_threads\"","webpack://@hijraah/web/external commonjs2 \"zlib\"","webpack://@hijraah/web/external commonjs2 \"perf_hooks\"","webpack://@hijraah/web/external node-commonjs \"node:worker_threads\"","webpack://@hijraah/web/external node-commonjs \"node:path\"","webpack://@hijraah/web/external node-commonjs \"node:net\"","webpack://@hijraah/web/external node-commonjs \"node:crypto\"","webpack://@hijraah/web/external commonjs2 \"buffer\"","webpack://@hijraah/web/external commonjs2 \"url\"","webpack://@hijraah/web/external commonjs2 \"child_process\"","webpack://@hijraah/web/external node-commonjs \"node:readline\"","webpack://@hijraah/web/external commonjs2 \"http\"","webpack://@hijraah/web/external commonjs2 \"tty\"","webpack://@hijraah/web/external commonjs2 \"async_hooks\"","webpack://@hijraah/web/external module \"ai\"","webpack://@hijraah/web/external node-commonjs \"node:inspector\"","webpack://@hijraah/web/external commonjs2 \"net\"","webpack://@hijraah/web/external commonjs2 \"events\""],"sourcesContent":["module.exports = require(\"next/dist/server/app-render/after-task-async-storage.external.js\");","module.exports = require(\"module\");","module.exports = require(\"next/dist/compiled/next-server/app-page.runtime.prod.js\");","module.exports = require(\"punycode\");","module.exports = require(\"next/dist/server/app-render/action-async-storage.external.js\");","module.exports = require(\"process\");","module.exports = require(\"os\");","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\(ai-unified)\\\\api\\\\document\\\\route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/(ai-unified)/api/document/route\",\n        pathname: \"/api/document\",\n        filename: \"route\",\n        bundlePath: \"app/(ai-unified)/api/document/route\"\n    },\n    resolvedPagePath: \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\(ai-unified)\\\\api\\\\document\\\\route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","module.exports = require(\"stream\");","module.exports = require(\"util\");","module.exports = require(\"fs\");","module.exports = require(\"next/dist/server/app-render/work-async-storage.external.js\");","module.exports = require(\"node:child_process\");","module.exports = require(\"path\");","module.exports = require(\"tls\");","import type { ArtifactType } from \"@/types/artifact\"; // Correct type for supabase queries\r\nimport { auth } from \"@/lib/auth\"; // Adjusted path\r\nimport {\r\n  deleteDocumentsByIdAfterTimestamp,\r\n  getDocumentsById,\r\n  saveDocument,\r\n} from \"@/supabase/queries\"; // Using path alias\r\n\r\nexport async function GET(request: Request) {\r\n  const { searchParams } = new URL(request.url);\r\n  const id = searchParams.get(\"id\");\r\n\r\n  if (!id) {\r\n    return new Response(\"Missing id\", { status: 400 });\r\n  }\r\n\r\n  const session = await auth();\r\n\r\n  if (!session?.user?.id) {\r\n    return new Response(\"Unauthorized\", { status: 401 });\r\n  }\r\n\r\n  const documents = await getDocumentsById({ id });\r\n\r\n  const [document] = documents;\r\n\r\n  if (!document) {\r\n    return new Response(\"Not found\", { status: 404 });\r\n  }\r\n\r\n  if (document.userId !== session.user.id) {\r\n    return new Response(\"Forbidden\", { status: 403 });\r\n  }\r\n\r\n  return Response.json(documents, { status: 200 });\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  const { searchParams } = new URL(request.url);\r\n  const id = searchParams.get(\"id\");\r\n\r\n  if (!id) {\r\n    return new Response(\"Missing id\", { status: 400 });\r\n  }\r\n\r\n  const session = await auth();\r\n\r\n  if (!session?.user?.id) {\r\n    return new Response(\"Unauthorized\", { status: 401 });\r\n  }\r\n\r\n  const {\r\n    content,\r\n    title,\r\n    kind,\r\n  }: { content: string; title: string; kind: ArtifactType } =\r\n    await request.json();\r\n\r\n  const documents = await getDocumentsById({ id });\r\n\r\n  if (documents.length > 0) {\r\n    const [document] = documents;\r\n\r\n    if (document.userId !== session.user.id) {\r\n      return new Response(\"Forbidden\", { status: 403 });\r\n    }\r\n  }\r\n\r\n  const document = await saveDocument({\r\n    id,\r\n    content,\r\n    title,\r\n    kind,\r\n    userId: session.user.id,\r\n  });\r\n\r\n  return Response.json(document, { status: 200 });\r\n}\r\n\r\nexport async function DELETE(request: Request) {\r\n  const { searchParams } = new URL(request.url);\r\n  const id = searchParams.get(\"id\");\r\n  const timestamp = searchParams.get(\"timestamp\");\r\n\r\n  if (!id) {\r\n    return new Response(\"Missing id\", { status: 400 });\r\n  }\r\n\r\n  if (!timestamp) {\r\n    return new Response(\"Missing timestamp\", { status: 400 });\r\n  }\r\n\r\n  const session = await auth();\r\n\r\n  if (!session?.user?.id) {\r\n    return new Response(\"Unauthorized\", { status: 401 });\r\n  }\r\n\r\n  const documents = await getDocumentsById({ id });\r\n\r\n  const [document] = documents;\r\n\r\n  if (document.userId !== session.user.id) {\r\n    return new Response(\"Unauthorized\", { status: 401 });\r\n  }\r\n\r\n  const documentsDeleted = await deleteDocumentsByIdAfterTimestamp({\r\n    id,\r\n    timestamp: new Date(timestamp),\r\n  });\r\n\r\n  return Response.json(documentsDeleted, { status: 200 });\r\n}\r\n","import * as origModule from 'next/dist/server/app-render/work-unit-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport {} from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nimport * as Sentry from '@sentry/nextjs';\n\n// @ts-expect-error Because we cannot be sure if the RequestAsyncStorage module exists (it is not part of the Next.js public\n// API) we use a shim if it doesn't exist. The logic for this is in the wrapping loader.\n\nconst asyncStorageModule = { ...origModule } ;\n\nconst requestAsyncStorage =\n  'workUnitAsyncStorage' in asyncStorageModule\n    ? asyncStorageModule.workUnitAsyncStorage\n    : 'requestAsyncStorage' in asyncStorageModule\n      ? asyncStorageModule.requestAsyncStorage\n      : undefined;\n\nfunction wrapHandler(handler, method) {\n  // Running the instrumentation code during the build phase will mark any function as \"dynamic\" because we're accessing\n  // the Request object. We do not want to turn handlers dynamic so we skip instrumentation in the build phase.\n  if (process.env.NEXT_PHASE === 'phase-production-build') {\n    return handler;\n  }\n\n  if (typeof handler !== 'function') {\n    return handler;\n  }\n\n  return new Proxy(handler, {\n    apply: (originalFunction, thisArg, args) => {\n      let headers = undefined;\n\n      // We try-catch here just in case the API around `requestAsyncStorage` changes unexpectedly since it is not public API\n      try {\n        const requestAsyncStore = requestAsyncStorage?.getStore() ;\n        headers = requestAsyncStore?.headers;\n      } catch (e) {\n        /** empty */\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return Sentry.wrapRouteHandlerWithSentry(originalFunction , {\n        method,\n        parameterizedRoute: '/(ai-unified)/api/document',\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst GET = wrapHandler(serverComponentModule.GET , 'GET');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst POST = wrapHandler(serverComponentModule.POST , 'POST');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PUT = wrapHandler(serverComponentModule.PUT , 'PUT');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PATCH = wrapHandler(serverComponentModule.PATCH , 'PATCH');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst DELETE = wrapHandler(serverComponentModule.DELETE , 'DELETE');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst HEAD = wrapHandler(serverComponentModule.HEAD , 'HEAD');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst OPTIONS = wrapHandler(serverComponentModule.OPTIONS , 'OPTIONS');\n\nexport { DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT };\n","module.exports = require(\"diagnostics_channel\");","module.exports = require(\"node:http\");","module.exports = require(\"node:zlib\");","module.exports = require(\"node:tls\");","module.exports = require(\"node:https\");","module.exports = require(\"next/dist/compiled/next-server/app-route.runtime.prod.js\");","module.exports = require(\"node:os\");","module.exports = require(\"node:diagnostics_channel\");","module.exports = require(\"crypto\");","module.exports = require(\"https\");","module.exports = require(\"node:stream\");","module.exports = require(\"node:util\");","module.exports = require(\"next/dist/server/app-render/work-unit-async-storage.external.js\");","module.exports = require(\"node:fs\");","module.exports = require(\"worker_threads\");","module.exports = require(\"zlib\");","module.exports = require(\"perf_hooks\");","module.exports = require(\"node:worker_threads\");","module.exports = require(\"node:path\");","module.exports = require(\"node:net\");","module.exports = require(\"node:crypto\");","module.exports = require(\"buffer\");","module.exports = require(\"url\");","module.exports = require(\"child_process\");","module.exports = require(\"node:readline\");","module.exports = require(\"http\");","module.exports = require(\"tty\");","module.exports = require(\"async_hooks\");","module.exports = import(\"ai\");;","module.exports = require(\"node:inspector\");","module.exports = require(\"net\");","module.exports = require(\"events\");"],"names":["GET","request","searchParams","URL","url","id","get","Response","status","session","auth","user","documents","getDocumentsById","document","json","POST","content","title","kind","length","userId","saveDocument","DELETE","timestamp","documentsDeleted","deleteDocumentsByIdAfterTimestamp","Date","serverComponentModule.GET","serverComponentModule.PUT","serverComponentModule.PATCH","serverComponentModule.DELETE","serverComponentModule.HEAD","serverComponentModule.OPTIONS"],"sourceRoot":""}