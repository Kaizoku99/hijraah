# Hijraah Email Templates

This directory contains React-based email templates for the Hijraah application. These templates are designed to be used with Supabase authentication flows.

## Available Templates

- **PasswordReset**: For password reset emails
- **EmailConfirmation**: For confirming user email addresses during signup
- **MagicLink**: For passwordless authentication via magic links
- **EmailChange**: For confirming email address changes
- **UserInvitation**: For inviting users to join an organization

## Integration with Supabase

There are two main approaches to using these templates with Supabase:

### 1. Using the Supabase Dashboard

You can manually copy the HTML generated by these templates into the Supabase Dashboard:

1. Go to **Authentication** > **Email Templates** in your Supabase project dashboard
2. Select the template you want to customize
3. Copy the HTML from the `renderToStaticMarkup` function output for the corresponding template
4. Paste it into the template editor in the dashboard

### 2. Using Supabase Edge Functions (Recommended)

For a more programmatic approach, you can use Supabase Edge Functions:

1. Deploy the edge function from `supabase/functions/custom-email/index.ts`
2. Configure your Supabase project to use this function for email templates:
   - Go to **Authentication** > **URL Configuration** in your project dashboard
   - Set the **Custom Email Template Callback URL** to your deployed edge function URL

## Using the Email Templates in Your Code

```tsx
import { renderToStaticMarkup } from "react-dom/server";
import { PasswordReset } from "@/emails";

// Example: Generate password reset email HTML
const html = renderToStaticMarkup(
  <PasswordReset
    actionUrl="https://example.com/reset-password?token=xyz"
    email="user@example.com"
    name="John Doe"
  />,
);

// Now you can use the HTML in your email sending service
```

## Email Handler Utility

The `supabaseEmailHandler.ts` file provides a utility function that can be used to generate HTML for different email types based on Supabase's metadata structure.

This is particularly useful for implementing the edge function approach mentioned above.

## Development

To add or modify email templates:

1. Create a new template file in `src/emails/templates/`
2. Export it in `src/emails/index.ts`
3. Add handling for the new template in `supabaseEmailHandler.ts` if needed
4. Update the edge function to support the new template type

## Edge Function Implementation

The edge function implementation uses Deno and React to generate HTML on demand. Due to the limitations of Deno's environment, the edge function includes simplified versions of the email templates.

If you update the React templates, you'll need to update the edge function implementation as well.
