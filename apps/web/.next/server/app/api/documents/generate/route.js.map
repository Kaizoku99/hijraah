{"version":3,"file":"app/api/documents/generate/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/./src/lib/openai.ts","webpack://_N_E/src/app/api/documents/generate/route.ts","webpack://_N_E/sentry-wrapper-module","webpack://_N_E/./src/app/api/documents/generate/route.ts","webpack://_N_E/?aece"],"sourcesContent":["module.exports = require(\"node:buffer\");","module.exports = require(\"node:async_hooks\");","import OpenAI from 'openai';\r\n\r\n// Initialize the OpenAI client\r\nexport const openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\n/**\r\n * Generate an embedding for a given text\r\n * @param text - The text to generate an embedding for\r\n * @returns A vector of floating point numbers\r\n */\r\nexport async function generateEmbedding(text: string): Promise<number[]> {\r\n  try {\r\n    // Clean and prepare the text\r\n    const input = text.replace(/\\n/g, ' ').trim();\r\n    \r\n    // Generate embedding with text-embedding-3-small model\r\n    const response = await openai.embeddings.create({\r\n      model: 'text-embedding-3-small',\r\n      input,\r\n      dimensions: 1536,\r\n    });\r\n\r\n    // Return the embedding vector\r\n    return response.data[0].embedding;\r\n  } catch (error) {\r\n    console.error('Error generating embedding:', error);\r\n    throw new Error('Failed to generate text embedding');\r\n  }\r\n}\r\n\r\n/**\r\n * Extract content from an artifact for embedding purposes\r\n * @param artifact - The document artifact \r\n * @returns Processed text suitable for embedding\r\n */\r\nexport function getTextForEmbedding(artifact: any): string {\r\n  const content = artifact.content?.text || '';\r\n  const title = artifact.title || '';\r\n  const description = artifact.description || '';\r\n  \r\n  // Combine the title, description, and content for a comprehensive embedding\r\n  return `Title: ${title}\\nDescription: ${description}\\nContent: ${content}`;\r\n} ","import { zValidator } from \"@hono/zod-validator\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\nimport { Hono } from \"hono\";\r\nimport { cors } from \"hono/cors\";\r\nimport { handle } from \"hono/vercel\";\r\nimport { z } from \"zod\";\r\n\r\nimport { openai } from \"@/lib/openai\"; // Assuming this uses the official openai package\r\n\r\n// Initialize Supabase client\r\nconst supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);\r\n\r\n// --- Templates --- //\r\n// (Keep the existing documentTemplates object here)\r\nconst documentTemplates = {\r\n  \"cover-letter\": {\r\n    system: `You are a professional immigration document writer...`,\r\n  },\r\n  \"personal-statement\": {\r\n    system: `You are a professional immigration document writer...`,\r\n  },\r\n  \"legal-brief\": {\r\n    system: `You are a professional immigration legal expert...`,\r\n  },\r\n  affidavit: {\r\n    system: `You are a professional immigration document writer...`,\r\n  },\r\n};\r\ntype DocumentTemplate = keyof typeof documentTemplates;\r\n\r\n// --- Schemas --- //\r\nconst GenerateRequestSchema = z.object({\r\n  prompt: z.string().min(1, \"Prompt is required\"),\r\n  template: z.enum(\r\n    Object.keys(documentTemplates) as [DocumentTemplate, ...DocumentTemplate[]]\r\n  ),\r\n  additionalContext: z.string().optional(),\r\n  userId: z.string().uuid().optional(), // Optional: client might handle auth separately\r\n});\r\n\r\n// --- Hono App Setup --- //\r\nconst app = new Hono();\r\n\r\n// --- Middleware --- //\r\napp.use(\"*\", cors());\r\n// TODO: Add proper session/user authentication middleware\r\n\r\n// --- Route --- //\r\napp.post(\"/\", zValidator(\"json\", GenerateRequestSchema), async (c) => {\r\n  const { prompt, template, additionalContext, userId } = c.req.valid(\"json\");\r\n  // TODO: Replace placeholder userId with one from auth middleware if implemented\r\n  const effectiveUserId = userId || \"placeholder-user-from-auth\";\r\n\r\n  const selectedTemplate = documentTemplates[template]; // Type checked by schema\r\n\r\n  const messages = [\r\n    {\r\n      role: \"system\" as const,\r\n      content: selectedTemplate.system,\r\n    },\r\n    {\r\n      role: \"user\" as const,\r\n      content: `Generate a ${template} with the following details:\\n\\n${prompt}${additionalContext ? `\\n\\nAdditional context: ${additionalContext}` : \"\"}`,\r\n    },\r\n  ];\r\n\r\n  try {\r\n    console.log(\r\n      `[Generate Doc API] Request for template: ${template}, User: ${effectiveUserId}`\r\n    );\r\n    // Call OpenAI\r\n    const completion = await openai.chat.completions.create({\r\n      model: \"gpt-4\", // Consider making model configurable\r\n      messages,\r\n      temperature: 0.7,\r\n    });\r\n\r\n    const generatedText = completion.choices[0]?.message?.content;\r\n\r\n    if (!generatedText) {\r\n      console.error(\"[Generate Doc API] OpenAI returned no content.\");\r\n      return c.json({ error: \"Failed to generate document content\" }, 502); // Bad Gateway\r\n    }\r\n\r\n    let saved = false;\r\n    if (effectiveUserId !== \"placeholder-user-from-auth\") {\r\n      // Only save if real userId\r\n      try {\r\n        const { error: insertError } = await supabaseAdmin\r\n          .from(\"artifacts\")\r\n          .insert({\r\n            user_id: effectiveUserId,\r\n            title: `AI-Generated ${template.replace(\"-\", \" \").replace(/\\b\\w/g, (l: string) => l.toUpperCase())}`,\r\n            description:\r\n              prompt.substring(0, 100) + (prompt.length > 100 ? \"...\" : \"\"),\r\n            content: {\r\n              text: generatedText,\r\n              format: \"markdown\", // Assuming markdown format\r\n            },\r\n            type: \"document\",\r\n            visibility: \"private\",\r\n            needs_embedding: true,\r\n            metadata: {\r\n              template,\r\n              generated_at: new Date().toISOString(),\r\n              prompt,\r\n            },\r\n          });\r\n        if (insertError) throw insertError;\r\n        saved = true;\r\n        console.log(\r\n          `[Generate Doc API] Saved artifact for user ${effectiveUserId}`\r\n        );\r\n      } catch (dbError) {\r\n        console.error(\"[Generate Doc API] Error saving artifact:\", dbError);\r\n        // Don't fail the request, just note that saving failed\r\n      }\r\n    }\r\n\r\n    // Return generated text\r\n    return c.json({ text: generatedText, saved });\r\n  } catch (error) {\r\n    console.error(\"[Generate Doc API] Error:\", error);\r\n    const message =\r\n      error instanceof Error\r\n        ? error.message\r\n        : \"Unknown error generating document\";\r\n    return c.json({ error: message }, { status: 500 });\r\n  }\r\n});\r\n\r\n// --- Export Hono App --- //\r\nexport const POST = handle(app);\r\n\r\n// Optional: Specify runtime\r\nexport const runtime = \"edge\";\r\n","import * as origModule from 'next/dist/server/app-render/work-unit-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport {} from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nimport * as Sentry from '@sentry/nextjs';\n\n// @ts-expect-error Because we cannot be sure if the RequestAsyncStorage module exists (it is not part of the Next.js public\n// API) we use a shim if it doesn't exist. The logic for this is in the wrapping loader.\n\nconst asyncStorageModule = { ...origModule } ;\n\nconst requestAsyncStorage =\n  'workUnitAsyncStorage' in asyncStorageModule\n    ? asyncStorageModule.workUnitAsyncStorage\n    : 'requestAsyncStorage' in asyncStorageModule\n      ? asyncStorageModule.requestAsyncStorage\n      : undefined;\n\nfunction wrapHandler(handler, method) {\n  // Running the instrumentation code during the build phase will mark any function as \"dynamic\" because we're accessing\n  // the Request object. We do not want to turn handlers dynamic so we skip instrumentation in the build phase.\n  if (process.env.NEXT_PHASE === 'phase-production-build') {\n    return handler;\n  }\n\n  if (typeof handler !== 'function') {\n    return handler;\n  }\n\n  return new Proxy(handler, {\n    apply: (originalFunction, thisArg, args) => {\n      let headers = undefined;\n\n      // We try-catch here just in case the API around `requestAsyncStorage` changes unexpectedly since it is not public API\n      try {\n        const requestAsyncStore = requestAsyncStorage?.getStore() ;\n        headers = requestAsyncStore?.headers;\n      } catch (e) {\n        /** empty */\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return Sentry.wrapRouteHandlerWithSentry(originalFunction , {\n        method,\n        parameterizedRoute: '/api/documents/generate',\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst GET = wrapHandler(serverComponentModule.GET , 'GET');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst POST = wrapHandler(serverComponentModule.POST , 'POST');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PUT = wrapHandler(serverComponentModule.PUT , 'PUT');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PATCH = wrapHandler(serverComponentModule.PATCH , 'PATCH');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst DELETE = wrapHandler(serverComponentModule.DELETE , 'DELETE');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst HEAD = wrapHandler(serverComponentModule.HEAD , 'HEAD');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst OPTIONS = wrapHandler(serverComponentModule.OPTIONS , 'OPTIONS');\n\nexport { DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT };\n","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\api\\\\documents\\\\generate\\\\route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/documents/generate/route\",\n        pathname: \"/api/documents/generate\",\n        filename: \"route\",\n        bundlePath: \"app/api/documents/generate/route\"\n    },\n    resolvedPagePath: \"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\src\\\\app\\\\api\\\\documents\\\\generate\\\\route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","var _self___RSC_MANIFEST;\nimport { createServerModuleMap } from \"next/dist/server/app-render/action-utils\";\nimport { setReferenceManifestsSingleton } from \"next/dist/server/app-render/encryption-utils\";\nimport { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Fdocuments%2Fgenerate%2Froute&page=%2Fapi%2Fdocuments%2Fgenerate%2Froute&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Fgenerate%2Froute.ts&appDir=E%3A%5Cdownloads%5CHijraah%5Capps%5Cweb%5Csrc%5Capp&appPaths=%2Fapi%2Fdocuments%2Fgenerate%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/documents/generate/route.ts?__next_edge_ssr_entry__\";\nconst nextConfig = {\"env\":{\"_sentryRewriteFramesDistDir\":\".next\",\"_sentryRewriteFramesAssetPrefixPath\":\"\",\"_sentryRewritesTunnelPath\":\"/monitoring\",\"_sentryRelease\":\"d92a5e8d8d7c20e1f785b33fde2c15257fdb31d2\"},\"eslint\":{\"ignoreDuringBuilds\":false,\"dirs\":[\"src\",\"app\",\"config\",\"scripts\",\"__tests__\"]},\"typescript\":{\"ignoreBuildErrors\":true,\"tsconfigPath\":\"tsconfig.json\"},\"distDir\":\".next\",\"cleanDistDir\":true,\"assetPrefix\":\"\",\"cacheMaxMemorySize\":52428800,\"configOrigin\":\"next.config.mjs\",\"useFileSystemPublicRoutes\":true,\"generateEtags\":true,\"pageExtensions\":[\"tsx\",\"ts\",\"jsx\",\"js\"],\"poweredByHeader\":false,\"compress\":true,\"images\":{\"deviceSizes\":[640,750,828,1080,1200,1920,2048,3840],\"imageSizes\":[16,32,48,64,96,128,256,384],\"path\":\"/_next/image\",\"loader\":\"default\",\"loaderFile\":\"\",\"domains\":[\"images.unsplash.com\",\"cdn.sanity.io\"],\"disableStaticImages\":false,\"minimumCacheTTL\":60,\"formats\":[\"image/webp\"],\"dangerouslyAllowSVG\":false,\"contentSecurityPolicy\":\"script-src 'none'; frame-src 'none'; sandbox;\",\"contentDispositionType\":\"attachment\",\"remotePatterns\":[{\"protocol\":\"https\",\"hostname\":\"**\"}],\"unoptimized\":false},\"devIndicators\":{\"position\":\"bottom-left\"},\"onDemandEntries\":{\"maxInactiveAge\":60000,\"pagesBufferLength\":5},\"amp\":{\"canonicalBase\":\"\"},\"basePath\":\"\",\"sassOptions\":{},\"trailingSlash\":false,\"i18n\":null,\"productionBrowserSourceMaps\":false,\"excludeDefaultMomentLocales\":true,\"serverRuntimeConfig\":{},\"publicRuntimeConfig\":{},\"reactProductionProfiling\":false,\"reactStrictMode\":true,\"reactMaxHeadersLength\":6000,\"httpAgentOptions\":{\"keepAlive\":true},\"logging\":{\"fetches\":{\"fullUrl\":true}},\"expireTime\":31536000,\"staticPageGenerationTimeout\":60,\"modularizeImports\":{\"@mui/icons-material\":{\"transform\":\"@mui/icons-material/{{member}}\"},\"lodash\":{\"transform\":\"lodash/{{member}}\"}},\"outputFileTracingRoot\":\"E:\\\\downloads\\\\Hijraah\",\"experimental\":{\"nodeMiddleware\":false,\"cacheLife\":{\"default\":{\"stale\":300,\"revalidate\":900,\"expire\":4294967294},\"seconds\":{\"stale\":0,\"revalidate\":1,\"expire\":60},\"minutes\":{\"stale\":300,\"revalidate\":60,\"expire\":3600},\"hours\":{\"stale\":300,\"revalidate\":3600,\"expire\":86400},\"days\":{\"stale\":300,\"revalidate\":86400,\"expire\":604800},\"weeks\":{\"stale\":300,\"revalidate\":604800,\"expire\":2592000},\"max\":{\"stale\":300,\"revalidate\":2592000,\"expire\":4294967294}},\"cacheHandlers\":{},\"cssChunking\":true,\"multiZoneDraftMode\":false,\"appNavFailHandling\":false,\"prerenderEarlyExit\":true,\"serverMinification\":true,\"serverSourceMaps\":false,\"linkNoTouchStart\":false,\"caseSensitiveRoutes\":false,\"clientSegmentCache\":false,\"preloadEntriesOnStart\":true,\"clientRouterFilter\":true,\"clientRouterFilterRedirects\":false,\"fetchCacheKeyPrefix\":\"\",\"middlewarePrefetch\":\"flexible\",\"optimisticClientCache\":true,\"manualClientBasePath\":false,\"cpus\":11,\"memoryBasedWorkersCount\":false,\"imgOptConcurrency\":null,\"imgOptTimeoutInSeconds\":7,\"imgOptMaxInputPixels\":268402689,\"imgOptSequentialRead\":null,\"isrFlushToDisk\":true,\"workerThreads\":false,\"optimizeCss\":true,\"nextScriptWorkers\":false,\"scrollRestoration\":false,\"externalDir\":false,\"disableOptimizedLoading\":false,\"gzipSize\":true,\"craCompat\":false,\"esmExternals\":true,\"fullySpecified\":false,\"swcTraceProfiling\":false,\"forceSwcTransforms\":false,\"largePageDataBytes\":128000,\"turbo\":{\"root\":\"E:\\\\downloads\\\\Hijraah\"},\"typedRoutes\":false,\"typedEnv\":false,\"clientTraceMetadata\":[\"baggage\",\"sentry-trace\"],\"parallelServerCompiles\":false,\"parallelServerBuildTraces\":false,\"ppr\":false,\"authInterrupts\":false,\"webpackMemoryOptimizations\":false,\"optimizeServerReact\":true,\"useEarlyImport\":false,\"viewTransition\":false,\"staleTimes\":{\"dynamic\":0,\"static\":300},\"serverComponentsHmrCache\":true,\"staticGenerationMaxConcurrency\":8,\"staticGenerationMinPagesPerWorker\":25,\"dynamicIO\":false,\"inlineCss\":false,\"useCache\":false,\"serverActions\":{\"bodySizeLimit\":\"2mb\",\"allowedOrigins\":[\"localhost:3000\"]},\"optimizePackageImports\":[\"lucide-react\",\"@radix-ui/react-icons\",\"date-fns\",\"lodash\",\"lodash-es\",\"ramda\",\"antd\",\"react-bootstrap\",\"ahooks\",\"@ant-design/icons\",\"@headlessui/react\",\"@headlessui-float/react\",\"@heroicons/react/20/solid\",\"@heroicons/react/24/solid\",\"@heroicons/react/24/outline\",\"@visx/visx\",\"@tremor/react\",\"rxjs\",\"@mui/material\",\"@mui/icons-material\",\"recharts\",\"react-use\",\"effect\",\"@effect/schema\",\"@effect/platform\",\"@effect/platform-node\",\"@effect/platform-browser\",\"@effect/platform-bun\",\"@effect/sql\",\"@effect/sql-mssql\",\"@effect/sql-mysql2\",\"@effect/sql-pg\",\"@effect/sql-squlite-node\",\"@effect/sql-squlite-bun\",\"@effect/sql-squlite-wasm\",\"@effect/sql-squlite-react-native\",\"@effect/rpc\",\"@effect/rpc-http\",\"@effect/typeclass\",\"@effect/experimental\",\"@effect/opentelemetry\",\"@material-ui/core\",\"@material-ui/icons\",\"@tabler/icons-react\",\"mui-core\",\"react-icons/ai\",\"react-icons/bi\",\"react-icons/bs\",\"react-icons/cg\",\"react-icons/ci\",\"react-icons/di\",\"react-icons/fa\",\"react-icons/fa6\",\"react-icons/fc\",\"react-icons/fi\",\"react-icons/gi\",\"react-icons/go\",\"react-icons/gr\",\"react-icons/hi\",\"react-icons/hi2\",\"react-icons/im\",\"react-icons/io\",\"react-icons/io5\",\"react-icons/lia\",\"react-icons/lib\",\"react-icons/lu\",\"react-icons/md\",\"react-icons/pi\",\"react-icons/ri\",\"react-icons/rx\",\"react-icons/si\",\"react-icons/sl\",\"react-icons/tb\",\"react-icons/tfi\",\"react-icons/ti\",\"react-icons/vsc\",\"react-icons/wi\"]},\"htmlLimitedBots\":\"Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\",\"bundlePagesRouterDependencies\":false,\"configFile\":\"E:\\\\downloads\\\\Hijraah\\\\apps\\\\web\\\\next.config.mjs\",\"configFileName\":\"next.config.mjs\",\"serverExternalPackages\":[\"pdf-parse\",\"ai\",\"amqplib\",\"connect\",\"dataloader\",\"express\",\"generic-pool\",\"graphql\",\"@hapi/hapi\",\"ioredis\",\"kafkajs\",\"koa\",\"lru-memoizer\",\"mongodb\",\"mongoose\",\"mysql\",\"mysql2\",\"knex\",\"pg\",\"pg-pool\",\"@node-redis/client\",\"@redis/client\",\"redis\",\"tedious\"],\"compiler\":{\"removeConsole\":{\"exclude\":[\"error\",\"warn\"]}},\"_originalRewrites\":{\"beforeFiles\":[],\"afterFiles\":[{\"source\":\"/monitoring(/?)\",\"has\":[{\"type\":\"query\",\"key\":\"o\",\"value\":\"(?<orgid>\\\\d*)\"},{\"type\":\"query\",\"key\":\"p\",\"value\":\"(?<projectid>\\\\d*)\"},{\"type\":\"query\",\"key\":\"r\",\"value\":\"(?<region>[a-z]{2})\"}],\"destination\":\"https://o:orgid.ingest.:region.sentry.io/api/:projectid/envelope/?hsts=0\"},{\"source\":\"/monitoring(/?)\",\"has\":[{\"type\":\"query\",\"key\":\"o\",\"value\":\"(?<orgid>\\\\d*)\"},{\"type\":\"query\",\"key\":\"p\",\"value\":\"(?<projectid>\\\\d*)\"}],\"destination\":\"https://o:orgid.ingest.sentry.io/api/:projectid/envelope/?hsts=0\"}],\"fallback\":[]},\"_originalRedirects\":[{\"source\":\"/login\",\"destination\":\"/auth/login\",\"permanent\":true},{\"source\":\"/signup\",\"destination\":\"/auth/signup\",\"permanent\":true}]}\nconst maybeJSONParse = (str)=>str ? JSON.parse(str) : undefined;\nconst rscManifest = (_self___RSC_MANIFEST = self.__RSC_MANIFEST) == null ? void 0 : _self___RSC_MANIFEST[\"/api/documents/generate/route\"];\nconst rscServerManifest = maybeJSONParse(self.__RSC_SERVER_MANIFEST);\nif (rscManifest && rscServerManifest) {\n    setReferenceManifestsSingleton({\n        page: \"/api/documents/generate/route\",\n        clientReferenceManifest: rscManifest,\n        serverActionsManifest: rscServerManifest,\n        serverModuleMap: createServerModuleMap({\n            serverActionsManifest: rscServerManifest\n        })\n    });\n}\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule, {\n    nextConfig\n});\n\n//# sourceMappingURL=edge-app-route.js.map"],"names":["openai","OpenAI","apiKey","process","env","OPENAI_API_KEY","supabaseAdmin","createClient","SUPABASE_SERVICE_ROLE_KEY","documentTemplates","system","affidavit","GenerateRequestSchema","z","prompt","min","template","Object","keys","additionalContext","optional","userId","uuid","app","Hono","use","cors","post","zValidator","c","req","valid","effectiveUserId","messages","role","content","completion","completions","chat","create","model","temperature","generatedText","choices","message","console","error","json","saved","insertError","from","insert","user_id","title","replace","l","toUpperCase","description","substring","length","text","format","type","visibility","needs_embedding","metadata","generated_at","Date","toISOString","dbError","Error","status","POST","handle","serverComponentModule.GET","serverComponentModule.PUT","serverComponentModule.PATCH","serverComponentModule.DELETE","serverComponentModule.HEAD","serverComponentModule.OPTIONS"],"sourceRoot":"","ignoreList":[]}